{"remainingRequest":"/Users/uu/Desktop/ncov_main/node_modules/thread-loader/dist/cjs.js!/Users/uu/Desktop/ncov_main/node_modules/babel-loader/lib/index.js!/Users/uu/Desktop/ncov_main/src/assets/js/echarts-wordcloud.min.js","dependencies":[{"path":"/Users/uu/Desktop/ncov_main/src/assets/js/echarts-wordcloud.min.js","mtime":1591807139000},{"path":"/Users/uu/Desktop/ncov_main/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/uu/Desktop/ncov_main/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/uu/Desktop/ncov_main/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbGwiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5sYXN0LWluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3RvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuY29uc3RydWN0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwZWF0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3ViIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmxvYXQzMi1hcnJheSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmNvcHktd2l0aGluIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZXZlcnkiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maWxsIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmlsdGVyIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbmQtaW5kZXgiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmluY2x1ZGVzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pdGVyYXRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmpvaW4iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5sYXN0LWluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkubWFwIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkucmVkdWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkucmVkdWNlLXJpZ2h0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkucmV2ZXJzZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNldCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc29tZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNvcnQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zdWJhcnJheSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnRvLWxvY2FsZS1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmltbWVkaWF0ZSIpOwoKdmFyIF90eXBlb2YgPSByZXF1aXJlKCIvVXNlcnMvdXUvRGVza3RvcC9uY292X21haW4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIik7CgohZnVuY3Rpb24gKHQsIGUpIHsKICAib2JqZWN0IiA9PSAodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSAmJiAib2JqZWN0IiA9PSAodHlwZW9mIG1vZHVsZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YobW9kdWxlKSkgPyBtb2R1bGUuZXhwb3J0cyA9IGUocmVxdWlyZSgiZWNoYXJ0cyIpKSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsiZWNoYXJ0cyJdLCBlKSA6ICJvYmplY3QiID09ICh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpID8gZXhwb3J0c1siZWNoYXJ0cy13b3JkY2xvdWQiXSA9IGUocmVxdWlyZSgiZWNoYXJ0cyIpKSA6IHRbImVjaGFydHMtd29yZGNsb3VkIl0gPSBlKHQuZWNoYXJ0cyk7Cn0odGhpcywgZnVuY3Rpb24gKHQpIHsKICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgIGZ1bmN0aW9uIGUobikgewogICAgICBpZiAocltuXSkgcmV0dXJuIHJbbl0uZXhwb3J0czsKICAgICAgdmFyIGkgPSByW25dID0gewogICAgICAgIGk6IG4sCiAgICAgICAgbDogITEsCiAgICAgICAgZXhwb3J0czoge30KICAgICAgfTsKICAgICAgcmV0dXJuIHRbbl0uY2FsbChpLmV4cG9ydHMsIGksIGkuZXhwb3J0cywgZSksIGkubCA9ICEwLCBpLmV4cG9ydHM7CiAgICB9CgogICAgdmFyIHIgPSB7fTsKICAgIHJldHVybiBlLm0gPSB0LCBlLmMgPSByLCBlLmQgPSBmdW5jdGlvbiAodCwgciwgbikgewogICAgICBlLm8odCwgcikgfHwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIHIsIHsKICAgICAgICBjb25maWd1cmFibGU6ICExLAogICAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICAgIGdldDogbgogICAgICB9KTsKICAgIH0sIGUubiA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciByID0gdCAmJiB0Ll9fZXNNb2R1bGUgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHQuZGVmYXVsdDsKICAgICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdDsKICAgICAgfTsKICAgICAgcmV0dXJuIGUuZChyLCAiYSIsIHIpLCByOwogICAgfSwgZS5vID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCBlKTsKICAgIH0sIGUucCA9ICIiLCBlKGUucyA9IDI1KTsKICB9KFtmdW5jdGlvbiAodCwgZSkgewogICAgZnVuY3Rpb24gcih0LCBlKSB7CiAgICAgIEdbdF0gPSBlOwogICAgfQoKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICBpZiAobnVsbCA9PSB0IHx8ICJvYmplY3QiICE9IF90eXBlb2YodCkpIHJldHVybiB0OwogICAgICB2YXIgZSA9IHQsCiAgICAgICAgICByID0gVy5jYWxsKHQpOwoKICAgICAgaWYgKCJbb2JqZWN0IEFycmF5XSIgPT09IHIpIHsKICAgICAgICBlID0gW107CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBhID0gdC5sZW5ndGg7IGkgPCBhOyBpKyspIHsKICAgICAgICAgIGVbaV0gPSBuKHRbaV0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChFW3JdKSB7CiAgICAgICAgdmFyIG8gPSB0LmNvbnN0cnVjdG9yOwogICAgICAgIGlmICh0LmNvbnN0cnVjdG9yLmZyb20pIGUgPSBvLmZyb20odCk7ZWxzZSB7CiAgICAgICAgICBlID0gbmV3IG8odC5sZW5ndGgpOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBhID0gdC5sZW5ndGg7IGkgPCBhOyBpKyspIHsKICAgICAgICAgICAgZVtpXSA9IG4odFtpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCFOW3JdICYmICFGKHQpICYmICFUKHQpKSB7CiAgICAgICAgZSA9IHt9OwoKICAgICAgICBmb3IgKHZhciBzIGluIHQpIHsKICAgICAgICAgIHQuaGFzT3duUHJvcGVydHkocykgJiYgKGVbc10gPSBuKHRbc10pKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBlOwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSwgcikgewogICAgICBpZiAoIVMoZSkgfHwgIVModCkpIHJldHVybiByID8gbihlKSA6IHQ7CgogICAgICBmb3IgKHZhciBhIGluIGUpIHsKICAgICAgICBpZiAoZS5oYXNPd25Qcm9wZXJ0eShhKSkgewogICAgICAgICAgdmFyIG8gPSB0W2FdLAogICAgICAgICAgICAgIHMgPSBlW2FdOwogICAgICAgICAgIVMocykgfHwgIVMobykgfHwgdyhzKSB8fCB3KG8pIHx8IFQocykgfHwgVChvKSB8fCBNKHMpIHx8IE0obykgfHwgRihzKSB8fCBGKG8pID8gIXIgJiYgYSBpbiB0IHx8ICh0W2FdID0gbihlW2FdLCAhMCkpIDogaShvLCBzLCByKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGEodCwgZSkgewogICAgICBmb3IgKHZhciByID0gdFswXSwgbiA9IDEsIGEgPSB0Lmxlbmd0aDsgbiA8IGE7IG4rKykgewogICAgICAgIHIgPSBpKHIsIHRbbl0sIGUpOwogICAgICB9CgogICAgICByZXR1cm4gcjsKICAgIH0KCiAgICBmdW5jdGlvbiBvKHQsIGUpIHsKICAgICAgZm9yICh2YXIgciBpbiBlKSB7CiAgICAgICAgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOwogICAgICB9CgogICAgICByZXR1cm4gdDsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIGUsIHIpIHsKICAgICAgZm9yICh2YXIgbiBpbiBlKSB7CiAgICAgICAgZS5oYXNPd25Qcm9wZXJ0eShuKSAmJiAociA/IG51bGwgIT0gZVtuXSA6IG51bGwgPT0gdFtuXSkgJiYgKHRbbl0gPSBlW25dKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gbCgpIHsKICAgICAgcmV0dXJuICQgfHwgKCQgPSBVKCkuZ2V0Q29udGV4dCgiMmQiKSksICQ7CiAgICB9CgogICAgZnVuY3Rpb24gaCh0LCBlKSB7CiAgICAgIGlmICh0KSB7CiAgICAgICAgaWYgKHQuaW5kZXhPZikgcmV0dXJuIHQuaW5kZXhPZihlKTsKCiAgICAgICAgZm9yICh2YXIgciA9IDAsIG4gPSB0Lmxlbmd0aDsgciA8IG47IHIrKykgewogICAgICAgICAgaWYgKHRbcl0gPT09IGUpIHJldHVybiByOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIC0xOwogICAgfQoKICAgIGZ1bmN0aW9uIHUodCwgZSkgewogICAgICBmdW5jdGlvbiByKCkge30KCiAgICAgIHZhciBuID0gdC5wcm90b3R5cGU7CiAgICAgIHIucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIHQucHJvdG90eXBlID0gbmV3IHIoKTsKCiAgICAgIGZvciAodmFyIGkgaW4gbikgewogICAgICAgIHQucHJvdG90eXBlW2ldID0gbltpXTsKICAgICAgfQoKICAgICAgdC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSB0LCB0LnN1cGVyQ2xhc3MgPSBlOwogICAgfQoKICAgIGZ1bmN0aW9uIGModCwgZSwgcikgewogICAgICB0ID0gInByb3RvdHlwZSIgaW4gdCA/IHQucHJvdG90eXBlIDogdCwgZSA9ICJwcm90b3R5cGUiIGluIGUgPyBlLnByb3RvdHlwZSA6IGUsIHModCwgZSwgcik7CiAgICB9CgogICAgZnVuY3Rpb24gZih0KSB7CiAgICAgIGlmICh0KSByZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIHQgJiYgIm51bWJlciIgPT0gdHlwZW9mIHQubGVuZ3RoOwogICAgfQoKICAgIGZ1bmN0aW9uIGQodCwgZSwgcikgewogICAgICBpZiAodCAmJiBlKSBpZiAodC5mb3JFYWNoICYmIHQuZm9yRWFjaCA9PT0gSCkgdC5mb3JFYWNoKGUsIHIpO2Vsc2UgaWYgKHQubGVuZ3RoID09PSArdC5sZW5ndGgpIGZvciAodmFyIG4gPSAwLCBpID0gdC5sZW5ndGg7IG4gPCBpOyBuKyspIHsKICAgICAgICBlLmNhbGwociwgdFtuXSwgbiwgdCk7CiAgICAgIH0gZWxzZSBmb3IgKHZhciBhIGluIHQpIHsKICAgICAgICB0Lmhhc093blByb3BlcnR5KGEpICYmIGUuY2FsbChyLCB0W2FdLCBhLCB0KTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHYodCwgZSwgcikgewogICAgICBpZiAodCAmJiBlKSB7CiAgICAgICAgaWYgKHQubWFwICYmIHQubWFwID09PSBZKSByZXR1cm4gdC5tYXAoZSwgcik7CgogICAgICAgIGZvciAodmFyIG4gPSBbXSwgaSA9IDAsIGEgPSB0Lmxlbmd0aDsgaSA8IGE7IGkrKykgewogICAgICAgICAgbi5wdXNoKGUuY2FsbChyLCB0W2ldLCBpLCB0KSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbjsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGcodCwgZSwgciwgbikgewogICAgICBpZiAodCAmJiBlKSB7CiAgICAgICAgaWYgKHQucmVkdWNlICYmIHQucmVkdWNlID09PSBWKSByZXR1cm4gdC5yZWR1Y2UoZSwgciwgbik7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBhID0gdC5sZW5ndGg7IGkgPCBhOyBpKyspIHsKICAgICAgICAgIHIgPSBlLmNhbGwobiwgciwgdFtpXSwgaSwgdCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcjsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHAodCwgZSwgcikgewogICAgICBpZiAodCAmJiBlKSB7CiAgICAgICAgaWYgKHQuZmlsdGVyICYmIHQuZmlsdGVyID09PSBqKSByZXR1cm4gdC5maWx0ZXIoZSwgcik7CgogICAgICAgIGZvciAodmFyIG4gPSBbXSwgaSA9IDAsIGEgPSB0Lmxlbmd0aDsgaSA8IGE7IGkrKykgewogICAgICAgICAgZS5jYWxsKHIsIHRbaV0sIGksIHQpICYmIG4ucHVzaCh0W2ldKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbSh0LCBlLCByKSB7CiAgICAgIGlmICh0ICYmIGUpIGZvciAodmFyIG4gPSAwLCBpID0gdC5sZW5ndGg7IG4gPCBpOyBuKyspIHsKICAgICAgICBpZiAoZS5jYWxsKHIsIHRbbl0sIG4sIHQpKSByZXR1cm4gdFtuXTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHgodCwgZSkgewogICAgICB2YXIgciA9IFguY2FsbChhcmd1bWVudHMsIDIpOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0LmFwcGx5KGUsIHIuY29uY2F0KFguY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24geSh0KSB7CiAgICAgIHZhciBlID0gWC5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHQuYXBwbHkodGhpcywgZS5jb25jYXQoWC5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiB3KHQpIHsKICAgICAgcmV0dXJuICJbb2JqZWN0IEFycmF5XSIgPT09IFcuY2FsbCh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBfKHQpIHsKICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gYih0KSB7CiAgICAgIHJldHVybiAiW29iamVjdCBTdHJpbmddIiA9PT0gVy5jYWxsKHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIFModCkgewogICAgICB2YXIgZSA9IF90eXBlb2YodCk7CgogICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gZSB8fCAhIXQgJiYgIm9iamVjdCIgPT0gZTsKICAgIH0KCiAgICBmdW5jdGlvbiBNKHQpIHsKICAgICAgcmV0dXJuICEhTltXLmNhbGwodCldOwogICAgfQoKICAgIGZ1bmN0aW9uIFQodCkgewogICAgICByZXR1cm4gIm9iamVjdCIgPT0gX3R5cGVvZih0KSAmJiAibnVtYmVyIiA9PSB0eXBlb2YgdC5ub2RlVHlwZSAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKHQub3duZXJEb2N1bWVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gayh0KSB7CiAgICAgIHJldHVybiB0ICE9PSB0OwogICAgfQoKICAgIGZ1bmN0aW9uIEModCkgewogICAgICBmb3IgKHZhciBlID0gMCwgciA9IGFyZ3VtZW50cy5sZW5ndGg7IGUgPCByOyBlKyspIHsKICAgICAgICBpZiAobnVsbCAhPSBhcmd1bWVudHNbZV0pIHJldHVybiBhcmd1bWVudHNbZV07CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBQKHQsIGUpIHsKICAgICAgcmV0dXJuIG51bGwgIT0gdCA/IHQgOiBlOwogICAgfQoKICAgIGZ1bmN0aW9uIEkodCwgZSwgcikgewogICAgICByZXR1cm4gbnVsbCAhPSB0ID8gdCA6IG51bGwgIT0gZSA/IGUgOiByOwogICAgfQoKICAgIGZ1bmN0aW9uIEEoKSB7CiAgICAgIHJldHVybiBGdW5jdGlvbi5jYWxsLmFwcGx5KFgsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgZnVuY3Rpb24gTyh0KSB7CiAgICAgIGlmICgibnVtYmVyIiA9PSB0eXBlb2YgdCkgcmV0dXJuIFt0LCB0LCB0LCB0XTsKICAgICAgdmFyIGUgPSB0Lmxlbmd0aDsKICAgICAgcmV0dXJuIDIgPT09IGUgPyBbdFswXSwgdFsxXSwgdFswXSwgdFsxXV0gOiAzID09PSBlID8gW3RbMF0sIHRbMV0sIHRbMl0sIHRbMV1dIDogdDsKICAgIH0KCiAgICBmdW5jdGlvbiBEKHQsIGUpIHsKICAgICAgaWYgKCF0KSB0aHJvdyBuZXcgRXJyb3IoZSk7CiAgICB9CgogICAgZnVuY3Rpb24gTCh0KSB7CiAgICAgIHRbWl0gPSAhMDsKICAgIH0KCiAgICBmdW5jdGlvbiBGKHQpIHsKICAgICAgcmV0dXJuIHRbWl07CiAgICB9CgogICAgZnVuY3Rpb24gUih0KSB7CiAgICAgIHQgJiYgZCh0LCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHRoaXMuc2V0KGUsIHQpOwogICAgICB9LCB0aGlzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBCKHQpIHsKICAgICAgcmV0dXJuIG5ldyBSKHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHooKSB7fQoKICAgIHZhciBOID0gewogICAgICAiW29iamVjdCBGdW5jdGlvbl0iOiAxLAogICAgICAiW29iamVjdCBSZWdFeHBdIjogMSwKICAgICAgIltvYmplY3QgRGF0ZV0iOiAxLAogICAgICAiW29iamVjdCBFcnJvcl0iOiAxLAogICAgICAiW29iamVjdCBDYW52YXNHcmFkaWVudF0iOiAxLAogICAgICAiW29iamVjdCBDYW52YXNQYXR0ZXJuXSI6IDEsCiAgICAgICJbb2JqZWN0IEltYWdlXSI6IDEsCiAgICAgICJbb2JqZWN0IENhbnZhc10iOiAxCiAgICB9LAogICAgICAgIEUgPSB7CiAgICAgICJbb2JqZWN0IEludDhBcnJheV0iOiAxLAogICAgICAiW29iamVjdCBVaW50OEFycmF5XSI6IDEsCiAgICAgICJbb2JqZWN0IFVpbnQ4Q2xhbXBlZEFycmF5XSI6IDEsCiAgICAgICJbb2JqZWN0IEludDE2QXJyYXldIjogMSwKICAgICAgIltvYmplY3QgVWludDE2QXJyYXldIjogMSwKICAgICAgIltvYmplY3QgSW50MzJBcnJheV0iOiAxLAogICAgICAiW29iamVjdCBVaW50MzJBcnJheV0iOiAxLAogICAgICAiW29iamVjdCBGbG9hdDMyQXJyYXldIjogMSwKICAgICAgIltvYmplY3QgRmxvYXQ2NEFycmF5XSI6IDEKICAgIH0sCiAgICAgICAgVyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsCiAgICAgICAgcSA9IEFycmF5LnByb3RvdHlwZSwKICAgICAgICBIID0gcS5mb3JFYWNoLAogICAgICAgIGogPSBxLmZpbHRlciwKICAgICAgICBYID0gcS5zbGljZSwKICAgICAgICBZID0gcS5tYXAsCiAgICAgICAgViA9IHEucmVkdWNlLAogICAgICAgIEcgPSB7fSwKICAgICAgICBVID0gZnVuY3Rpb24gVSgpIHsKICAgICAgcmV0dXJuIEcuY3JlYXRlQ2FudmFzKCk7CiAgICB9OwoKICAgIEcuY3JlYXRlQ2FudmFzID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICB9OwoKICAgIHZhciAkLAogICAgICAgIFogPSAiX19lY19wcmltaXRpdmVfXyI7CiAgICBSLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IFIsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KHQpIHsKICAgICAgICByZXR1cm4gdGhpc1siX2VjXyIgKyB0XTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodCwgZSkgewogICAgICAgIHJldHVybiB0aGlzWyJfZWNfIiArIHRdID0gZSwgZTsKICAgICAgfSwKICAgICAgZWFjaDogZnVuY3Rpb24gZWFjaCh0LCBlKSB7CiAgICAgICAgdm9pZCAwICE9PSBlICYmICh0ID0geCh0LCBlKSk7CgogICAgICAgIGZvciAodmFyIHIgaW4gdGhpcykgewogICAgICAgICAgdGhpcy5oYXNPd25Qcm9wZXJ0eShyKSAmJiB0KHRoaXNbcl0sIHIuc2xpY2UoNCkpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVtb3ZlS2V5OiBmdW5jdGlvbiByZW1vdmVLZXkodCkgewogICAgICAgIGRlbGV0ZSB0aGlzWyJfZWNfIiArIHRdOwogICAgICB9CiAgICB9LCBlLiRvdmVycmlkZSA9IHIsIGUuY2xvbmUgPSBuLCBlLm1lcmdlID0gaSwgZS5tZXJnZUFsbCA9IGEsIGUuZXh0ZW5kID0gbywgZS5kZWZhdWx0cyA9IHMsIGUuY3JlYXRlQ2FudmFzID0gVSwgZS5nZXRDb250ZXh0ID0gbCwgZS5pbmRleE9mID0gaCwgZS5pbmhlcml0cyA9IHUsIGUubWl4aW4gPSBjLCBlLmlzQXJyYXlMaWtlID0gZiwgZS5lYWNoID0gZCwgZS5tYXAgPSB2LCBlLnJlZHVjZSA9IGcsIGUuZmlsdGVyID0gcCwgZS5maW5kID0gbSwgZS5iaW5kID0geCwgZS5jdXJyeSA9IHksIGUuaXNBcnJheSA9IHcsIGUuaXNGdW5jdGlvbiA9IF8sIGUuaXNTdHJpbmcgPSBiLCBlLmlzT2JqZWN0ID0gUywgZS5pc0J1aWx0SW5PYmplY3QgPSBNLCBlLmlzRG9tID0gVCwgZS5lcU5hTiA9IGssIGUucmV0cmlldmUgPSBDLCBlLnJldHJpZXZlMiA9IFAsIGUucmV0cmlldmUzID0gSSwgZS5zbGljZSA9IEEsIGUubm9ybWFsaXplQ3NzQXJyYXkgPSBPLCBlLmFzc2VydCA9IEQsIGUuc2V0QXNQcmltaXRpdmUgPSBMLCBlLmlzUHJpbWl0aXZlID0gRiwgZS5jcmVhdGVIYXNoTWFwID0gQiwgZS5ub29wID0gejsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIGkuY2FsbCh0aGlzLCB0KSwgdGhpcy5wYXRoID0gbnVsbDsKICAgIH0KCiAgICB2YXIgaSA9IHIoMTIpLAogICAgICAgIGEgPSByKDApLAogICAgICAgIG8gPSByKDYpLAogICAgICAgIHMgPSByKDUwKSwKICAgICAgICBsID0gcig1NiksCiAgICAgICAgaCA9IGwucHJvdG90eXBlLmdldENhbnZhc1BhdHRlcm4sCiAgICAgICAgdSA9IE1hdGguYWJzLAogICAgICAgIGMgPSBuZXcgbyghMCk7CiAgICBuLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IG4sCiAgICAgIHR5cGU6ICJwYXRoIiwKICAgICAgX19kaXJ0eVBhdGg6ICEwLAogICAgICBzdHJva2VDb250YWluVGhyZXNob2xkOiA1LAogICAgICBicnVzaDogZnVuY3Rpb24gYnJ1c2godCwgZSkgewogICAgICAgIHZhciByID0gdGhpcy5zdHlsZSwKICAgICAgICAgICAgbiA9IHRoaXMucGF0aCB8fCBjLAogICAgICAgICAgICBpID0gci5oYXNTdHJva2UoKSwKICAgICAgICAgICAgYSA9IHIuaGFzRmlsbCgpLAogICAgICAgICAgICBvID0gci5maWxsLAogICAgICAgICAgICBzID0gci5zdHJva2UsCiAgICAgICAgICAgIGwgPSBhICYmICEhby5jb2xvclN0b3BzLAogICAgICAgICAgICB1ID0gaSAmJiAhIXMuY29sb3JTdG9wcywKICAgICAgICAgICAgZiA9IGEgJiYgISFvLmltYWdlLAogICAgICAgICAgICBkID0gaSAmJiAhIXMuaW1hZ2U7CgogICAgICAgIGlmIChyLmJpbmQodCwgdGhpcywgZSksIHRoaXMuc2V0VHJhbnNmb3JtKHQpLCB0aGlzLl9fZGlydHkpIHsKICAgICAgICAgIHZhciB2OwogICAgICAgICAgbCAmJiAodiA9IHYgfHwgdGhpcy5nZXRCb3VuZGluZ1JlY3QoKSwgdGhpcy5fZmlsbEdyYWRpZW50ID0gci5nZXRHcmFkaWVudCh0LCBvLCB2KSksIHUgJiYgKHYgPSB2IHx8IHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCksIHRoaXMuX3N0cm9rZUdyYWRpZW50ID0gci5nZXRHcmFkaWVudCh0LCBzLCB2KSk7CiAgICAgICAgfQoKICAgICAgICBsID8gdC5maWxsU3R5bGUgPSB0aGlzLl9maWxsR3JhZGllbnQgOiBmICYmICh0LmZpbGxTdHlsZSA9IGguY2FsbChvLCB0KSksIHUgPyB0LnN0cm9rZVN0eWxlID0gdGhpcy5fc3Ryb2tlR3JhZGllbnQgOiBkICYmICh0LnN0cm9rZVN0eWxlID0gaC5jYWxsKHMsIHQpKTsKICAgICAgICB2YXIgZyA9IHIubGluZURhc2gsCiAgICAgICAgICAgIHAgPSByLmxpbmVEYXNoT2Zmc2V0LAogICAgICAgICAgICBtID0gISF0LnNldExpbmVEYXNoLAogICAgICAgICAgICB4ID0gdGhpcy5nZXRHbG9iYWxTY2FsZSgpOwogICAgICAgIG4uc2V0U2NhbGUoeFswXSwgeFsxXSksIHRoaXMuX19kaXJ0eVBhdGggfHwgZyAmJiAhbSAmJiBpID8gKG4uYmVnaW5QYXRoKHQpLCBnICYmICFtICYmIChuLnNldExpbmVEYXNoKGcpLCBuLnNldExpbmVEYXNoT2Zmc2V0KHApKSwgdGhpcy5idWlsZFBhdGgobiwgdGhpcy5zaGFwZSwgITEpLCB0aGlzLnBhdGggJiYgKHRoaXMuX19kaXJ0eVBhdGggPSAhMSkpIDogKHQuYmVnaW5QYXRoKCksIHRoaXMucGF0aC5yZWJ1aWxkUGF0aCh0KSksIGEgJiYgbi5maWxsKHQpLCBnICYmIG0gJiYgKHQuc2V0TGluZURhc2goZyksIHQubGluZURhc2hPZmZzZXQgPSBwKSwgaSAmJiBuLnN0cm9rZSh0KSwgZyAmJiBtICYmIHQuc2V0TGluZURhc2goW10pLCB0aGlzLnJlc3RvcmVUcmFuc2Zvcm0odCksIG51bGwgIT0gci50ZXh0ICYmIHRoaXMuZHJhd1JlY3RUZXh0KHQsIHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCkpOwogICAgICB9LAogICAgICBidWlsZFBhdGg6IGZ1bmN0aW9uIGJ1aWxkUGF0aCh0LCBlLCByKSB7fSwKICAgICAgY3JlYXRlUGF0aFByb3h5OiBmdW5jdGlvbiBjcmVhdGVQYXRoUHJveHkoKSB7CiAgICAgICAgdGhpcy5wYXRoID0gbmV3IG8oKTsKICAgICAgfSwKICAgICAgZ2V0Qm91bmRpbmdSZWN0OiBmdW5jdGlvbiBnZXRCb3VuZGluZ1JlY3QoKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLl9yZWN0LAogICAgICAgICAgICBlID0gdGhpcy5zdHlsZSwKICAgICAgICAgICAgciA9ICF0OwoKICAgICAgICBpZiAocikgewogICAgICAgICAgdmFyIG4gPSB0aGlzLnBhdGg7CiAgICAgICAgICBuIHx8IChuID0gdGhpcy5wYXRoID0gbmV3IG8oKSksIHRoaXMuX19kaXJ0eVBhdGggJiYgKG4uYmVnaW5QYXRoKCksIHRoaXMuYnVpbGRQYXRoKG4sIHRoaXMuc2hhcGUsICExKSksIHQgPSBuLmdldEJvdW5kaW5nUmVjdCgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuX3JlY3QgPSB0LCBlLmhhc1N0cm9rZSgpKSB7CiAgICAgICAgICB2YXIgaSA9IHRoaXMuX3JlY3RXaXRoU3Ryb2tlIHx8ICh0aGlzLl9yZWN0V2l0aFN0cm9rZSA9IHQuY2xvbmUoKSk7CgogICAgICAgICAgaWYgKHRoaXMuX19kaXJ0eSB8fCByKSB7CiAgICAgICAgICAgIGkuY29weSh0KTsKICAgICAgICAgICAgdmFyIGEgPSBlLmxpbmVXaWR0aCwKICAgICAgICAgICAgICAgIHMgPSBlLnN0cm9rZU5vU2NhbGUgPyB0aGlzLmdldExpbmVTY2FsZSgpIDogMTsKICAgICAgICAgICAgZS5oYXNGaWxsKCkgfHwgKGEgPSBNYXRoLm1heChhLCB0aGlzLnN0cm9rZUNvbnRhaW5UaHJlc2hvbGQgfHwgNCkpLCBzID4gMWUtMTAgJiYgKGkud2lkdGggKz0gYSAvIHMsIGkuaGVpZ2h0ICs9IGEgLyBzLCBpLnggLT0gYSAvIHMgLyAyLCBpLnkgLT0gYSAvIHMgLyAyKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gaTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0OwogICAgICB9LAogICAgICBjb250YWluOiBmdW5jdGlvbiBjb250YWluKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHRoaXMudHJhbnNmb3JtQ29vcmRUb0xvY2FsKHQsIGUpLAogICAgICAgICAgICBuID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKSwKICAgICAgICAgICAgaSA9IHRoaXMuc3R5bGU7CgogICAgICAgIGlmICh0ID0gclswXSwgZSA9IHJbMV0sIG4uY29udGFpbih0LCBlKSkgewogICAgICAgICAgdmFyIGEgPSB0aGlzLnBhdGguZGF0YTsKCiAgICAgICAgICBpZiAoaS5oYXNTdHJva2UoKSkgewogICAgICAgICAgICB2YXIgbyA9IGkubGluZVdpZHRoLAogICAgICAgICAgICAgICAgbCA9IGkuc3Ryb2tlTm9TY2FsZSA/IHRoaXMuZ2V0TGluZVNjYWxlKCkgOiAxOwogICAgICAgICAgICBpZiAobCA+IDFlLTEwICYmIChpLmhhc0ZpbGwoKSB8fCAobyA9IE1hdGgubWF4KG8sIHRoaXMuc3Ryb2tlQ29udGFpblRocmVzaG9sZCkpLCBzLmNvbnRhaW5TdHJva2UoYSwgbyAvIGwsIHQsIGUpKSkgcmV0dXJuICEwOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpLmhhc0ZpbGwoKSkgcmV0dXJuIHMuY29udGFpbihhLCB0LCBlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAhMTsKICAgICAgfSwKICAgICAgZGlydHk6IGZ1bmN0aW9uIGRpcnR5KHQpIHsKICAgICAgICBudWxsID09IHQgJiYgKHQgPSAhMCksIHQgJiYgKHRoaXMuX19kaXJ0eVBhdGggPSB0LCB0aGlzLl9yZWN0ID0gbnVsbCksIHRoaXMuX19kaXJ0eSA9ICEwLCB0aGlzLl9fenIgJiYgdGhpcy5fX3pyLnJlZnJlc2goKSwgdGhpcy5fX2NsaXBUYXJnZXQgJiYgdGhpcy5fX2NsaXBUYXJnZXQuZGlydHkoKTsKICAgICAgfSwKICAgICAgYW5pbWF0ZVNoYXBlOiBmdW5jdGlvbiBhbmltYXRlU2hhcGUodCkgewogICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGUoInNoYXBlIiwgdCk7CiAgICAgIH0sCiAgICAgIGF0dHJLVjogZnVuY3Rpb24gYXR0cktWKHQsIGUpIHsKICAgICAgICAic2hhcGUiID09PSB0ID8gKHRoaXMuc2V0U2hhcGUoZSksIHRoaXMuX19kaXJ0eVBhdGggPSAhMCwgdGhpcy5fcmVjdCA9IG51bGwpIDogaS5wcm90b3R5cGUuYXR0cktWLmNhbGwodGhpcywgdCwgZSk7CiAgICAgIH0sCiAgICAgIHNldFNoYXBlOiBmdW5jdGlvbiBzZXRTaGFwZSh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLnNoYXBlOwoKICAgICAgICBpZiAocikgewogICAgICAgICAgaWYgKGEuaXNPYmplY3QodCkpIGZvciAodmFyIG4gaW4gdCkgewogICAgICAgICAgICB0Lmhhc093blByb3BlcnR5KG4pICYmIChyW25dID0gdFtuXSk7CiAgICAgICAgICB9IGVsc2Ugclt0XSA9IGU7CiAgICAgICAgICB0aGlzLmRpcnR5KCEwKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBnZXRMaW5lU2NhbGU6IGZ1bmN0aW9uIGdldExpbmVTY2FsZSgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMudHJhbnNmb3JtOwogICAgICAgIHJldHVybiB0ICYmIHUodFswXSAtIDEpID4gMWUtMTAgJiYgdSh0WzNdIC0gMSkgPiAxZS0xMCA/IE1hdGguc3FydCh1KHRbMF0gKiB0WzNdIC0gdFsyXSAqIHRbMV0pKSA6IDE7CiAgICAgIH0KICAgIH0sIG4uZXh0ZW5kID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUgPSBmdW5jdGlvbiBlKF9lKSB7CiAgICAgICAgbi5jYWxsKHRoaXMsIF9lKSwgdC5zdHlsZSAmJiB0aGlzLnN0eWxlLmV4dGVuZEZyb20odC5zdHlsZSwgITEpOwogICAgICAgIHZhciByID0gdC5zaGFwZTsKCiAgICAgICAgaWYgKHIpIHsKICAgICAgICAgIHRoaXMuc2hhcGUgPSB0aGlzLnNoYXBlIHx8IHt9OwogICAgICAgICAgdmFyIGkgPSB0aGlzLnNoYXBlOwoKICAgICAgICAgIGZvciAodmFyIGEgaW4gcikgewogICAgICAgICAgICAhaS5oYXNPd25Qcm9wZXJ0eShhKSAmJiByLmhhc093blByb3BlcnR5KGEpICYmIChpW2FdID0gclthXSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0LmluaXQgJiYgdC5pbml0LmNhbGwodGhpcywgX2UpOwogICAgICB9OwoKICAgICAgYS5pbmhlcml0cyhlLCBuKTsKCiAgICAgIGZvciAodmFyIHIgaW4gdCkgewogICAgICAgICJzdHlsZSIgIT09IHIgJiYgInNoYXBlIiAhPT0gciAmJiAoZS5wcm90b3R5cGVbcl0gPSB0W3JdKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGU7CiAgICB9LCBhLmluaGVyaXRzKG4sIGkpOwogICAgdmFyIGYgPSBuOwogICAgdC5leHBvcnRzID0gZjsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgZnVuY3Rpb24gcih0LCBlKSB7CiAgICAgIHZhciByID0gbmV3IFMoMik7CiAgICAgIHJldHVybiBudWxsID09IHQgJiYgKHQgPSAwKSwgbnVsbCA9PSBlICYmIChlID0gMCksIHJbMF0gPSB0LCByWzFdID0gZSwgcjsKICAgIH0KCiAgICBmdW5jdGlvbiBuKHQsIGUpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlWzBdLCB0WzFdID0gZVsxXSwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgdmFyIGUgPSBuZXcgUygyKTsKICAgICAgcmV0dXJuIGVbMF0gPSB0WzBdLCBlWzFdID0gdFsxXSwgZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlLCB0WzFdID0gciwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBvKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlWzBdICsgclswXSwgdFsxXSA9IGVbMV0gKyByWzFdLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIHModCwgZSwgciwgbikgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0gKyByWzBdICogbiwgdFsxXSA9IGVbMV0gKyByWzFdICogbiwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlWzBdIC0gclswXSwgdFsxXSA9IGVbMV0gLSByWzFdLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGgodCkgewogICAgICByZXR1cm4gTWF0aC5zcXJ0KHUodCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHUodCkgewogICAgICByZXR1cm4gdFswXSAqIHRbMF0gKyB0WzFdICogdFsxXTsKICAgIH0KCiAgICBmdW5jdGlvbiBjKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlWzBdICogclswXSwgdFsxXSA9IGVbMV0gKiByWzFdLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGYodCwgZSwgcikgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0gLyByWzBdLCB0WzFdID0gZVsxXSAvIHJbMV0sIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gZCh0LCBlKSB7CiAgICAgIHJldHVybiB0WzBdICogZVswXSArIHRbMV0gKiBlWzFdOwogICAgfQoKICAgIGZ1bmN0aW9uIHYodCwgZSwgcikgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0gKiByLCB0WzFdID0gZVsxXSAqIHIsIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gZyh0LCBlKSB7CiAgICAgIHZhciByID0gaChlKTsKICAgICAgcmV0dXJuIDAgPT09IHIgPyAodFswXSA9IDAsIHRbMV0gPSAwKSA6ICh0WzBdID0gZVswXSAvIHIsIHRbMV0gPSBlWzFdIC8gciksIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gcCh0LCBlKSB7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHRbMF0gLSBlWzBdKSAqICh0WzBdIC0gZVswXSkgKyAodFsxXSAtIGVbMV0pICogKHRbMV0gLSBlWzFdKSk7CiAgICB9CgogICAgZnVuY3Rpb24gbSh0LCBlKSB7CiAgICAgIHJldHVybiAodFswXSAtIGVbMF0pICogKHRbMF0gLSBlWzBdKSArICh0WzFdIC0gZVsxXSkgKiAodFsxXSAtIGVbMV0pOwogICAgfQoKICAgIGZ1bmN0aW9uIHgodCwgZSkgewogICAgICByZXR1cm4gdFswXSA9IC1lWzBdLCB0WzFdID0gLWVbMV0sIHQ7CiAgICB9CgogICAgZnVuY3Rpb24geSh0LCBlLCByLCBuKSB7CiAgICAgIHJldHVybiB0WzBdID0gZVswXSArIG4gKiAoclswXSAtIGVbMF0pLCB0WzFdID0gZVsxXSArIG4gKiAoclsxXSAtIGVbMV0pLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIHcodCwgZSwgcikgewogICAgICB2YXIgbiA9IGVbMF0sCiAgICAgICAgICBpID0gZVsxXTsKICAgICAgcmV0dXJuIHRbMF0gPSByWzBdICogbiArIHJbMl0gKiBpICsgcls0XSwgdFsxXSA9IHJbMV0gKiBuICsgclszXSAqIGkgKyByWzVdLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIF8odCwgZSwgcikgewogICAgICByZXR1cm4gdFswXSA9IE1hdGgubWluKGVbMF0sIHJbMF0pLCB0WzFdID0gTWF0aC5taW4oZVsxXSwgclsxXSksIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gYih0LCBlLCByKSB7CiAgICAgIHJldHVybiB0WzBdID0gTWF0aC5tYXgoZVswXSwgclswXSksIHRbMV0gPSBNYXRoLm1heChlWzFdLCByWzFdKSwgdDsKICAgIH0KCiAgICB2YXIgUyA9ICJ1bmRlZmluZWQiID09IHR5cGVvZiBGbG9hdDMyQXJyYXkgPyBBcnJheSA6IEZsb2F0MzJBcnJheSwKICAgICAgICBNID0gaCwKICAgICAgICBUID0gdSwKICAgICAgICBrID0gcCwKICAgICAgICBDID0gbTsKICAgIGUuY3JlYXRlID0gciwgZS5jb3B5ID0gbiwgZS5jbG9uZSA9IGksIGUuc2V0ID0gYSwgZS5hZGQgPSBvLCBlLnNjYWxlQW5kQWRkID0gcywgZS5zdWIgPSBsLCBlLmxlbiA9IGgsIGUubGVuZ3RoID0gTSwgZS5sZW5TcXVhcmUgPSB1LCBlLmxlbmd0aFNxdWFyZSA9IFQsIGUubXVsID0gYywgZS5kaXYgPSBmLCBlLmRvdCA9IGQsIGUuc2NhbGUgPSB2LCBlLm5vcm1hbGl6ZSA9IGcsIGUuZGlzdGFuY2UgPSBwLCBlLmRpc3QgPSBrLCBlLmRpc3RhbmNlU3F1YXJlID0gbSwgZS5kaXN0U3F1YXJlID0gQywgZS5uZWdhdGUgPSB4LCBlLmxlcnAgPSB5LCBlLmFwcGx5VHJhbnNmb3JtID0gdywgZS5taW4gPSBfLCBlLm1heCA9IGI7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgciwgbikgewogICAgICByIDwgMCAmJiAodCArPSByLCByID0gLXIpLCBuIDwgMCAmJiAoZSArPSBuLCBuID0gLW4pLCB0aGlzLnggPSB0LCB0aGlzLnkgPSBlLCB0aGlzLndpZHRoID0gciwgdGhpcy5oZWlnaHQgPSBuOwogICAgfQoKICAgIHZhciBpID0gcigyKSwKICAgICAgICBhID0gcig4KSwKICAgICAgICBvID0gaS5hcHBseVRyYW5zZm9ybSwKICAgICAgICBzID0gTWF0aC5taW4sCiAgICAgICAgbCA9IE1hdGgubWF4OwogICAgbi5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBuLAogICAgICB1bmlvbjogZnVuY3Rpb24gdW5pb24odCkgewogICAgICAgIHZhciBlID0gcyh0LngsIHRoaXMueCksCiAgICAgICAgICAgIHIgPSBzKHQueSwgdGhpcy55KTsKICAgICAgICB0aGlzLndpZHRoID0gbCh0LnggKyB0LndpZHRoLCB0aGlzLnggKyB0aGlzLndpZHRoKSAtIGUsIHRoaXMuaGVpZ2h0ID0gbCh0LnkgKyB0LmhlaWdodCwgdGhpcy55ICsgdGhpcy5oZWlnaHQpIC0gciwgdGhpcy54ID0gZSwgdGhpcy55ID0gcjsKICAgICAgfSwKICAgICAgYXBwbHlUcmFuc2Zvcm06IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IFtdLAogICAgICAgICAgICBlID0gW10sCiAgICAgICAgICAgIHIgPSBbXSwKICAgICAgICAgICAgbiA9IFtdOwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoaSkgewogICAgICAgICAgaWYgKGkpIHsKICAgICAgICAgICAgdFswXSA9IHJbMF0gPSB0aGlzLngsIHRbMV0gPSBuWzFdID0gdGhpcy55LCBlWzBdID0gblswXSA9IHRoaXMueCArIHRoaXMud2lkdGgsIGVbMV0gPSByWzFdID0gdGhpcy55ICsgdGhpcy5oZWlnaHQsIG8odCwgdCwgaSksIG8oZSwgZSwgaSksIG8ociwgciwgaSksIG8obiwgbiwgaSksIHRoaXMueCA9IHModFswXSwgZVswXSwgclswXSwgblswXSksIHRoaXMueSA9IHModFsxXSwgZVsxXSwgclsxXSwgblsxXSk7CiAgICAgICAgICAgIHZhciBhID0gbCh0WzBdLCBlWzBdLCByWzBdLCBuWzBdKSwKICAgICAgICAgICAgICAgIGggPSBsKHRbMV0sIGVbMV0sIHJbMV0sIG5bMV0pOwogICAgICAgICAgICB0aGlzLndpZHRoID0gYSAtIHRoaXMueCwgdGhpcy5oZWlnaHQgPSBoIC0gdGhpcy55OwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0oKSwKICAgICAgY2FsY3VsYXRlVHJhbnNmb3JtOiBmdW5jdGlvbiBjYWxjdWxhdGVUcmFuc2Zvcm0odCkgewogICAgICAgIHZhciBlID0gdGhpcywKICAgICAgICAgICAgciA9IHQud2lkdGggLyBlLndpZHRoLAogICAgICAgICAgICBuID0gdC5oZWlnaHQgLyBlLmhlaWdodCwKICAgICAgICAgICAgaSA9IGEuY3JlYXRlKCk7CiAgICAgICAgcmV0dXJuIGEudHJhbnNsYXRlKGksIGksIFstZS54LCAtZS55XSksIGEuc2NhbGUoaSwgaSwgW3IsIG5dKSwgYS50cmFuc2xhdGUoaSwgaSwgW3QueCwgdC55XSksIGk7CiAgICAgIH0sCiAgICAgIGludGVyc2VjdDogZnVuY3Rpb24gaW50ZXJzZWN0KHQpIHsKICAgICAgICBpZiAoIXQpIHJldHVybiAhMTsKICAgICAgICB0IGluc3RhbmNlb2YgbiB8fCAodCA9IG4uY3JlYXRlKHQpKTsKICAgICAgICB2YXIgZSA9IHRoaXMsCiAgICAgICAgICAgIHIgPSBlLngsCiAgICAgICAgICAgIGkgPSBlLnggKyBlLndpZHRoLAogICAgICAgICAgICBhID0gZS55LAogICAgICAgICAgICBvID0gZS55ICsgZS5oZWlnaHQsCiAgICAgICAgICAgIHMgPSB0LngsCiAgICAgICAgICAgIGwgPSB0LnggKyB0LndpZHRoLAogICAgICAgICAgICBoID0gdC55LAogICAgICAgICAgICB1ID0gdC55ICsgdC5oZWlnaHQ7CiAgICAgICAgcmV0dXJuICEoaSA8IHMgfHwgbCA8IHIgfHwgbyA8IGggfHwgdSA8IGEpOwogICAgICB9LAogICAgICBjb250YWluOiBmdW5jdGlvbiBjb250YWluKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHRoaXM7CiAgICAgICAgcmV0dXJuIHQgPj0gci54ICYmIHQgPD0gci54ICsgci53aWR0aCAmJiBlID49IHIueSAmJiBlIDw9IHIueSArIHIuaGVpZ2h0OwogICAgICB9LAogICAgICBjbG9uZTogZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBuKHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7CiAgICAgIH0sCiAgICAgIGNvcHk6IGZ1bmN0aW9uIGNvcHkodCkgewogICAgICAgIHRoaXMueCA9IHQueCwgdGhpcy55ID0gdC55LCB0aGlzLndpZHRoID0gdC53aWR0aCwgdGhpcy5oZWlnaHQgPSB0LmhlaWdodDsKICAgICAgfSwKICAgICAgcGxhaW46IGZ1bmN0aW9uIHBsYWluKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB4OiB0aGlzLngsCiAgICAgICAgICB5OiB0aGlzLnksCiAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCwKICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQKICAgICAgICB9OwogICAgICB9CiAgICB9LCBuLmNyZWF0ZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBuZXcgbih0LngsIHQueSwgdC53aWR0aCwgdC5oZWlnaHQpOwogICAgfTsKICAgIHZhciBoID0gbjsKICAgIHQuZXhwb3J0cyA9IGg7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdCA+IC1iICYmIHQgPCBiOwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCkgewogICAgICByZXR1cm4gdCA+IGIgfHwgdCA8IC1iOwogICAgfQoKICAgIGZ1bmN0aW9uIGEodCwgZSwgciwgbiwgaSkgewogICAgICB2YXIgYSA9IDEgLSBpOwogICAgICByZXR1cm4gYSAqIGEgKiAoYSAqIHQgKyAzICogaSAqIGUpICsgaSAqIGkgKiAoaSAqIG4gKyAzICogYSAqIHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCwgZSwgciwgbiwgaSkgewogICAgICB2YXIgYSA9IDEgLSBpOwogICAgICByZXR1cm4gMyAqICgoKGUgLSB0KSAqIGEgKyAyICogKHIgLSBlKSAqIGkpICogYSArIChuIC0gcikgKiBpICogaSk7CiAgICB9CgogICAgZnVuY3Rpb24gcyh0LCBlLCByLCBpLCBhLCBvKSB7CiAgICAgIHZhciBzID0gaSArIDMgKiAoZSAtIHIpIC0gdCwKICAgICAgICAgIGwgPSAzICogKHIgLSAyICogZSArIHQpLAogICAgICAgICAgaCA9IDMgKiAoZSAtIHQpLAogICAgICAgICAgdSA9IHQgLSBhLAogICAgICAgICAgYyA9IGwgKiBsIC0gMyAqIHMgKiBoLAogICAgICAgICAgZiA9IGwgKiBoIC0gOSAqIHMgKiB1LAogICAgICAgICAgZCA9IGggKiBoIC0gMyAqIGwgKiB1LAogICAgICAgICAgdiA9IDA7CiAgICAgIGlmIChuKGMpICYmIG4oZikpIHsKICAgICAgICBpZiAobihsKSkgb1swXSA9IDA7ZWxzZSB7CiAgICAgICAgICB2YXIgZyA9IC1oIC8gbDsKICAgICAgICAgIGcgPj0gMCAmJiBnIDw9IDEgJiYgKG9bdisrXSA9IGcpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcCA9IGYgKiBmIC0gNCAqIGMgKiBkOwoKICAgICAgICBpZiAobihwKSkgewogICAgICAgICAgdmFyIG0gPSBmIC8gYywKICAgICAgICAgICAgICBnID0gLWwgLyBzICsgbSwKICAgICAgICAgICAgICB4ID0gLW0gLyAyOwogICAgICAgICAgZyA+PSAwICYmIGcgPD0gMSAmJiAob1t2KytdID0gZyksIHggPj0gMCAmJiB4IDw9IDEgJiYgKG9bdisrXSA9IHgpOwogICAgICAgIH0gZWxzZSBpZiAocCA+IDApIHsKICAgICAgICAgIHZhciB5ID0gXyhwKSwKICAgICAgICAgICAgICBiID0gYyAqIGwgKyAxLjUgKiBzICogKC1mICsgeSksCiAgICAgICAgICAgICAgUyA9IGMgKiBsICsgMS41ICogcyAqICgtZiAtIHkpOwoKICAgICAgICAgIGIgPSBiIDwgMCA/IC13KC1iLCBUKSA6IHcoYiwgVCksIFMgPSBTIDwgMCA/IC13KC1TLCBUKSA6IHcoUywgVCk7CiAgICAgICAgICB2YXIgZyA9ICgtbCAtIChiICsgUykpIC8gKDMgKiBzKTsKICAgICAgICAgIGcgPj0gMCAmJiBnIDw9IDEgJiYgKG9bdisrXSA9IGcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgayA9ICgyICogYyAqIGwgLSAzICogcyAqIGYpIC8gKDIgKiBfKGMgKiBjICogYykpLAogICAgICAgICAgICAgIEMgPSBNYXRoLmFjb3MoaykgLyAzLAogICAgICAgICAgICAgIFAgPSBfKGMpLAogICAgICAgICAgICAgIEkgPSBNYXRoLmNvcyhDKSwKICAgICAgICAgICAgICBnID0gKC1sIC0gMiAqIFAgKiBJKSAvICgzICogcyksCiAgICAgICAgICAgICAgeCA9ICgtbCArIFAgKiAoSSArIE0gKiBNYXRoLnNpbihDKSkpIC8gKDMgKiBzKSwKICAgICAgICAgICAgICBBID0gKC1sICsgUCAqIChJIC0gTSAqIE1hdGguc2luKEMpKSkgLyAoMyAqIHMpOwoKICAgICAgICAgIGcgPj0gMCAmJiBnIDw9IDEgJiYgKG9bdisrXSA9IGcpLCB4ID49IDAgJiYgeCA8PSAxICYmIChvW3YrK10gPSB4KSwgQSA+PSAwICYmIEEgPD0gMSAmJiAob1t2KytdID0gQSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB2OwogICAgfQoKICAgIGZ1bmN0aW9uIGwodCwgZSwgciwgYSwgbykgewogICAgICB2YXIgcyA9IDYgKiByIC0gMTIgKiBlICsgNiAqIHQsCiAgICAgICAgICBsID0gOSAqIGUgKyAzICogYSAtIDMgKiB0IC0gOSAqIHIsCiAgICAgICAgICBoID0gMyAqIGUgLSAzICogdCwKICAgICAgICAgIHUgPSAwOwoKICAgICAgaWYgKG4obCkpIHsKICAgICAgICBpZiAoaShzKSkgewogICAgICAgICAgdmFyIGMgPSAtaCAvIHM7CiAgICAgICAgICBjID49IDAgJiYgYyA8PSAxICYmIChvW3UrK10gPSBjKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGYgPSBzICogcyAtIDQgKiBsICogaDsKICAgICAgICBpZiAobihmKSkgb1swXSA9IC1zIC8gKDIgKiBsKTtlbHNlIGlmIChmID4gMCkgewogICAgICAgICAgdmFyIGQgPSBfKGYpLAogICAgICAgICAgICAgIGMgPSAoLXMgKyBkKSAvICgyICogbCksCiAgICAgICAgICAgICAgdiA9ICgtcyAtIGQpIC8gKDIgKiBsKTsKCiAgICAgICAgICBjID49IDAgJiYgYyA8PSAxICYmIChvW3UrK10gPSBjKSwgdiA+PSAwICYmIHYgPD0gMSAmJiAob1t1KytdID0gdik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdTsKICAgIH0KCiAgICBmdW5jdGlvbiBoKHQsIGUsIHIsIG4sIGksIGEpIHsKICAgICAgdmFyIG8gPSAoZSAtIHQpICogaSArIHQsCiAgICAgICAgICBzID0gKHIgLSBlKSAqIGkgKyBlLAogICAgICAgICAgbCA9IChuIC0gcikgKiBpICsgciwKICAgICAgICAgIGggPSAocyAtIG8pICogaSArIG8sCiAgICAgICAgICB1ID0gKGwgLSBzKSAqIGkgKyBzLAogICAgICAgICAgYyA9ICh1IC0gaCkgKiBpICsgaDsKICAgICAgYVswXSA9IHQsIGFbMV0gPSBvLCBhWzJdID0gaCwgYVszXSA9IGMsIGFbNF0gPSBjLCBhWzVdID0gdSwgYVs2XSA9IGwsIGFbN10gPSBuOwogICAgfQoKICAgIGZ1bmN0aW9uIHUodCwgZSwgciwgbiwgaSwgbywgcywgbCwgaCwgdSwgYykgewogICAgICB2YXIgZiwKICAgICAgICAgIGQsCiAgICAgICAgICB2LAogICAgICAgICAgZywKICAgICAgICAgIHAsCiAgICAgICAgICBtID0gLjAwNSwKICAgICAgICAgIHggPSAxIC8gMDsKICAgICAga1swXSA9IGgsIGtbMV0gPSB1OwoKICAgICAgZm9yICh2YXIgdyA9IDA7IHcgPCAxOyB3ICs9IC4wNSkgewogICAgICAgIENbMF0gPSBhKHQsIHIsIGksIHMsIHcpLCBDWzFdID0gYShlLCBuLCBvLCBsLCB3KSwgKGcgPSB5KGssIEMpKSA8IHggJiYgKGYgPSB3LCB4ID0gZyk7CiAgICAgIH0KCiAgICAgIHggPSAxIC8gMDsKCiAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgMzIgJiYgIShtIDwgUyk7IGIrKykgewogICAgICAgIGQgPSBmIC0gbSwgdiA9IGYgKyBtLCBDWzBdID0gYSh0LCByLCBpLCBzLCBkKSwgQ1sxXSA9IGEoZSwgbiwgbywgbCwgZCksIGcgPSB5KEMsIGspLCBkID49IDAgJiYgZyA8IHggPyAoZiA9IGQsIHggPSBnKSA6IChQWzBdID0gYSh0LCByLCBpLCBzLCB2KSwgUFsxXSA9IGEoZSwgbiwgbywgbCwgdiksIHAgPSB5KFAsIGspLCB2IDw9IDEgJiYgcCA8IHggPyAoZiA9IHYsIHggPSBwKSA6IG0gKj0gLjUpOwogICAgICB9CgogICAgICByZXR1cm4gYyAmJiAoY1swXSA9IGEodCwgciwgaSwgcywgZiksIGNbMV0gPSBhKGUsIG4sIG8sIGwsIGYpKSwgXyh4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjKHQsIGUsIHIsIG4pIHsKICAgICAgdmFyIGkgPSAxIC0gbjsKICAgICAgcmV0dXJuIGkgKiAoaSAqIHQgKyAyICogbiAqIGUpICsgbiAqIG4gKiByOwogICAgfQoKICAgIGZ1bmN0aW9uIGYodCwgZSwgciwgbikgewogICAgICByZXR1cm4gMiAqICgoMSAtIG4pICogKGUgLSB0KSArIG4gKiAociAtIGUpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkKHQsIGUsIHIsIGEsIG8pIHsKICAgICAgdmFyIHMgPSB0IC0gMiAqIGUgKyByLAogICAgICAgICAgbCA9IDIgKiAoZSAtIHQpLAogICAgICAgICAgaCA9IHQgLSBhLAogICAgICAgICAgdSA9IDA7CgogICAgICBpZiAobihzKSkgewogICAgICAgIGlmIChpKGwpKSB7CiAgICAgICAgICB2YXIgYyA9IC1oIC8gbDsKICAgICAgICAgIGMgPj0gMCAmJiBjIDw9IDEgJiYgKG9bdSsrXSA9IGMpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZiA9IGwgKiBsIC0gNCAqIHMgKiBoOwoKICAgICAgICBpZiAobihmKSkgewogICAgICAgICAgdmFyIGMgPSAtbCAvICgyICogcyk7CiAgICAgICAgICBjID49IDAgJiYgYyA8PSAxICYmIChvW3UrK10gPSBjKTsKICAgICAgICB9IGVsc2UgaWYgKGYgPiAwKSB7CiAgICAgICAgICB2YXIgZCA9IF8oZiksCiAgICAgICAgICAgICAgYyA9ICgtbCArIGQpIC8gKDIgKiBzKSwKICAgICAgICAgICAgICB2ID0gKC1sIC0gZCkgLyAoMiAqIHMpOwoKICAgICAgICAgIGMgPj0gMCAmJiBjIDw9IDEgJiYgKG9bdSsrXSA9IGMpLCB2ID49IDAgJiYgdiA8PSAxICYmIChvW3UrK10gPSB2KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB1OwogICAgfQoKICAgIGZ1bmN0aW9uIHYodCwgZSwgcikgewogICAgICB2YXIgbiA9IHQgKyByIC0gMiAqIGU7CiAgICAgIHJldHVybiAwID09PSBuID8gLjUgOiAodCAtIGUpIC8gbjsKICAgIH0KCiAgICBmdW5jdGlvbiBnKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgdmFyIGEgPSAoZSAtIHQpICogbiArIHQsCiAgICAgICAgICBvID0gKHIgLSBlKSAqIG4gKyBlLAogICAgICAgICAgcyA9IChvIC0gYSkgKiBuICsgYTsKICAgICAgaVswXSA9IHQsIGlbMV0gPSBhLCBpWzJdID0gcywgaVszXSA9IHMsIGlbNF0gPSBvLCBpWzVdID0gcjsKICAgIH0KCiAgICBmdW5jdGlvbiBwKHQsIGUsIHIsIG4sIGksIGEsIG8sIHMsIGwpIHsKICAgICAgdmFyIGgsCiAgICAgICAgICB1ID0gLjAwNSwKICAgICAgICAgIGYgPSAxIC8gMDsKICAgICAga1swXSA9IG8sIGtbMV0gPSBzOwoKICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCAxOyBkICs9IC4wNSkgewogICAgICAgIENbMF0gPSBjKHQsIHIsIGksIGQpLCBDWzFdID0gYyhlLCBuLCBhLCBkKTsKICAgICAgICB2YXIgdiA9IHkoaywgQyk7CiAgICAgICAgdiA8IGYgJiYgKGggPSBkLCBmID0gdik7CiAgICAgIH0KCiAgICAgIGYgPSAxIC8gMDsKCiAgICAgIGZvciAodmFyIGcgPSAwOyBnIDwgMzIgJiYgISh1IDwgUyk7IGcrKykgewogICAgICAgIHZhciBwID0gaCAtIHUsCiAgICAgICAgICAgIG0gPSBoICsgdTsKICAgICAgICBDWzBdID0gYyh0LCByLCBpLCBwKSwgQ1sxXSA9IGMoZSwgbiwgYSwgcCk7CiAgICAgICAgdmFyIHYgPSB5KEMsIGspOwogICAgICAgIGlmIChwID49IDAgJiYgdiA8IGYpIGggPSBwLCBmID0gdjtlbHNlIHsKICAgICAgICAgIFBbMF0gPSBjKHQsIHIsIGksIG0pLCBQWzFdID0gYyhlLCBuLCBhLCBtKTsKICAgICAgICAgIHZhciB4ID0geShQLCBrKTsKICAgICAgICAgIG0gPD0gMSAmJiB4IDwgZiA/IChoID0gbSwgZiA9IHgpIDogdSAqPSAuNTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBsICYmIChsWzBdID0gYyh0LCByLCBpLCBoKSwgbFsxXSA9IGMoZSwgbiwgYSwgaCkpLCBfKGYpOwogICAgfQoKICAgIHZhciBtID0gcigyKSwKICAgICAgICB4ID0gbS5jcmVhdGUsCiAgICAgICAgeSA9IG0uZGlzdFNxdWFyZSwKICAgICAgICB3ID0gTWF0aC5wb3csCiAgICAgICAgXyA9IE1hdGguc3FydCwKICAgICAgICBiID0gMWUtOCwKICAgICAgICBTID0gMWUtNCwKICAgICAgICBNID0gXygzKSwKICAgICAgICBUID0gMSAvIDMsCiAgICAgICAgayA9IHgoKSwKICAgICAgICBDID0geCgpLAogICAgICAgIFAgPSB4KCk7CgogICAgZS5jdWJpY0F0ID0gYSwgZS5jdWJpY0Rlcml2YXRpdmVBdCA9IG8sIGUuY3ViaWNSb290QXQgPSBzLCBlLmN1YmljRXh0cmVtYSA9IGwsIGUuY3ViaWNTdWJkaXZpZGUgPSBoLCBlLmN1YmljUHJvamVjdFBvaW50ID0gdSwgZS5xdWFkcmF0aWNBdCA9IGMsIGUucXVhZHJhdGljRGVyaXZhdGl2ZUF0ID0gZiwgZS5xdWFkcmF0aWNSb290QXQgPSBkLCBlLnF1YWRyYXRpY0V4dHJlbXVtID0gdiwgZS5xdWFkcmF0aWNTdWJkaXZpZGUgPSBnLCBlLnF1YWRyYXRpY1Byb2plY3RQb2ludCA9IHA7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSkgewogICAgICBMW3RdID0gZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgZSA9IGUgfHwgRDsKICAgICAgdmFyIHIgPSB0ICsgIjoiICsgZTsKICAgICAgaWYgKFBbcl0pIHJldHVybiBQW3JdOwoKICAgICAgZm9yICh2YXIgbiA9ICh0ICsgIiIpLnNwbGl0KCJcbiIpLCBpID0gMCwgYSA9IDAsIG8gPSBuLmxlbmd0aDsgYSA8IG87IGErKykgewogICAgICAgIGkgPSBNYXRoLm1heChwKG5bYV0sIGUpLndpZHRoLCBpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEkgPiBBICYmIChJID0gMCwgUCA9IHt9KSwgSSsrLCBQW3JdID0gaSwgaTsKICAgIH0KCiAgICBmdW5jdGlvbiBhKHQsIGUsIHIsIG4sIGksIGEsIGwpIHsKICAgICAgcmV0dXJuIGEgPyBzKHQsIGUsIHIsIG4sIGksIGEsIGwpIDogbyh0LCBlLCByLCBuLCBpLCBsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvKHQsIGUsIHIsIG4sIGEsIG8pIHsKICAgICAgdmFyIHMgPSBtKHQsIGUsIGEsIG8pLAogICAgICAgICAgdSA9IGkodCwgZSk7CiAgICAgIGEgJiYgKHUgKz0gYVsxXSArIGFbM10pOwogICAgICB2YXIgYyA9IHMub3V0ZXJIZWlnaHQsCiAgICAgICAgICBmID0gbCgwLCB1LCByKSwKICAgICAgICAgIGQgPSBoKDAsIGMsIG4pLAogICAgICAgICAgdiA9IG5ldyBfKGYsIGQsIHUsIGMpOwogICAgICByZXR1cm4gdi5saW5lSGVpZ2h0ID0gcy5saW5lSGVpZ2h0LCB2OwogICAgfQoKICAgIGZ1bmN0aW9uIHModCwgZSwgciwgbiwgaSwgYSwgbykgewogICAgICB2YXIgcyA9IHgodCwgewogICAgICAgIHJpY2g6IGEsCiAgICAgICAgdHJ1bmNhdGU6IG8sCiAgICAgICAgZm9udDogZSwKICAgICAgICB0ZXh0QWxpZ246IHIsCiAgICAgICAgdGV4dFBhZGRpbmc6IGkKICAgICAgfSksCiAgICAgICAgICB1ID0gcy5vdXRlcldpZHRoLAogICAgICAgICAgYyA9IHMub3V0ZXJIZWlnaHQsCiAgICAgICAgICBmID0gbCgwLCB1LCByKSwKICAgICAgICAgIGQgPSBoKDAsIGMsIG4pOwogICAgICByZXR1cm4gbmV3IF8oZiwgZCwgdSwgYyk7CiAgICB9CgogICAgZnVuY3Rpb24gbCh0LCBlLCByKSB7CiAgICAgIHJldHVybiAicmlnaHQiID09PSByID8gdCAtPSBlIDogImNlbnRlciIgPT09IHIgJiYgKHQgLT0gZSAvIDIpLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGgodCwgZSwgcikgewogICAgICByZXR1cm4gIm1pZGRsZSIgPT09IHIgPyB0IC09IGUgLyAyIDogImJvdHRvbSIgPT09IHIgJiYgKHQgLT0gZSksIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gdSh0LCBlLCByKSB7CiAgICAgIHZhciBuID0gZS54LAogICAgICAgICAgaSA9IGUueSwKICAgICAgICAgIGEgPSBlLmhlaWdodCwKICAgICAgICAgIG8gPSBlLndpZHRoLAogICAgICAgICAgcyA9IGEgLyAyLAogICAgICAgICAgbCA9ICJsZWZ0IiwKICAgICAgICAgIGggPSAidG9wIjsKCiAgICAgIHN3aXRjaCAodCkgewogICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgICAgbiAtPSByLCBpICs9IHMsIGwgPSAicmlnaHQiLCBoID0gIm1pZGRsZSI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgICAgbiArPSByICsgbywgaSArPSBzLCBoID0gIm1pZGRsZSI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAidG9wIjoKICAgICAgICAgIG4gKz0gbyAvIDIsIGkgLT0gciwgbCA9ICJjZW50ZXIiLCBoID0gImJvdHRvbSI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgIG4gKz0gbyAvIDIsIGkgKz0gYSArIHIsIGwgPSAiY2VudGVyIjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJpbnNpZGUiOgogICAgICAgICAgbiArPSBvIC8gMiwgaSArPSBzLCBsID0gImNlbnRlciIsIGggPSAibWlkZGxlIjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJpbnNpZGVMZWZ0IjoKICAgICAgICAgIG4gKz0gciwgaSArPSBzLCBoID0gIm1pZGRsZSI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiaW5zaWRlUmlnaHQiOgogICAgICAgICAgbiArPSBvIC0gciwgaSArPSBzLCBsID0gInJpZ2h0IiwgaCA9ICJtaWRkbGUiOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgImluc2lkZVRvcCI6CiAgICAgICAgICBuICs9IG8gLyAyLCBpICs9IHIsIGwgPSAiY2VudGVyIjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJpbnNpZGVCb3R0b20iOgogICAgICAgICAgbiArPSBvIC8gMiwgaSArPSBhIC0gciwgbCA9ICJjZW50ZXIiLCBoID0gImJvdHRvbSI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiaW5zaWRlVG9wTGVmdCI6CiAgICAgICAgICBuICs9IHIsIGkgKz0gcjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJpbnNpZGVUb3BSaWdodCI6CiAgICAgICAgICBuICs9IG8gLSByLCBpICs9IHIsIGwgPSAicmlnaHQiOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgImluc2lkZUJvdHRvbUxlZnQiOgogICAgICAgICAgbiArPSByLCBpICs9IGEgLSByLCBoID0gImJvdHRvbSI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiaW5zaWRlQm90dG9tUmlnaHQiOgogICAgICAgICAgbiArPSBvIC0gciwgaSArPSBhIC0gciwgbCA9ICJyaWdodCIsIGggPSAiYm90dG9tIjsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICB4OiBuLAogICAgICAgIHk6IGksCiAgICAgICAgdGV4dEFsaWduOiBsLAogICAgICAgIHRleHRWZXJ0aWNhbEFsaWduOiBoCiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gYyh0LCBlLCByLCBuLCBpKSB7CiAgICAgIGlmICghZSkgcmV0dXJuICIiOwogICAgICB2YXIgYSA9ICh0ICsgIiIpLnNwbGl0KCJcbiIpOwogICAgICBpID0gZihlLCByLCBuLCBpKTsKCiAgICAgIGZvciAodmFyIG8gPSAwLCBzID0gYS5sZW5ndGg7IG8gPCBzOyBvKyspIHsKICAgICAgICBhW29dID0gZChhW29dLCBpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGEuam9pbigiXG4iKTsKICAgIH0KCiAgICBmdW5jdGlvbiBmKHQsIGUsIHIsIG4pIHsKICAgICAgbiA9IFQoe30sIG4pLCBuLmZvbnQgPSBlOwogICAgICB2YXIgciA9IGsociwgIi4uLiIpOwogICAgICBuLm1heEl0ZXJhdGlvbnMgPSBrKG4ubWF4SXRlcmF0aW9ucywgMik7CiAgICAgIHZhciBhID0gbi5taW5DaGFyID0gayhuLm1pbkNoYXIsIDApOwogICAgICBuLmNuQ2hhcldpZHRoID0gaSgi5Zu9IiwgZSk7CiAgICAgIHZhciBvID0gbi5hc2NDaGFyV2lkdGggPSBpKCJhIiwgZSk7CiAgICAgIG4ucGxhY2Vob2xkZXIgPSBrKG4ucGxhY2Vob2xkZXIsICIiKTsKCiAgICAgIGZvciAodmFyIHMgPSB0ID0gTWF0aC5tYXgoMCwgdCAtIDEpLCBsID0gMDsgbCA8IGEgJiYgcyA+PSBvOyBsKyspIHsKICAgICAgICBzIC09IG87CiAgICAgIH0KCiAgICAgIHZhciBoID0gaShyKTsKICAgICAgcmV0dXJuIGggPiBzICYmIChyID0gIiIsIGggPSAwKSwgcyA9IHQgLSBoLCBuLmVsbGlwc2lzID0gciwgbi5lbGxpcHNpc1dpZHRoID0gaCwgbi5jb250ZW50V2lkdGggPSBzLCBuLmNvbnRhaW5lcldpZHRoID0gdCwgbjsKICAgIH0KCiAgICBmdW5jdGlvbiBkKHQsIGUpIHsKICAgICAgdmFyIHIgPSBlLmNvbnRhaW5lcldpZHRoLAogICAgICAgICAgbiA9IGUuZm9udCwKICAgICAgICAgIGEgPSBlLmNvbnRlbnRXaWR0aDsKICAgICAgaWYgKCFyKSByZXR1cm4gIiI7CiAgICAgIHZhciBvID0gaSh0LCBuKTsKICAgICAgaWYgKG8gPD0gcikgcmV0dXJuIHQ7CgogICAgICBmb3IgKHZhciBzID0gMDs7IHMrKykgewogICAgICAgIGlmIChvIDw9IGEgfHwgcyA+PSBlLm1heEl0ZXJhdGlvbnMpIHsKICAgICAgICAgIHQgKz0gZS5lbGxpcHNpczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgdmFyIGwgPSAwID09PSBzID8gdih0LCBhLCBlLmFzY0NoYXJXaWR0aCwgZS5jbkNoYXJXaWR0aCkgOiBvID4gMCA/IE1hdGguZmxvb3IodC5sZW5ndGggKiBhIC8gbykgOiAwOwogICAgICAgIHQgPSB0LnN1YnN0cigwLCBsKSwgbyA9IGkodCwgbik7CiAgICAgIH0KCiAgICAgIHJldHVybiAiIiA9PT0gdCAmJiAodCA9IGUucGxhY2Vob2xkZXIpLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIHYodCwgZSwgciwgbikgewogICAgICBmb3IgKHZhciBpID0gMCwgYSA9IDAsIG8gPSB0Lmxlbmd0aDsgYSA8IG8gJiYgaSA8IGU7IGErKykgewogICAgICAgIHZhciBzID0gdC5jaGFyQ29kZUF0KGEpOwogICAgICAgIGkgKz0gMCA8PSBzICYmIHMgPD0gMTI3ID8gciA6IG47CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGZ1bmN0aW9uIGcodCkgewogICAgICByZXR1cm4gaSgi5Zu9IiwgdCk7CiAgICB9CgogICAgZnVuY3Rpb24gcCh0LCBlKSB7CiAgICAgIHJldHVybiBMLm1lYXN1cmVUZXh0KHQsIGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIG0odCwgZSwgciwgbikgewogICAgICBudWxsICE9IHQgJiYgKHQgKz0gIiIpOwogICAgICB2YXIgaSA9IGcoZSksCiAgICAgICAgICBhID0gdCA/IHQuc3BsaXQoIlxuIikgOiBbXSwKICAgICAgICAgIG8gPSBhLmxlbmd0aCAqIGksCiAgICAgICAgICBzID0gbzsKCiAgICAgIGlmIChyICYmIChzICs9IHJbMF0gKyByWzJdKSwgdCAmJiBuKSB7CiAgICAgICAgdmFyIGwgPSBuLm91dGVySGVpZ2h0LAogICAgICAgICAgICBoID0gbi5vdXRlcldpZHRoOwogICAgICAgIGlmIChudWxsICE9IGwgJiYgcyA+IGwpIHQgPSAiIiwgYSA9IFtdO2Vsc2UgaWYgKG51bGwgIT0gaCkgZm9yICh2YXIgdSA9IGYoaCAtIChyID8gclsxXSArIHJbM10gOiAwKSwgZSwgbi5lbGxpcHNpcywgewogICAgICAgICAgbWluQ2hhcjogbi5taW5DaGFyLAogICAgICAgICAgcGxhY2Vob2xkZXI6IG4ucGxhY2Vob2xkZXIKICAgICAgICB9KSwgYyA9IDAsIHYgPSBhLmxlbmd0aDsgYyA8IHY7IGMrKykgewogICAgICAgICAgYVtjXSA9IGQoYVtjXSwgdSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGxpbmVzOiBhLAogICAgICAgIGhlaWdodDogbywKICAgICAgICBvdXRlckhlaWdodDogcywKICAgICAgICBsaW5lSGVpZ2h0OiBpCiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24geCh0LCBlKSB7CiAgICAgIHZhciByID0gewogICAgICAgIGxpbmVzOiBbXSwKICAgICAgICB3aWR0aDogMCwKICAgICAgICBoZWlnaHQ6IDAKICAgICAgfTsKICAgICAgaWYgKG51bGwgIT0gdCAmJiAodCArPSAiIiksICF0KSByZXR1cm4gcjsKCiAgICAgIGZvciAodmFyIG4sIGEgPSBPLmxhc3RJbmRleCA9IDA7IG51bGwgIT0gKG4gPSBPLmV4ZWModCkpOykgewogICAgICAgIHZhciBvID0gbi5pbmRleDsKICAgICAgICBvID4gYSAmJiB5KHIsIHQuc3Vic3RyaW5nKGEsIG8pKSwgeShyLCBuWzJdLCBuWzFdKSwgYSA9IE8ubGFzdEluZGV4OwogICAgICB9CgogICAgICBhIDwgdC5sZW5ndGggJiYgeShyLCB0LnN1YnN0cmluZyhhLCB0Lmxlbmd0aCkpOwogICAgICB2YXIgcyA9IHIubGluZXMsCiAgICAgICAgICBsID0gMCwKICAgICAgICAgIGggPSAwLAogICAgICAgICAgdSA9IFtdLAogICAgICAgICAgZiA9IGUudGV4dFBhZGRpbmcsCiAgICAgICAgICBkID0gZS50cnVuY2F0ZSwKICAgICAgICAgIHYgPSBkICYmIGQub3V0ZXJXaWR0aCwKICAgICAgICAgIHAgPSBkICYmIGQub3V0ZXJIZWlnaHQ7CiAgICAgIGYgJiYgKG51bGwgIT0gdiAmJiAodiAtPSBmWzFdICsgZlszXSksIG51bGwgIT0gcCAmJiAocCAtPSBmWzBdICsgZlsyXSkpOwoKICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBzLmxlbmd0aDsgbSsrKSB7CiAgICAgICAgZm9yICh2YXIgeCA9IHNbbV0sIHcgPSAwLCBfID0gMCwgUyA9IDA7IFMgPCB4LnRva2Vucy5sZW5ndGg7IFMrKykgewogICAgICAgICAgdmFyIE0gPSB4LnRva2Vuc1tTXSwKICAgICAgICAgICAgICBUID0gTS5zdHlsZU5hbWUgJiYgZS5yaWNoW00uc3R5bGVOYW1lXSB8fCB7fSwKICAgICAgICAgICAgICBQID0gTS50ZXh0UGFkZGluZyA9IFQudGV4dFBhZGRpbmcsCiAgICAgICAgICAgICAgSSA9IE0uZm9udCA9IFQuZm9udCB8fCBlLmZvbnQsCiAgICAgICAgICAgICAgQSA9IE0udGV4dEhlaWdodCA9IGsoVC50ZXh0SGVpZ2h0LCBnKEkpKTsKICAgICAgICAgIGlmIChQICYmIChBICs9IFBbMF0gKyBQWzJdKSwgTS5oZWlnaHQgPSBBLCBNLmxpbmVIZWlnaHQgPSBDKFQudGV4dExpbmVIZWlnaHQsIGUudGV4dExpbmVIZWlnaHQsIEEpLCBNLnRleHRBbGlnbiA9IFQgJiYgVC50ZXh0QWxpZ24gfHwgZS50ZXh0QWxpZ24sIE0udGV4dFZlcnRpY2FsQWxpZ24gPSBUICYmIFQudGV4dFZlcnRpY2FsQWxpZ24gfHwgIm1pZGRsZSIsIG51bGwgIT0gcCAmJiBsICsgTS5saW5lSGVpZ2h0ID4gcCkgcmV0dXJuIHsKICAgICAgICAgICAgbGluZXM6IFtdLAogICAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgICAgaGVpZ2h0OiAwCiAgICAgICAgICB9OwogICAgICAgICAgTS50ZXh0V2lkdGggPSBpKE0udGV4dCwgSSk7CiAgICAgICAgICB2YXIgRCA9IFQudGV4dFdpZHRoLAogICAgICAgICAgICAgIEwgPSBudWxsID09IEQgfHwgImF1dG8iID09PSBEOwogICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBEICYmICIlIiA9PT0gRC5jaGFyQXQoRC5sZW5ndGggLSAxKSkgTS5wZXJjZW50V2lkdGggPSBELCB1LnB1c2goTSksIEQgPSAwO2Vsc2UgewogICAgICAgICAgICBpZiAoTCkgewogICAgICAgICAgICAgIEQgPSBNLnRleHRXaWR0aDsKICAgICAgICAgICAgICB2YXIgRiA9IFQudGV4dEJhY2tncm91bmRDb2xvciwKICAgICAgICAgICAgICAgICAgUiA9IEYgJiYgRi5pbWFnZTsKICAgICAgICAgICAgICBSICYmIChSID0gYi5maW5kRXhpc3RJbWFnZShSKSwgYi5pc0ltYWdlUmVhZHkoUikgJiYgKEQgPSBNYXRoLm1heChELCBSLndpZHRoICogQSAvIFIuaGVpZ2h0KSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgQiA9IFAgPyBQWzFdICsgUFszXSA6IDA7CiAgICAgICAgICAgIEQgKz0gQjsKICAgICAgICAgICAgdmFyIHogPSBudWxsICE9IHYgPyB2IC0gXyA6IG51bGw7CiAgICAgICAgICAgIG51bGwgIT0geiAmJiB6IDwgRCAmJiAoIUwgfHwgeiA8IEIgPyAoTS50ZXh0ID0gIiIsIE0udGV4dFdpZHRoID0gRCA9IDApIDogKE0udGV4dCA9IGMoTS50ZXh0LCB6IC0gQiwgSSwgZC5lbGxpcHNpcywgewogICAgICAgICAgICAgIG1pbkNoYXI6IGQubWluQ2hhcgogICAgICAgICAgICB9KSwgTS50ZXh0V2lkdGggPSBpKE0udGV4dCwgSSksIEQgPSBNLnRleHRXaWR0aCArIEIpKTsKICAgICAgICAgIH0KICAgICAgICAgIF8gKz0gTS53aWR0aCA9IEQsIFQgJiYgKHcgPSBNYXRoLm1heCh3LCBNLmxpbmVIZWlnaHQpKTsKICAgICAgICB9CgogICAgICAgIHgud2lkdGggPSBfLCB4LmxpbmVIZWlnaHQgPSB3LCBsICs9IHcsIGggPSBNYXRoLm1heChoLCBfKTsKICAgICAgfQoKICAgICAgci5vdXRlcldpZHRoID0gci53aWR0aCA9IGsoZS50ZXh0V2lkdGgsIGgpLCByLm91dGVySGVpZ2h0ID0gci5oZWlnaHQgPSBrKGUudGV4dEhlaWdodCwgbCksIGYgJiYgKHIub3V0ZXJXaWR0aCArPSBmWzFdICsgZlszXSwgci5vdXRlckhlaWdodCArPSBmWzBdICsgZlsyXSk7CgogICAgICBmb3IgKHZhciBtID0gMDsgbSA8IHUubGVuZ3RoOyBtKyspIHsKICAgICAgICB2YXIgTSA9IHVbbV0sCiAgICAgICAgICAgIE4gPSBNLnBlcmNlbnRXaWR0aDsKICAgICAgICBNLndpZHRoID0gcGFyc2VJbnQoTiwgMTApIC8gMTAwICogaDsKICAgICAgfQoKICAgICAgcmV0dXJuIHI7CiAgICB9CgogICAgZnVuY3Rpb24geSh0LCBlLCByKSB7CiAgICAgIGZvciAodmFyIG4gPSAiIiA9PT0gZSwgaSA9IGUuc3BsaXQoIlxuIiksIGEgPSB0LmxpbmVzLCBvID0gMDsgbyA8IGkubGVuZ3RoOyBvKyspIHsKICAgICAgICB2YXIgcyA9IGlbb10sCiAgICAgICAgICAgIGwgPSB7CiAgICAgICAgICBzdHlsZU5hbWU6IHIsCiAgICAgICAgICB0ZXh0OiBzLAogICAgICAgICAgaXNMaW5lSG9sZGVyOiAhcyAmJiAhbgogICAgICAgIH07CiAgICAgICAgaWYgKG8pIGEucHVzaCh7CiAgICAgICAgICB0b2tlbnM6IFtsXQogICAgICAgIH0pO2Vsc2UgewogICAgICAgICAgdmFyIGggPSAoYVthLmxlbmd0aCAtIDFdIHx8IChhWzBdID0gewogICAgICAgICAgICB0b2tlbnM6IFtdCiAgICAgICAgICB9KSkudG9rZW5zLAogICAgICAgICAgICAgIHUgPSBoLmxlbmd0aDsKICAgICAgICAgIDEgPT09IHUgJiYgaFswXS5pc0xpbmVIb2xkZXIgPyBoWzBdID0gbCA6IChzIHx8ICF1IHx8IG4pICYmIGgucHVzaChsKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB3KHQpIHsKICAgICAgcmV0dXJuICh0LmZvbnRTaXplIHx8IHQuZm9udEZhbWlseSkgJiYgW3QuZm9udFN0eWxlLCB0LmZvbnRXZWlnaHQsICh0LmZvbnRTaXplIHx8IDEyKSArICJweCIsIHQuZm9udEZhbWlseSB8fCAic2Fucy1zZXJpZiJdLmpvaW4oIiAiKSB8fCB0LnRleHRGb250IHx8IHQuZm9udDsKICAgIH0KCiAgICB2YXIgXyA9IHIoMyksCiAgICAgICAgYiA9IHIoMTApLAogICAgICAgIFMgPSByKDApLAogICAgICAgIE0gPSBTLmdldENvbnRleHQsCiAgICAgICAgVCA9IFMuZXh0ZW5kLAogICAgICAgIGsgPSBTLnJldHJpZXZlMiwKICAgICAgICBDID0gUy5yZXRyaWV2ZTMsCiAgICAgICAgUCA9IHt9LAogICAgICAgIEkgPSAwLAogICAgICAgIEEgPSA1ZTMsCiAgICAgICAgTyA9IC9ceyhbYS16QS1aMC05X10rKVx8KFtefV0qKVx9L2csCiAgICAgICAgRCA9ICIxMnB4IHNhbnMtc2VyaWYiLAogICAgICAgIEwgPSB7fTsKCiAgICBMLm1lYXN1cmVUZXh0ID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgdmFyIHIgPSBNKCk7CiAgICAgIHJldHVybiByLmZvbnQgPSBlIHx8IEQsIHIubWVhc3VyZVRleHQodCk7CiAgICB9LCBlLkRFRkFVTFRfRk9OVCA9IEQsIGUuJG92ZXJyaWRlID0gbiwgZS5nZXRXaWR0aCA9IGksIGUuZ2V0Qm91bmRpbmdSZWN0ID0gYSwgZS5hZGp1c3RUZXh0WCA9IGwsIGUuYWRqdXN0VGV4dFkgPSBoLCBlLmFkanVzdFRleHRQb3NpdGlvbk9uUmVjdCA9IHUsIGUudHJ1bmNhdGVUZXh0ID0gYywgZS5nZXRMaW5lSGVpZ2h0ID0gZywgZS5tZWFzdXJlVGV4dCA9IHAsIGUucGFyc2VQbGFpblRleHQgPSBtLCBlLnBhcnNlUmljaFRleHQgPSB4LCBlLm1ha2VGb250ID0gdzsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDQpLAogICAgICAgIGkgPSByKDIpLAogICAgICAgIGEgPSByKDQ5KSwKICAgICAgICBvID0gcigzKSwKICAgICAgICBzID0gcigxOSksCiAgICAgICAgbCA9IHMuZGV2aWNlUGl4ZWxSYXRpbywKICAgICAgICBoID0gewogICAgICBNOiAxLAogICAgICBMOiAyLAogICAgICBDOiAzLAogICAgICBROiA0LAogICAgICBBOiA1LAogICAgICBaOiA2LAogICAgICBSOiA3CiAgICB9LAogICAgICAgIHUgPSBbXSwKICAgICAgICBjID0gW10sCiAgICAgICAgZiA9IFtdLAogICAgICAgIGQgPSBbXSwKICAgICAgICB2ID0gTWF0aC5taW4sCiAgICAgICAgZyA9IE1hdGgubWF4LAogICAgICAgIHAgPSBNYXRoLmNvcywKICAgICAgICBtID0gTWF0aC5zaW4sCiAgICAgICAgeCA9IE1hdGguc3FydCwKICAgICAgICB5ID0gTWF0aC5hYnMsCiAgICAgICAgdyA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBGbG9hdDMyQXJyYXksCiAgICAgICAgXyA9IGZ1bmN0aW9uIF8odCkgewogICAgICB0aGlzLl9zYXZlRGF0YSA9ICF0LCB0aGlzLl9zYXZlRGF0YSAmJiAodGhpcy5kYXRhID0gW10pLCB0aGlzLl9jdHggPSBudWxsOwogICAgfTsKCiAgICBfLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IF8sCiAgICAgIF94aTogMCwKICAgICAgX3lpOiAwLAogICAgICBfeDA6IDAsCiAgICAgIF95MDogMCwKICAgICAgX3V4OiAwLAogICAgICBfdXk6IDAsCiAgICAgIF9sZW46IDAsCiAgICAgIF9saW5lRGFzaDogbnVsbCwKICAgICAgX2Rhc2hPZmZzZXQ6IDAsCiAgICAgIF9kYXNoSWR4OiAwLAogICAgICBfZGFzaFN1bTogMCwKICAgICAgc2V0U2NhbGU6IGZ1bmN0aW9uIHNldFNjYWxlKHQsIGUpIHsKICAgICAgICB0aGlzLl91eCA9IHkoMSAvIGwgLyB0KSB8fCAwLCB0aGlzLl91eSA9IHkoMSAvIGwgLyBlKSB8fCAwOwogICAgICB9LAogICAgICBnZXRDb250ZXh0OiBmdW5jdGlvbiBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jdHg7CiAgICAgIH0sCiAgICAgIGJlZ2luUGF0aDogZnVuY3Rpb24gYmVnaW5QYXRoKHQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3R4ID0gdCwgdCAmJiB0LmJlZ2luUGF0aCgpLCB0ICYmICh0aGlzLmRwciA9IHQuZHByKSwgdGhpcy5fc2F2ZURhdGEgJiYgKHRoaXMuX2xlbiA9IDApLCB0aGlzLl9saW5lRGFzaCAmJiAodGhpcy5fbGluZURhc2ggPSBudWxsLCB0aGlzLl9kYXNoT2Zmc2V0ID0gMCksIHRoaXM7CiAgICAgIH0sCiAgICAgIG1vdmVUbzogZnVuY3Rpb24gbW92ZVRvKHQsIGUpIHsKICAgICAgICByZXR1cm4gdGhpcy5hZGREYXRhKGguTSwgdCwgZSksIHRoaXMuX2N0eCAmJiB0aGlzLl9jdHgubW92ZVRvKHQsIGUpLCB0aGlzLl94MCA9IHQsIHRoaXMuX3kwID0gZSwgdGhpcy5feGkgPSB0LCB0aGlzLl95aSA9IGUsIHRoaXM7CiAgICAgIH0sCiAgICAgIGxpbmVUbzogZnVuY3Rpb24gbGluZVRvKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHkodCAtIHRoaXMuX3hpKSA+IHRoaXMuX3V4IHx8IHkoZSAtIHRoaXMuX3lpKSA+IHRoaXMuX3V5IHx8IHRoaXMuX2xlbiA8IDU7CiAgICAgICAgcmV0dXJuIHRoaXMuYWRkRGF0YShoLkwsIHQsIGUpLCB0aGlzLl9jdHggJiYgciAmJiAodGhpcy5fbmVlZHNEYXNoKCkgPyB0aGlzLl9kYXNoZWRMaW5lVG8odCwgZSkgOiB0aGlzLl9jdHgubGluZVRvKHQsIGUpKSwgciAmJiAodGhpcy5feGkgPSB0LCB0aGlzLl95aSA9IGUpLCB0aGlzOwogICAgICB9LAogICAgICBiZXppZXJDdXJ2ZVRvOiBmdW5jdGlvbiBiZXppZXJDdXJ2ZVRvKHQsIGUsIHIsIG4sIGksIGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5hZGREYXRhKGguQywgdCwgZSwgciwgbiwgaSwgYSksIHRoaXMuX2N0eCAmJiAodGhpcy5fbmVlZHNEYXNoKCkgPyB0aGlzLl9kYXNoZWRCZXppZXJUbyh0LCBlLCByLCBuLCBpLCBhKSA6IHRoaXMuX2N0eC5iZXppZXJDdXJ2ZVRvKHQsIGUsIHIsIG4sIGksIGEpKSwgdGhpcy5feGkgPSBpLCB0aGlzLl95aSA9IGEsIHRoaXM7CiAgICAgIH0sCiAgICAgIHF1YWRyYXRpY0N1cnZlVG86IGZ1bmN0aW9uIHF1YWRyYXRpY0N1cnZlVG8odCwgZSwgciwgbikgewogICAgICAgIHJldHVybiB0aGlzLmFkZERhdGEoaC5RLCB0LCBlLCByLCBuKSwgdGhpcy5fY3R4ICYmICh0aGlzLl9uZWVkc0Rhc2goKSA/IHRoaXMuX2Rhc2hlZFF1YWRyYXRpY1RvKHQsIGUsIHIsIG4pIDogdGhpcy5fY3R4LnF1YWRyYXRpY0N1cnZlVG8odCwgZSwgciwgbikpLCB0aGlzLl94aSA9IHIsIHRoaXMuX3lpID0gbiwgdGhpczsKICAgICAgfSwKICAgICAgYXJjOiBmdW5jdGlvbiBhcmModCwgZSwgciwgbiwgaSwgYSkgewogICAgICAgIHJldHVybiB0aGlzLmFkZERhdGEoaC5BLCB0LCBlLCByLCByLCBuLCBpIC0gbiwgMCwgYSA/IDAgOiAxKSwgdGhpcy5fY3R4ICYmIHRoaXMuX2N0eC5hcmModCwgZSwgciwgbiwgaSwgYSksIHRoaXMuX3hpID0gcChpKSAqIHIgKyB0LCB0aGlzLl95aSA9IG0oaSkgKiByICsgdCwgdGhpczsKICAgICAgfSwKICAgICAgYXJjVG86IGZ1bmN0aW9uIGFyY1RvKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3R4ICYmIHRoaXMuX2N0eC5hcmNUbyh0LCBlLCByLCBuLCBpKSwgdGhpczsKICAgICAgfSwKICAgICAgcmVjdDogZnVuY3Rpb24gcmVjdCh0LCBlLCByLCBuKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N0eCAmJiB0aGlzLl9jdHgucmVjdCh0LCBlLCByLCBuKSwgdGhpcy5hZGREYXRhKGguUiwgdCwgZSwgciwgbiksIHRoaXM7CiAgICAgIH0sCiAgICAgIGNsb3NlUGF0aDogZnVuY3Rpb24gY2xvc2VQYXRoKCkgewogICAgICAgIHRoaXMuYWRkRGF0YShoLlopOwogICAgICAgIHZhciB0ID0gdGhpcy5fY3R4LAogICAgICAgICAgICBlID0gdGhpcy5feDAsCiAgICAgICAgICAgIHIgPSB0aGlzLl95MDsKICAgICAgICByZXR1cm4gdCAmJiAodGhpcy5fbmVlZHNEYXNoKCkgJiYgdGhpcy5fZGFzaGVkTGluZVRvKGUsIHIpLCB0LmNsb3NlUGF0aCgpKSwgdGhpcy5feGkgPSBlLCB0aGlzLl95aSA9IHIsIHRoaXM7CiAgICAgIH0sCiAgICAgIGZpbGw6IGZ1bmN0aW9uIGZpbGwodCkgewogICAgICAgIHQgJiYgdC5maWxsKCksIHRoaXMudG9TdGF0aWMoKTsKICAgICAgfSwKICAgICAgc3Ryb2tlOiBmdW5jdGlvbiBzdHJva2UodCkgewogICAgICAgIHQgJiYgdC5zdHJva2UoKSwgdGhpcy50b1N0YXRpYygpOwogICAgICB9LAogICAgICBzZXRMaW5lRGFzaDogZnVuY3Rpb24gc2V0TGluZURhc2godCkgewogICAgICAgIGlmICh0IGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgIHRoaXMuX2xpbmVEYXNoID0gdCwgdGhpcy5fZGFzaElkeCA9IDA7CgogICAgICAgICAgZm9yICh2YXIgZSA9IDAsIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykgewogICAgICAgICAgICBlICs9IHRbcl07CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fZGFzaFN1bSA9IGU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgc2V0TGluZURhc2hPZmZzZXQ6IGZ1bmN0aW9uIHNldExpbmVEYXNoT2Zmc2V0KHQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGFzaE9mZnNldCA9IHQsIHRoaXM7CiAgICAgIH0sCiAgICAgIGxlbjogZnVuY3Rpb24gbGVuKCkgewogICAgICAgIHJldHVybiB0aGlzLl9sZW47CiAgICAgIH0sCiAgICAgIHNldERhdGE6IGZ1bmN0aW9uIHNldERhdGEodCkgewogICAgICAgIHZhciBlID0gdC5sZW5ndGg7CiAgICAgICAgdGhpcy5kYXRhICYmIHRoaXMuZGF0YS5sZW5ndGggPT0gZSB8fCAhdyB8fCAodGhpcy5kYXRhID0gbmV3IEZsb2F0MzJBcnJheShlKSk7CgogICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgZTsgcisrKSB7CiAgICAgICAgICB0aGlzLmRhdGFbcl0gPSB0W3JdOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fbGVuID0gZTsKICAgICAgfSwKICAgICAgYXBwZW5kUGF0aDogZnVuY3Rpb24gYXBwZW5kUGF0aCh0KSB7CiAgICAgICAgdCBpbnN0YW5jZW9mIEFycmF5IHx8ICh0ID0gW3RdKTsKCiAgICAgICAgZm9yICh2YXIgZSA9IHQubGVuZ3RoLCByID0gMCwgbiA9IHRoaXMuX2xlbiwgaSA9IDA7IGkgPCBlOyBpKyspIHsKICAgICAgICAgIHIgKz0gdFtpXS5sZW4oKTsKICAgICAgICB9CgogICAgICAgIHcgJiYgdGhpcy5kYXRhIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5ICYmICh0aGlzLmRhdGEgPSBuZXcgRmxvYXQzMkFycmF5KG4gKyByKSk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZTsgaSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBhID0gdFtpXS5kYXRhLCBvID0gMDsgbyA8IGEubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgdGhpcy5kYXRhW24rK10gPSBhW29dOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5fbGVuID0gbjsKICAgICAgfSwKICAgICAgYWRkRGF0YTogZnVuY3Rpb24gYWRkRGF0YSh0KSB7CiAgICAgICAgaWYgKHRoaXMuX3NhdmVEYXRhKSB7CiAgICAgICAgICB2YXIgZSA9IHRoaXMuZGF0YTsKICAgICAgICAgIHRoaXMuX2xlbiArIGFyZ3VtZW50cy5sZW5ndGggPiBlLmxlbmd0aCAmJiAodGhpcy5fZXhwYW5kRGF0YSgpLCBlID0gdGhpcy5kYXRhKTsKCiAgICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKykgewogICAgICAgICAgICBlW3RoaXMuX2xlbisrXSA9IGFyZ3VtZW50c1tyXTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLl9wcmV2Q21kID0gdDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIF9leHBhbmREYXRhOiBmdW5jdGlvbiBfZXhwYW5kRGF0YSgpIHsKICAgICAgICBpZiAoISh0aGlzLmRhdGEgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgICAgICAgIGZvciAodmFyIHQgPSBbXSwgZSA9IDA7IGUgPCB0aGlzLl9sZW47IGUrKykgewogICAgICAgICAgICB0W2VdID0gdGhpcy5kYXRhW2VdOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuZGF0YSA9IHQ7CiAgICAgICAgfQogICAgICB9LAogICAgICBfbmVlZHNEYXNoOiBmdW5jdGlvbiBfbmVlZHNEYXNoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9saW5lRGFzaDsKICAgICAgfSwKICAgICAgX2Rhc2hlZExpbmVUbzogZnVuY3Rpb24gX2Rhc2hlZExpbmVUbyh0LCBlKSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIGkgPSB0aGlzLl9kYXNoU3VtLAogICAgICAgICAgICBhID0gdGhpcy5fZGFzaE9mZnNldCwKICAgICAgICAgICAgbyA9IHRoaXMuX2xpbmVEYXNoLAogICAgICAgICAgICBzID0gdGhpcy5fY3R4LAogICAgICAgICAgICBsID0gdGhpcy5feGksCiAgICAgICAgICAgIGggPSB0aGlzLl95aSwKICAgICAgICAgICAgdSA9IHQgLSBsLAogICAgICAgICAgICBjID0gZSAtIGgsCiAgICAgICAgICAgIGYgPSB4KHUgKiB1ICsgYyAqIGMpLAogICAgICAgICAgICBkID0gbCwKICAgICAgICAgICAgcCA9IGgsCiAgICAgICAgICAgIG0gPSBvLmxlbmd0aDsKCiAgICAgICAgZm9yICh1IC89IGYsIGMgLz0gZiwgYSA8IDAgJiYgKGEgPSBpICsgYSksIGEgJT0gaSwgZCAtPSBhICogdSwgcCAtPSBhICogYzsgdSA+IDAgJiYgZCA8PSB0IHx8IHUgPCAwICYmIGQgPj0gdCB8fCAwID09IHUgJiYgKGMgPiAwICYmIHAgPD0gZSB8fCBjIDwgMCAmJiBwID49IGUpOykgewogICAgICAgICAgbiA9IHRoaXMuX2Rhc2hJZHgsIHIgPSBvW25dLCBkICs9IHUgKiByLCBwICs9IGMgKiByLCB0aGlzLl9kYXNoSWR4ID0gKG4gKyAxKSAlIG0sIHUgPiAwICYmIGQgPCBsIHx8IHUgPCAwICYmIGQgPiBsIHx8IGMgPiAwICYmIHAgPCBoIHx8IGMgPCAwICYmIHAgPiBoIHx8IHNbbiAlIDIgPyAibW92ZVRvIiA6ICJsaW5lVG8iXSh1ID49IDAgPyB2KGQsIHQpIDogZyhkLCB0KSwgYyA+PSAwID8gdihwLCBlKSA6IGcocCwgZSkpOwogICAgICAgIH0KCiAgICAgICAgdSA9IGQgLSB0LCBjID0gcCAtIGUsIHRoaXMuX2Rhc2hPZmZzZXQgPSAteCh1ICogdSArIGMgKiBjKTsKICAgICAgfSwKICAgICAgX2Rhc2hlZEJlemllclRvOiBmdW5jdGlvbiBfZGFzaGVkQmV6aWVyVG8odCwgZSwgciwgaSwgYSwgbykgewogICAgICAgIHZhciBzLAogICAgICAgICAgICBsLAogICAgICAgICAgICBoLAogICAgICAgICAgICB1LAogICAgICAgICAgICBjLAogICAgICAgICAgICBmID0gdGhpcy5fZGFzaFN1bSwKICAgICAgICAgICAgZCA9IHRoaXMuX2Rhc2hPZmZzZXQsCiAgICAgICAgICAgIHYgPSB0aGlzLl9saW5lRGFzaCwKICAgICAgICAgICAgZyA9IHRoaXMuX2N0eCwKICAgICAgICAgICAgcCA9IHRoaXMuX3hpLAogICAgICAgICAgICBtID0gdGhpcy5feWksCiAgICAgICAgICAgIHkgPSBuLmN1YmljQXQsCiAgICAgICAgICAgIHcgPSAwLAogICAgICAgICAgICBfID0gdGhpcy5fZGFzaElkeCwKICAgICAgICAgICAgYiA9IHYubGVuZ3RoLAogICAgICAgICAgICBTID0gMDsKCiAgICAgICAgZm9yIChkIDwgMCAmJiAoZCA9IGYgKyBkKSwgZCAlPSBmLCBzID0gMDsgcyA8IDE7IHMgKz0gLjEpIHsKICAgICAgICAgIGwgPSB5KHAsIHQsIHIsIGEsIHMgKyAuMSkgLSB5KHAsIHQsIHIsIGEsIHMpLCBoID0geShtLCBlLCBpLCBvLCBzICsgLjEpIC0geShtLCBlLCBpLCBvLCBzKSwgdyArPSB4KGwgKiBsICsgaCAqIGgpOwogICAgICAgIH0KCiAgICAgICAgZm9yICg7IF8gPCBiICYmICEoKFMgKz0gdltfXSkgPiBkKTsgXysrKSB7CiAgICAgICAgICA7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHMgPSAoUyAtIGQpIC8gdzsgcyA8PSAxOykgewogICAgICAgICAgdSA9IHkocCwgdCwgciwgYSwgcyksIGMgPSB5KG0sIGUsIGksIG8sIHMpLCBfICUgMiA/IGcubW92ZVRvKHUsIGMpIDogZy5saW5lVG8odSwgYyksIHMgKz0gdltfXSAvIHcsIF8gPSAoXyArIDEpICUgYjsKICAgICAgICB9CgogICAgICAgIF8gJSAyICE9IDAgJiYgZy5saW5lVG8oYSwgbyksIGwgPSBhIC0gdSwgaCA9IG8gLSBjLCB0aGlzLl9kYXNoT2Zmc2V0ID0gLXgobCAqIGwgKyBoICogaCk7CiAgICAgIH0sCiAgICAgIF9kYXNoZWRRdWFkcmF0aWNUbzogZnVuY3Rpb24gX2Rhc2hlZFF1YWRyYXRpY1RvKHQsIGUsIHIsIG4pIHsKICAgICAgICB2YXIgaSA9IHIsCiAgICAgICAgICAgIGEgPSBuOwogICAgICAgIHIgPSAociArIDIgKiB0KSAvIDMsIG4gPSAobiArIDIgKiBlKSAvIDMsIHQgPSAodGhpcy5feGkgKyAyICogdCkgLyAzLCBlID0gKHRoaXMuX3lpICsgMiAqIGUpIC8gMywgdGhpcy5fZGFzaGVkQmV6aWVyVG8odCwgZSwgciwgbiwgaSwgYSk7CiAgICAgIH0sCiAgICAgIHRvU3RhdGljOiBmdW5jdGlvbiB0b1N0YXRpYygpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuZGF0YTsKICAgICAgICB0IGluc3RhbmNlb2YgQXJyYXkgJiYgKHQubGVuZ3RoID0gdGhpcy5fbGVuLCB3ICYmICh0aGlzLmRhdGEgPSBuZXcgRmxvYXQzMkFycmF5KHQpKSk7CiAgICAgIH0sCiAgICAgIGdldEJvdW5kaW5nUmVjdDogZnVuY3Rpb24gZ2V0Qm91bmRpbmdSZWN0KCkgewogICAgICAgIHVbMF0gPSB1WzFdID0gZlswXSA9IGZbMV0gPSBOdW1iZXIuTUFYX1ZBTFVFLCBjWzBdID0gY1sxXSA9IGRbMF0gPSBkWzFdID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICAgIGZvciAodmFyIHQgPSB0aGlzLmRhdGEsIGUgPSAwLCByID0gMCwgbiA9IDAsIHMgPSAwLCBsID0gMDsgbCA8IHQubGVuZ3RoOykgewogICAgICAgICAgdmFyIHYgPSB0W2wrK107CgogICAgICAgICAgc3dpdGNoICgxID09IGwgJiYgKGUgPSB0W2xdLCByID0gdFtsICsgMV0sIG4gPSBlLCBzID0gciksIHYpIHsKICAgICAgICAgICAgY2FzZSBoLk06CiAgICAgICAgICAgICAgbiA9IHRbbCsrXSwgcyA9IHRbbCsrXSwgZSA9IG4sIHIgPSBzLCBmWzBdID0gbiwgZlsxXSA9IHMsIGRbMF0gPSBuLCBkWzFdID0gczsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgaC5MOgogICAgICAgICAgICAgIGEuZnJvbUxpbmUoZSwgciwgdFtsXSwgdFtsICsgMV0sIGYsIGQpLCBlID0gdFtsKytdLCByID0gdFtsKytdOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBoLkM6CiAgICAgICAgICAgICAgYS5mcm9tQ3ViaWMoZSwgciwgdFtsKytdLCB0W2wrK10sIHRbbCsrXSwgdFtsKytdLCB0W2xdLCB0W2wgKyAxXSwgZiwgZCksIGUgPSB0W2wrK10sIHIgPSB0W2wrK107CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIGguUToKICAgICAgICAgICAgICBhLmZyb21RdWFkcmF0aWMoZSwgciwgdFtsKytdLCB0W2wrK10sIHRbbF0sIHRbbCArIDFdLCBmLCBkKSwgZSA9IHRbbCsrXSwgciA9IHRbbCsrXTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgaC5BOgogICAgICAgICAgICAgIHZhciBnID0gdFtsKytdLAogICAgICAgICAgICAgICAgICB4ID0gdFtsKytdLAogICAgICAgICAgICAgICAgICB5ID0gdFtsKytdLAogICAgICAgICAgICAgICAgICB3ID0gdFtsKytdLAogICAgICAgICAgICAgICAgICBfID0gdFtsKytdLAogICAgICAgICAgICAgICAgICBiID0gdFtsKytdICsgXywKICAgICAgICAgICAgICAgICAgUyA9ICh0W2wrK10sIDEgLSB0W2wrK10pOwogICAgICAgICAgICAgIDEgPT0gbCAmJiAobiA9IHAoXykgKiB5ICsgZywgcyA9IG0oXykgKiB3ICsgeCksIGEuZnJvbUFyYyhnLCB4LCB5LCB3LCBfLCBiLCBTLCBmLCBkKSwgZSA9IHAoYikgKiB5ICsgZywgciA9IG0oYikgKiB3ICsgeDsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgaC5SOgogICAgICAgICAgICAgIG4gPSBlID0gdFtsKytdLCBzID0gciA9IHRbbCsrXTsKICAgICAgICAgICAgICB2YXIgTSA9IHRbbCsrXSwKICAgICAgICAgICAgICAgICAgVCA9IHRbbCsrXTsKICAgICAgICAgICAgICBhLmZyb21MaW5lKG4sIHMsIG4gKyBNLCBzICsgVCwgZiwgZCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIGguWjoKICAgICAgICAgICAgICBlID0gbiwgciA9IHM7CiAgICAgICAgICB9CgogICAgICAgICAgaS5taW4odSwgdSwgZiksIGkubWF4KGMsIGMsIGQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDAgPT09IGwgJiYgKHVbMF0gPSB1WzFdID0gY1swXSA9IGNbMV0gPSAwKSwgbmV3IG8odVswXSwgdVsxXSwgY1swXSAtIHVbMF0sIGNbMV0gLSB1WzFdKTsKICAgICAgfSwKICAgICAgcmVidWlsZFBhdGg6IGZ1bmN0aW9uIHJlYnVpbGRQYXRoKHQpIHsKICAgICAgICBmb3IgKHZhciBlLCByLCBuLCBpLCBhLCBvLCBzID0gdGhpcy5kYXRhLCBsID0gdGhpcy5fdXgsIHUgPSB0aGlzLl91eSwgYyA9IHRoaXMuX2xlbiwgZiA9IDA7IGYgPCBjOykgewogICAgICAgICAgdmFyIGQgPSBzW2YrK107CgogICAgICAgICAgc3dpdGNoICgxID09IGYgJiYgKG4gPSBzW2ZdLCBpID0gc1tmICsgMV0sIGUgPSBuLCByID0gaSksIGQpIHsKICAgICAgICAgICAgY2FzZSBoLk06CiAgICAgICAgICAgICAgZSA9IG4gPSBzW2YrK10sIHIgPSBpID0gc1tmKytdLCB0Lm1vdmVUbyhuLCBpKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgaC5MOgogICAgICAgICAgICAgIGEgPSBzW2YrK10sIG8gPSBzW2YrK10sICh5KGEgLSBuKSA+IGwgfHwgeShvIC0gaSkgPiB1IHx8IGYgPT09IGMgLSAxKSAmJiAodC5saW5lVG8oYSwgbyksIG4gPSBhLCBpID0gbyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIGguQzoKICAgICAgICAgICAgICB0LmJlemllckN1cnZlVG8oc1tmKytdLCBzW2YrK10sIHNbZisrXSwgc1tmKytdLCBzW2YrK10sIHNbZisrXSksIG4gPSBzW2YgLSAyXSwgaSA9IHNbZiAtIDFdOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBoLlE6CiAgICAgICAgICAgICAgdC5xdWFkcmF0aWNDdXJ2ZVRvKHNbZisrXSwgc1tmKytdLCBzW2YrK10sIHNbZisrXSksIG4gPSBzW2YgLSAyXSwgaSA9IHNbZiAtIDFdOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBoLkE6CiAgICAgICAgICAgICAgdmFyIHYgPSBzW2YrK10sCiAgICAgICAgICAgICAgICAgIGcgPSBzW2YrK10sCiAgICAgICAgICAgICAgICAgIHggPSBzW2YrK10sCiAgICAgICAgICAgICAgICAgIHcgPSBzW2YrK10sCiAgICAgICAgICAgICAgICAgIF8gPSBzW2YrK10sCiAgICAgICAgICAgICAgICAgIGIgPSBzW2YrK10sCiAgICAgICAgICAgICAgICAgIFMgPSBzW2YrK10sCiAgICAgICAgICAgICAgICAgIE0gPSBzW2YrK10sCiAgICAgICAgICAgICAgICAgIFQgPSB4ID4gdyA/IHggOiB3LAogICAgICAgICAgICAgICAgICBrID0geCA+IHcgPyAxIDogeCAvIHcsCiAgICAgICAgICAgICAgICAgIEMgPSB4ID4gdyA/IHcgLyB4IDogMSwKICAgICAgICAgICAgICAgICAgUCA9IE1hdGguYWJzKHggLSB3KSA+IC4wMDEsCiAgICAgICAgICAgICAgICAgIEkgPSBfICsgYjsKICAgICAgICAgICAgICBQID8gKHQudHJhbnNsYXRlKHYsIGcpLCB0LnJvdGF0ZShTKSwgdC5zY2FsZShrLCBDKSwgdC5hcmMoMCwgMCwgVCwgXywgSSwgMSAtIE0pLCB0LnNjYWxlKDEgLyBrLCAxIC8gQyksIHQucm90YXRlKC1TKSwgdC50cmFuc2xhdGUoLXYsIC1nKSkgOiB0LmFyYyh2LCBnLCBULCBfLCBJLCAxIC0gTSksIDEgPT0gZiAmJiAoZSA9IHAoXykgKiB4ICsgdiwgciA9IG0oXykgKiB3ICsgZyksIG4gPSBwKEkpICogeCArIHYsIGkgPSBtKEkpICogdyArIGc7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIGguUjoKICAgICAgICAgICAgICBlID0gbiA9IHNbZl0sIHIgPSBpID0gc1tmICsgMV0sIHQucmVjdChzW2YrK10sIHNbZisrXSwgc1tmKytdLCBzW2YrK10pOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBoLlo6CiAgICAgICAgICAgICAgdC5jbG9zZVBhdGgoKSwgbiA9IGUsIGkgPSByOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgXy5DTUQgPSBoOwogICAgdmFyIGIgPSBfOwogICAgdC5leHBvcnRzID0gYjsKICB9LCBmdW5jdGlvbiAoZSwgcikgewogICAgZS5leHBvcnRzID0gdDsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgZnVuY3Rpb24gcigpIHsKICAgICAgdmFyIHQgPSBuZXcgdSg2KTsKICAgICAgcmV0dXJuIG4odCksIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHJldHVybiB0WzBdID0gMSwgdFsxXSA9IDAsIHRbMl0gPSAwLCB0WzNdID0gMSwgdFs0XSA9IDAsIHRbNV0gPSAwLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICByZXR1cm4gdFswXSA9IGVbMF0sIHRbMV0gPSBlWzFdLCB0WzJdID0gZVsyXSwgdFszXSA9IGVbM10sIHRbNF0gPSBlWzRdLCB0WzVdID0gZVs1XSwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBhKHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSBlWzBdICogclswXSArIGVbMl0gKiByWzFdLAogICAgICAgICAgaSA9IGVbMV0gKiByWzBdICsgZVszXSAqIHJbMV0sCiAgICAgICAgICBhID0gZVswXSAqIHJbMl0gKyBlWzJdICogclszXSwKICAgICAgICAgIG8gPSBlWzFdICogclsyXSArIGVbM10gKiByWzNdLAogICAgICAgICAgcyA9IGVbMF0gKiByWzRdICsgZVsyXSAqIHJbNV0gKyBlWzRdLAogICAgICAgICAgbCA9IGVbMV0gKiByWzRdICsgZVszXSAqIHJbNV0gKyBlWzVdOwogICAgICByZXR1cm4gdFswXSA9IG4sIHRbMV0gPSBpLCB0WzJdID0gYSwgdFszXSA9IG8sIHRbNF0gPSBzLCB0WzVdID0gbCwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBvKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlWzBdLCB0WzFdID0gZVsxXSwgdFsyXSA9IGVbMl0sIHRbM10gPSBlWzNdLCB0WzRdID0gZVs0XSArIHJbMF0sIHRbNV0gPSBlWzVdICsgclsxXSwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSBlWzBdLAogICAgICAgICAgaSA9IGVbMl0sCiAgICAgICAgICBhID0gZVs0XSwKICAgICAgICAgIG8gPSBlWzFdLAogICAgICAgICAgcyA9IGVbM10sCiAgICAgICAgICBsID0gZVs1XSwKICAgICAgICAgIGggPSBNYXRoLnNpbihyKSwKICAgICAgICAgIHUgPSBNYXRoLmNvcyhyKTsKICAgICAgcmV0dXJuIHRbMF0gPSBuICogdSArIG8gKiBoLCB0WzFdID0gLW4gKiBoICsgbyAqIHUsIHRbMl0gPSBpICogdSArIHMgKiBoLCB0WzNdID0gLWkgKiBoICsgdSAqIHMsIHRbNF0gPSB1ICogYSArIGggKiBsLCB0WzVdID0gdSAqIGwgLSBoICogYSwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSByWzBdLAogICAgICAgICAgaSA9IHJbMV07CiAgICAgIHJldHVybiB0WzBdID0gZVswXSAqIG4sIHRbMV0gPSBlWzFdICogaSwgdFsyXSA9IGVbMl0gKiBuLCB0WzNdID0gZVszXSAqIGksIHRbNF0gPSBlWzRdICogbiwgdFs1XSA9IGVbNV0gKiBpLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGgodCwgZSkgewogICAgICB2YXIgciA9IGVbMF0sCiAgICAgICAgICBuID0gZVsyXSwKICAgICAgICAgIGkgPSBlWzRdLAogICAgICAgICAgYSA9IGVbMV0sCiAgICAgICAgICBvID0gZVszXSwKICAgICAgICAgIHMgPSBlWzVdLAogICAgICAgICAgbCA9IHIgKiBvIC0gYSAqIG47CiAgICAgIHJldHVybiBsID8gKGwgPSAxIC8gbCwgdFswXSA9IG8gKiBsLCB0WzFdID0gLWEgKiBsLCB0WzJdID0gLW4gKiBsLCB0WzNdID0gciAqIGwsIHRbNF0gPSAobiAqIHMgLSBvICogaSkgKiBsLCB0WzVdID0gKGEgKiBpIC0gciAqIHMpICogbCwgdCkgOiBudWxsOwogICAgfQoKICAgIHZhciB1ID0gInVuZGVmaW5lZCIgPT0gdHlwZW9mIEZsb2F0MzJBcnJheSA/IEFycmF5IDogRmxvYXQzMkFycmF5OwogICAgZS5jcmVhdGUgPSByLCBlLmlkZW50aXR5ID0gbiwgZS5jb3B5ID0gaSwgZS5tdWwgPSBhLCBlLnRyYW5zbGF0ZSA9IG8sIGUucm90YXRlID0gcywgZS5zY2FsZSA9IGwsIGUuaW52ZXJ0ID0gaDsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHJldHVybiB0LnJlcGxhY2UoL15ccysvLCAiIikucmVwbGFjZSgvXHMrJC8sICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQsIGUsIHIsIG4pIHsKICAgICAgdmFyIGkgPSBlWzFdIC0gZVswXSwKICAgICAgICAgIGEgPSByWzFdIC0gclswXTsKICAgICAgaWYgKDAgPT09IGkpIHJldHVybiAwID09PSBhID8gclswXSA6IChyWzBdICsgclsxXSkgLyAyOwogICAgICBpZiAobikgewogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgaWYgKHQgPD0gZVswXSkgcmV0dXJuIHJbMF07CiAgICAgICAgICBpZiAodCA+PSBlWzFdKSByZXR1cm4gclsxXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHQgPj0gZVswXSkgcmV0dXJuIHJbMF07CiAgICAgICAgICBpZiAodCA8PSBlWzFdKSByZXR1cm4gclsxXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHQgPT09IGVbMF0pIHJldHVybiByWzBdOwogICAgICAgIGlmICh0ID09PSBlWzFdKSByZXR1cm4gclsxXTsKICAgICAgfQogICAgICByZXR1cm4gKHQgLSBlWzBdKSAvIGkgKiBhICsgclswXTsKICAgIH0KCiAgICBmdW5jdGlvbiBhKHQsIGUpIHsKICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgY2FzZSAiY2VudGVyIjoKICAgICAgICBjYXNlICJtaWRkbGUiOgogICAgICAgICAgdCA9ICI1MCUiOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgIGNhc2UgInRvcCI6CiAgICAgICAgICB0ID0gIjAlIjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgIHQgPSAiMTAwJSI7CiAgICAgIH0KCiAgICAgIHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgdCA/IG4odCkubWF0Y2goLyUkLykgPyBwYXJzZUZsb2F0KHQpIC8gMTAwICogZSA6IHBhcnNlRmxvYXQodCkgOiBudWxsID09IHQgPyBOYU4gOiArdDsKICAgIH0KCiAgICBmdW5jdGlvbiBvKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIG51bGwgPT0gZSAmJiAoZSA9IDEwKSwgZSA9IE1hdGgubWluKE1hdGgubWF4KDAsIGUpLCAyMCksIHQgPSAoK3QpLnRvRml4ZWQoZSksIHIgPyB0IDogK3Q7CiAgICB9CgogICAgZnVuY3Rpb24gcyh0KSB7CiAgICAgIHJldHVybiB0LnNvcnQoZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gdCAtIGU7CiAgICAgIH0pLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGwodCkgewogICAgICBpZiAodCA9ICt0LCBpc05hTih0KSkgcmV0dXJuIDA7CgogICAgICBmb3IgKHZhciBlID0gMSwgciA9IDA7IE1hdGgucm91bmQodCAqIGUpIC8gZSAhPT0gdDspIHsKICAgICAgICBlICo9IDEwLCByKys7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQoKICAgIGZ1bmN0aW9uIGgodCkgewogICAgICB2YXIgZSA9IHQudG9TdHJpbmcoKSwKICAgICAgICAgIHIgPSBlLmluZGV4T2YoImUiKTsKCiAgICAgIGlmIChyID4gMCkgewogICAgICAgIHZhciBuID0gK2Uuc2xpY2UociArIDEpOwogICAgICAgIHJldHVybiBuIDwgMCA/IC1uIDogMDsKICAgICAgfQoKICAgICAgdmFyIGkgPSBlLmluZGV4T2YoIi4iKTsKICAgICAgcmV0dXJuIGkgPCAwID8gMCA6IGUubGVuZ3RoIC0gMSAtIGk7CiAgICB9CgogICAgZnVuY3Rpb24gdSh0LCBlKSB7CiAgICAgIHZhciByID0gTWF0aC5sb2csCiAgICAgICAgICBuID0gTWF0aC5MTjEwLAogICAgICAgICAgaSA9IE1hdGguZmxvb3Iocih0WzFdIC0gdFswXSkgLyBuKSwKICAgICAgICAgIGEgPSBNYXRoLnJvdW5kKHIoTWF0aC5hYnMoZVsxXSAtIGVbMF0pKSAvIG4pLAogICAgICAgICAgbyA9IE1hdGgubWluKE1hdGgubWF4KC1pICsgYSwgMCksIDIwKTsKICAgICAgcmV0dXJuIGlzRmluaXRlKG8pID8gbyA6IDIwOwogICAgfQoKICAgIGZ1bmN0aW9uIGModCwgZSwgcikgewogICAgICBpZiAoIXRbZV0pIHJldHVybiAwOwogICAgICB2YXIgbiA9IHcucmVkdWNlKHQsIGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIHQgKyAoaXNOYU4oZSkgPyAwIDogZSk7CiAgICAgIH0sIDApOwogICAgICBpZiAoMCA9PT0gbikgcmV0dXJuIDA7CgogICAgICBmb3IgKHZhciBpID0gTWF0aC5wb3coMTAsIHIpLCBhID0gdy5tYXAodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gKGlzTmFOKHQpID8gMCA6IHQpIC8gbiAqIGkgKiAxMDA7CiAgICAgIH0pLCBvID0gMTAwICogaSwgcyA9IHcubWFwKGEsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodCk7CiAgICAgIH0pLCBsID0gdy5yZWR1Y2UocywgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gdCArIGU7CiAgICAgIH0sIDApLCBoID0gdy5tYXAoYSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gdCAtIHNbZV07CiAgICAgIH0pOyBsIDwgbzspIHsKICAgICAgICBmb3IgKHZhciB1ID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLCBjID0gbnVsbCwgZiA9IDAsIGQgPSBoLmxlbmd0aDsgZiA8IGQ7ICsrZikgewogICAgICAgICAgaFtmXSA+IHUgJiYgKHUgPSBoW2ZdLCBjID0gZik7CiAgICAgICAgfQoKICAgICAgICArK3NbY10sIGhbY10gPSAwLCArK2w7CiAgICAgIH0KCiAgICAgIHJldHVybiBzW2VdIC8gaTsKICAgIH0KCiAgICBmdW5jdGlvbiBmKHQpIHsKICAgICAgdmFyIGUgPSAyICogTWF0aC5QSTsKICAgICAgcmV0dXJuICh0ICUgZSArIGUpICUgZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkKHQpIHsKICAgICAgcmV0dXJuIHQgPiAtXyAmJiB0IDwgXzsKICAgIH0KCiAgICBmdW5jdGlvbiB2KHQpIHsKICAgICAgaWYgKHQgaW5zdGFuY2VvZiBEYXRlKSByZXR1cm4gdDsKCiAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgdCkgewogICAgICAgIHZhciBlID0gYi5leGVjKHQpOwogICAgICAgIGlmICghZSkgcmV0dXJuIG5ldyBEYXRlKE5hTik7CgogICAgICAgIGlmIChlWzhdKSB7CiAgICAgICAgICB2YXIgciA9ICtlWzRdIHx8IDA7CiAgICAgICAgICByZXR1cm4gIloiICE9PSBlWzhdLnRvVXBwZXJDYXNlKCkgJiYgKHIgLT0gZVs4XS5zbGljZSgwLCAzKSksIG5ldyBEYXRlKERhdGUuVVRDKCtlWzFdLCArKGVbMl0gfHwgMSkgLSAxLCArZVszXSB8fCAxLCByLCArKGVbNV0gfHwgMCksICtlWzZdIHx8IDAsICtlWzddIHx8IDApKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXcgRGF0ZSgrZVsxXSwgKyhlWzJdIHx8IDEpIC0gMSwgK2VbM10gfHwgMSwgK2VbNF0gfHwgMCwgKyhlWzVdIHx8IDApLCArZVs2XSB8fCAwLCArZVs3XSB8fCAwKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGwgPT0gdCA/IG5ldyBEYXRlKE5hTikgOiBuZXcgRGF0ZShNYXRoLnJvdW5kKHQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnKHQpIHsKICAgICAgcmV0dXJuIE1hdGgucG93KDEwLCBwKHQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwKHQpIHsKICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5sb2codCkgLyBNYXRoLkxOMTApOwogICAgfQoKICAgIGZ1bmN0aW9uIG0odCwgZSkgewogICAgICB2YXIgciwKICAgICAgICAgIG4gPSBwKHQpLAogICAgICAgICAgaSA9IE1hdGgucG93KDEwLCBuKSwKICAgICAgICAgIGEgPSB0IC8gaTsKICAgICAgcmV0dXJuIHIgPSBlID8gYSA8IDEuNSA/IDEgOiBhIDwgMi41ID8gMiA6IGEgPCA0ID8gMyA6IGEgPCA3ID8gNSA6IDEwIDogYSA8IDEgPyAxIDogYSA8IDIgPyAyIDogYSA8IDMgPyAzIDogYSA8IDUgPyA1IDogMTAsIHQgPSByICogaSwgbiA+PSAtMjAgPyArdC50b0ZpeGVkKG4gPCAwID8gLW4gOiAwKSA6IHQ7CiAgICB9CgogICAgZnVuY3Rpb24geCh0KSB7CiAgICAgIGZ1bmN0aW9uIGUodCwgciwgbikgewogICAgICAgIHJldHVybiB0LmludGVydmFsW25dIDwgci5pbnRlcnZhbFtuXSB8fCB0LmludGVydmFsW25dID09PSByLmludGVydmFsW25dICYmICh0LmNsb3NlW25dIC0gci5jbG9zZVtuXSA9PSAobiA/IC0xIDogMSkgfHwgIW4gJiYgZSh0LCByLCAxKSk7CiAgICAgIH0KCiAgICAgIHQuc29ydChmdW5jdGlvbiAodCwgcikgewogICAgICAgIHJldHVybiBlKHQsIHIsIDApID8gLTEgOiAxOwogICAgICB9KTsKCiAgICAgIGZvciAodmFyIHIgPSAtMSAvIDAsIG4gPSAxLCBpID0gMDsgaSA8IHQubGVuZ3RoOykgewogICAgICAgIGZvciAodmFyIGEgPSB0W2ldLmludGVydmFsLCBvID0gdFtpXS5jbG9zZSwgcyA9IDA7IHMgPCAyOyBzKyspIHsKICAgICAgICAgIGFbc10gPD0gciAmJiAoYVtzXSA9IHIsIG9bc10gPSBzID8gMSA6IDEgLSBuKSwgciA9IGFbc10sIG4gPSBvW3NdOwogICAgICAgIH0KCiAgICAgICAgYVswXSA9PT0gYVsxXSAmJiBvWzBdICogb1sxXSAhPSAxID8gdC5zcGxpY2UoaSwgMSkgOiBpKys7CiAgICAgIH0KCiAgICAgIHJldHVybiB0OwogICAgfQoKICAgIGZ1bmN0aW9uIHkodCkgewogICAgICByZXR1cm4gdCAtIHBhcnNlRmxvYXQodCkgPj0gMDsKICAgIH0KCiAgICB2YXIgdyA9IHIoMCksCiAgICAgICAgXyA9IDFlLTQsCiAgICAgICAgYiA9IC9eKD86KFxkezR9KSg/OlstXC9dKFxkezEsMn0pKD86Wy1cL10oXGR7MSwyfSkoPzpbVCBdKFxkezEsMn0pKD86OihcZFxkKSg/OjooXGRcZCkoPzpbLixdKFxkKykpPyk/KT8oWnxbXCtcLV1cZFxkOj9cZFxkKT8pPyk/KT8pPyQvOwogICAgZS5saW5lYXJNYXAgPSBpLCBlLnBhcnNlUGVyY2VudCA9IGEsIGUucm91bmQgPSBvLCBlLmFzYyA9IHMsIGUuZ2V0UHJlY2lzaW9uID0gbCwgZS5nZXRQcmVjaXNpb25TYWZlID0gaCwgZS5nZXRQaXhlbFByZWNpc2lvbiA9IHUsIGUuZ2V0UGVyY2VudFdpdGhQcmVjaXNpb24gPSBjLCBlLk1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxLCBlLnJlbVJhZGlhbiA9IGYsIGUuaXNSYWRpYW5Bcm91bmRaZXJvID0gZCwgZS5wYXJzZURhdGUgPSB2LCBlLnF1YW50aXR5ID0gZywgZS5uaWNlID0gbSwgZS5yZWZvcm1JbnRlcnZhbHMgPSB4LCBlLmlzTnVtZXJpYyA9IHk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHQpIHsKICAgICAgICB2YXIgZSA9IGwuZ2V0KHQpOwogICAgICAgIHJldHVybiBlICYmIGUuaW1hZ2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSwgciwgbiwgaSkgewogICAgICBpZiAodCkgewogICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgdCkgewogICAgICAgICAgaWYgKGUgJiYgZS5fX3pySW1hZ2VTcmMgPT09IHQgfHwgIXIpIHJldHVybiBlOwogICAgICAgICAgdmFyIHMgPSBsLmdldCh0KSwKICAgICAgICAgICAgICBoID0gewogICAgICAgICAgICBob3N0RWw6IHIsCiAgICAgICAgICAgIGNiOiBuLAogICAgICAgICAgICBjYlBheWxvYWQ6IGkKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gcyA/IChlID0gcy5pbWFnZSwgIW8oZSkgJiYgcy5wZW5kaW5nLnB1c2goaCkpIDogKCFlICYmIChlID0gbmV3IEltYWdlKCkpLCBlLm9ubG9hZCA9IGEsIGwucHV0KHQsIGUuX19jYWNoZWRJbWdPYmogPSB7CiAgICAgICAgICAgIGltYWdlOiBlLAogICAgICAgICAgICBwZW5kaW5nOiBbaF0KICAgICAgICAgIH0pLCBlLnNyYyA9IGUuX196ckltYWdlU3JjID0gdCksIGU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdDsKICAgICAgfQoKICAgICAgcmV0dXJuIGU7CiAgICB9CgogICAgZnVuY3Rpb24gYSgpIHsKICAgICAgdmFyIHQgPSB0aGlzLl9fY2FjaGVkSW1nT2JqOwogICAgICB0aGlzLm9ubG9hZCA9IHRoaXMuX19jYWNoZWRJbWdPYmogPSBudWxsOwoKICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCB0LnBlbmRpbmcubGVuZ3RoOyBlKyspIHsKICAgICAgICB2YXIgciA9IHQucGVuZGluZ1tlXSwKICAgICAgICAgICAgbiA9IHIuY2I7CiAgICAgICAgbiAmJiBuKHRoaXMsIHIuY2JQYXlsb2FkKSwgci5ob3N0RWwuZGlydHkoKTsKICAgICAgfQoKICAgICAgdC5wZW5kaW5nLmxlbmd0aCA9IDA7CiAgICB9CgogICAgZnVuY3Rpb24gbyh0KSB7CiAgICAgIHJldHVybiB0ICYmIHQud2lkdGggJiYgdC5oZWlnaHQ7CiAgICB9CgogICAgdmFyIHMgPSByKDE0KSwKICAgICAgICBsID0gbmV3IHMoNTApOwogICAgZS5maW5kRXhpc3RJbWFnZSA9IG4sIGUuY3JlYXRlT3JVcGRhdGVJbWFnZSA9IGksIGUuaXNJbWFnZVJlYWR5ID0gbzsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUrKykgewogICAgICAgIHRbZV1bMV0gfHwgKHRbZV1bMV0gPSB0W2VdWzBdKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlLCByLCBuKSB7CiAgICAgICAgZm9yICh2YXIgYSA9IHt9LCBvID0gMDsgbyA8IHQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgIHZhciBzID0gdFtvXVsxXTsKCiAgICAgICAgICBpZiAoIShyICYmIGkuaW5kZXhPZihyLCBzKSA+PSAwIHx8IG4gJiYgaS5pbmRleE9mKG4sIHMpIDwgMCkpIHsKICAgICAgICAgICAgdmFyIGwgPSBlLmdldFNoYWxsb3cocyk7CiAgICAgICAgICAgIG51bGwgIT0gbCAmJiAoYVt0W29dWzBdXSA9IGwpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGE7CiAgICAgIH07CiAgICB9CgogICAgdmFyIGkgPSByKDApOwogICAgdC5leHBvcnRzID0gbjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHQgPSB0IHx8IHt9LCBvLmNhbGwodGhpcywgdCk7CgogICAgICBmb3IgKHZhciBlIGluIHQpIHsKICAgICAgICB0Lmhhc093blByb3BlcnR5KGUpICYmICJzdHlsZSIgIT09IGUgJiYgKHRoaXNbZV0gPSB0W2VdKTsKICAgICAgfQoKICAgICAgdGhpcy5zdHlsZSA9IG5ldyBhKHQuc3R5bGUsIHRoaXMpLCB0aGlzLl9yZWN0ID0gbnVsbCwgdGhpcy5fX2NsaXBQYXRocyA9IFtdOwogICAgfQoKICAgIHZhciBpID0gcigwKSwKICAgICAgICBhID0gcig0MCksCiAgICAgICAgbyA9IHIoMTYpLAogICAgICAgIHMgPSByKDQ4KTsKICAgIG4ucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogbiwKICAgICAgdHlwZTogImRpc3BsYXlhYmxlIiwKICAgICAgX19kaXJ0eTogITAsCiAgICAgIGludmlzaWJsZTogITEsCiAgICAgIHo6IDAsCiAgICAgIHoyOiAwLAogICAgICB6bGV2ZWw6IDAsCiAgICAgIGRyYWdnYWJsZTogITEsCiAgICAgIGRyYWdnaW5nOiAhMSwKICAgICAgc2lsZW50OiAhMSwKICAgICAgY3VsbGluZzogITEsCiAgICAgIGN1cnNvcjogInBvaW50ZXIiLAogICAgICByZWN0SG92ZXI6ICExLAogICAgICBwcm9ncmVzc2l2ZTogLTEsCiAgICAgIGJlZm9yZUJydXNoOiBmdW5jdGlvbiBiZWZvcmVCcnVzaCh0KSB7fSwKICAgICAgYWZ0ZXJCcnVzaDogZnVuY3Rpb24gYWZ0ZXJCcnVzaCh0KSB7fSwKICAgICAgYnJ1c2g6IGZ1bmN0aW9uIGJydXNoKHQsIGUpIHt9LAogICAgICBnZXRCb3VuZGluZ1JlY3Q6IGZ1bmN0aW9uIGdldEJvdW5kaW5nUmVjdCgpIHt9LAogICAgICBjb250YWluOiBmdW5jdGlvbiBjb250YWluKHQsIGUpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZWN0Q29udGFpbih0LCBlKTsKICAgICAgfSwKICAgICAgdHJhdmVyc2U6IGZ1bmN0aW9uIHRyYXZlcnNlKHQsIGUpIHsKICAgICAgICB0LmNhbGwoZSwgdGhpcyk7CiAgICAgIH0sCiAgICAgIHJlY3RDb250YWluOiBmdW5jdGlvbiByZWN0Q29udGFpbih0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLnRyYW5zZm9ybUNvb3JkVG9Mb2NhbCh0LCBlKTsKICAgICAgICByZXR1cm4gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKS5jb250YWluKHJbMF0sIHJbMV0pOwogICAgICB9LAogICAgICBkaXJ0eTogZnVuY3Rpb24gZGlydHkoKSB7CiAgICAgICAgdGhpcy5fX2RpcnR5ID0gITAsIHRoaXMuX3JlY3QgPSBudWxsLCB0aGlzLl9fenIgJiYgdGhpcy5fX3pyLnJlZnJlc2goKTsKICAgICAgfSwKICAgICAgYW5pbWF0ZVN0eWxlOiBmdW5jdGlvbiBhbmltYXRlU3R5bGUodCkgewogICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGUoInN0eWxlIiwgdCk7CiAgICAgIH0sCiAgICAgIGF0dHJLVjogZnVuY3Rpb24gYXR0cktWKHQsIGUpIHsKICAgICAgICAic3R5bGUiICE9PSB0ID8gby5wcm90b3R5cGUuYXR0cktWLmNhbGwodGhpcywgdCwgZSkgOiB0aGlzLnN0eWxlLnNldChlKTsKICAgICAgfSwKICAgICAgc2V0U3R5bGU6IGZ1bmN0aW9uIHNldFN0eWxlKHQsIGUpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHlsZS5zZXQodCwgZSksIHRoaXMuZGlydHkoITEpLCB0aGlzOwogICAgICB9LAogICAgICB1c2VTdHlsZTogZnVuY3Rpb24gdXNlU3R5bGUodCkgewogICAgICAgIHJldHVybiB0aGlzLnN0eWxlID0gbmV3IGEodCwgdGhpcyksIHRoaXMuZGlydHkoITEpLCB0aGlzOwogICAgICB9CiAgICB9LCBpLmluaGVyaXRzKG4sIG8pLCBpLm1peGluKG4sIHMpOwogICAgdmFyIGwgPSBuOwogICAgdC5leHBvcnRzID0gbDsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHJldHVybiBpc05hTih0KSA/ICItIiA6ICh0ID0gKHQgKyAiIikuc3BsaXQoIi4iKSwgdFswXS5yZXBsYWNlKC8oXGR7MSwzfSkoPz0oPzpcZHszfSkrKD8hXGQpKS9nLCAiJDEsIikgKyAodC5sZW5ndGggPiAxID8gIi4iICsgdFsxXSA6ICIiKSk7CiAgICB9CgogICAgZnVuY3Rpb24gaSh0LCBlKSB7CiAgICAgIHJldHVybiB0ID0gKHQgfHwgIiIpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvLSguKS9nLCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiBlLnRvVXBwZXJDYXNlKCk7CiAgICAgIH0pLCBlICYmIHQgJiYgKHQgPSB0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdC5zbGljZSgxKSksIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gYSh0KSB7CiAgICAgIHJldHVybiBTdHJpbmcodCkucmVwbGFjZSgvJi9nLCAiJmFtcDsiKS5yZXBsYWNlKC88L2csICImbHQ7IikucmVwbGFjZSgvPi9nLCAiJmd0OyIpLnJlcGxhY2UoLyIvZywgIiZxdW90OyIpLnJlcGxhY2UoLycvZywgIiYjMzk7Iik7CiAgICB9CgogICAgZnVuY3Rpb24gbyh0LCBlLCByKSB7CiAgICAgIGMuaXNBcnJheShlKSB8fCAoZSA9IFtlXSk7CiAgICAgIHZhciBuID0gZS5sZW5ndGg7CiAgICAgIGlmICghbikgcmV0dXJuICIiOwoKICAgICAgZm9yICh2YXIgaSA9IGVbMF0uJHZhcnMgfHwgW10sIG8gPSAwOyBvIDwgaS5sZW5ndGg7IG8rKykgewogICAgICAgIHZhciBzID0gZ1tvXSwKICAgICAgICAgICAgbCA9IHAocywgMCk7CiAgICAgICAgdCA9IHQucmVwbGFjZShwKHMpLCByID8gYShsKSA6IGwpOwogICAgICB9CgogICAgICBmb3IgKHZhciBoID0gMDsgaCA8IG47IGgrKykgewogICAgICAgIGZvciAodmFyIHUgPSAwOyB1IDwgaS5sZW5ndGg7IHUrKykgewogICAgICAgICAgdmFyIGwgPSBlW2hdW2lbdV1dOwogICAgICAgICAgdCA9IHQucmVwbGFjZShwKGdbdV0sIGgpLCByID8gYShsKSA6IGwpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gcyh0LCBlLCByKSB7CiAgICAgIHJldHVybiBjLmVhY2goZSwgZnVuY3Rpb24gKGUsIG4pIHsKICAgICAgICB0ID0gdC5yZXBsYWNlKCJ7IiArIG4gKyAifSIsIHIgPyBhKGUpIDogZSk7CiAgICAgIH0pLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGwodCwgZSkgewogICAgICByZXR1cm4gdCA/ICc8c3BhbiBzdHlsZT0iZGlzcGxheTppbmxpbmUtYmxvY2s7bWFyZ2luLXJpZ2h0OjVweDtib3JkZXItcmFkaXVzOjEwcHg7d2lkdGg6OXB4O2hlaWdodDo5cHg7YmFja2dyb3VuZC1jb2xvcjonICsgYSh0KSArICI7IiArIChlIHx8ICIiKSArICciPjwvc3Bhbj4nIDogIiI7CiAgICB9CgogICAgZnVuY3Rpb24gaCh0LCBlLCByKSB7CiAgICAgICJ3ZWVrIiAhPT0gdCAmJiAibW9udGgiICE9PSB0ICYmICJxdWFydGVyIiAhPT0gdCAmJiAiaGFsZi15ZWFyIiAhPT0gdCAmJiAieWVhciIgIT09IHQgfHwgKHQgPSAiTU0tZGRcbnl5eXkiKTsKICAgICAgdmFyIG4gPSBkLnBhcnNlRGF0ZShlKSwKICAgICAgICAgIGkgPSByID8gIlVUQyIgOiAiIiwKICAgICAgICAgIGEgPSBuWyJnZXQiICsgaSArICJGdWxsWWVhciJdKCksCiAgICAgICAgICBvID0gblsiZ2V0IiArIGkgKyAiTW9udGgiXSgpICsgMSwKICAgICAgICAgIHMgPSBuWyJnZXQiICsgaSArICJEYXRlIl0oKSwKICAgICAgICAgIGwgPSBuWyJnZXQiICsgaSArICJIb3VycyJdKCksCiAgICAgICAgICBoID0gblsiZ2V0IiArIGkgKyAiTWludXRlcyJdKCksCiAgICAgICAgICB1ID0gblsiZ2V0IiArIGkgKyAiU2Vjb25kcyJdKCk7CiAgICAgIHJldHVybiB0ID0gdC5yZXBsYWNlKCJNTSIsIG0obykpLnJlcGxhY2UoIk0iLCBvKS5yZXBsYWNlKCJ5eXl5IiwgYSkucmVwbGFjZSgieXkiLCBhICUgMTAwKS5yZXBsYWNlKCJkZCIsIG0ocykpLnJlcGxhY2UoImQiLCBzKS5yZXBsYWNlKCJoaCIsIG0obCkpLnJlcGxhY2UoImgiLCBsKS5yZXBsYWNlKCJtbSIsIG0oaCkpLnJlcGxhY2UoIm0iLCBoKS5yZXBsYWNlKCJzcyIsIG0odSkpLnJlcGxhY2UoInMiLCB1KTsKICAgIH0KCiAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgcmV0dXJuIHQgPyB0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdC5zdWJzdHIoMSkgOiB0OwogICAgfQoKICAgIHZhciBjID0gcigwKSwKICAgICAgICBmID0gcig1KSwKICAgICAgICBkID0gcig5KSwKICAgICAgICB2ID0gYy5ub3JtYWxpemVDc3NBcnJheSwKICAgICAgICBnID0gWyJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIl0sCiAgICAgICAgcCA9IGZ1bmN0aW9uIHAodCwgZSkgewogICAgICByZXR1cm4gInsiICsgdCArIChudWxsID09IGUgPyAiIiA6IGUpICsgIn0iOwogICAgfSwKICAgICAgICBtID0gZnVuY3Rpb24gbSh0KSB7CiAgICAgIHJldHVybiB0IDwgMTAgPyAiMCIgKyB0IDogdDsKICAgIH0sCiAgICAgICAgeCA9IGYudHJ1bmNhdGVUZXh0LAogICAgICAgIHkgPSBmLmdldEJvdW5kaW5nUmVjdDsKCiAgICBlLmFkZENvbW1hcyA9IG4sIGUudG9DYW1lbENhc2UgPSBpLCBlLm5vcm1hbGl6ZUNzc0FycmF5ID0gdiwgZS5lbmNvZGVIVE1MID0gYSwgZS5mb3JtYXRUcGwgPSBvLCBlLmZvcm1hdFRwbFNpbXBsZSA9IHMsIGUuZ2V0VG9vbHRpcE1hcmtlciA9IGwsIGUuZm9ybWF0VGltZSA9IGgsIGUuY2FwaXRhbEZpcnN0ID0gdSwgZS50cnVuY2F0ZVRleHQgPSB4LCBlLmdldFRleHRSZWN0ID0geTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHIgPSBmdW5jdGlvbiByKCkgewogICAgICB0aGlzLmhlYWQgPSBudWxsLCB0aGlzLnRhaWwgPSBudWxsLCB0aGlzLl9sZW4gPSAwOwogICAgfSwKICAgICAgICBuID0gci5wcm90b3R5cGU7CgogICAgbi5pbnNlcnQgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IG5ldyBpKHQpOwogICAgICByZXR1cm4gdGhpcy5pbnNlcnRFbnRyeShlKSwgZTsKICAgIH0sIG4uaW5zZXJ0RW50cnkgPSBmdW5jdGlvbiAodCkgewogICAgICB0aGlzLmhlYWQgPyAodGhpcy50YWlsLm5leHQgPSB0LCB0LnByZXYgPSB0aGlzLnRhaWwsIHQubmV4dCA9IG51bGwsIHRoaXMudGFpbCA9IHQpIDogdGhpcy5oZWFkID0gdGhpcy50YWlsID0gdCwgdGhpcy5fbGVuKys7CiAgICB9LCBuLnJlbW92ZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0gdC5wcmV2LAogICAgICAgICAgciA9IHQubmV4dDsKICAgICAgZSA/IGUubmV4dCA9IHIgOiB0aGlzLmhlYWQgPSByLCByID8gci5wcmV2ID0gZSA6IHRoaXMudGFpbCA9IGUsIHQubmV4dCA9IHQucHJldiA9IG51bGwsIHRoaXMuX2xlbi0tOwogICAgfSwgbi5sZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9sZW47CiAgICB9LCBuLmNsZWFyID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmhlYWQgPSB0aGlzLnRhaWwgPSBudWxsLCB0aGlzLl9sZW4gPSAwOwogICAgfTsKCiAgICB2YXIgaSA9IGZ1bmN0aW9uIGkodCkgewogICAgICB0aGlzLnZhbHVlID0gdCwgdGhpcy5uZXh0LCB0aGlzLnByZXY7CiAgICB9LAogICAgICAgIGEgPSBmdW5jdGlvbiBhKHQpIHsKICAgICAgdGhpcy5fbGlzdCA9IG5ldyByKCksIHRoaXMuX21hcCA9IHt9LCB0aGlzLl9tYXhTaXplID0gdCB8fCAxMCwgdGhpcy5fbGFzdFJlbW92ZWRFbnRyeSA9IG51bGw7CiAgICB9LAogICAgICAgIG8gPSBhLnByb3RvdHlwZTsKCiAgICBvLnB1dCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIHZhciByID0gdGhpcy5fbGlzdCwKICAgICAgICAgIG4gPSB0aGlzLl9tYXAsCiAgICAgICAgICBhID0gbnVsbDsKCiAgICAgIGlmIChudWxsID09IG5bdF0pIHsKICAgICAgICB2YXIgbyA9IHIubGVuKCksCiAgICAgICAgICAgIHMgPSB0aGlzLl9sYXN0UmVtb3ZlZEVudHJ5OwoKICAgICAgICBpZiAobyA+PSB0aGlzLl9tYXhTaXplICYmIG8gPiAwKSB7CiAgICAgICAgICB2YXIgbCA9IHIuaGVhZDsKICAgICAgICAgIHIucmVtb3ZlKGwpLCBkZWxldGUgbltsLmtleV0sIGEgPSBsLnZhbHVlLCB0aGlzLl9sYXN0UmVtb3ZlZEVudHJ5ID0gbDsKICAgICAgICB9CgogICAgICAgIHMgPyBzLnZhbHVlID0gZSA6IHMgPSBuZXcgaShlKSwgcy5rZXkgPSB0LCByLmluc2VydEVudHJ5KHMpLCBuW3RdID0gczsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9LCBvLmdldCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0gdGhpcy5fbWFwW3RdLAogICAgICAgICAgciA9IHRoaXMuX2xpc3Q7CiAgICAgIGlmIChudWxsICE9IGUpIHJldHVybiBlICE9PSByLnRhaWwgJiYgKHIucmVtb3ZlKGUpLCByLmluc2VydEVudHJ5KGUpKSwgZS52YWx1ZTsKICAgIH0sIG8uY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuX2xpc3QuY2xlYXIoKSwgdGhpcy5fbWFwID0ge307CiAgICB9OwogICAgdmFyIHMgPSBhOwogICAgdC5leHBvcnRzID0gczsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHIgPSB7fTsKICAgIHIgPSAidW5kZWZpbmVkIiA9PSB0eXBlb2YgbmF2aWdhdG9yID8gewogICAgICBicm93c2VyOiB7fSwKICAgICAgb3M6IHt9LAogICAgICBub2RlOiAhMCwKICAgICAgY2FudmFzU3VwcG9ydGVkOiAhMCwKICAgICAgc3ZnU3VwcG9ydGVkOiAhMAogICAgfSA6IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0ge30sCiAgICAgICAgICByID0ge30sCiAgICAgICAgICBuID0gdC5tYXRjaCgvRmlyZWZveFwvKFtcZC5dKykvKSwKICAgICAgICAgIGkgPSB0Lm1hdGNoKC9NU0lFXHMoW1xkLl0rKS8pIHx8IHQubWF0Y2goL1RyaWRlbnRcLy4rP3J2OigoW1xkLl0rKSkvKSwKICAgICAgICAgIGEgPSB0Lm1hdGNoKC9FZGdlXC8oW1xkLl0rKS8pLAogICAgICAgICAgbyA9IC9taWNyb21lc3Nlbmdlci9pLnRlc3QodCk7CiAgICAgIHJldHVybiBuICYmIChyLmZpcmVmb3ggPSAhMCwgci52ZXJzaW9uID0gblsxXSksIGkgJiYgKHIuaWUgPSAhMCwgci52ZXJzaW9uID0gaVsxXSksIGEgJiYgKHIuZWRnZSA9ICEwLCByLnZlcnNpb24gPSBhWzFdKSwgbyAmJiAoci53ZUNoYXQgPSAhMCksIHsKICAgICAgICBicm93c2VyOiByLAogICAgICAgIG9zOiBlLAogICAgICAgIG5vZGU6ICExLAogICAgICAgIGNhbnZhc1N1cHBvcnRlZDogISFkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKS5nZXRDb250ZXh0LAogICAgICAgIHN2Z1N1cHBvcnRlZDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFNWR1JlY3QsCiAgICAgICAgdG91Y2hFdmVudHNTdXBwb3J0ZWQ6ICJvbnRvdWNoc3RhcnQiIGluIHdpbmRvdyAmJiAhci5pZSAmJiAhci5lZGdlLAogICAgICAgIHBvaW50ZXJFdmVudHNTdXBwb3J0ZWQ6ICJvbnBvaW50ZXJkb3duIiBpbiB3aW5kb3cgJiYgKHIuZWRnZSB8fCByLmllICYmIHIudmVyc2lvbiA+PSAxMSkKICAgICAgfTsKICAgIH0obmF2aWdhdG9yLnVzZXJBZ2VudCk7CiAgICB2YXIgbiA9IHI7CiAgICB0LmV4cG9ydHMgPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoNDEpLAogICAgICAgIGkgPSByKDQyKSwKICAgICAgICBhID0gcigxNyksCiAgICAgICAgbyA9IHIoNDMpLAogICAgICAgIHMgPSByKDApLAogICAgICAgIGwgPSBmdW5jdGlvbiBsKHQpIHsKICAgICAgYS5jYWxsKHRoaXMsIHQpLCBpLmNhbGwodGhpcywgdCksIG8uY2FsbCh0aGlzLCB0KSwgdGhpcy5pZCA9IHQuaWQgfHwgbigpOwogICAgfTsKCiAgICBsLnByb3RvdHlwZSA9IHsKICAgICAgdHlwZTogImVsZW1lbnQiLAogICAgICBuYW1lOiAiIiwKICAgICAgX196cjogbnVsbCwKICAgICAgaWdub3JlOiAhMSwKICAgICAgY2xpcFBhdGg6IG51bGwsCiAgICAgIGRyaWZ0OiBmdW5jdGlvbiBkcmlmdCh0LCBlKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLmRyYWdnYWJsZSkgewogICAgICAgICAgY2FzZSAiaG9yaXpvbnRhbCI6CiAgICAgICAgICAgIGUgPSAwOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICJ2ZXJ0aWNhbCI6CiAgICAgICAgICAgIHQgPSAwOwogICAgICAgIH0KCiAgICAgICAgdmFyIHIgPSB0aGlzLnRyYW5zZm9ybTsKICAgICAgICByIHx8IChyID0gdGhpcy50cmFuc2Zvcm0gPSBbMSwgMCwgMCwgMSwgMCwgMF0pLCByWzRdICs9IHQsIHJbNV0gKz0gZSwgdGhpcy5kZWNvbXBvc2VUcmFuc2Zvcm0oKSwgdGhpcy5kaXJ0eSghMSk7CiAgICAgIH0sCiAgICAgIGJlZm9yZVVwZGF0ZTogZnVuY3Rpb24gYmVmb3JlVXBkYXRlKCkge30sCiAgICAgIGFmdGVyVXBkYXRlOiBmdW5jdGlvbiBhZnRlclVwZGF0ZSgpIHt9LAogICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZSgpIHsKICAgICAgICB0aGlzLnVwZGF0ZVRyYW5zZm9ybSgpOwogICAgICB9LAogICAgICB0cmF2ZXJzZTogZnVuY3Rpb24gdHJhdmVyc2UodCwgZSkge30sCiAgICAgIGF0dHJLVjogZnVuY3Rpb24gYXR0cktWKHQsIGUpIHsKICAgICAgICBpZiAoInBvc2l0aW9uIiA9PT0gdCB8fCAic2NhbGUiID09PSB0IHx8ICJvcmlnaW4iID09PSB0KSB7CiAgICAgICAgICBpZiAoZSkgewogICAgICAgICAgICB2YXIgciA9IHRoaXNbdF07CiAgICAgICAgICAgIHIgfHwgKHIgPSB0aGlzW3RdID0gW10pLCByWzBdID0gZVswXSwgclsxXSA9IGVbMV07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHRoaXNbdF0gPSBlOwogICAgICB9LAogICAgICBoaWRlOiBmdW5jdGlvbiBoaWRlKCkgewogICAgICAgIHRoaXMuaWdub3JlID0gITAsIHRoaXMuX196ciAmJiB0aGlzLl9fenIucmVmcmVzaCgpOwogICAgICB9LAogICAgICBzaG93OiBmdW5jdGlvbiBzaG93KCkgewogICAgICAgIHRoaXMuaWdub3JlID0gITEsIHRoaXMuX196ciAmJiB0aGlzLl9fenIucmVmcmVzaCgpOwogICAgICB9LAogICAgICBhdHRyOiBmdW5jdGlvbiBhdHRyKHQsIGUpIHsKICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHQpIHRoaXMuYXR0cktWKHQsIGUpO2Vsc2UgaWYgKHMuaXNPYmplY3QodCkpIGZvciAodmFyIHIgaW4gdCkgewogICAgICAgICAgdC5oYXNPd25Qcm9wZXJ0eShyKSAmJiB0aGlzLmF0dHJLVihyLCB0W3JdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZGlydHkoITEpLCB0aGlzOwogICAgICB9LAogICAgICBzZXRDbGlwUGF0aDogZnVuY3Rpb24gc2V0Q2xpcFBhdGgodCkgewogICAgICAgIHZhciBlID0gdGhpcy5fX3pyOwogICAgICAgIGUgJiYgdC5hZGRTZWxmVG9acihlKSwgdGhpcy5jbGlwUGF0aCAmJiB0aGlzLmNsaXBQYXRoICE9PSB0ICYmIHRoaXMucmVtb3ZlQ2xpcFBhdGgoKSwgdGhpcy5jbGlwUGF0aCA9IHQsIHQuX196ciA9IGUsIHQuX19jbGlwVGFyZ2V0ID0gdGhpcywgdGhpcy5kaXJ0eSghMSk7CiAgICAgIH0sCiAgICAgIHJlbW92ZUNsaXBQYXRoOiBmdW5jdGlvbiByZW1vdmVDbGlwUGF0aCgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuY2xpcFBhdGg7CiAgICAgICAgdCAmJiAodC5fX3pyICYmIHQucmVtb3ZlU2VsZkZyb21acih0Ll9fenIpLCB0Ll9fenIgPSBudWxsLCB0Ll9fY2xpcFRhcmdldCA9IG51bGwsIHRoaXMuY2xpcFBhdGggPSBudWxsLCB0aGlzLmRpcnR5KCExKSk7CiAgICAgIH0sCiAgICAgIGFkZFNlbGZUb1pyOiBmdW5jdGlvbiBhZGRTZWxmVG9acih0KSB7CiAgICAgICAgdGhpcy5fX3pyID0gdDsKICAgICAgICB2YXIgZSA9IHRoaXMuYW5pbWF0b3JzOwogICAgICAgIGlmIChlKSBmb3IgKHZhciByID0gMDsgciA8IGUubGVuZ3RoOyByKyspIHsKICAgICAgICAgIHQuYW5pbWF0aW9uLmFkZEFuaW1hdG9yKGVbcl0pOwogICAgICAgIH0KICAgICAgICB0aGlzLmNsaXBQYXRoICYmIHRoaXMuY2xpcFBhdGguYWRkU2VsZlRvWnIodCk7CiAgICAgIH0sCiAgICAgIHJlbW92ZVNlbGZGcm9tWnI6IGZ1bmN0aW9uIHJlbW92ZVNlbGZGcm9tWnIodCkgewogICAgICAgIHRoaXMuX196ciA9IG51bGw7CiAgICAgICAgdmFyIGUgPSB0aGlzLmFuaW1hdG9yczsKICAgICAgICBpZiAoZSkgZm9yICh2YXIgciA9IDA7IHIgPCBlLmxlbmd0aDsgcisrKSB7CiAgICAgICAgICB0LmFuaW1hdGlvbi5yZW1vdmVBbmltYXRvcihlW3JdKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jbGlwUGF0aCAmJiB0aGlzLmNsaXBQYXRoLnJlbW92ZVNlbGZGcm9tWnIodCk7CiAgICAgIH0KICAgIH0sIHMubWl4aW4obCwgbyksIHMubWl4aW4obCwgYSksIHMubWl4aW4obCwgaSk7CiAgICB2YXIgaCA9IGw7CiAgICB0LmV4cG9ydHMgPSBoOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgcmV0dXJuIHQgPiBzIHx8IHQgPCAtczsKICAgIH0KCiAgICB2YXIgaSA9IHIoOCksCiAgICAgICAgYSA9IHIoMiksCiAgICAgICAgbyA9IGkuaWRlbnRpdHksCiAgICAgICAgcyA9IDVlLTUsCiAgICAgICAgbCA9IGZ1bmN0aW9uIGwodCkgewogICAgICB0ID0gdCB8fCB7fSwgdC5wb3NpdGlvbiB8fCAodGhpcy5wb3NpdGlvbiA9IFswLCAwXSksIG51bGwgPT0gdC5yb3RhdGlvbiAmJiAodGhpcy5yb3RhdGlvbiA9IDApLCB0LnNjYWxlIHx8ICh0aGlzLnNjYWxlID0gWzEsIDFdKSwgdGhpcy5vcmlnaW4gPSB0aGlzLm9yaWdpbiB8fCBudWxsOwogICAgfSwKICAgICAgICBoID0gbC5wcm90b3R5cGU7CgogICAgaC50cmFuc2Zvcm0gPSBudWxsLCBoLm5lZWRMb2NhbFRyYW5zZm9ybSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG4odGhpcy5yb3RhdGlvbikgfHwgbih0aGlzLnBvc2l0aW9uWzBdKSB8fCBuKHRoaXMucG9zaXRpb25bMV0pIHx8IG4odGhpcy5zY2FsZVswXSAtIDEpIHx8IG4odGhpcy5zY2FsZVsxXSAtIDEpOwogICAgfSwgaC51cGRhdGVUcmFuc2Zvcm0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0ID0gdGhpcy5wYXJlbnQsCiAgICAgICAgICBlID0gdCAmJiB0LnRyYW5zZm9ybSwKICAgICAgICAgIHIgPSB0aGlzLm5lZWRMb2NhbFRyYW5zZm9ybSgpLAogICAgICAgICAgbiA9IHRoaXMudHJhbnNmb3JtOwogICAgICBpZiAoIXIgJiYgIWUpIHJldHVybiB2b2lkIChuICYmIG8obikpOwogICAgICBuID0gbiB8fCBpLmNyZWF0ZSgpLCByID8gdGhpcy5nZXRMb2NhbFRyYW5zZm9ybShuKSA6IG8obiksIGUgJiYgKHIgPyBpLm11bChuLCB0LnRyYW5zZm9ybSwgbikgOiBpLmNvcHkobiwgdC50cmFuc2Zvcm0pKSwgdGhpcy50cmFuc2Zvcm0gPSBuLCB0aGlzLmludlRyYW5zZm9ybSA9IHRoaXMuaW52VHJhbnNmb3JtIHx8IGkuY3JlYXRlKCksIGkuaW52ZXJ0KHRoaXMuaW52VHJhbnNmb3JtLCBuKTsKICAgIH0sIGguZ2V0TG9jYWxUcmFuc2Zvcm0gPSBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbC5nZXRMb2NhbFRyYW5zZm9ybSh0aGlzLCB0KTsKICAgIH0sIGguc2V0VHJhbnNmb3JtID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUgPSB0aGlzLnRyYW5zZm9ybSwKICAgICAgICAgIHIgPSB0LmRwciB8fCAxOwogICAgICBlID8gdC5zZXRUcmFuc2Zvcm0ociAqIGVbMF0sIHIgKiBlWzFdLCByICogZVsyXSwgciAqIGVbM10sIHIgKiBlWzRdLCByICogZVs1XSkgOiB0LnNldFRyYW5zZm9ybShyLCAwLCAwLCByLCAwLCAwKTsKICAgIH0sIGgucmVzdG9yZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0gdC5kcHIgfHwgMTsKICAgICAgdC5zZXRUcmFuc2Zvcm0oZSwgMCwgMCwgZSwgMCwgMCk7CiAgICB9OwogICAgdmFyIHUgPSBbXTsKICAgIGguZGVjb21wb3NlVHJhbnNmb3JtID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy50cmFuc2Zvcm0pIHsKICAgICAgICB2YXIgdCA9IHRoaXMucGFyZW50LAogICAgICAgICAgICBlID0gdGhpcy50cmFuc2Zvcm07CiAgICAgICAgdCAmJiB0LnRyYW5zZm9ybSAmJiAoaS5tdWwodSwgdC5pbnZUcmFuc2Zvcm0sIGUpLCBlID0gdSk7CiAgICAgICAgdmFyIHIgPSBlWzBdICogZVswXSArIGVbMV0gKiBlWzFdLAogICAgICAgICAgICBhID0gZVsyXSAqIGVbMl0gKyBlWzNdICogZVszXSwKICAgICAgICAgICAgbyA9IHRoaXMucG9zaXRpb24sCiAgICAgICAgICAgIHMgPSB0aGlzLnNjYWxlOwogICAgICAgIG4ociAtIDEpICYmIChyID0gTWF0aC5zcXJ0KHIpKSwgbihhIC0gMSkgJiYgKGEgPSBNYXRoLnNxcnQoYSkpLCBlWzBdIDwgMCAmJiAociA9IC1yKSwgZVszXSA8IDAgJiYgKGEgPSAtYSksIG9bMF0gPSBlWzRdLCBvWzFdID0gZVs1XSwgc1swXSA9IHIsIHNbMV0gPSBhLCB0aGlzLnJvdGF0aW9uID0gTWF0aC5hdGFuMigtZVsxXSAvIGEsIGVbMF0gLyByKTsKICAgICAgfQogICAgfSwgaC5nZXRHbG9iYWxTY2FsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHQgPSB0aGlzLnRyYW5zZm9ybTsKICAgICAgaWYgKCF0KSByZXR1cm4gWzEsIDFdOwogICAgICB2YXIgZSA9IE1hdGguc3FydCh0WzBdICogdFswXSArIHRbMV0gKiB0WzFdKSwKICAgICAgICAgIHIgPSBNYXRoLnNxcnQodFsyXSAqIHRbMl0gKyB0WzNdICogdFszXSk7CiAgICAgIHJldHVybiB0WzBdIDwgMCAmJiAoZSA9IC1lKSwgdFszXSA8IDAgJiYgKHIgPSAtciksIFtlLCByXTsKICAgIH0sIGgudHJhbnNmb3JtQ29vcmRUb0xvY2FsID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgdmFyIHIgPSBbdCwgZV0sCiAgICAgICAgICBuID0gdGhpcy5pbnZUcmFuc2Zvcm07CiAgICAgIHJldHVybiBuICYmIGEuYXBwbHlUcmFuc2Zvcm0ociwgciwgbiksIHI7CiAgICB9LCBoLnRyYW5zZm9ybUNvb3JkVG9HbG9iYWwgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICB2YXIgciA9IFt0LCBlXSwKICAgICAgICAgIG4gPSB0aGlzLnRyYW5zZm9ybTsKICAgICAgcmV0dXJuIG4gJiYgYS5hcHBseVRyYW5zZm9ybShyLCByLCBuKSwgcjsKICAgIH0sIGwuZ2V0TG9jYWxUcmFuc2Zvcm0gPSBmdW5jdGlvbiAodCwgZSkgewogICAgICBlID0gZSB8fCBbXSwgbyhlKTsKICAgICAgdmFyIHIgPSB0Lm9yaWdpbiwKICAgICAgICAgIG4gPSB0LnNjYWxlIHx8IFsxLCAxXSwKICAgICAgICAgIGEgPSB0LnJvdGF0aW9uIHx8IDAsCiAgICAgICAgICBzID0gdC5wb3NpdGlvbiB8fCBbMCwgMF07CiAgICAgIHJldHVybiByICYmIChlWzRdIC09IHJbMF0sIGVbNV0gLT0gclsxXSksIGkuc2NhbGUoZSwgZSwgbiksIGEgJiYgaS5yb3RhdGUoZSwgZSwgYSksIHIgJiYgKGVbNF0gKz0gclswXSwgZVs1XSArPSByWzFdKSwgZVs0XSArPSBzWzBdLCBlWzVdICs9IHNbMV0sIGU7CiAgICB9OwogICAgdmFyIGMgPSBsOwogICAgdC5leHBvcnRzID0gYzsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHJldHVybiB0ID0gTWF0aC5yb3VuZCh0KSwgdCA8IDAgPyAwIDogdCA+IDI1NSA/IDI1NSA6IHQ7CiAgICB9CgogICAgZnVuY3Rpb24gaSh0KSB7CiAgICAgIHJldHVybiB0ID0gTWF0aC5yb3VuZCh0KSwgdCA8IDAgPyAwIDogdCA+IDM2MCA/IDM2MCA6IHQ7CiAgICB9CgogICAgZnVuY3Rpb24gYSh0KSB7CiAgICAgIHJldHVybiB0IDwgMCA/IDAgOiB0ID4gMSA/IDEgOiB0OwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCkgewogICAgICByZXR1cm4gbih0Lmxlbmd0aCAmJiAiJSIgPT09IHQuY2hhckF0KHQubGVuZ3RoIC0gMSkgPyBwYXJzZUZsb2F0KHQpIC8gMTAwICogMjU1IDogcGFyc2VJbnQodCwgMTApKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQpIHsKICAgICAgcmV0dXJuIGEodC5sZW5ndGggJiYgIiUiID09PSB0LmNoYXJBdCh0Lmxlbmd0aCAtIDEpID8gcGFyc2VGbG9hdCh0KSAvIDEwMCA6IHBhcnNlRmxvYXQodCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGwodCwgZSwgcikgewogICAgICByZXR1cm4gciA8IDAgPyByICs9IDEgOiByID4gMSAmJiAociAtPSAxKSwgNiAqIHIgPCAxID8gdCArIChlIC0gdCkgKiByICogNiA6IDIgKiByIDwgMSA/IGUgOiAzICogciA8IDIgPyB0ICsgKGUgLSB0KSAqICgyIC8gMyAtIHIpICogNiA6IHQ7CiAgICB9CgogICAgZnVuY3Rpb24gaCh0LCBlLCByKSB7CiAgICAgIHJldHVybiB0ICsgKGUgLSB0KSAqIHI7CiAgICB9CgogICAgZnVuY3Rpb24gdSh0LCBlLCByLCBuLCBpKSB7CiAgICAgIHJldHVybiB0WzBdID0gZSwgdFsxXSA9IHIsIHRbMl0gPSBuLCB0WzNdID0gaSwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiBjKHQsIGUpIHsKICAgICAgcmV0dXJuIHRbMF0gPSBlWzBdLCB0WzFdID0gZVsxXSwgdFsyXSA9IGVbMl0sIHRbM10gPSBlWzNdLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGYodCwgZSkgewogICAgICBrICYmIGMoaywgZSksIGsgPSBULnB1dCh0LCBrIHx8IGUuc2xpY2UoKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZCh0LCBlKSB7CiAgICAgIGlmICh0KSB7CiAgICAgICAgZSA9IGUgfHwgW107CiAgICAgICAgdmFyIHIgPSBULmdldCh0KTsKICAgICAgICBpZiAocikgcmV0dXJuIGMoZSwgcik7CiAgICAgICAgdCArPSAiIjsKICAgICAgICB2YXIgbiA9IHQucmVwbGFjZSgvIC9nLCAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAobiBpbiBNKSByZXR1cm4gYyhlLCBNW25dKSwgZih0LCBlKSwgZTsKCiAgICAgICAgaWYgKCIjIiAhPT0gbi5jaGFyQXQoMCkpIHsKICAgICAgICAgIHZhciBpID0gbi5pbmRleE9mKCIoIiksCiAgICAgICAgICAgICAgYSA9IG4uaW5kZXhPZigiKSIpOwoKICAgICAgICAgIGlmICgtMSAhPT0gaSAmJiBhICsgMSA9PT0gbi5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGwgPSBuLnN1YnN0cigwLCBpKSwKICAgICAgICAgICAgICAgIGggPSBuLnN1YnN0cihpICsgMSwgYSAtIChpICsgMSkpLnNwbGl0KCIsIiksCiAgICAgICAgICAgICAgICBkID0gMTsKCiAgICAgICAgICAgIHN3aXRjaCAobCkgewogICAgICAgICAgICAgIGNhc2UgInJnYmEiOgogICAgICAgICAgICAgICAgaWYgKDQgIT09IGgubGVuZ3RoKSByZXR1cm4gdm9pZCB1KGUsIDAsIDAsIDAsIDEpOwogICAgICAgICAgICAgICAgZCA9IHMoaC5wb3AoKSk7CgogICAgICAgICAgICAgIGNhc2UgInJnYiI6CiAgICAgICAgICAgICAgICByZXR1cm4gMyAhPT0gaC5sZW5ndGggPyB2b2lkIHUoZSwgMCwgMCwgMCwgMSkgOiAodShlLCBvKGhbMF0pLCBvKGhbMV0pLCBvKGhbMl0pLCBkKSwgZih0LCBlKSwgZSk7CgogICAgICAgICAgICAgIGNhc2UgImhzbGEiOgogICAgICAgICAgICAgICAgcmV0dXJuIDQgIT09IGgubGVuZ3RoID8gdm9pZCB1KGUsIDAsIDAsIDAsIDEpIDogKGhbM10gPSBzKGhbM10pLCB2KGgsIGUpLCBmKHQsIGUpLCBlKTsKCiAgICAgICAgICAgICAgY2FzZSAiaHNsIjoKICAgICAgICAgICAgICAgIHJldHVybiAzICE9PSBoLmxlbmd0aCA/IHZvaWQgdShlLCAwLCAwLCAwLCAxKSA6ICh2KGgsIGUpLCBmKHQsIGUpLCBlKTsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHUoZSwgMCwgMCwgMCwgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICg0ID09PSBuLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgZyA9IHBhcnNlSW50KG4uc3Vic3RyKDEpLCAxNik7CiAgICAgICAgICAgIHJldHVybiBnID49IDAgJiYgZyA8PSA0MDk1ID8gKHUoZSwgKDM4NDAgJiBnKSA+PiA0IHwgKDM4NDAgJiBnKSA+PiA4LCAyNDAgJiBnIHwgKDI0MCAmIGcpID4+IDQsIDE1ICYgZyB8ICgxNSAmIGcpIDw8IDQsIDEpLCBmKHQsIGUpLCBlKSA6IHZvaWQgdShlLCAwLCAwLCAwLCAxKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoNyA9PT0gbi5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGcgPSBwYXJzZUludChuLnN1YnN0cigxKSwgMTYpOwogICAgICAgICAgICByZXR1cm4gZyA+PSAwICYmIGcgPD0gMTY3NzcyMTUgPyAodShlLCAoMTY3MTE2ODAgJiBnKSA+PiAxNiwgKDY1MjgwICYgZykgPj4gOCwgMjU1ICYgZywgMSksIGYodCwgZSksIGUpIDogdm9pZCB1KGUsIDAsIDAsIDAsIDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHYodCwgZSkgewogICAgICB2YXIgciA9IChwYXJzZUZsb2F0KHRbMF0pICUgMzYwICsgMzYwKSAlIDM2MCAvIDM2MCwKICAgICAgICAgIGkgPSBzKHRbMV0pLAogICAgICAgICAgYSA9IHModFsyXSksCiAgICAgICAgICBvID0gYSA8PSAuNSA/IGEgKiAoaSArIDEpIDogYSArIGkgLSBhICogaSwKICAgICAgICAgIGggPSAyICogYSAtIG87CiAgICAgIHJldHVybiBlID0gZSB8fCBbXSwgdShlLCBuKDI1NSAqIGwoaCwgbywgciArIDEgLyAzKSksIG4oMjU1ICogbChoLCBvLCByKSksIG4oMjU1ICogbChoLCBvLCByIC0gMSAvIDMpKSwgMSksIDQgPT09IHQubGVuZ3RoICYmIChlWzNdID0gdFszXSksIGU7CiAgICB9CgogICAgZnVuY3Rpb24gZyh0KSB7CiAgICAgIGlmICh0KSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIG4gPSB0WzBdIC8gMjU1LAogICAgICAgICAgICBpID0gdFsxXSAvIDI1NSwKICAgICAgICAgICAgYSA9IHRbMl0gLyAyNTUsCiAgICAgICAgICAgIG8gPSBNYXRoLm1pbihuLCBpLCBhKSwKICAgICAgICAgICAgcyA9IE1hdGgubWF4KG4sIGksIGEpLAogICAgICAgICAgICBsID0gcyAtIG8sCiAgICAgICAgICAgIGggPSAocyArIG8pIC8gMjsKICAgICAgICBpZiAoMCA9PT0gbCkgZSA9IDAsIHIgPSAwO2Vsc2UgewogICAgICAgICAgciA9IGggPCAuNSA/IGwgLyAocyArIG8pIDogbCAvICgyIC0gcyAtIG8pOwogICAgICAgICAgdmFyIHUgPSAoKHMgLSBuKSAvIDYgKyBsIC8gMikgLyBsLAogICAgICAgICAgICAgIGMgPSAoKHMgLSBpKSAvIDYgKyBsIC8gMikgLyBsLAogICAgICAgICAgICAgIGYgPSAoKHMgLSBhKSAvIDYgKyBsIC8gMikgLyBsOwogICAgICAgICAgbiA9PT0gcyA/IGUgPSBmIC0gYyA6IGkgPT09IHMgPyBlID0gMSAvIDMgKyB1IC0gZiA6IGEgPT09IHMgJiYgKGUgPSAyIC8gMyArIGMgLSB1KSwgZSA8IDAgJiYgKGUgKz0gMSksIGUgPiAxICYmIChlIC09IDEpOwogICAgICAgIH0KICAgICAgICB2YXIgZCA9IFszNjAgKiBlLCByLCBoXTsKICAgICAgICByZXR1cm4gbnVsbCAhPSB0WzNdICYmIGQucHVzaCh0WzNdKSwgZDsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHAodCwgZSkgewogICAgICB2YXIgciA9IGQodCk7CgogICAgICBpZiAocikgewogICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgMzsgbisrKSB7CiAgICAgICAgICByW25dID0gZSA8IDAgPyByW25dICogKDEgLSBlKSB8IDAgOiAoMjU1IC0gcltuXSkgKiBlICsgcltuXSB8IDA7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYihyLCA0ID09PSByLmxlbmd0aCA/ICJyZ2JhIiA6ICJyZ2IiKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG0odCkgewogICAgICB2YXIgZSA9IGQodCk7CiAgICAgIGlmIChlKSByZXR1cm4gKCgxIDw8IDI0KSArIChlWzBdIDw8IDE2KSArIChlWzFdIDw8IDgpICsgK2VbMl0pLnRvU3RyaW5nKDE2KS5zbGljZSgxKTsKICAgIH0KCiAgICBmdW5jdGlvbiB4KHQsIGUsIHIpIHsKICAgICAgaWYgKGUgJiYgZS5sZW5ndGggJiYgdCA+PSAwICYmIHQgPD0gMSkgewogICAgICAgIHIgPSByIHx8IFtdOwogICAgICAgIHZhciBpID0gdCAqIChlLmxlbmd0aCAtIDEpLAogICAgICAgICAgICBvID0gTWF0aC5mbG9vcihpKSwKICAgICAgICAgICAgcyA9IE1hdGguY2VpbChpKSwKICAgICAgICAgICAgbCA9IGVbb10sCiAgICAgICAgICAgIHUgPSBlW3NdLAogICAgICAgICAgICBjID0gaSAtIG87CiAgICAgICAgcmV0dXJuIHJbMF0gPSBuKGgobFswXSwgdVswXSwgYykpLCByWzFdID0gbihoKGxbMV0sIHVbMV0sIGMpKSwgclsyXSA9IG4oaChsWzJdLCB1WzJdLCBjKSksIHJbM10gPSBhKGgobFszXSwgdVszXSwgYykpLCByOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24geSh0LCBlLCByKSB7CiAgICAgIGlmIChlICYmIGUubGVuZ3RoICYmIHQgPj0gMCAmJiB0IDw9IDEpIHsKICAgICAgICB2YXIgaSA9IHQgKiAoZS5sZW5ndGggLSAxKSwKICAgICAgICAgICAgbyA9IE1hdGguZmxvb3IoaSksCiAgICAgICAgICAgIHMgPSBNYXRoLmNlaWwoaSksCiAgICAgICAgICAgIGwgPSBkKGVbb10pLAogICAgICAgICAgICB1ID0gZChlW3NdKSwKICAgICAgICAgICAgYyA9IGkgLSBvLAogICAgICAgICAgICBmID0gYihbbihoKGxbMF0sIHVbMF0sIGMpKSwgbihoKGxbMV0sIHVbMV0sIGMpKSwgbihoKGxbMl0sIHVbMl0sIGMpKSwgYShoKGxbM10sIHVbM10sIGMpKV0sICJyZ2JhIik7CiAgICAgICAgcmV0dXJuIHIgPyB7CiAgICAgICAgICBjb2xvcjogZiwKICAgICAgICAgIGxlZnRJbmRleDogbywKICAgICAgICAgIHJpZ2h0SW5kZXg6IHMsCiAgICAgICAgICB2YWx1ZTogaQogICAgICAgIH0gOiBmOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdyh0LCBlLCByLCBuKSB7CiAgICAgIGlmICh0ID0gZCh0KSkgcmV0dXJuIHQgPSBnKHQpLCBudWxsICE9IGUgJiYgKHRbMF0gPSBpKGUpKSwgbnVsbCAhPSByICYmICh0WzFdID0gcyhyKSksIG51bGwgIT0gbiAmJiAodFsyXSA9IHMobikpLCBiKHYodCksICJyZ2JhIik7CiAgICB9CgogICAgZnVuY3Rpb24gXyh0LCBlKSB7CiAgICAgIGlmICgodCA9IGQodCkpICYmIG51bGwgIT0gZSkgcmV0dXJuIHRbM10gPSBhKGUpLCBiKHQsICJyZ2JhIik7CiAgICB9CgogICAgZnVuY3Rpb24gYih0LCBlKSB7CiAgICAgIGlmICh0ICYmIHQubGVuZ3RoKSB7CiAgICAgICAgdmFyIHIgPSB0WzBdICsgIiwiICsgdFsxXSArICIsIiArIHRbMl07CiAgICAgICAgcmV0dXJuICJyZ2JhIiAhPT0gZSAmJiAiaHN2YSIgIT09IGUgJiYgImhzbGEiICE9PSBlIHx8IChyICs9ICIsIiArIHRbM10pLCBlICsgIigiICsgciArICIpIjsKICAgICAgfQogICAgfQoKICAgIHZhciBTID0gcigxNCksCiAgICAgICAgTSA9IHsKICAgICAgdHJhbnNwYXJlbnQ6IFswLCAwLCAwLCAwXSwKICAgICAgYWxpY2VibHVlOiBbMjQwLCAyNDgsIDI1NSwgMV0sCiAgICAgIGFudGlxdWV3aGl0ZTogWzI1MCwgMjM1LCAyMTUsIDFdLAogICAgICBhcXVhOiBbMCwgMjU1LCAyNTUsIDFdLAogICAgICBhcXVhbWFyaW5lOiBbMTI3LCAyNTUsIDIxMiwgMV0sCiAgICAgIGF6dXJlOiBbMjQwLCAyNTUsIDI1NSwgMV0sCiAgICAgIGJlaWdlOiBbMjQ1LCAyNDUsIDIyMCwgMV0sCiAgICAgIGJpc3F1ZTogWzI1NSwgMjI4LCAxOTYsIDFdLAogICAgICBibGFjazogWzAsIDAsIDAsIDFdLAogICAgICBibGFuY2hlZGFsbW9uZDogWzI1NSwgMjM1LCAyMDUsIDFdLAogICAgICBibHVlOiBbMCwgMCwgMjU1LCAxXSwKICAgICAgYmx1ZXZpb2xldDogWzEzOCwgNDMsIDIyNiwgMV0sCiAgICAgIGJyb3duOiBbMTY1LCA0MiwgNDIsIDFdLAogICAgICBidXJseXdvb2Q6IFsyMjIsIDE4NCwgMTM1LCAxXSwKICAgICAgY2FkZXRibHVlOiBbOTUsIDE1OCwgMTYwLCAxXSwKICAgICAgY2hhcnRyZXVzZTogWzEyNywgMjU1LCAwLCAxXSwKICAgICAgY2hvY29sYXRlOiBbMjEwLCAxMDUsIDMwLCAxXSwKICAgICAgY29yYWw6IFsyNTUsIDEyNywgODAsIDFdLAogICAgICBjb3JuZmxvd2VyYmx1ZTogWzEwMCwgMTQ5LCAyMzcsIDFdLAogICAgICBjb3Juc2lsazogWzI1NSwgMjQ4LCAyMjAsIDFdLAogICAgICBjcmltc29uOiBbMjIwLCAyMCwgNjAsIDFdLAogICAgICBjeWFuOiBbMCwgMjU1LCAyNTUsIDFdLAogICAgICBkYXJrYmx1ZTogWzAsIDAsIDEzOSwgMV0sCiAgICAgIGRhcmtjeWFuOiBbMCwgMTM5LCAxMzksIDFdLAogICAgICBkYXJrZ29sZGVucm9kOiBbMTg0LCAxMzQsIDExLCAxXSwKICAgICAgZGFya2dyYXk6IFsxNjksIDE2OSwgMTY5LCAxXSwKICAgICAgZGFya2dyZWVuOiBbMCwgMTAwLCAwLCAxXSwKICAgICAgZGFya2dyZXk6IFsxNjksIDE2OSwgMTY5LCAxXSwKICAgICAgZGFya2toYWtpOiBbMTg5LCAxODMsIDEwNywgMV0sCiAgICAgIGRhcmttYWdlbnRhOiBbMTM5LCAwLCAxMzksIDFdLAogICAgICBkYXJrb2xpdmVncmVlbjogWzg1LCAxMDcsIDQ3LCAxXSwKICAgICAgZGFya29yYW5nZTogWzI1NSwgMTQwLCAwLCAxXSwKICAgICAgZGFya29yY2hpZDogWzE1MywgNTAsIDIwNCwgMV0sCiAgICAgIGRhcmtyZWQ6IFsxMzksIDAsIDAsIDFdLAogICAgICBkYXJrc2FsbW9uOiBbMjMzLCAxNTAsIDEyMiwgMV0sCiAgICAgIGRhcmtzZWFncmVlbjogWzE0MywgMTg4LCAxNDMsIDFdLAogICAgICBkYXJrc2xhdGVibHVlOiBbNzIsIDYxLCAxMzksIDFdLAogICAgICBkYXJrc2xhdGVncmF5OiBbNDcsIDc5LCA3OSwgMV0sCiAgICAgIGRhcmtzbGF0ZWdyZXk6IFs0NywgNzksIDc5LCAxXSwKICAgICAgZGFya3R1cnF1b2lzZTogWzAsIDIwNiwgMjA5LCAxXSwKICAgICAgZGFya3Zpb2xldDogWzE0OCwgMCwgMjExLCAxXSwKICAgICAgZGVlcHBpbms6IFsyNTUsIDIwLCAxNDcsIDFdLAogICAgICBkZWVwc2t5Ymx1ZTogWzAsIDE5MSwgMjU1LCAxXSwKICAgICAgZGltZ3JheTogWzEwNSwgMTA1LCAxMDUsIDFdLAogICAgICBkaW1ncmV5OiBbMTA1LCAxMDUsIDEwNSwgMV0sCiAgICAgIGRvZGdlcmJsdWU6IFszMCwgMTQ0LCAyNTUsIDFdLAogICAgICBmaXJlYnJpY2s6IFsxNzgsIDM0LCAzNCwgMV0sCiAgICAgIGZsb3JhbHdoaXRlOiBbMjU1LCAyNTAsIDI0MCwgMV0sCiAgICAgIGZvcmVzdGdyZWVuOiBbMzQsIDEzOSwgMzQsIDFdLAogICAgICBmdWNoc2lhOiBbMjU1LCAwLCAyNTUsIDFdLAogICAgICBnYWluc2Jvcm86IFsyMjAsIDIyMCwgMjIwLCAxXSwKICAgICAgZ2hvc3R3aGl0ZTogWzI0OCwgMjQ4LCAyNTUsIDFdLAogICAgICBnb2xkOiBbMjU1LCAyMTUsIDAsIDFdLAogICAgICBnb2xkZW5yb2Q6IFsyMTgsIDE2NSwgMzIsIDFdLAogICAgICBncmF5OiBbMTI4LCAxMjgsIDEyOCwgMV0sCiAgICAgIGdyZWVuOiBbMCwgMTI4LCAwLCAxXSwKICAgICAgZ3JlZW55ZWxsb3c6IFsxNzMsIDI1NSwgNDcsIDFdLAogICAgICBncmV5OiBbMTI4LCAxMjgsIDEyOCwgMV0sCiAgICAgIGhvbmV5ZGV3OiBbMjQwLCAyNTUsIDI0MCwgMV0sCiAgICAgIGhvdHBpbms6IFsyNTUsIDEwNSwgMTgwLCAxXSwKICAgICAgaW5kaWFucmVkOiBbMjA1LCA5MiwgOTIsIDFdLAogICAgICBpbmRpZ286IFs3NSwgMCwgMTMwLCAxXSwKICAgICAgaXZvcnk6IFsyNTUsIDI1NSwgMjQwLCAxXSwKICAgICAga2hha2k6IFsyNDAsIDIzMCwgMTQwLCAxXSwKICAgICAgbGF2ZW5kZXI6IFsyMzAsIDIzMCwgMjUwLCAxXSwKICAgICAgbGF2ZW5kZXJibHVzaDogWzI1NSwgMjQwLCAyNDUsIDFdLAogICAgICBsYXduZ3JlZW46IFsxMjQsIDI1MiwgMCwgMV0sCiAgICAgIGxlbW9uY2hpZmZvbjogWzI1NSwgMjUwLCAyMDUsIDFdLAogICAgICBsaWdodGJsdWU6IFsxNzMsIDIxNiwgMjMwLCAxXSwKICAgICAgbGlnaHRjb3JhbDogWzI0MCwgMTI4LCAxMjgsIDFdLAogICAgICBsaWdodGN5YW46IFsyMjQsIDI1NSwgMjU1LCAxXSwKICAgICAgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6IFsyNTAsIDI1MCwgMjEwLCAxXSwKICAgICAgbGlnaHRncmF5OiBbMjExLCAyMTEsIDIxMSwgMV0sCiAgICAgIGxpZ2h0Z3JlZW46IFsxNDQsIDIzOCwgMTQ0LCAxXSwKICAgICAgbGlnaHRncmV5OiBbMjExLCAyMTEsIDIxMSwgMV0sCiAgICAgIGxpZ2h0cGluazogWzI1NSwgMTgyLCAxOTMsIDFdLAogICAgICBsaWdodHNhbG1vbjogWzI1NSwgMTYwLCAxMjIsIDFdLAogICAgICBsaWdodHNlYWdyZWVuOiBbMzIsIDE3OCwgMTcwLCAxXSwKICAgICAgbGlnaHRza3libHVlOiBbMTM1LCAyMDYsIDI1MCwgMV0sCiAgICAgIGxpZ2h0c2xhdGVncmF5OiBbMTE5LCAxMzYsIDE1MywgMV0sCiAgICAgIGxpZ2h0c2xhdGVncmV5OiBbMTE5LCAxMzYsIDE1MywgMV0sCiAgICAgIGxpZ2h0c3RlZWxibHVlOiBbMTc2LCAxOTYsIDIyMiwgMV0sCiAgICAgIGxpZ2h0eWVsbG93OiBbMjU1LCAyNTUsIDIyNCwgMV0sCiAgICAgIGxpbWU6IFswLCAyNTUsIDAsIDFdLAogICAgICBsaW1lZ3JlZW46IFs1MCwgMjA1LCA1MCwgMV0sCiAgICAgIGxpbmVuOiBbMjUwLCAyNDAsIDIzMCwgMV0sCiAgICAgIG1hZ2VudGE6IFsyNTUsIDAsIDI1NSwgMV0sCiAgICAgIG1hcm9vbjogWzEyOCwgMCwgMCwgMV0sCiAgICAgIG1lZGl1bWFxdWFtYXJpbmU6IFsxMDIsIDIwNSwgMTcwLCAxXSwKICAgICAgbWVkaXVtYmx1ZTogWzAsIDAsIDIwNSwgMV0sCiAgICAgIG1lZGl1bW9yY2hpZDogWzE4NiwgODUsIDIxMSwgMV0sCiAgICAgIG1lZGl1bXB1cnBsZTogWzE0NywgMTEyLCAyMTksIDFdLAogICAgICBtZWRpdW1zZWFncmVlbjogWzYwLCAxNzksIDExMywgMV0sCiAgICAgIG1lZGl1bXNsYXRlYmx1ZTogWzEyMywgMTA0LCAyMzgsIDFdLAogICAgICBtZWRpdW1zcHJpbmdncmVlbjogWzAsIDI1MCwgMTU0LCAxXSwKICAgICAgbWVkaXVtdHVycXVvaXNlOiBbNzIsIDIwOSwgMjA0LCAxXSwKICAgICAgbWVkaXVtdmlvbGV0cmVkOiBbMTk5LCAyMSwgMTMzLCAxXSwKICAgICAgbWlkbmlnaHRibHVlOiBbMjUsIDI1LCAxMTIsIDFdLAogICAgICBtaW50Y3JlYW06IFsyNDUsIDI1NSwgMjUwLCAxXSwKICAgICAgbWlzdHlyb3NlOiBbMjU1LCAyMjgsIDIyNSwgMV0sCiAgICAgIG1vY2Nhc2luOiBbMjU1LCAyMjgsIDE4MSwgMV0sCiAgICAgIG5hdmFqb3doaXRlOiBbMjU1LCAyMjIsIDE3MywgMV0sCiAgICAgIG5hdnk6IFswLCAwLCAxMjgsIDFdLAogICAgICBvbGRsYWNlOiBbMjUzLCAyNDUsIDIzMCwgMV0sCiAgICAgIG9saXZlOiBbMTI4LCAxMjgsIDAsIDFdLAogICAgICBvbGl2ZWRyYWI6IFsxMDcsIDE0MiwgMzUsIDFdLAogICAgICBvcmFuZ2U6IFsyNTUsIDE2NSwgMCwgMV0sCiAgICAgIG9yYW5nZXJlZDogWzI1NSwgNjksIDAsIDFdLAogICAgICBvcmNoaWQ6IFsyMTgsIDExMiwgMjE0LCAxXSwKICAgICAgcGFsZWdvbGRlbnJvZDogWzIzOCwgMjMyLCAxNzAsIDFdLAogICAgICBwYWxlZ3JlZW46IFsxNTIsIDI1MSwgMTUyLCAxXSwKICAgICAgcGFsZXR1cnF1b2lzZTogWzE3NSwgMjM4LCAyMzgsIDFdLAogICAgICBwYWxldmlvbGV0cmVkOiBbMjE5LCAxMTIsIDE0NywgMV0sCiAgICAgIHBhcGF5YXdoaXA6IFsyNTUsIDIzOSwgMjEzLCAxXSwKICAgICAgcGVhY2hwdWZmOiBbMjU1LCAyMTgsIDE4NSwgMV0sCiAgICAgIHBlcnU6IFsyMDUsIDEzMywgNjMsIDFdLAogICAgICBwaW5rOiBbMjU1LCAxOTIsIDIwMywgMV0sCiAgICAgIHBsdW06IFsyMjEsIDE2MCwgMjIxLCAxXSwKICAgICAgcG93ZGVyYmx1ZTogWzE3NiwgMjI0LCAyMzAsIDFdLAogICAgICBwdXJwbGU6IFsxMjgsIDAsIDEyOCwgMV0sCiAgICAgIHJlZDogWzI1NSwgMCwgMCwgMV0sCiAgICAgIHJvc3licm93bjogWzE4OCwgMTQzLCAxNDMsIDFdLAogICAgICByb3lhbGJsdWU6IFs2NSwgMTA1LCAyMjUsIDFdLAogICAgICBzYWRkbGVicm93bjogWzEzOSwgNjksIDE5LCAxXSwKICAgICAgc2FsbW9uOiBbMjUwLCAxMjgsIDExNCwgMV0sCiAgICAgIHNhbmR5YnJvd246IFsyNDQsIDE2NCwgOTYsIDFdLAogICAgICBzZWFncmVlbjogWzQ2LCAxMzksIDg3LCAxXSwKICAgICAgc2Vhc2hlbGw6IFsyNTUsIDI0NSwgMjM4LCAxXSwKICAgICAgc2llbm5hOiBbMTYwLCA4MiwgNDUsIDFdLAogICAgICBzaWx2ZXI6IFsxOTIsIDE5MiwgMTkyLCAxXSwKICAgICAgc2t5Ymx1ZTogWzEzNSwgMjA2LCAyMzUsIDFdLAogICAgICBzbGF0ZWJsdWU6IFsxMDYsIDkwLCAyMDUsIDFdLAogICAgICBzbGF0ZWdyYXk6IFsxMTIsIDEyOCwgMTQ0LCAxXSwKICAgICAgc2xhdGVncmV5OiBbMTEyLCAxMjgsIDE0NCwgMV0sCiAgICAgIHNub3c6IFsyNTUsIDI1MCwgMjUwLCAxXSwKICAgICAgc3ByaW5nZ3JlZW46IFswLCAyNTUsIDEyNywgMV0sCiAgICAgIHN0ZWVsYmx1ZTogWzcwLCAxMzAsIDE4MCwgMV0sCiAgICAgIHRhbjogWzIxMCwgMTgwLCAxNDAsIDFdLAogICAgICB0ZWFsOiBbMCwgMTI4LCAxMjgsIDFdLAogICAgICB0aGlzdGxlOiBbMjE2LCAxOTEsIDIxNiwgMV0sCiAgICAgIHRvbWF0bzogWzI1NSwgOTksIDcxLCAxXSwKICAgICAgdHVycXVvaXNlOiBbNjQsIDIyNCwgMjA4LCAxXSwKICAgICAgdmlvbGV0OiBbMjM4LCAxMzAsIDIzOCwgMV0sCiAgICAgIHdoZWF0OiBbMjQ1LCAyMjIsIDE3OSwgMV0sCiAgICAgIHdoaXRlOiBbMjU1LCAyNTUsIDI1NSwgMV0sCiAgICAgIHdoaXRlc21va2U6IFsyNDUsIDI0NSwgMjQ1LCAxXSwKICAgICAgeWVsbG93OiBbMjU1LCAyNTUsIDAsIDFdLAogICAgICB5ZWxsb3dncmVlbjogWzE1NCwgMjA1LCA1MCwgMV0KICAgIH0sCiAgICAgICAgVCA9IG5ldyBTKDIwKSwKICAgICAgICBrID0gbnVsbCwKICAgICAgICBDID0geCwKICAgICAgICBQID0geTsKICAgIGUucGFyc2UgPSBkLCBlLmxpZnQgPSBwLCBlLnRvSGV4ID0gbSwgZS5mYXN0TGVycCA9IHgsIGUuZmFzdE1hcFRvQ29sb3IgPSBDLCBlLmxlcnAgPSB5LCBlLm1hcFRvQ29sb3IgPSBQLCBlLm1vZGlmeUhTTCA9IHcsIGUubW9kaWZ5QWxwaGEgPSBfLCBlLnN0cmluZ2lmeSA9IGI7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHZhciByID0gMTsKICAgICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgJiYgKHIgPSBNYXRoLm1heCh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxLCAxKSk7CiAgICB2YXIgbiA9IHI7CiAgICBlLmRlYnVnTW9kZSA9IDAsIGUuZGV2aWNlUGl4ZWxSYXRpbyA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gaSh0KSwgTSh0LnJpY2gsIGkpLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCkgewogICAgICBpZiAodCkgewogICAgICAgIHQuZm9udCA9IFAubWFrZUZvbnQodCk7CiAgICAgICAgdmFyIGUgPSB0LnRleHRBbGlnbjsKICAgICAgICAibWlkZGxlIiA9PT0gZSAmJiAoZSA9ICJjZW50ZXIiKSwgdC50ZXh0QWxpZ24gPSBudWxsID09IGUgfHwgT1tlXSA/IGUgOiAibGVmdCI7CiAgICAgICAgdmFyIHIgPSB0LnRleHRWZXJ0aWNhbEFsaWduIHx8IHQudGV4dEJhc2VsaW5lOwogICAgICAgICJjZW50ZXIiID09PSByICYmIChyID0gIm1pZGRsZSIpLCB0LnRleHRWZXJ0aWNhbEFsaWduID0gbnVsbCA9PSByIHx8IERbcl0gPyByIDogInRvcCI7CiAgICAgICAgdC50ZXh0UGFkZGluZyAmJiAodC50ZXh0UGFkZGluZyA9IFQodC50ZXh0UGFkZGluZykpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYSh0LCBlLCByLCBuLCBpKSB7CiAgICAgIG4ucmljaCA/IHModCwgZSwgciwgbiwgaSkgOiBvKHQsIGUsIHIsIG4sIGkpOwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCwgZSwgciwgbiwgaSkgewogICAgICB2YXIgYSA9IGcoZSwgImZvbnQiLCBuLmZvbnQgfHwgUC5ERUZBVUxUX0ZPTlQpLAogICAgICAgICAgbyA9IG4udGV4dFBhZGRpbmcsCiAgICAgICAgICBzID0gdC5fX3RleHRDb3RlbnRCbG9jazsKICAgICAgcyAmJiAhdC5fX2RpcnR5IHx8IChzID0gdC5fX3RleHRDb3RlbnRCbG9jayA9IFAucGFyc2VQbGFpblRleHQociwgYSwgbywgbi50cnVuY2F0ZSkpOwogICAgICB2YXIgbCA9IHMub3V0ZXJIZWlnaHQsCiAgICAgICAgICB1ID0gcy5saW5lcywKICAgICAgICAgIGQgPSBzLmxpbmVIZWlnaHQsCiAgICAgICAgICB4ID0gdihsLCBuLCBpKSwKICAgICAgICAgIHcgPSB4LmJhc2VYLAogICAgICAgICAgXyA9IHguYmFzZVksCiAgICAgICAgICBiID0geC50ZXh0QWxpZ24sCiAgICAgICAgICBTID0geC50ZXh0VmVydGljYWxBbGlnbjsKICAgICAgaChlLCBuLCBpLCB3LCBfKTsKICAgICAgdmFyIE0gPSBQLmFkanVzdFRleHRZKF8sIGwsIFMpLAogICAgICAgICAgVCA9IHcsCiAgICAgICAgICBrID0gTSwKICAgICAgICAgIEMgPSBjKG4pOwoKICAgICAgaWYgKEMgfHwgbykgewogICAgICAgIHZhciBJID0gUC5nZXRXaWR0aChyLCBhKSwKICAgICAgICAgICAgQSA9IEk7CiAgICAgICAgbyAmJiAoQSArPSBvWzFdICsgb1szXSk7CiAgICAgICAgdmFyIE8gPSBQLmFkanVzdFRleHRYKHcsIEEsIGIpOwogICAgICAgIEMgJiYgZih0LCBlLCBuLCBPLCBNLCBBLCBsKSwgbyAmJiAoVCA9IHkodywgYiwgbyksIGsgKz0gb1swXSk7CiAgICAgIH0KCiAgICAgIGcoZSwgInRleHRBbGlnbiIsIGIgfHwgImxlZnQiKSwgZyhlLCAidGV4dEJhc2VsaW5lIiwgIm1pZGRsZSIpLCBnKGUsICJzaGFkb3dCbHVyIiwgbi50ZXh0U2hhZG93Qmx1ciB8fCAwKSwgZyhlLCAic2hhZG93Q29sb3IiLCBuLnRleHRTaGFkb3dDb2xvciB8fCAidHJhbnNwYXJlbnQiKSwgZyhlLCAic2hhZG93T2Zmc2V0WCIsIG4udGV4dFNoYWRvd09mZnNldFggfHwgMCksIGcoZSwgInNoYWRvd09mZnNldFkiLCBuLnRleHRTaGFkb3dPZmZzZXRZIHx8IDApLCBrICs9IGQgLyAyOwogICAgICB2YXIgRCA9IG4udGV4dFN0cm9rZVdpZHRoLAogICAgICAgICAgTCA9IHAobi50ZXh0U3Ryb2tlLCBEKSwKICAgICAgICAgIEYgPSBtKG4udGV4dEZpbGwpOwogICAgICBMICYmIChnKGUsICJsaW5lV2lkdGgiLCBEKSwgZyhlLCAic3Ryb2tlU3R5bGUiLCBMKSksIEYgJiYgZyhlLCAiZmlsbFN0eWxlIiwgRik7CgogICAgICBmb3IgKHZhciBSID0gMDsgUiA8IHUubGVuZ3RoOyBSKyspIHsKICAgICAgICBMICYmIGUuc3Ryb2tlVGV4dCh1W1JdLCBULCBrKSwgRiAmJiBlLmZpbGxUZXh0KHVbUl0sIFQsIGspLCBrICs9IGQ7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgdmFyIGEgPSB0Ll9fdGV4dENvdGVudEJsb2NrOwogICAgICBhICYmICF0Ll9fZGlydHkgfHwgKGEgPSB0Ll9fdGV4dENvdGVudEJsb2NrID0gUC5wYXJzZVJpY2hUZXh0KHIsIG4pKSwgbCh0LCBlLCBhLCBuLCBpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgdmFyIGEgPSByLndpZHRoLAogICAgICAgICAgbyA9IHIub3V0ZXJXaWR0aCwKICAgICAgICAgIHMgPSByLm91dGVySGVpZ2h0LAogICAgICAgICAgbCA9IG4udGV4dFBhZGRpbmcsCiAgICAgICAgICBkID0gdihzLCBuLCBpKSwKICAgICAgICAgIGcgPSBkLmJhc2VYLAogICAgICAgICAgcCA9IGQuYmFzZVksCiAgICAgICAgICBtID0gZC50ZXh0QWxpZ24sCiAgICAgICAgICB4ID0gZC50ZXh0VmVydGljYWxBbGlnbjsKICAgICAgaChlLCBuLCBpLCBnLCBwKTsKICAgICAgdmFyIHkgPSBQLmFkanVzdFRleHRYKGcsIG8sIG0pLAogICAgICAgICAgdyA9IFAuYWRqdXN0VGV4dFkocCwgcywgeCksCiAgICAgICAgICBfID0geSwKICAgICAgICAgIGIgPSB3OwogICAgICBsICYmIChfICs9IGxbM10sIGIgKz0gbFswXSk7CiAgICAgIHZhciBTID0gXyArIGE7CiAgICAgIGMobikgJiYgZih0LCBlLCBuLCB5LCB3LCBvLCBzKTsKCiAgICAgIGZvciAodmFyIE0gPSAwOyBNIDwgci5saW5lcy5sZW5ndGg7IE0rKykgewogICAgICAgIGZvciAodmFyIFQsIGsgPSByLmxpbmVzW01dLCBDID0gay50b2tlbnMsIEkgPSBDLmxlbmd0aCwgQSA9IGsubGluZUhlaWdodCwgTyA9IGsud2lkdGgsIEQgPSAwLCBMID0gXywgRiA9IFMsIFIgPSBJIC0gMTsgRCA8IEkgJiYgKFQgPSBDW0RdLCAhVC50ZXh0QWxpZ24gfHwgImxlZnQiID09PSBULnRleHRBbGlnbik7KSB7CiAgICAgICAgICB1KHQsIGUsIFQsIG4sIEEsIGIsIEwsICJsZWZ0IiksIE8gLT0gVC53aWR0aCwgTCArPSBULndpZHRoLCBEKys7CiAgICAgICAgfQoKICAgICAgICBmb3IgKDsgUiA+PSAwICYmIChUID0gQ1tSXSwgInJpZ2h0IiA9PT0gVC50ZXh0QWxpZ24pOykgewogICAgICAgICAgdSh0LCBlLCBULCBuLCBBLCBiLCBGLCAicmlnaHQiKSwgTyAtPSBULndpZHRoLCBGIC09IFQud2lkdGgsIFItLTsKICAgICAgICB9CgogICAgICAgIGZvciAoTCArPSAoYSAtIChMIC0gXykgLSAoUyAtIEYpIC0gTykgLyAyOyBEIDw9IFI7KSB7CiAgICAgICAgICBUID0gQ1tEXSwgdSh0LCBlLCBULCBuLCBBLCBiLCBMICsgVC53aWR0aCAvIDIsICJjZW50ZXIiKSwgTCArPSBULndpZHRoLCBEKys7CiAgICAgICAgfQoKICAgICAgICBiICs9IEE7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBoKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgaWYgKHIgJiYgZS50ZXh0Um90YXRpb24pIHsKICAgICAgICB2YXIgYSA9IGUudGV4dE9yaWdpbjsKICAgICAgICAiY2VudGVyIiA9PT0gYSA/IChuID0gci53aWR0aCAvIDIgKyByLngsIGkgPSByLmhlaWdodCAvIDIgKyByLnkpIDogYSAmJiAobiA9IGFbMF0gKyByLngsIGkgPSBhWzFdICsgci55KSwgdC50cmFuc2xhdGUobiwgaSksIHQucm90YXRlKC1lLnRleHRSb3RhdGlvbiksIHQudHJhbnNsYXRlKC1uLCAtaSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB1KHQsIGUsIHIsIG4sIGksIGEsIG8sIHMpIHsKICAgICAgdmFyIGwgPSBuLnJpY2hbci5zdHlsZU5hbWVdIHx8IHt9LAogICAgICAgICAgaCA9IHIudGV4dFZlcnRpY2FsQWxpZ24sCiAgICAgICAgICB1ID0gYSArIGkgLyAyOwogICAgICAidG9wIiA9PT0gaCA/IHUgPSBhICsgci5oZWlnaHQgLyAyIDogImJvdHRvbSIgPT09IGggJiYgKHUgPSBhICsgaSAtIHIuaGVpZ2h0IC8gMiksICFyLmlzTGluZUhvbGRlciAmJiBjKGwpICYmIGYodCwgZSwgbCwgInJpZ2h0IiA9PT0gcyA/IG8gLSByLndpZHRoIDogImNlbnRlciIgPT09IHMgPyBvIC0gci53aWR0aCAvIDIgOiBvLCB1IC0gci5oZWlnaHQgLyAyLCByLndpZHRoLCByLmhlaWdodCk7CiAgICAgIHZhciBkID0gci50ZXh0UGFkZGluZzsKICAgICAgZCAmJiAobyA9IHkobywgcywgZCksIHUgLT0gci5oZWlnaHQgLyAyIC0gZFsyXSAtIHIudGV4dEhlaWdodCAvIDIpLCBnKGUsICJzaGFkb3dCbHVyIiwgUyhsLnRleHRTaGFkb3dCbHVyLCBuLnRleHRTaGFkb3dCbHVyLCAwKSksIGcoZSwgInNoYWRvd0NvbG9yIiwgbC50ZXh0U2hhZG93Q29sb3IgfHwgbi50ZXh0U2hhZG93Q29sb3IgfHwgInRyYW5zcGFyZW50IiksIGcoZSwgInNoYWRvd09mZnNldFgiLCBTKGwudGV4dFNoYWRvd09mZnNldFgsIG4udGV4dFNoYWRvd09mZnNldFgsIDApKSwgZyhlLCAic2hhZG93T2Zmc2V0WSIsIFMobC50ZXh0U2hhZG93T2Zmc2V0WSwgbi50ZXh0U2hhZG93T2Zmc2V0WSwgMCkpLCBnKGUsICJ0ZXh0QWxpZ24iLCBzKSwgZyhlLCAidGV4dEJhc2VsaW5lIiwgIm1pZGRsZSIpLCBnKGUsICJmb250Iiwgci5mb250IHx8IFAuREVGQVVMVF9GT05UKTsKICAgICAgdmFyIHYgPSBwKGwudGV4dFN0cm9rZSB8fCBuLnRleHRTdHJva2UsIHcpLAogICAgICAgICAgeCA9IG0obC50ZXh0RmlsbCB8fCBuLnRleHRGaWxsKSwKICAgICAgICAgIHcgPSBiKGwudGV4dFN0cm9rZVdpZHRoLCBuLnRleHRTdHJva2VXaWR0aCk7CiAgICAgIHYgJiYgKGcoZSwgImxpbmVXaWR0aCIsIHcpLCBnKGUsICJzdHJva2VTdHlsZSIsIHYpLCBlLnN0cm9rZVRleHQoci50ZXh0LCBvLCB1KSksIHggJiYgKGcoZSwgImZpbGxTdHlsZSIsIHgpLCBlLmZpbGxUZXh0KHIudGV4dCwgbywgdSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGModCkgewogICAgICByZXR1cm4gdC50ZXh0QmFja2dyb3VuZENvbG9yIHx8IHQudGV4dEJvcmRlcldpZHRoICYmIHQudGV4dEJvcmRlckNvbG9yOwogICAgfQoKICAgIGZ1bmN0aW9uIGYodCwgZSwgciwgbiwgaSwgYSwgbykgewogICAgICB2YXIgcyA9IHIudGV4dEJhY2tncm91bmRDb2xvciwKICAgICAgICAgIGwgPSByLnRleHRCb3JkZXJXaWR0aCwKICAgICAgICAgIGggPSByLnRleHRCb3JkZXJDb2xvciwKICAgICAgICAgIHUgPSBrKHMpOwoKICAgICAgaWYgKGcoZSwgInNoYWRvd0JsdXIiLCByLnRleHRCb3hTaGFkb3dCbHVyIHx8IDApLCBnKGUsICJzaGFkb3dDb2xvciIsIHIudGV4dEJveFNoYWRvd0NvbG9yIHx8ICJ0cmFuc3BhcmVudCIpLCBnKGUsICJzaGFkb3dPZmZzZXRYIiwgci50ZXh0Qm94U2hhZG93T2Zmc2V0WCB8fCAwKSwgZyhlLCAic2hhZG93T2Zmc2V0WSIsIHIudGV4dEJveFNoYWRvd09mZnNldFkgfHwgMCksIHUgfHwgbCAmJiBoKSB7CiAgICAgICAgZS5iZWdpblBhdGgoKTsKICAgICAgICB2YXIgYyA9IHIudGV4dEJvcmRlclJhZGl1czsKICAgICAgICBjID8gSS5idWlsZFBhdGgoZSwgewogICAgICAgICAgeDogbiwKICAgICAgICAgIHk6IGksCiAgICAgICAgICB3aWR0aDogYSwKICAgICAgICAgIGhlaWdodDogbywKICAgICAgICAgIHI6IGMKICAgICAgICB9KSA6IGUucmVjdChuLCBpLCBhLCBvKSwgZS5jbG9zZVBhdGgoKTsKICAgICAgfQoKICAgICAgaWYgKHUpIGcoZSwgImZpbGxTdHlsZSIsIHMpLCBlLmZpbGwoKTtlbHNlIGlmIChDKHMpKSB7CiAgICAgICAgdmFyIGYgPSBzLmltYWdlOwogICAgICAgIGYgPSBBLmNyZWF0ZU9yVXBkYXRlSW1hZ2UoZiwgbnVsbCwgdCwgZCwgcyksIGYgJiYgQS5pc0ltYWdlUmVhZHkoZikgJiYgZS5kcmF3SW1hZ2UoZiwgbiwgaSwgYSwgbyk7CiAgICAgIH0KICAgICAgbCAmJiBoICYmIChnKGUsICJsaW5lV2lkdGgiLCBsKSwgZyhlLCAic3Ryb2tlU3R5bGUiLCBoKSwgZS5zdHJva2UoKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZCh0LCBlKSB7CiAgICAgIGUuaW1hZ2UgPSB0OwogICAgfQoKICAgIGZ1bmN0aW9uIHYodCwgZSwgcikgewogICAgICB2YXIgbiA9IGUueCB8fCAwLAogICAgICAgICAgaSA9IGUueSB8fCAwLAogICAgICAgICAgYSA9IGUudGV4dEFsaWduLAogICAgICAgICAgbyA9IGUudGV4dFZlcnRpY2FsQWxpZ247CgogICAgICBpZiAocikgewogICAgICAgIHZhciBzID0gZS50ZXh0UG9zaXRpb247CiAgICAgICAgaWYgKHMgaW5zdGFuY2VvZiBBcnJheSkgbiA9IHIueCArIHgoc1swXSwgci53aWR0aCksIGkgPSByLnkgKyB4KHNbMV0sIHIuaGVpZ2h0KTtlbHNlIHsKICAgICAgICAgIHZhciBsID0gUC5hZGp1c3RUZXh0UG9zaXRpb25PblJlY3QocywgciwgZS50ZXh0RGlzdGFuY2UpOwogICAgICAgICAgbiA9IGwueCwgaSA9IGwueSwgYSA9IGEgfHwgbC50ZXh0QWxpZ24sIG8gPSBvIHx8IGwudGV4dFZlcnRpY2FsQWxpZ247CiAgICAgICAgfQogICAgICAgIHZhciBoID0gZS50ZXh0T2Zmc2V0OwogICAgICAgIGggJiYgKG4gKz0gaFswXSwgaSArPSBoWzFdKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBiYXNlWDogbiwKICAgICAgICBiYXNlWTogaSwKICAgICAgICB0ZXh0QWxpZ246IGEsCiAgICAgICAgdGV4dFZlcnRpY2FsQWxpZ246IG8KICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBnKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRbZV0gPSByLCB0W2VdOwogICAgfQoKICAgIGZ1bmN0aW9uIHAodCwgZSkgewogICAgICByZXR1cm4gbnVsbCA9PSB0IHx8IGUgPD0gMCB8fCAidHJhbnNwYXJlbnQiID09PSB0IHx8ICJub25lIiA9PT0gdCA/IG51bGwgOiB0LmltYWdlIHx8IHQuY29sb3JTdG9wcyA/ICIjMDAwIiA6IHQ7CiAgICB9CgogICAgZnVuY3Rpb24gbSh0KSB7CiAgICAgIHJldHVybiBudWxsID09IHQgfHwgIm5vbmUiID09PSB0ID8gbnVsbCA6IHQuaW1hZ2UgfHwgdC5jb2xvclN0b3BzID8gIiMwMDAiIDogdDsKICAgIH0KCiAgICBmdW5jdGlvbiB4KHQsIGUpIHsKICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiB0ID8gdC5sYXN0SW5kZXhPZigiJSIpID49IDAgPyBwYXJzZUZsb2F0KHQpIC8gMTAwICogZSA6IHBhcnNlRmxvYXQodCkgOiB0OwogICAgfQoKICAgIGZ1bmN0aW9uIHkodCwgZSwgcikgewogICAgICByZXR1cm4gInJpZ2h0IiA9PT0gZSA/IHQgLSByWzFdIDogImNlbnRlciIgPT09IGUgPyB0ICsgclszXSAvIDIgLSByWzFdIC8gMiA6IHQgKyByWzNdOwogICAgfQoKICAgIGZ1bmN0aW9uIHcodCwgZSkgewogICAgICByZXR1cm4gbnVsbCAhPSB0ICYmICh0IHx8IGUudGV4dEJhY2tncm91bmRDb2xvciB8fCBlLnRleHRCb3JkZXJXaWR0aCAmJiBlLnRleHRCb3JkZXJDb2xvciB8fCBlLnRleHRQYWRkaW5nKTsKICAgIH0KCiAgICB2YXIgXyA9IHIoMCksCiAgICAgICAgYiA9IF8ucmV0cmlldmUyLAogICAgICAgIFMgPSBfLnJldHJpZXZlMywKICAgICAgICBNID0gXy5lYWNoLAogICAgICAgIFQgPSBfLm5vcm1hbGl6ZUNzc0FycmF5LAogICAgICAgIGsgPSBfLmlzU3RyaW5nLAogICAgICAgIEMgPSBfLmlzT2JqZWN0LAogICAgICAgIFAgPSByKDUpLAogICAgICAgIEkgPSByKDIxKSwKICAgICAgICBBID0gcigxMCksCiAgICAgICAgTyA9IHsKICAgICAgbGVmdDogMSwKICAgICAgcmlnaHQ6IDEsCiAgICAgIGNlbnRlcjogMQogICAgfSwKICAgICAgICBEID0gewogICAgICB0b3A6IDEsCiAgICAgIGJvdHRvbTogMSwKICAgICAgbWlkZGxlOiAxCiAgICB9OwoKICAgIGUubm9ybWFsaXplVGV4dFN0eWxlID0gbiwgZS5yZW5kZXJUZXh0ID0gYSwgZS5nZXRTdHJva2UgPSBwLCBlLmdldEZpbGwgPSBtLCBlLm5lZWREcmF3VGV4dCA9IHc7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIGZ1bmN0aW9uIHIodCwgZSkgewogICAgICB2YXIgciwKICAgICAgICAgIG4sCiAgICAgICAgICBpLAogICAgICAgICAgYSwKICAgICAgICAgIG8gPSBlLngsCiAgICAgICAgICBzID0gZS55LAogICAgICAgICAgbCA9IGUud2lkdGgsCiAgICAgICAgICBoID0gZS5oZWlnaHQsCiAgICAgICAgICB1ID0gZS5yOwogICAgICBsIDwgMCAmJiAobyArPSBsLCBsID0gLWwpLCBoIDwgMCAmJiAocyArPSBoLCBoID0gLWgpLCAibnVtYmVyIiA9PSB0eXBlb2YgdSA/IHIgPSBuID0gaSA9IGEgPSB1IDogdSBpbnN0YW5jZW9mIEFycmF5ID8gMSA9PT0gdS5sZW5ndGggPyByID0gbiA9IGkgPSBhID0gdVswXSA6IDIgPT09IHUubGVuZ3RoID8gKHIgPSBpID0gdVswXSwgbiA9IGEgPSB1WzFdKSA6IDMgPT09IHUubGVuZ3RoID8gKHIgPSB1WzBdLCBuID0gYSA9IHVbMV0sIGkgPSB1WzJdKSA6IChyID0gdVswXSwgbiA9IHVbMV0sIGkgPSB1WzJdLCBhID0gdVszXSkgOiByID0gbiA9IGkgPSBhID0gMDsKICAgICAgdmFyIGM7CiAgICAgIHIgKyBuID4gbCAmJiAoYyA9IHIgKyBuLCByICo9IGwgLyBjLCBuICo9IGwgLyBjKSwgaSArIGEgPiBsICYmIChjID0gaSArIGEsIGkgKj0gbCAvIGMsIGEgKj0gbCAvIGMpLCBuICsgaSA+IGggJiYgKGMgPSBuICsgaSwgbiAqPSBoIC8gYywgaSAqPSBoIC8gYyksIHIgKyBhID4gaCAmJiAoYyA9IHIgKyBhLCByICo9IGggLyBjLCBhICo9IGggLyBjKSwgdC5tb3ZlVG8obyArIHIsIHMpLCB0LmxpbmVUbyhvICsgbCAtIG4sIHMpLCAwICE9PSBuICYmIHQucXVhZHJhdGljQ3VydmVUbyhvICsgbCwgcywgbyArIGwsIHMgKyBuKSwgdC5saW5lVG8obyArIGwsIHMgKyBoIC0gaSksIDAgIT09IGkgJiYgdC5xdWFkcmF0aWNDdXJ2ZVRvKG8gKyBsLCBzICsgaCwgbyArIGwgLSBpLCBzICsgaCksIHQubGluZVRvKG8gKyBhLCBzICsgaCksIDAgIT09IGEgJiYgdC5xdWFkcmF0aWNDdXJ2ZVRvKG8sIHMgKyBoLCBvLCBzICsgaCAtIGEpLCB0LmxpbmVUbyhvLCBzICsgciksIDAgIT09IHIgJiYgdC5xdWFkcmF0aWNDdXJ2ZVRvKG8sIHMsIG8gKyByLCBzKTsKICAgIH0KCiAgICBlLmJ1aWxkUGF0aCA9IHI7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIGZ1bmN0aW9uIHIodCkgewogICAgICByZXR1cm4gdCAlPSBuLCB0IDwgMCAmJiAodCArPSBuKSwgdDsKICAgIH0KCiAgICB2YXIgbiA9IDIgKiBNYXRoLlBJOwogICAgZS5ub3JtYWxpemVSYWRpYW4gPSByOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSBlLnBvaW50cywKICAgICAgICAgIG8gPSBlLnNtb290aDsKCiAgICAgIGlmIChuICYmIG4ubGVuZ3RoID49IDIpIHsKICAgICAgICBpZiAobyAmJiAic3BsaW5lIiAhPT0gbykgewogICAgICAgICAgdmFyIHMgPSBhKG4sIG8sIHIsIGUuc21vb3RoQ29uc3RyYWludCk7CiAgICAgICAgICB0Lm1vdmVUbyhuWzBdWzBdLCBuWzBdWzFdKTsKCiAgICAgICAgICBmb3IgKHZhciBsID0gbi5sZW5ndGgsIGggPSAwOyBoIDwgKHIgPyBsIDogbCAtIDEpOyBoKyspIHsKICAgICAgICAgICAgdmFyIHUgPSBzWzIgKiBoXSwKICAgICAgICAgICAgICAgIGMgPSBzWzIgKiBoICsgMV0sCiAgICAgICAgICAgICAgICBmID0gblsoaCArIDEpICUgbF07CiAgICAgICAgICAgIHQuYmV6aWVyQ3VydmVUbyh1WzBdLCB1WzFdLCBjWzBdLCBjWzFdLCBmWzBdLCBmWzFdKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgInNwbGluZSIgPT09IG8gJiYgKG4gPSBpKG4sIHIpKSwgdC5tb3ZlVG8oblswXVswXSwgblswXVsxXSk7CgogICAgICAgICAgZm9yICh2YXIgaCA9IDEsIGQgPSBuLmxlbmd0aDsgaCA8IGQ7IGgrKykgewogICAgICAgICAgICB0LmxpbmVUbyhuW2hdWzBdLCBuW2hdWzFdKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHIgJiYgdC5jbG9zZVBhdGgoKTsKICAgICAgfQogICAgfQoKICAgIHZhciBpID0gcig2NiksCiAgICAgICAgYSA9IHIoNjcpOwogICAgZS5idWlsZFBhdGggPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB2YXIgciA9IGZ1bmN0aW9uIHIodCkgewogICAgICB0aGlzLmNvbG9yU3RvcHMgPSB0IHx8IFtdOwogICAgfTsKCiAgICByLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IHIsCiAgICAgIGFkZENvbG9yU3RvcDogZnVuY3Rpb24gYWRkQ29sb3JTdG9wKHQsIGUpIHsKICAgICAgICB0aGlzLmNvbG9yU3RvcHMucHVzaCh7CiAgICAgICAgICBvZmZzZXQ6IHQsCiAgICAgICAgICBjb2xvcjogZQogICAgICAgIH0pOwogICAgICB9CiAgICB9OwogICAgdmFyIG4gPSByOwogICAgdC5leHBvcnRzID0gbjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdC5leHBvcnRzID0gcigyNik7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICBmb3IgKHZhciBlID0gdC5nZXRDb250ZXh0KCIyZCIpLCByID0gZS5nZXRJbWFnZURhdGEoMCwgMCwgdC53aWR0aCwgdC5oZWlnaHQpLCBuID0gZS5jcmVhdGVJbWFnZURhdGEociksIGkgPSAwLCBhID0gMCwgbyA9IDA7IG8gPCByLmRhdGEubGVuZ3RoOyBvICs9IDQpIHsKICAgICAgICB2YXIgcyA9IHIuZGF0YVtvICsgM107CgogICAgICAgIGlmIChzID4gMTI4KSB7CiAgICAgICAgICB2YXIgbCA9IHIuZGF0YVtvXSArIHIuZGF0YVtvICsgMV0gKyByLmRhdGFbbyArIDJdOwogICAgICAgICAgaSArPSBsLCArK2E7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKHZhciBoID0gaSAvIGEsIG8gPSAwOyBvIDwgci5kYXRhLmxlbmd0aDsgbyArPSA0KSB7CiAgICAgICAgdmFyIGwgPSByLmRhdGFbb10gKyByLmRhdGFbbyArIDFdICsgci5kYXRhW28gKyAyXSwKICAgICAgICAgICAgcyA9IHIuZGF0YVtvICsgM107CiAgICAgICAgcyA8IDEyOCB8fCBsID4gaCA/IChuLmRhdGFbb10gPSAwLCBuLmRhdGFbbyArIDFdID0gMCwgbi5kYXRhW28gKyAyXSA9IDAsIG4uZGF0YVtvICsgM10gPSAwKSA6IChuLmRhdGFbb10gPSAyNTUsIG4uZGF0YVtvICsgMV0gPSAyNTUsIG4uZGF0YVtvICsgMl0gPSAyNTUsIG4uZGF0YVtvICsgM10gPSAyNTUpOwogICAgICB9CgogICAgICBlLnB1dEltYWdlRGF0YShuLCAwLCAwKTsKICAgIH0KCiAgICB2YXIgaSA9IHIoNyksCiAgICAgICAgYSA9IHIoMjcpOwogICAgcigyOCksIHIoNzcpOwogICAgdmFyIG8gPSByKDc4KTsKICAgIGlmICghby5pc1N1cHBvcnRlZCkgdGhyb3cgbmV3IEVycm9yKCJTb3JyeSB5b3VyIGJyb3dzZXIgbm90IHN1cHBvcnQgd29yZENsb3VkIik7CiAgICBpLnJlZ2lzdGVyTGF5b3V0KGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIHQuZWFjaFNlcmllc0J5VHlwZSgid29yZENsb3VkIiwgZnVuY3Rpb24gKHIpIHsKICAgICAgICBmdW5jdGlvbiBzKHQpIHsKICAgICAgICAgIHZhciBlID0gdC5kZXRhaWwuaXRlbTsKICAgICAgICAgIHQuZGV0YWlsLmRyYXduICYmIHIubGF5b3V0SW5zdGFuY2Uub25kcmF3ICYmICh0LmRldGFpbC5kcmF3bi5neCArPSBsLnggLyBtLCB0LmRldGFpbC5kcmF3bi5neSArPSBsLnkgLyBtLCByLmxheW91dEluc3RhbmNlLm9uZHJhdyhlWzBdLCBlWzFdLCBlWzJdLCB0LmRldGFpbC5kcmF3bikpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGwgPSBhLmdldExheW91dFJlY3Qoci5nZXRCb3hMYXlvdXRQYXJhbXMoKSwgewogICAgICAgICAgd2lkdGg6IGUuZ2V0V2lkdGgoKSwKICAgICAgICAgIGhlaWdodDogZS5nZXRIZWlnaHQoKQogICAgICAgIH0pLAogICAgICAgICAgICBoID0gci5nZXREYXRhKCksCiAgICAgICAgICAgIHUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICB1LndpZHRoID0gbC53aWR0aCwgdS5oZWlnaHQgPSBsLmhlaWdodDsKICAgICAgICB2YXIgYyA9IHUuZ2V0Q29udGV4dCgiMmQiKSwKICAgICAgICAgICAgZiA9IHIuZ2V0KCJtYXNrSW1hZ2UiKTsKICAgICAgICBpZiAoZikgdHJ5IHsKICAgICAgICAgIGMuZHJhd0ltYWdlKGYsIDAsIDAsIHUud2lkdGgsIHUuaGVpZ2h0KSwgbih1KTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJJbnZhbGlkIG1hc2sgaW1hZ2UiKSwgY29uc29sZS5lcnJvcih0LnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgICAgICB2YXIgZCA9IHIuZ2V0KCJzaXplUmFuZ2UiKSwKICAgICAgICAgICAgdiA9IHIuZ2V0KCJyb3RhdGlvblJhbmdlIiksCiAgICAgICAgICAgIGcgPSBoLmdldERhdGFFeHRlbnQoInZhbHVlIiksCiAgICAgICAgICAgIHAgPSBNYXRoLlBJIC8gMTgwLAogICAgICAgICAgICBtID0gci5nZXQoImdyaWRTaXplIik7CiAgICAgICAgbyh1LCB7CiAgICAgICAgICBsaXN0OiBoLm1hcEFycmF5KCJ2YWx1ZSIsIGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICAgIHZhciByID0gaC5nZXRJdGVtTW9kZWwoZSk7CiAgICAgICAgICAgIHJldHVybiBbaC5nZXROYW1lKGUpLCByLmdldCgidGV4dFN0eWxlLm5vcm1hbC50ZXh0U2l6ZSIsICEwKSB8fCBpLm51bWJlci5saW5lYXJNYXAodCwgZywgZCksIGVdOwogICAgICAgICAgfSkuc29ydChmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICByZXR1cm4gZVsxXSAtIHRbMV07CiAgICAgICAgICB9KSwKICAgICAgICAgIGZvbnRGYW1pbHk6IHIuZ2V0KCJ0ZXh0U3R5bGUubm9ybWFsLmZvbnRGYW1pbHkiKSB8fCByLmdldCgidGV4dFN0eWxlLmVtcGhhc2lzLmZvbnRGYW1pbHkiKSB8fCB0LmdldCgidGV4dFN0eWxlLmZvbnRGYW1pbHkiKSwKICAgICAgICAgIGZvbnRXZWlnaHQ6IHIuZ2V0KCJ0ZXh0U3R5bGUubm9ybWFsLmZvbnRXZWlnaHQiKSB8fCByLmdldCgidGV4dFN0eWxlLmVtcGhhc2lzLmZvbnRXZWlnaHQiKSB8fCB0LmdldCgidGV4dFN0eWxlLmZvbnRXZWlnaHQiKSwKICAgICAgICAgIGdyaWRTaXplOiBtLAogICAgICAgICAgZWxsaXB0aWNpdHk6IGwuaGVpZ2h0IC8gbC53aWR0aCwKICAgICAgICAgIG1pblJvdGF0aW9uOiB2WzBdICogcCwKICAgICAgICAgIG1heFJvdGF0aW9uOiB2WzFdICogcCwKICAgICAgICAgIGNsZWFyQ2FudmFzOiAhZiwKICAgICAgICAgIHJvdGF0ZVJhdGlvOiAxLAogICAgICAgICAgcm90YXRpb25TdGVwOiByLmdldCgicm90YXRpb25TdGVwIikgKiBwLAogICAgICAgICAgZHJhd091dE9mQm91bmQ6IHIuZ2V0KCJkcmF3T3V0T2ZCb3VuZCIpLAogICAgICAgICAgc2h1ZmZsZTogITEsCiAgICAgICAgICBzaGFwZTogci5nZXQoInNoYXBlIikKICAgICAgICB9KSwgdS5hZGRFdmVudExpc3RlbmVyKCJ3b3JkY2xvdWRkcmF3biIsIHMpLCByLmxheW91dEluc3RhbmNlICYmIHIubGF5b3V0SW5zdGFuY2UuZGlzcG9zZSgpLCByLmxheW91dEluc3RhbmNlID0gewogICAgICAgICAgb25kcmF3OiBudWxsLAogICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgICAgICAgdS5yZW1vdmVFdmVudExpc3RlbmVyKCJ3b3JkY2xvdWRkcmF3biIsIHMpLCB1LmFkZEV2ZW50TGlzdGVuZXIoIndvcmRjbG91ZGRyYXduIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0pOwogICAgfSksIGkucmVnaXN0ZXJQcmVwcm9jZXNzb3IoZnVuY3Rpb24gKHQpIHsKICAgICAgZnVuY3Rpb24gZSh0KSB7CiAgICAgICAgdCAmJiBpLnV0aWwuZWFjaChuLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdC5oYXNPd25Qcm9wZXJ0eShlKSAmJiAodFsidGV4dCIgKyBpLmZvcm1hdC5jYXBpdGFsRmlyc3QoZSldID0gdFtlXSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciByID0gKHQgfHwge30pLnNlcmllczsKICAgICAgIWkudXRpbC5pc0FycmF5KHIpICYmIChyID0gciA/IFtyXSA6IFtdKTsKICAgICAgdmFyIG4gPSBbInNoYWRvd0NvbG9yIiwgInNoYWRvd0JsdXIiLCAic2hhZG93T2Zmc2V0WCIsICJzaGFkb3dPZmZzZXRZIl07CiAgICAgIGkudXRpbC5lYWNoKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKHQgJiYgIndvcmRDbG91ZCIgPT09IHQudHlwZSkgewogICAgICAgICAgdmFyIHIgPSB0LnRleHRTdHlsZSB8fCB7fTsKICAgICAgICAgIGUoci5ub3JtYWwpLCBlKHIuZW1waGFzaXMpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0LCBlLCByLCBuLCBpKSB7CiAgICAgIHZhciBhID0gMCwKICAgICAgICAgIG8gPSAwOwogICAgICBudWxsID09IG4gJiYgKG4gPSAxIC8gMCksIG51bGwgPT0gaSAmJiAoaSA9IDEgLyAwKTsKICAgICAgdmFyIHMgPSAwOwogICAgICBlLmVhY2hDaGlsZChmdW5jdGlvbiAobCwgaCkgewogICAgICAgIHZhciB1LAogICAgICAgICAgICBjLAogICAgICAgICAgICBmID0gbC5wb3NpdGlvbiwKICAgICAgICAgICAgZCA9IGwuZ2V0Qm91bmRpbmdSZWN0KCksCiAgICAgICAgICAgIHYgPSBlLmNoaWxkQXQoaCArIDEpLAogICAgICAgICAgICBnID0gdiAmJiB2LmdldEJvdW5kaW5nUmVjdCgpOwoKICAgICAgICBpZiAoImhvcml6b250YWwiID09PSB0KSB7CiAgICAgICAgICB2YXIgcCA9IGQud2lkdGggKyAoZyA/IC1nLnggKyBkLnggOiAwKTsKICAgICAgICAgIHUgPSBhICsgcCwgdSA+IG4gfHwgbC5uZXdsaW5lID8gKGEgPSAwLCB1ID0gcCwgbyArPSBzICsgciwgcyA9IGQuaGVpZ2h0KSA6IHMgPSBNYXRoLm1heChzLCBkLmhlaWdodCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBtID0gZC5oZWlnaHQgKyAoZyA/IC1nLnkgKyBkLnkgOiAwKTsKICAgICAgICAgIGMgPSBvICsgbSwgYyA+IGkgfHwgbC5uZXdsaW5lID8gKGEgKz0gcyArIHIsIG8gPSAwLCBjID0gbSwgcyA9IGQud2lkdGgpIDogcyA9IE1hdGgubWF4KHMsIGQud2lkdGgpOwogICAgICAgIH0KCiAgICAgICAgbC5uZXdsaW5lIHx8IChmWzBdID0gYSwgZlsxXSA9IG8sICJob3Jpem9udGFsIiA9PT0gdCA/IGEgPSB1ICsgciA6IG8gPSBjICsgcik7CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSwgcikgewogICAgICB2YXIgbiA9IGUud2lkdGgsCiAgICAgICAgICBpID0gZS5oZWlnaHQsCiAgICAgICAgICBhID0gdih0LngsIG4pLAogICAgICAgICAgbyA9IHYodC55LCBpKSwKICAgICAgICAgIHMgPSB2KHQueDIsIG4pLAogICAgICAgICAgbCA9IHYodC55MiwgaSk7CiAgICAgIHJldHVybiAoaXNOYU4oYSkgfHwgaXNOYU4ocGFyc2VGbG9hdCh0LngpKSkgJiYgKGEgPSAwKSwgKGlzTmFOKHMpIHx8IGlzTmFOKHBhcnNlRmxvYXQodC54MikpKSAmJiAocyA9IG4pLCAoaXNOYU4obykgfHwgaXNOYU4ocGFyc2VGbG9hdCh0LnkpKSkgJiYgKG8gPSAwKSwgKGlzTmFOKGwpIHx8IGlzTmFOKHBhcnNlRmxvYXQodC55MikpKSAmJiAobCA9IGkpLCByID0gZy5ub3JtYWxpemVDc3NBcnJheShyIHx8IDApLCB7CiAgICAgICAgd2lkdGg6IE1hdGgubWF4KHMgLSBhIC0gclsxXSAtIHJbM10sIDApLAogICAgICAgIGhlaWdodDogTWF0aC5tYXgobCAtIG8gLSByWzBdIC0gclsyXSwgMCkKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBhKHQsIGUsIHIpIHsKICAgICAgciA9IGcubm9ybWFsaXplQ3NzQXJyYXkociB8fCAwKTsKICAgICAgdmFyIG4gPSBlLndpZHRoLAogICAgICAgICAgaSA9IGUuaGVpZ2h0LAogICAgICAgICAgYSA9IHYodC5sZWZ0LCBuKSwKICAgICAgICAgIG8gPSB2KHQudG9wLCBpKSwKICAgICAgICAgIHMgPSB2KHQucmlnaHQsIG4pLAogICAgICAgICAgbCA9IHYodC5ib3R0b20sIGkpLAogICAgICAgICAgaCA9IHYodC53aWR0aCwgbiksCiAgICAgICAgICB1ID0gdih0LmhlaWdodCwgaSksCiAgICAgICAgICBjID0gclsyXSArIHJbMF0sCiAgICAgICAgICBkID0gclsxXSArIHJbM10sCiAgICAgICAgICBwID0gdC5hc3BlY3Q7CgogICAgICBzd2l0Y2ggKGlzTmFOKGgpICYmIChoID0gbiAtIHMgLSBkIC0gYSksIGlzTmFOKHUpICYmICh1ID0gaSAtIGwgLSBjIC0gbyksIG51bGwgIT0gcCAmJiAoaXNOYU4oaCkgJiYgaXNOYU4odSkgJiYgKHAgPiBuIC8gaSA/IGggPSAuOCAqIG4gOiB1ID0gLjggKiBpKSwgaXNOYU4oaCkgJiYgKGggPSBwICogdSksIGlzTmFOKHUpICYmICh1ID0gaCAvIHApKSwgaXNOYU4oYSkgJiYgKGEgPSBuIC0gcyAtIGggLSBkKSwgaXNOYU4obykgJiYgKG8gPSBpIC0gbCAtIHUgLSBjKSwgdC5sZWZ0IHx8IHQucmlnaHQpIHsKICAgICAgICBjYXNlICJjZW50ZXIiOgogICAgICAgICAgYSA9IG4gLyAyIC0gaCAvIDIgLSByWzNdOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICAgIGEgPSBuIC0gaCAtIGQ7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAodC50b3AgfHwgdC5ib3R0b20pIHsKICAgICAgICBjYXNlICJtaWRkbGUiOgogICAgICAgIGNhc2UgImNlbnRlciI6CiAgICAgICAgICBvID0gaSAvIDIgLSB1IC8gMiAtIHJbMF07CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgIG8gPSBpIC0gdSAtIGM7CiAgICAgIH0KCiAgICAgIGEgPSBhIHx8IDAsIG8gPSBvIHx8IDAsIGlzTmFOKGgpICYmIChoID0gbiAtIGQgLSBhIC0gKHMgfHwgMCkpLCBpc05hTih1KSAmJiAodSA9IGkgLSBjIC0gbyAtIChsIHx8IDApKTsKICAgICAgdmFyIG0gPSBuZXcgZihhICsgclszXSwgbyArIHJbMF0sIGgsIHUpOwogICAgICByZXR1cm4gbS5tYXJnaW4gPSByLCBtOwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCwgZSwgciwgbiwgaSkgewogICAgICB2YXIgbyA9ICFpIHx8ICFpLmh2IHx8IGkuaHZbMF0sCiAgICAgICAgICBzID0gIWkgfHwgIWkuaHYgfHwgaS5odlsxXSwKICAgICAgICAgIGwgPSBpICYmIGkuYm91bmRpbmdNb2RlIHx8ICJhbGwiOwoKICAgICAgaWYgKG8gfHwgcykgewogICAgICAgIHZhciBoOwogICAgICAgIGlmICgicmF3IiA9PT0gbCkgaCA9ICJncm91cCIgPT09IHQudHlwZSA/IG5ldyBmKDAsIDAsICtlLndpZHRoIHx8IDAsICtlLmhlaWdodCB8fCAwKSA6IHQuZ2V0Qm91bmRpbmdSZWN0KCk7ZWxzZSBpZiAoaCA9IHQuZ2V0Qm91bmRpbmdSZWN0KCksIHQubmVlZExvY2FsVHJhbnNmb3JtKCkpIHsKICAgICAgICAgIHZhciB1ID0gdC5nZXRMb2NhbFRyYW5zZm9ybSgpOwogICAgICAgICAgaCA9IGguY2xvbmUoKSwgaC5hcHBseVRyYW5zZm9ybSh1KTsKICAgICAgICB9CiAgICAgICAgZSA9IGEoYy5kZWZhdWx0cyh7CiAgICAgICAgICB3aWR0aDogaC53aWR0aCwKICAgICAgICAgIGhlaWdodDogaC5oZWlnaHQKICAgICAgICB9LCBlKSwgciwgbik7CiAgICAgICAgdmFyIGQgPSB0LnBvc2l0aW9uLAogICAgICAgICAgICB2ID0gbyA/IGUueCAtIGgueCA6IDAsCiAgICAgICAgICAgIGcgPSBzID8gZS55IC0gaC55IDogMDsKICAgICAgICB0LmF0dHIoInBvc2l0aW9uIiwgInJhdyIgPT09IGwgPyBbdiwgZ10gOiBbZFswXSArIHYsIGRbMV0gKyBnXSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIGUpIHsKICAgICAgcmV0dXJuIG51bGwgIT0gdFt4W2VdWzBdXSB8fCBudWxsICE9IHRbeFtlXVsxXV0gJiYgbnVsbCAhPSB0W3hbZV1bMl1dOwogICAgfQoKICAgIGZ1bmN0aW9uIGwodCwgZSwgcikgewogICAgICBmdW5jdGlvbiBuKHIsIG4pIHsKICAgICAgICB2YXIgbyA9IHt9LAogICAgICAgICAgICBsID0gMCwKICAgICAgICAgICAgaCA9IHt9LAogICAgICAgICAgICB1ID0gMDsKICAgICAgICBpZiAocChyLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgaFtlXSA9IHRbZV07CiAgICAgICAgfSksIHAociwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGkoZSwgdCkgJiYgKG9bdF0gPSBoW3RdID0gZVt0XSksIGEobywgdCkgJiYgbCsrLCBhKGgsIHQpICYmIHUrKzsKICAgICAgICB9KSwgc1tuXSkgcmV0dXJuIGEoZSwgclsxXSkgPyBoW3JbMl1dID0gbnVsbCA6IGEoZSwgclsyXSkgJiYgKGhbclsxXV0gPSBudWxsKSwgaDsKCiAgICAgICAgaWYgKDIgIT09IHUgJiYgbCkgewogICAgICAgICAgaWYgKGwgPj0gMikgcmV0dXJuIG87CgogICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCByLmxlbmd0aDsgYysrKSB7CiAgICAgICAgICAgIHZhciBmID0gcltjXTsKCiAgICAgICAgICAgIGlmICghaShvLCBmKSAmJiBpKHQsIGYpKSB7CiAgICAgICAgICAgICAgb1tmXSA9IHRbZl07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbzsKICAgICAgICB9CgogICAgICAgIHJldHVybiBoOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgICByZXR1cm4gdC5oYXNPd25Qcm9wZXJ0eShlKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYSh0LCBlKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT0gdFtlXSAmJiAiYXV0byIgIT09IHRbZV07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG8odCwgZSwgcikgewogICAgICAgIHAodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGVbdF0gPSByW3RdOwogICAgICAgIH0pOwogICAgICB9CgogICAgICAhYy5pc09iamVjdChyKSAmJiAociA9IHt9KTsKICAgICAgdmFyIHMgPSByLmlnbm9yZVNpemU7CiAgICAgICFjLmlzQXJyYXkocykgJiYgKHMgPSBbcywgc10pOwogICAgICB2YXIgbCA9IG4oeFswXSwgMCksCiAgICAgICAgICBoID0gbih4WzFdLCAxKTsKICAgICAgbyh4WzBdLCB0LCBsKSwgbyh4WzFdLCB0LCBoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBoKHQpIHsKICAgICAgcmV0dXJuIHUoe30sIHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHUodCwgZSkgewogICAgICByZXR1cm4gZSAmJiB0ICYmIHAobSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7CiAgICAgIH0pLCB0OwogICAgfQoKICAgIHZhciBjID0gcigwKSwKICAgICAgICBmID0gcigzKSwKICAgICAgICBkID0gcig5KSwKICAgICAgICB2ID0gZC5wYXJzZVBlcmNlbnQsCiAgICAgICAgZyA9IHIoMTMpLAogICAgICAgIHAgPSBjLmVhY2gsCiAgICAgICAgbSA9IFsibGVmdCIsICJyaWdodCIsICJ0b3AiLCAiYm90dG9tIiwgIndpZHRoIiwgImhlaWdodCJdLAogICAgICAgIHggPSBbWyJ3aWR0aCIsICJsZWZ0IiwgInJpZ2h0Il0sIFsiaGVpZ2h0IiwgInRvcCIsICJib3R0b20iXV0sCiAgICAgICAgeSA9IG4sCiAgICAgICAgdyA9IGMuY3VycnkobiwgInZlcnRpY2FsIiksCiAgICAgICAgXyA9IGMuY3VycnkobiwgImhvcml6b250YWwiKTsKCiAgICBlLkxPQ0FUSU9OX1BBUkFNUyA9IG0sIGUuSFZfTkFNRVMgPSB4LCBlLmJveCA9IHksIGUudmJveCA9IHcsIGUuaGJveCA9IF8sIGUuZ2V0QXZhaWxhYmxlU2l6ZSA9IGksIGUuZ2V0TGF5b3V0UmVjdCA9IGEsIGUucG9zaXRpb25FbGVtZW50ID0gbywgZS5zaXplQ2FsY3VsYWJsZSA9IHMsIGUubWVyZ2VMYXlvdXRQYXJhbSA9IGwsIGUuZ2V0TGF5b3V0UGFyYW1zID0gaCwgZS5jb3B5TGF5b3V0UGFyYW1zID0gdTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDI5KSwKICAgICAgICBpID0gcig3KTsKICAgIGkuZXh0ZW5kU2VyaWVzTW9kZWwoewogICAgICB0eXBlOiAic2VyaWVzLndvcmRDbG91ZCIsCiAgICAgIHZpc3VhbENvbG9yQWNjZXNzUGF0aDogInRleHRTdHlsZS5ub3JtYWwuY29sb3IiLAogICAgICBvcHRpb25VcGRhdGVkOiBmdW5jdGlvbiBvcHRpb25VcGRhdGVkKCkgewogICAgICAgIHZhciB0ID0gdGhpcy5vcHRpb247CiAgICAgICAgdC5ncmlkU2l6ZSA9IE1hdGgubWF4KE1hdGguZmxvb3IodC5ncmlkU2l6ZSksIDQpOwogICAgICB9LAogICAgICBnZXRJbml0aWFsRGF0YTogZnVuY3Rpb24gZ2V0SW5pdGlhbERhdGEodCwgZSkgewogICAgICAgIHZhciByID0gbihbInZhbHVlIl0sIHQuZGF0YSksCiAgICAgICAgICAgIGEgPSBuZXcgaS5MaXN0KHIsIHRoaXMpOwogICAgICAgIHJldHVybiBhLmluaXREYXRhKHQuZGF0YSksIGE7CiAgICAgIH0sCiAgICAgIGRlZmF1bHRPcHRpb246IHsKICAgICAgICBtYXNrSW1hZ2U6IG51bGwsCiAgICAgICAgc2hhcGU6ICJjaXJjbGUiLAogICAgICAgIGxlZnQ6ICJjZW50ZXIiLAogICAgICAgIHRvcDogImNlbnRlciIsCiAgICAgICAgd2lkdGg6ICI3MCUiLAogICAgICAgIGhlaWdodDogIjgwJSIsCiAgICAgICAgc2l6ZVJhbmdlOiBbMTIsIDYwXSwKICAgICAgICByb3RhdGlvblJhbmdlOiBbLTkwLCA5MF0sCiAgICAgICAgcm90YXRpb25TdGVwOiA0NSwKICAgICAgICBncmlkU2l6ZTogOCwKICAgICAgICBkcmF3T3V0T2ZCb3VuZDogITEsCiAgICAgICAgdGV4dFN0eWxlOiB7CiAgICAgICAgICBub3JtYWw6IHsKICAgICAgICAgICAgZm9udFdlaWdodDogIm5vcm1hbCIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIpIHsKICAgICAgZnVuY3Rpb24gbih0LCBlLCByKSB7CiAgICAgICAgY1tlXSA/IHQub3RoZXJEaW1zW2VdID0gciA6ICh0LmNvb3JkRGltID0gZSwgdC5jb29yZERpbUluZGV4ID0gciwgcC5zZXQoZSwgITApKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbyh0LCBlLCByKSB7CiAgICAgICAgaWYgKHIgfHwgbnVsbCAhPSBlLmdldCh0KSkgewogICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG51bGwgIT0gZS5nZXQodCArIG4pOykgewogICAgICAgICAgICBuKys7CiAgICAgICAgICB9CgogICAgICAgICAgdCArPSBuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGUuc2V0KHQsICEwKSwgdDsKICAgICAgfQoKICAgICAgZSA9IGUgfHwgW10sIHIgPSByIHx8IHt9LCB0ID0gKHQgfHwgW10pLnNsaWNlKCk7CiAgICAgIHZhciBkID0gKHIuZGltc0RlZiB8fCBbXSkuc2xpY2UoKSwKICAgICAgICAgIHYgPSBhLmNyZWF0ZUhhc2hNYXAoci5lbmNvZGVEZWYpLAogICAgICAgICAgZyA9IGEuY3JlYXRlSGFzaE1hcCgpLAogICAgICAgICAgcCA9IGEuY3JlYXRlSGFzaE1hcCgpLAogICAgICAgICAgbSA9IFtdLAogICAgICAgICAgeCA9IHIuZGltQ291bnQ7CgogICAgICBpZiAobnVsbCA9PSB4KSB7CiAgICAgICAgdmFyIHkgPSBpKGVbMF0pOwogICAgICAgIHggPSBNYXRoLm1heChhLmlzQXJyYXkoeSkgJiYgeS5sZW5ndGggfHwgMSwgdC5sZW5ndGgsIGQubGVuZ3RoKSwgbCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUgPSB0LmRpbXNEZWY7CiAgICAgICAgICBlICYmICh4ID0gTWF0aC5tYXgoeCwgZS5sZW5ndGgpKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZm9yICh2YXIgdyA9IDA7IHcgPCB4OyB3KyspIHsKICAgICAgICB2YXIgXyA9IGgoZFt3XSkgPyB7CiAgICAgICAgICBuYW1lOiBkW3ddCiAgICAgICAgfSA6IGRbd10gfHwge30sCiAgICAgICAgICAgIGIgPSBfLm5hbWUsCiAgICAgICAgICAgIFMgPSBtW3ddID0gewogICAgICAgICAgb3RoZXJEaW1zOiB7fQogICAgICAgIH07CgogICAgICAgIG51bGwgIT0gYiAmJiBudWxsID09IGcuZ2V0KGIpICYmIChTLm5hbWUgPSBTLnRvb2x0aXBOYW1lID0gYiwgZy5zZXQoYiwgdykpLCBudWxsICE9IF8udHlwZSAmJiAoUy50eXBlID0gXy50eXBlKTsKICAgICAgfQoKICAgICAgdi5lYWNoKGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdCA9IHYuc2V0KGUsIHModCkuc2xpY2UoKSksIGwodCwgZnVuY3Rpb24gKHIsIGkpIHsKICAgICAgICAgIGgocikgJiYgKHIgPSBnLmdldChyKSksIG51bGwgIT0gciAmJiByIDwgeCAmJiAodFtpXSA9IHIsIG4obVtyXSwgZSwgaSkpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdmFyIE0gPSAwOwogICAgICBsKHQsIGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgdmFyIHIsIHQsIGksIG87CiAgICAgICAgaCh0KSA/IChyID0gdCwgdCA9IHt9KSA6IChyID0gdC5uYW1lLCB0ID0gYS5jbG9uZSh0KSwgaSA9IHQuZGltc0RlZiwgbyA9IHQub3RoZXJEaW1zLCB0Lm5hbWUgPSB0LmNvb3JkRGltID0gdC5jb29yZERpbUluZGV4ID0gdC5kaW1zRGVmID0gdC5vdGhlckRpbXMgPSBudWxsKTsKICAgICAgICB2YXIgYyA9IHModi5nZXQocikpOwogICAgICAgIGlmICghYy5sZW5ndGgpIGZvciAodmFyIGYgPSAwOyBmIDwgKGkgJiYgaS5sZW5ndGggfHwgMSk7IGYrKykgewogICAgICAgICAgZm9yICg7IE0gPCBtLmxlbmd0aCAmJiBudWxsICE9IG1bTV0uY29vcmREaW07KSB7CiAgICAgICAgICAgIE0rKzsKICAgICAgICAgIH0KCiAgICAgICAgICBNIDwgbS5sZW5ndGggJiYgYy5wdXNoKE0rKyk7CiAgICAgICAgfQogICAgICAgIGwoYywgZnVuY3Rpb24gKGUsIGEpIHsKICAgICAgICAgIHZhciBzID0gbVtlXTsKICAgICAgICAgIG4odShzLCB0KSwgciwgYSksIG51bGwgPT0gcy5uYW1lICYmIGkgJiYgKHMubmFtZSA9IHMudG9vbHRpcE5hbWUgPSBpW2FdKSwgbyAmJiB1KHMub3RoZXJEaW1zLCBvKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBmb3IgKHZhciBUID0gci5leHRyYVByZWZpeCB8fCAidmFsdWUiLCBrID0gMDsgayA8IHg7IGsrKykgewogICAgICAgIHZhciBTID0gbVtrXSA9IG1ba10gfHwge307CiAgICAgICAgbnVsbCA9PSBTLmNvb3JkRGltICYmIChTLmNvb3JkRGltID0gbyhULCBwLCByLmV4dHJhRnJvbVplcm8pLCBTLmNvb3JkRGltSW5kZXggPSAwLCBTLmlzRXh0cmFDb29yZCA9ICEwKSwgbnVsbCA9PSBTLm5hbWUgJiYgKFMubmFtZSA9IG8oUy5jb29yZERpbSwgZykpLCBudWxsID09IFMudHlwZSAmJiBmKGUsIGspICYmIChTLnR5cGUgPSAib3JkaW5hbCIpOwogICAgICB9CgogICAgICByZXR1cm4gbTsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgcmV0dXJuIGEuaXNBcnJheSh0KSA/IHQgOiBhLmlzT2JqZWN0KHQpID8gdC52YWx1ZSA6IHQ7CiAgICB9CgogICAgdmFyIGEgPSByKDApLAogICAgICAgIG8gPSByKDMwKSwKICAgICAgICBzID0gby5ub3JtYWxpemVUb0FycmF5LAogICAgICAgIGwgPSBhLmVhY2gsCiAgICAgICAgaCA9IGEuaXNTdHJpbmcsCiAgICAgICAgdSA9IGEuZGVmYXVsdHMsCiAgICAgICAgYyA9IHsKICAgICAgdG9vbHRpcDogMSwKICAgICAgbGFiZWw6IDEsCiAgICAgIGl0ZW1OYW1lOiAxCiAgICB9LAogICAgICAgIGYgPSBuLmd1ZXNzT3JkaW5hbCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIGZvciAodmFyIHIgPSAwLCBuID0gdC5sZW5ndGg7IHIgPCBuOyByKyspIHsKICAgICAgICB2YXIgbyA9IGkodFtyXSk7CiAgICAgICAgaWYgKCFhLmlzQXJyYXkobykpIHJldHVybiAhMTsKICAgICAgICB2YXIgbyA9IG9bZV07CiAgICAgICAgaWYgKG51bGwgIT0gbyAmJiBpc0Zpbml0ZShvKSAmJiAiIiAhPT0gbykgcmV0dXJuICExOwogICAgICAgIGlmIChoKG8pICYmICItIiAhPT0gbykgcmV0dXJuICEwOwogICAgICB9CgogICAgICByZXR1cm4gITE7CiAgICB9LAogICAgICAgIGQgPSBuOwoKICAgIHQuZXhwb3J0cyA9IGQ7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIEFycmF5ID8gdCA6IG51bGwgPT0gdCA/IFtdIDogW3RdOwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICBpZiAodCkgZm9yICh2YXIgciA9IHQuZW1waGFzaXMgPSB0LmVtcGhhc2lzIHx8IHt9LCBuID0gdC5ub3JtYWwgPSB0Lm5vcm1hbCB8fCB7fSwgaSA9IDAsIGEgPSBlLmxlbmd0aDsgaSA8IGE7IGkrKykgewogICAgICAgIHZhciBvID0gZVtpXTsKICAgICAgICAhci5oYXNPd25Qcm9wZXJ0eShvKSAmJiBuLmhhc093blByb3BlcnR5KG8pICYmIChyW29dID0gbltvXSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhKHQpIHsKICAgICAgcmV0dXJuIHQgJiYgKG51bGwgPT0gdC52YWx1ZSA/IHQgOiB0LnZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgcmV0dXJuIE0odCkgJiYgISh0IGluc3RhbmNlb2YgQXJyYXkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHModCwgZSkgewogICAgICB2YXIgciA9IGUgJiYgZS50eXBlOwogICAgICByZXR1cm4gIm9yZGluYWwiID09PSByID8gdCA6ICgidGltZSIgPT09IHIgJiYgIm51bWJlciIgIT0gdHlwZW9mIHQgJiYgbnVsbCAhPSB0ICYmICItIiAhPT0gdCAmJiAodCA9ICtfLnBhcnNlRGF0ZSh0KSksIG51bGwgPT0gdCB8fCAiIiA9PT0gdCA/IE5hTiA6ICt0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQsIGUpIHsKICAgICAgdmFyIHIgPSBuZXcgYigpOwogICAgICByZXR1cm4geS5taXhpbihyLCBrKSwgci5zZXJpZXNJbmRleCA9IGUuc2VyaWVzSW5kZXgsIHIubmFtZSA9IGUubmFtZSB8fCAiIiwgci5tYWluVHlwZSA9IGUubWFpblR5cGUsIHIuc3ViVHlwZSA9IGUuc3ViVHlwZSwgci5nZXREYXRhID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0OwogICAgICB9LCByOwogICAgfQoKICAgIGZ1bmN0aW9uIGgodCwgZSkgewogICAgICBlID0gKGUgfHwgW10pLnNsaWNlKCk7CiAgICAgIHZhciByID0geS5tYXAodCB8fCBbXSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZXhpc3Q6IHQKICAgICAgICB9OwogICAgICB9KTsKICAgICAgcmV0dXJuIFMoZSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBpZiAoTSh0KSkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghcltpXS5vcHRpb24gJiYgbnVsbCAhPSB0LmlkICYmIHJbaV0uZXhpc3QuaWQgPT09IHQuaWQgKyAiIikgcmV0dXJuIHJbaV0ub3B0aW9uID0gdCwgdm9pZCAoZVtuXSA9IG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgYSA9IHJbaV0uZXhpc3Q7CiAgICAgICAgICAgIGlmICghKHJbaV0ub3B0aW9uIHx8IG51bGwgIT0gYS5pZCAmJiBudWxsICE9IHQuaWQgfHwgbnVsbCA9PSB0Lm5hbWUgfHwgYyh0KSB8fCBjKGEpIHx8IGEubmFtZSAhPT0gdC5uYW1lICsgIiIpKSByZXR1cm4gcltpXS5vcHRpb24gPSB0LCB2b2lkIChlW25dID0gbnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KSwgUyhlLCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGlmIChNKHQpKSB7CiAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IHIubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgdmFyIGkgPSByW25dLmV4aXN0OwoKICAgICAgICAgICAgaWYgKCFyW25dLm9wdGlvbiAmJiAhYyhpKSAmJiBudWxsID09IHQuaWQpIHsKICAgICAgICAgICAgICByW25dLm9wdGlvbiA9IHQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBuID49IHIubGVuZ3RoICYmIHIucHVzaCh7CiAgICAgICAgICAgIG9wdGlvbjogdAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KSwgcjsKICAgIH0KCiAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgdmFyIGUgPSB5LmNyZWF0ZUhhc2hNYXAoKTsKICAgICAgUyh0LCBmdW5jdGlvbiAodCwgcikgewogICAgICAgIHZhciBuID0gdC5leGlzdDsKICAgICAgICBuICYmIGUuc2V0KG4uaWQsIHQpOwogICAgICB9KSwgUyh0LCBmdW5jdGlvbiAodCwgcikgewogICAgICAgIHZhciBuID0gdC5vcHRpb247CiAgICAgICAgeS5hc3NlcnQoIW4gfHwgbnVsbCA9PSBuLmlkIHx8ICFlLmdldChuLmlkKSB8fCBlLmdldChuLmlkKSA9PT0gdCwgImlkIGR1cGxpY2F0ZXM6ICIgKyAobiAmJiBuLmlkKSksIG4gJiYgbnVsbCAhPSBuLmlkICYmIGUuc2V0KG4uaWQsIHQpLCAhdC5rZXlJbmZvICYmICh0LmtleUluZm8gPSB7fSk7CiAgICAgIH0pLCBTKHQsIGZ1bmN0aW9uICh0LCByKSB7CiAgICAgICAgdmFyIG4gPSB0LmV4aXN0LAogICAgICAgICAgICBpID0gdC5vcHRpb24sCiAgICAgICAgICAgIGEgPSB0LmtleUluZm87CgogICAgICAgIGlmIChNKGkpKSB7CiAgICAgICAgICBpZiAoYS5uYW1lID0gbnVsbCAhPSBpLm5hbWUgPyBpLm5hbWUgKyAiIiA6IG4gPyBuLm5hbWUgOiAiXDAtIiwgbikgYS5pZCA9IG4uaWQ7ZWxzZSBpZiAobnVsbCAhPSBpLmlkKSBhLmlkID0gaS5pZCArICIiO2Vsc2UgewogICAgICAgICAgICB2YXIgbyA9IDA7CgogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgYS5pZCA9ICJcMCIgKyBhLm5hbWUgKyAiXDAiICsgbysrOwogICAgICAgICAgICB9IHdoaWxlIChlLmdldChhLmlkKSk7CiAgICAgICAgICB9CiAgICAgICAgICBlLnNldChhLmlkLCB0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGModCkgewogICAgICByZXR1cm4gTSh0KSAmJiB0LmlkICYmIDAgPT09ICh0LmlkICsgIiIpLmluZGV4T2YoIlwwX2VjX1wwIik7CiAgICB9CgogICAgZnVuY3Rpb24gZih0LCBlKSB7CiAgICAgIGZ1bmN0aW9uIHIodCwgZSwgcikgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBhID0gdC5sZW5ndGg7IGkgPCBhOyBpKyspIHsKICAgICAgICAgIGZvciAodmFyIG8gPSB0W2ldLnNlcmllc0lkLCBzID0gbih0W2ldLmRhdGFJbmRleCksIGwgPSByICYmIHJbb10sIGggPSAwLCB1ID0gcy5sZW5ndGg7IGggPCB1OyBoKyspIHsKICAgICAgICAgICAgdmFyIGMgPSBzW2hdOwogICAgICAgICAgICBsICYmIGxbY10gPyBsW2NdID0gbnVsbCA6IChlW29dIHx8IChlW29dID0ge30pKVtjXSA9IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgICB2YXIgciA9IFtdOwoKICAgICAgICBmb3IgKHZhciBuIGluIHQpIHsKICAgICAgICAgIGlmICh0Lmhhc093blByb3BlcnR5KG4pICYmIG51bGwgIT0gdFtuXSkgaWYgKGUpIHIucHVzaCgrbik7ZWxzZSB7CiAgICAgICAgICAgIHZhciBhID0gaSh0W25dLCAhMCk7CiAgICAgICAgICAgIGEubGVuZ3RoICYmIHIucHVzaCh7CiAgICAgICAgICAgICAgc2VyaWVzSWQ6IG4sCiAgICAgICAgICAgICAgZGF0YUluZGV4OiBhCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHI7CiAgICAgIH0KCiAgICAgIHZhciBhID0ge30sCiAgICAgICAgICBvID0ge307CiAgICAgIHJldHVybiByKHQgfHwgW10sIGEpLCByKGUgfHwgW10sIG8sIGEpLCBbaShhKSwgaShvKV07CiAgICB9CgogICAgZnVuY3Rpb24gZCh0LCBlKSB7CiAgICAgIHJldHVybiBudWxsICE9IGUuZGF0YUluZGV4SW5zaWRlID8gZS5kYXRhSW5kZXhJbnNpZGUgOiBudWxsICE9IGUuZGF0YUluZGV4ID8geS5pc0FycmF5KGUuZGF0YUluZGV4KSA/IHkubWFwKGUuZGF0YUluZGV4LCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB0LmluZGV4T2ZSYXdJbmRleChlKTsKICAgICAgfSkgOiB0LmluZGV4T2ZSYXdJbmRleChlLmRhdGFJbmRleCkgOiBudWxsICE9IGUubmFtZSA/IHkuaXNBcnJheShlLm5hbWUpID8geS5tYXAoZS5uYW1lLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB0LmluZGV4T2ZOYW1lKGUpOwogICAgICB9KSA6IHQuaW5kZXhPZk5hbWUoZS5uYW1lKSA6IHZvaWQgMDsKICAgIH0KCiAgICBmdW5jdGlvbiB2KHQsIGUsIHIpIHsKICAgICAgaWYgKHkuaXNTdHJpbmcoZSkpIHsKICAgICAgICB2YXIgbiA9IHt9OwogICAgICAgIG5bZSArICJJbmRleCJdID0gMCwgZSA9IG47CiAgICAgIH0KCiAgICAgIHZhciBpID0gciAmJiByLmRlZmF1bHRNYWluVHlwZTsKICAgICAgIWkgfHwgeChlLCBpICsgIkluZGV4IikgfHwgeChlLCBpICsgIklkIikgfHwgeChlLCBpICsgIk5hbWUiKSB8fCAoZVtpICsgIkluZGV4Il0gPSAwKTsKICAgICAgdmFyIGEgPSB7fTsKICAgICAgcmV0dXJuIFMoZSwgZnVuY3Rpb24gKG4sIGkpIHsKICAgICAgICB2YXIgbiA9IGVbaV07CiAgICAgICAgaWYgKCJkYXRhSW5kZXgiID09PSBpIHx8ICJkYXRhSW5kZXhJbnNpZGUiID09PSBpKSByZXR1cm4gdm9pZCAoYVtpXSA9IG4pOwogICAgICAgIHZhciBvID0gaS5tYXRjaCgvXihcdyspKEluZGV4fElkfE5hbWUpJC8pIHx8IFtdLAogICAgICAgICAgICBzID0gb1sxXSwKICAgICAgICAgICAgbCA9IChvWzJdIHx8ICIiKS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICBpZiAoISghcyB8fCAhbCB8fCBudWxsID09IG4gfHwgImluZGV4IiA9PT0gbCAmJiAibm9uZSIgPT09IG4gfHwgciAmJiByLmluY2x1ZGVNYWluVHlwZXMgJiYgeS5pbmRleE9mKHIuaW5jbHVkZU1haW5UeXBlcywgcykgPCAwKSkgewogICAgICAgICAgdmFyIGggPSB7CiAgICAgICAgICAgIG1haW5UeXBlOiBzCiAgICAgICAgICB9OwogICAgICAgICAgImluZGV4IiA9PT0gbCAmJiAiYWxsIiA9PT0gbiB8fCAoaFtsXSA9IG4pOwogICAgICAgICAgdmFyIHUgPSB0LnF1ZXJ5Q29tcG9uZW50cyhoKTsKICAgICAgICAgIGFbcyArICJNb2RlbHMiXSA9IHUsIGFbcyArICJNb2RlbCJdID0gdVswXTsKICAgICAgICB9CiAgICAgIH0pLCBhOwogICAgfQoKICAgIGZ1bmN0aW9uIGcodCwgZSkgewogICAgICB2YXIgciA9IHQuZGltZW5zaW9uczsKICAgICAgZSA9IHQuZ2V0RGltZW5zaW9uKGUpOwoKICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCByLmxlbmd0aDsgbisrKSB7CiAgICAgICAgdmFyIGkgPSB0LmdldERpbWVuc2lvbkluZm8ocltuXSk7CiAgICAgICAgaWYgKGkubmFtZSA9PT0gZSkgcmV0dXJuIGkuY29vcmREaW07CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwKHQsIGUpIHsKICAgICAgdmFyIHIgPSBbXTsKICAgICAgcmV0dXJuIFModC5kaW1lbnNpb25zLCBmdW5jdGlvbiAobikgewogICAgICAgIHZhciBpID0gdC5nZXREaW1lbnNpb25JbmZvKG4pOwogICAgICAgIGkuY29vcmREaW0gPT09IGUgJiYgKHJbaS5jb29yZERpbUluZGV4XSA9IGkubmFtZSk7CiAgICAgIH0pLCByOwogICAgfQoKICAgIGZ1bmN0aW9uIG0odCwgZSkgewogICAgICB2YXIgciA9IFtdOwogICAgICByZXR1cm4gUyh0LmRpbWVuc2lvbnMsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgdmFyIGkgPSB0LmdldERpbWVuc2lvbkluZm8obiksCiAgICAgICAgICAgIGEgPSBpLm90aGVyRGltcywKICAgICAgICAgICAgbyA9IGFbZV07CiAgICAgICAgbnVsbCAhPSBvICYmICExICE9PSBvICYmIChyW29dID0gaS5uYW1lKTsKICAgICAgfSksIHI7CiAgICB9CgogICAgZnVuY3Rpb24geCh0LCBlKSB7CiAgICAgIHJldHVybiB0ICYmIHQuaGFzT3duUHJvcGVydHkoZSk7CiAgICB9CgogICAgdmFyIHkgPSByKDApLAogICAgICAgIHcgPSByKDEzKSwKICAgICAgICBfID0gcig5KSwKICAgICAgICBiID0gcigzMSksCiAgICAgICAgUyA9IHkuZWFjaCwKICAgICAgICBNID0geS5pc09iamVjdCwKICAgICAgICBUID0gWyJmb250U3R5bGUiLCAiZm9udFdlaWdodCIsICJmb250U2l6ZSIsICJmb250RmFtaWx5IiwgInJpY2giLCAidGFnIiwgImNvbG9yIiwgInRleHRCb3JkZXJDb2xvciIsICJ0ZXh0Qm9yZGVyV2lkdGgiLCAid2lkdGgiLCAiaGVpZ2h0IiwgImxpbmVIZWlnaHQiLCAiYWxpZ24iLCAidmVydGljYWxBbGlnbiIsICJiYXNlbGluZSIsICJzaGFkb3dDb2xvciIsICJzaGFkb3dCbHVyIiwgInNoYWRvd09mZnNldFgiLCAic2hhZG93T2Zmc2V0WSIsICJ0ZXh0U2hhZG93Q29sb3IiLCAidGV4dFNoYWRvd0JsdXIiLCAidGV4dFNoYWRvd09mZnNldFgiLCAidGV4dFNoYWRvd09mZnNldFkiLCAiYmFja2dyb3VuZENvbG9yIiwgImJvcmRlckNvbG9yIiwgImJvcmRlcldpZHRoIiwgImJvcmRlclJhZGl1cyIsICJwYWRkaW5nIl0sCiAgICAgICAgayA9IHsKICAgICAgZ2V0RGF0YVBhcmFtczogZnVuY3Rpb24gZ2V0RGF0YVBhcmFtcyh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLmdldERhdGEoZSksCiAgICAgICAgICAgIG4gPSB0aGlzLmdldFJhd1ZhbHVlKHQsIGUpLAogICAgICAgICAgICBpID0gci5nZXRSYXdJbmRleCh0KSwKICAgICAgICAgICAgYSA9IHIuZ2V0TmFtZSh0LCAhMCksCiAgICAgICAgICAgIG8gPSByLmdldFJhd0RhdGFJdGVtKHQpLAogICAgICAgICAgICBzID0gci5nZXRJdGVtVmlzdWFsKHQsICJjb2xvciIpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjb21wb25lbnRUeXBlOiB0aGlzLm1haW5UeXBlLAogICAgICAgICAgY29tcG9uZW50U3ViVHlwZTogdGhpcy5zdWJUeXBlLAogICAgICAgICAgc2VyaWVzVHlwZTogInNlcmllcyIgPT09IHRoaXMubWFpblR5cGUgPyB0aGlzLnN1YlR5cGUgOiBudWxsLAogICAgICAgICAgc2VyaWVzSW5kZXg6IHRoaXMuc2VyaWVzSW5kZXgsCiAgICAgICAgICBzZXJpZXNJZDogdGhpcy5pZCwKICAgICAgICAgIHNlcmllc05hbWU6IHRoaXMubmFtZSwKICAgICAgICAgIG5hbWU6IGEsCiAgICAgICAgICBkYXRhSW5kZXg6IGksCiAgICAgICAgICBkYXRhOiBvLAogICAgICAgICAgZGF0YVR5cGU6IGUsCiAgICAgICAgICB2YWx1ZTogbiwKICAgICAgICAgIGNvbG9yOiBzLAogICAgICAgICAgbWFya2VyOiB3LmdldFRvb2x0aXBNYXJrZXIocyksCiAgICAgICAgICAkdmFyczogWyJzZXJpZXNOYW1lIiwgIm5hbWUiLCAidmFsdWUiXQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGdldEZvcm1hdHRlZExhYmVsOiBmdW5jdGlvbiBnZXRGb3JtYXR0ZWRMYWJlbCh0LCBlLCByLCBuLCBpKSB7CiAgICAgICAgZSA9IGUgfHwgIm5vcm1hbCI7CiAgICAgICAgdmFyIGEgPSB0aGlzLmdldERhdGEociksCiAgICAgICAgICAgIG8gPSBhLmdldEl0ZW1Nb2RlbCh0KSwKICAgICAgICAgICAgcyA9IHRoaXMuZ2V0RGF0YVBhcmFtcyh0LCByKTsKICAgICAgICBudWxsICE9IG4gJiYgcy52YWx1ZSBpbnN0YW5jZW9mIEFycmF5ICYmIChzLnZhbHVlID0gcy52YWx1ZVtuXSk7CiAgICAgICAgdmFyIGwgPSBvLmdldChbaSB8fCAibGFiZWwiLCBlLCAiZm9ybWF0dGVyIl0pOwogICAgICAgIHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiBsID8gKHMuc3RhdHVzID0gZSwgbChzKSkgOiAic3RyaW5nIiA9PSB0eXBlb2YgbCA/IHcuZm9ybWF0VHBsKGwsIHMpIDogdm9pZCAwOwogICAgICB9LAogICAgICBnZXRSYXdWYWx1ZTogZnVuY3Rpb24gZ2V0UmF3VmFsdWUodCwgZSkgewogICAgICAgIHZhciByID0gdGhpcy5nZXREYXRhKGUpLAogICAgICAgICAgICBuID0gci5nZXRSYXdEYXRhSXRlbSh0KTsKICAgICAgICBpZiAobnVsbCAhPSBuKSByZXR1cm4gIU0obikgfHwgbiBpbnN0YW5jZW9mIEFycmF5ID8gbiA6IG4udmFsdWU7CiAgICAgIH0sCiAgICAgIGZvcm1hdFRvb2x0aXA6IHkubm9vcAogICAgfSwKICAgICAgICBDID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdCA9IDA7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGUgPSAiXDBfX2VjX3Byb3BfZ2V0dGVyXyIgKyB0Kys7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdFtlXSB8fCAodFtlXSA9IHt9KTsKICAgICAgICB9OwogICAgICB9OwogICAgfSgpOwoKICAgIGUubm9ybWFsaXplVG9BcnJheSA9IG4sIGUuZGVmYXVsdEVtcGhhc2lzID0gaSwgZS5URVhUX1NUWUxFX09QVElPTlMgPSBULCBlLmdldERhdGFJdGVtVmFsdWUgPSBhLCBlLmlzRGF0YUl0ZW1PcHRpb24gPSBvLCBlLmNvbnZlckRhdGFWYWx1ZSA9IHMsIGUuY3JlYXRlRGF0YUZvcm1hdE1vZGVsID0gbCwgZS5kYXRhRm9ybWF0TWl4aW4gPSBrLCBlLm1hcHBpbmdUb0V4aXN0cyA9IGgsIGUubWFrZUlkQW5kTmFtZSA9IHUsIGUuaXNJZElubmVyID0gYywgZS5jb21wcmVzc0JhdGNoZXMgPSBmLCBlLnF1ZXJ5RGF0YUluZGV4ID0gZCwgZS5tYWtlR2V0dGVyID0gQywgZS5wYXJzZUZpbmRlciA9IHYsIGUuZGF0YURpbVRvQ29vcmREaW0gPSBnLCBlLmNvb3JkRGltVG9EYXRhRGltID0gcCwgZS5vdGhlckRpbVRvRGF0YURpbSA9IG07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgcikgewogICAgICB0aGlzLnBhcmVudE1vZGVsID0gZSwgdGhpcy5lY01vZGVsID0gciwgdGhpcy5vcHRpb24gPSB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSwgcikgewogICAgICBmb3IgKHZhciBuID0gMDsgbiA8IGUubGVuZ3RoICYmICghZVtuXSB8fCBudWxsICE9ICh0ID0gdCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKHQpID8gdFtlW25dXSA6IG51bGwpKTsgbisrKSB7CiAgICAgICAgOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbCA9PSB0ICYmIHIgJiYgKHQgPSByLmdldChlKSksIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gYSh0LCBlKSB7CiAgICAgIHZhciByID0gbC5nZXQodCwgImdldFBhcmVudCIpOwogICAgICByZXR1cm4gciA/IHIuY2FsbCh0LCBlKSA6IHQucGFyZW50TW9kZWw7CiAgICB9CgogICAgdmFyIG8gPSByKDApLAogICAgICAgIHMgPSByKDE1KSwKICAgICAgICBsID0gcigzMiksCiAgICAgICAgaCA9IHIoMzUpLAogICAgICAgIHUgPSByKDM2KSwKICAgICAgICBjID0gcigzNyksCiAgICAgICAgZiA9IHIoNzYpLAogICAgICAgIGQgPSBvLm1peGluOwogICAgbi5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBuLAogICAgICBpbml0OiBudWxsLAogICAgICBtZXJnZU9wdGlvbjogZnVuY3Rpb24gbWVyZ2VPcHRpb24odCkgewogICAgICAgIG8ubWVyZ2UodGhpcy5vcHRpb24sIHQsICEwKTsKICAgICAgfSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQodCwgZSkgewogICAgICAgIHJldHVybiBudWxsID09IHQgPyB0aGlzLm9wdGlvbiA6IGkodGhpcy5vcHRpb24sIHRoaXMucGFyc2VQYXRoKHQpLCAhZSAmJiBhKHRoaXMsIHQpKTsKICAgICAgfSwKICAgICAgZ2V0U2hhbGxvdzogZnVuY3Rpb24gZ2V0U2hhbGxvdyh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLm9wdGlvbiwKICAgICAgICAgICAgbiA9IG51bGwgPT0gciA/IHIgOiByW3RdLAogICAgICAgICAgICBpID0gIWUgJiYgYSh0aGlzLCB0KTsKICAgICAgICByZXR1cm4gbnVsbCA9PSBuICYmIGkgJiYgKG4gPSBpLmdldFNoYWxsb3codCkpLCBuOwogICAgICB9LAogICAgICBnZXRNb2RlbDogZnVuY3Rpb24gZ2V0TW9kZWwodCwgZSkgewogICAgICAgIHZhciByLAogICAgICAgICAgICBvID0gbnVsbCA9PSB0ID8gdGhpcy5vcHRpb24gOiBpKHRoaXMub3B0aW9uLCB0ID0gdGhpcy5wYXJzZVBhdGgodCkpOwogICAgICAgIHJldHVybiBlID0gZSB8fCAociA9IGEodGhpcywgdCkpICYmIHIuZ2V0TW9kZWwodCksIG5ldyBuKG8sIGUsIHRoaXMuZWNNb2RlbCk7CiAgICAgIH0sCiAgICAgIGlzRW1wdHk6IGZ1bmN0aW9uIGlzRW1wdHkoKSB7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdGhpcy5vcHRpb247CiAgICAgIH0sCiAgICAgIHJlc3RvcmVEYXRhOiBmdW5jdGlvbiByZXN0b3JlRGF0YSgpIHt9LAogICAgICBjbG9uZTogZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyAoMCwgdGhpcy5jb25zdHJ1Y3Rvcikoby5jbG9uZSh0aGlzLm9wdGlvbikpOwogICAgICB9LAogICAgICBzZXRSZWFkT25seTogZnVuY3Rpb24gc2V0UmVhZE9ubHkodCkgewogICAgICAgIGwuc2V0UmVhZE9ubHkodGhpcywgdCk7CiAgICAgIH0sCiAgICAgIHBhcnNlUGF0aDogZnVuY3Rpb24gcGFyc2VQYXRoKHQpIHsKICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHQgJiYgKHQgPSB0LnNwbGl0KCIuIikpLCB0OwogICAgICB9LAogICAgICBjdXN0b21pemVHZXRQYXJlbnQ6IGZ1bmN0aW9uIGN1c3RvbWl6ZUdldFBhcmVudCh0KSB7CiAgICAgICAgbC5zZXQodGhpcywgImdldFBhcmVudCIsIHQpOwogICAgICB9LAogICAgICBpc0FuaW1hdGlvbkVuYWJsZWQ6IGZ1bmN0aW9uIGlzQW5pbWF0aW9uRW5hYmxlZCgpIHsKICAgICAgICBpZiAoIXMubm9kZSkgewogICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5vcHRpb24uYW5pbWF0aW9uKSByZXR1cm4gISF0aGlzLm9wdGlvbi5hbmltYXRpb247CiAgICAgICAgICBpZiAodGhpcy5wYXJlbnRNb2RlbCkgcmV0dXJuIHRoaXMucGFyZW50TW9kZWwuaXNBbmltYXRpb25FbmFibGVkKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBsLmVuYWJsZUNsYXNzRXh0ZW5kKG4pLCBkKG4sIGgpLCBkKG4sIHUpLCBkKG4sIGMpLCBkKG4sIGYpOwogICAgdmFyIHYgPSBuOwogICAgdC5leHBvcnRzID0gdjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0LCBlLCByKSB7CiAgICAgIHJldHVybiB0W20gKyBlXSA9IHI7CiAgICB9CgogICAgZnVuY3Rpb24gaSh0LCBlKSB7CiAgICAgIHJldHVybiB0W20gKyBlXTsKICAgIH0KCiAgICBmdW5jdGlvbiBhKHQsIGUpIHsKICAgICAgcmV0dXJuIHQuaGFzT3duUHJvcGVydHkobSArIGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCkgewogICAgICB2YXIgZSA9IHsKICAgICAgICBtYWluOiAiIiwKICAgICAgICBzdWI6ICIiCiAgICAgIH07CiAgICAgIHJldHVybiB0ICYmICh0ID0gdC5zcGxpdChnKSwgZS5tYWluID0gdFswXSB8fCAiIiwgZS5zdWIgPSB0WzFdIHx8ICIiKSwgZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQpIHsKICAgICAgdi5hc3NlcnQoL15bYS16QS1aMC05X10rKFsuXVthLXpBLVowLTlfXSspPyQvLnRlc3QodCksICdjb21wb25lbnRUeXBlICInICsgdCArICciIGlsbGVnYWwnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQsIGUpIHsKICAgICAgdC4kY29uc3RydWN0b3IgPSB0LCB0LmV4dGVuZCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLAogICAgICAgICAgICByID0gZnVuY3Rpb24gcigpIHsKICAgICAgICAgIHQuJGNvbnN0cnVjdG9yID8gdC4kY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gdi5leHRlbmQoci5wcm90b3R5cGUsIHQpLCByLmV4dGVuZCA9IHRoaXMuZXh0ZW5kLCByLnN1cGVyQ2FsbCA9IGgsIHIuc3VwZXJBcHBseSA9IHUsIHYuaW5oZXJpdHMociwgdGhpcyksIHIuc3VwZXJDbGFzcyA9IGUsIHI7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gaCh0LCBlKSB7CiAgICAgIHZhciByID0gdi5zbGljZShhcmd1bWVudHMsIDIpOwogICAgICByZXR1cm4gdGhpcy5zdXBlckNsYXNzLnByb3RvdHlwZVtlXS5hcHBseSh0LCByKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1KHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRoaXMuc3VwZXJDbGFzcy5wcm90b3R5cGVbZV0uYXBwbHkodCwgcik7CiAgICB9CgogICAgZnVuY3Rpb24gYyh0LCBlKSB7CiAgICAgIGZ1bmN0aW9uIHIodCkgewogICAgICAgIHZhciBlID0gblt0Lm1haW5dOwogICAgICAgIHJldHVybiBlICYmIGVbcF0gfHwgKGUgPSBuW3QubWFpbl0gPSB7fSwgZVtwXSA9ICEwKSwgZTsKICAgICAgfQoKICAgICAgZSA9IGUgfHwge307CiAgICAgIHZhciBuID0ge307CgogICAgICBpZiAodC5yZWdpc3RlckNsYXNzID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICBpZiAoZSkgaWYgKHMoZSksIGUgPSBvKGUpLCBlLnN1YikgewogICAgICAgICAgaWYgKGUuc3ViICE9PSBwKSB7CiAgICAgICAgICAgIHZhciBpID0gcihlKTsKICAgICAgICAgICAgaVtlLnN1Yl0gPSB0OwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBuW2UubWFpbl0gPSB0OwogICAgICAgIHJldHVybiB0OwogICAgICB9LCB0LmdldENsYXNzID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICB2YXIgaSA9IG5bdF07CiAgICAgICAgaWYgKGkgJiYgaVtwXSAmJiAoaSA9IGUgPyBpW2VdIDogbnVsbCksIHIgJiYgIWkpIHRocm93IG5ldyBFcnJvcihlID8gIkNvbXBvbmVudCAiICsgdCArICIuIiArIChlIHx8ICIiKSArICIgbm90IGV4aXN0cy4gTG9hZCBpdCBmaXJzdC4iIDogdCArICIudHlwZSBzaG91bGQgYmUgc3BlY2lmaWVkLiIpOwogICAgICAgIHJldHVybiBpOwogICAgICB9LCB0LmdldENsYXNzZXNCeU1haW5UeXBlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0ID0gbyh0KTsKICAgICAgICB2YXIgZSA9IFtdLAogICAgICAgICAgICByID0gblt0Lm1haW5dOwogICAgICAgIHJldHVybiByICYmIHJbcF0gPyB2LmVhY2gociwgZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICAgIHIgIT09IHAgJiYgZS5wdXNoKHQpOwogICAgICAgIH0pIDogZS5wdXNoKHIpLCBlOwogICAgICB9LCB0Lmhhc0NsYXNzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdCA9IG8odCksICEhblt0Lm1haW5dOwogICAgICB9LCB0LmdldEFsbENsYXNzTWFpblR5cGVzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gW107CiAgICAgICAgcmV0dXJuIHYuZWFjaChuLCBmdW5jdGlvbiAoZSwgcikgewogICAgICAgICAgdC5wdXNoKHIpOwogICAgICAgIH0pLCB0OwogICAgICB9LCB0Lmhhc1N1YlR5cGVzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0ID0gbyh0KTsKICAgICAgICB2YXIgZSA9IG5bdC5tYWluXTsKICAgICAgICByZXR1cm4gZSAmJiBlW3BdOwogICAgICB9LCB0LnBhcnNlQ2xhc3NUeXBlID0gbywgZS5yZWdpc3RlcldoZW5FeHRlbmQpIHsKICAgICAgICB2YXIgaSA9IHQuZXh0ZW5kOwogICAgICAgIGkgJiYgKHQuZXh0ZW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciByID0gaS5jYWxsKHRoaXMsIGUpOwogICAgICAgICAgcmV0dXJuIHQucmVnaXN0ZXJDbGFzcyhyLCBlLnR5cGUpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gdDsKICAgIH0KCiAgICBmdW5jdGlvbiBmKHQsIGUpIHt9CgogICAgdmFyIGQgPSByKDMzKSwKICAgICAgICB2ID0gKGQuX19ERVZfXywgcigwKSksCiAgICAgICAgZyA9ICIuIiwKICAgICAgICBwID0gIl9fX0VDX19DT01QT05FTlRfX0NPTlRBSU5FUl9fXyIsCiAgICAgICAgbSA9ICJcMGVjX1wwIjsKICAgIGUuc2V0ID0gbiwgZS5nZXQgPSBpLCBlLmhhc093biA9IGEsIGUucGFyc2VDbGFzc1R5cGUgPSBvLCBlLmVuYWJsZUNsYXNzRXh0ZW5kID0gbCwgZS5lbmFibGVDbGFzc01hbmFnZW1lbnQgPSBjLCBlLnNldFJlYWRPbmx5ID0gZjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciByOwogICAgICAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gciA9IHdpbmRvdy5fX0RFVl9fIDogdm9pZCAwICE9PSB0ICYmIChyID0gdC5fX0RFVl9fKSwgdm9pZCAwID09PSByICYmIChyID0gITApOwogICAgICB2YXIgbiA9IHI7CiAgICAgIGUuX19ERVZfXyA9IG47CiAgICB9KS5jYWxsKGUsIHIoMzQpKTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHI7CgogICAgciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9KCk7CgogICAgdHJ5IHsKICAgICAgciA9IHIgfHwgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKSB8fCAoMCwgZXZhbCkoInRoaXMiKTsKICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgIm9iamVjdCIgPT0gKHR5cGVvZiB3aW5kb3cgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKHdpbmRvdykpICYmIChyID0gd2luZG93KTsKICAgIH0KCiAgICB0LmV4cG9ydHMgPSByOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMTEpLAogICAgICAgIGkgPSBuKFtbImxpbmVXaWR0aCIsICJ3aWR0aCJdLCBbInN0cm9rZSIsICJjb2xvciJdLCBbIm9wYWNpdHkiXSwgWyJzaGFkb3dCbHVyIl0sIFsic2hhZG93T2Zmc2V0WCJdLCBbInNoYWRvd09mZnNldFkiXSwgWyJzaGFkb3dDb2xvciJdXSksCiAgICAgICAgYSA9IHsKICAgICAgZ2V0TGluZVN0eWxlOiBmdW5jdGlvbiBnZXRMaW5lU3R5bGUodCkgewogICAgICAgIHZhciBlID0gaSh0aGlzLCB0KSwKICAgICAgICAgICAgciA9IHRoaXMuZ2V0TGluZURhc2goZS5saW5lV2lkdGgpOwogICAgICAgIHJldHVybiByICYmIChlLmxpbmVEYXNoID0gciksIGU7CiAgICAgIH0sCiAgICAgIGdldExpbmVEYXNoOiBmdW5jdGlvbiBnZXRMaW5lRGFzaCh0KSB7CiAgICAgICAgbnVsbCA9PSB0ICYmICh0ID0gMSk7CiAgICAgICAgdmFyIGUgPSB0aGlzLmdldCgidHlwZSIpLAogICAgICAgICAgICByID0gTWF0aC5tYXgodCwgMiksCiAgICAgICAgICAgIG4gPSA0ICogdDsKICAgICAgICByZXR1cm4gInNvbGlkIiA9PT0gZSB8fCBudWxsID09IGUgPyBudWxsIDogImRhc2hlZCIgPT09IGUgPyBbbiwgbl0gOiBbciwgcl07CiAgICAgIH0KICAgIH07CiAgICB0LmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMTEpLAogICAgICAgIGkgPSBuKFtbImZpbGwiLCAiY29sb3IiXSwgWyJzaGFkb3dCbHVyIl0sIFsic2hhZG93T2Zmc2V0WCJdLCBbInNoYWRvd09mZnNldFkiXSwgWyJvcGFjaXR5Il0sIFsic2hhZG93Q29sb3IiXV0pLAogICAgICAgIGEgPSB7CiAgICAgIGdldEFyZWFTdHlsZTogZnVuY3Rpb24gZ2V0QXJlYVN0eWxlKHQsIGUpIHsKICAgICAgICByZXR1cm4gaSh0aGlzLCB0LCBlKTsKICAgICAgfQogICAgfTsKICAgIHQuZXhwb3J0cyA9IGE7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcig1KSwKICAgICAgICBpID0gcigzOCksCiAgICAgICAgYSA9IFsidGV4dFN0eWxlIiwgImNvbG9yIl0sCiAgICAgICAgbyA9IHsKICAgICAgZ2V0VGV4dENvbG9yOiBmdW5jdGlvbiBnZXRUZXh0Q29sb3IodCkgewogICAgICAgIHZhciBlID0gdGhpcy5lY01vZGVsOwogICAgICAgIHJldHVybiB0aGlzLmdldFNoYWxsb3coImNvbG9yIikgfHwgKCF0ICYmIGUgPyBlLmdldChhKSA6IG51bGwpOwogICAgICB9LAogICAgICBnZXRGb250OiBmdW5jdGlvbiBnZXRGb250KCkgewogICAgICAgIHJldHVybiBpLmdldEZvbnQoewogICAgICAgICAgZm9udFN0eWxlOiB0aGlzLmdldFNoYWxsb3coImZvbnRTdHlsZSIpLAogICAgICAgICAgZm9udFdlaWdodDogdGhpcy5nZXRTaGFsbG93KCJmb250V2VpZ2h0IiksCiAgICAgICAgICBmb250U2l6ZTogdGhpcy5nZXRTaGFsbG93KCJmb250U2l6ZSIpLAogICAgICAgICAgZm9udEZhbWlseTogdGhpcy5nZXRTaGFsbG93KCJmb250RmFtaWx5IikKICAgICAgICB9LCB0aGlzLmVjTW9kZWwpOwogICAgICB9LAogICAgICBnZXRUZXh0UmVjdDogZnVuY3Rpb24gZ2V0VGV4dFJlY3QodCkgewogICAgICAgIHJldHVybiBuLmdldEJvdW5kaW5nUmVjdCh0LCB0aGlzLmdldEZvbnQoKSwgdGhpcy5nZXRTaGFsbG93KCJhbGlnbiIpLCB0aGlzLmdldFNoYWxsb3coInZlcnRpY2FsQWxpZ24iKSB8fCB0aGlzLmdldFNoYWxsb3coImJhc2VsaW5lIiksIHRoaXMuZ2V0U2hhbGxvdygicGFkZGluZyIpLCB0aGlzLmdldFNoYWxsb3coInJpY2giKSwgdGhpcy5nZXRTaGFsbG93KCJ0cnVuY2F0ZVRleHQiKSk7CiAgICAgIH0KICAgIH07CiAgICB0LmV4cG9ydHMgPSBvOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgcmV0dXJuIFouZXh0ZW5kKHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICByZXR1cm4gVi5leHRlbmRGcm9tU3RyaW5nKHQsIGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGEodCwgZSwgciwgbikgewogICAgICB2YXIgaSA9IFYuY3JlYXRlRnJvbVN0cmluZyh0LCBlKSwKICAgICAgICAgIGEgPSBpLmdldEJvdW5kaW5nUmVjdCgpOwogICAgICByZXR1cm4gciAmJiAoImNlbnRlciIgPT09IG4gJiYgKHIgPSBzKHIsIGEpKSwgbChpLCByKSksIGk7CiAgICB9CgogICAgZnVuY3Rpb24gbyh0LCBlLCByKSB7CiAgICAgIHZhciBuID0gbmV3IEsoewogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBpbWFnZTogdCwKICAgICAgICAgIHg6IGUueCwKICAgICAgICAgIHk6IGUueSwKICAgICAgICAgIHdpZHRoOiBlLndpZHRoLAogICAgICAgICAgaGVpZ2h0OiBlLmhlaWdodAogICAgICAgIH0sCiAgICAgICAgb25sb2FkOiBmdW5jdGlvbiBvbmxvYWQodCkgewogICAgICAgICAgaWYgKCJjZW50ZXIiID09PSByKSB7CiAgICAgICAgICAgIHZhciBpID0gewogICAgICAgICAgICAgIHdpZHRoOiB0LndpZHRoLAogICAgICAgICAgICAgIGhlaWdodDogdC5oZWlnaHQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbi5zZXRTdHlsZShzKGUsIGkpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gbjsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIGUpIHsKICAgICAgdmFyIHIsCiAgICAgICAgICBuID0gZS53aWR0aCAvIGUuaGVpZ2h0LAogICAgICAgICAgaSA9IHQuaGVpZ2h0ICogbjsKICAgICAgcmV0dXJuIGkgPD0gdC53aWR0aCA/IHIgPSB0LmhlaWdodCA6IChpID0gdC53aWR0aCwgciA9IGkgLyBuKSwgewogICAgICAgIHg6IHQueCArIHQud2lkdGggLyAyIC0gaSAvIDIsCiAgICAgICAgeTogdC55ICsgdC5oZWlnaHQgLyAyIC0gciAvIDIsCiAgICAgICAgd2lkdGg6IGksCiAgICAgICAgaGVpZ2h0OiByCiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gbCh0LCBlKSB7CiAgICAgIGlmICh0LmFwcGx5VHJhbnNmb3JtKSB7CiAgICAgICAgdmFyIHIgPSB0LmdldEJvdW5kaW5nUmVjdCgpLAogICAgICAgICAgICBuID0gci5jYWxjdWxhdGVUcmFuc2Zvcm0oZSk7CiAgICAgICAgdC5hcHBseVRyYW5zZm9ybShuKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGgodCkgewogICAgICB2YXIgZSA9IHQuc2hhcGUsCiAgICAgICAgICByID0gdC5zdHlsZS5saW5lV2lkdGg7CiAgICAgIHJldHVybiB2dCgyICogZS54MSkgPT09IHZ0KDIgKiBlLngyKSAmJiAoZS54MSA9IGUueDIgPSBjKGUueDEsIHIsICEwKSksIHZ0KDIgKiBlLnkxKSA9PT0gdnQoMiAqIGUueTIpICYmIChlLnkxID0gZS55MiA9IGMoZS55MSwgciwgITApKSwgdDsKICAgIH0KCiAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgdmFyIGUgPSB0LnNoYXBlLAogICAgICAgICAgciA9IHQuc3R5bGUubGluZVdpZHRoLAogICAgICAgICAgbiA9IGUueCwKICAgICAgICAgIGkgPSBlLnksCiAgICAgICAgICBhID0gZS53aWR0aCwKICAgICAgICAgIG8gPSBlLmhlaWdodDsKICAgICAgcmV0dXJuIGUueCA9IGMoZS54LCByLCAhMCksIGUueSA9IGMoZS55LCByLCAhMCksIGUud2lkdGggPSBNYXRoLm1heChjKG4gKyBhLCByLCAhMSkgLSBlLngsIDAgPT09IGEgPyAwIDogMSksIGUuaGVpZ2h0ID0gTWF0aC5tYXgoYyhpICsgbywgciwgITEpIC0gZS55LCAwID09PSBvID8gMCA6IDEpLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGModCwgZSwgcikgewogICAgICB2YXIgbiA9IHZ0KDIgKiB0KTsKICAgICAgcmV0dXJuIChuICsgdnQoZSkpICUgMiA9PSAwID8gbiAvIDIgOiAobiArIChyID8gMSA6IC0xKSkgLyAyOwogICAgfQoKICAgIGZ1bmN0aW9uIGYodCkgewogICAgICByZXR1cm4gbnVsbCAhPSB0ICYmICJub25lIiAhPSB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGQodCkgewogICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHQgPyBHLmxpZnQodCwgLS4xKSA6IHQ7CiAgICB9CgogICAgZnVuY3Rpb24gdih0KSB7CiAgICAgIGlmICh0Ll9faG92ZXJTdGxEaXJ0eSkgewogICAgICAgIHZhciBlID0gdC5zdHlsZS5zdHJva2UsCiAgICAgICAgICAgIHIgPSB0LnN0eWxlLmZpbGwsCiAgICAgICAgICAgIG4gPSB0Ll9faG92ZXJTdGw7CiAgICAgICAgbi5maWxsID0gbi5maWxsIHx8IChmKHIpID8gZChyKSA6IG51bGwpLCBuLnN0cm9rZSA9IG4uc3Ryb2tlIHx8IChmKGUpID8gZChlKSA6IG51bGwpOwogICAgICAgIHZhciBpID0ge307CgogICAgICAgIGZvciAodmFyIGEgaW4gbikgewogICAgICAgICAgbnVsbCAhPSBuW2FdICYmIChpW2FdID0gdC5zdHlsZVthXSk7CiAgICAgICAgfQoKICAgICAgICB0Ll9fbm9ybWFsU3RsID0gaSwgdC5fX2hvdmVyU3RsRGlydHkgPSAhMTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGcodCkgewogICAgICBpZiAoIXQuX19pc0hvdmVyKSB7CiAgICAgICAgaWYgKHYodCksIHQudXNlSG92ZXJMYXllcikgdC5fX3pyICYmIHQuX196ci5hZGRIb3Zlcih0LCB0Ll9faG92ZXJTdGwpO2Vsc2UgewogICAgICAgICAgdmFyIGUgPSB0LnN0eWxlLAogICAgICAgICAgICAgIHIgPSBlLmluc2lkZVJvbGxiYWNrT3B0OwogICAgICAgICAgciAmJiBMKGUpLCBlLmV4dGVuZEZyb20odC5fX2hvdmVyU3RsKSwgciAmJiAoRChlLCBlLmluc2lkZU9yaWdpbmFsVGV4dFBvc2l0aW9uLCByKSwgbnVsbCA9PSBlLnRleHRGaWxsICYmIChlLnRleHRGaWxsID0gci5hdXRvQ29sb3IpKSwgdC5kaXJ0eSghMSksIHQuejIgKz0gMTsKICAgICAgICB9CiAgICAgICAgdC5fX2lzSG92ZXIgPSAhMDsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHAodCkgewogICAgICBpZiAodC5fX2lzSG92ZXIpIHsKICAgICAgICB2YXIgZSA9IHQuX19ub3JtYWxTdGw7CiAgICAgICAgdC51c2VIb3ZlckxheWVyID8gdC5fX3pyICYmIHQuX196ci5yZW1vdmVIb3Zlcih0KSA6IChlICYmIHQuc2V0U3R5bGUoZSksIHQuejIgLT0gMSksIHQuX19pc0hvdmVyID0gITE7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBtKHQpIHsKICAgICAgImdyb3VwIiA9PT0gdC50eXBlID8gdC50cmF2ZXJzZShmdW5jdGlvbiAodCkgewogICAgICAgICJncm91cCIgIT09IHQudHlwZSAmJiBnKHQpOwogICAgICB9KSA6IGcodCk7CiAgICB9CgogICAgZnVuY3Rpb24geCh0KSB7CiAgICAgICJncm91cCIgPT09IHQudHlwZSA/IHQudHJhdmVyc2UoZnVuY3Rpb24gKHQpIHsKICAgICAgICAiZ3JvdXAiICE9PSB0LnR5cGUgJiYgcCh0KTsKICAgICAgfSkgOiBwKHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHkodCwgZSkgewogICAgICB0Ll9faG92ZXJTdGwgPSB0LmhvdmVyU3R5bGUgfHwgZSB8fCB7fSwgdC5fX2hvdmVyU3RsRGlydHkgPSAhMCwgdC5fX2lzSG92ZXIgJiYgdih0KTsKICAgIH0KCiAgICBmdW5jdGlvbiB3KHQpIHsKICAgICAgdGhpcy5fX2hvdmVyU2lsZW50T25Ub3VjaCAmJiB0LnpyQnlUb3VjaCB8fCAhdGhpcy5fX2lzRW1waGFzaXMgJiYgbSh0aGlzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfKHQpIHsKICAgICAgdGhpcy5fX2hvdmVyU2lsZW50T25Ub3VjaCAmJiB0LnpyQnlUb3VjaCB8fCAhdGhpcy5fX2lzRW1waGFzaXMgJiYgeCh0aGlzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBiKCkgewogICAgICB0aGlzLl9faXNFbXBoYXNpcyA9ICEwLCBtKHRoaXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIFMoKSB7CiAgICAgIHRoaXMuX19pc0VtcGhhc2lzID0gITEsIHgodGhpcyk7CiAgICB9CgogICAgZnVuY3Rpb24gTSh0LCBlLCByKSB7CiAgICAgIHQuX19ob3ZlclNpbGVudE9uVG91Y2ggPSByICYmIHIuaG92ZXJTaWxlbnRPblRvdWNoLCAiZ3JvdXAiID09PSB0LnR5cGUgPyB0LnRyYXZlcnNlKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgImdyb3VwIiAhPT0gdC50eXBlICYmIHkodCwgZSk7CiAgICAgIH0pIDogeSh0LCBlKSwgdC5vbigibW91c2VvdmVyIiwgdykub24oIm1vdXNlb3V0IiwgXyksIHQub24oImVtcGhhc2lzIiwgYikub24oIm5vcm1hbCIsIFMpOwogICAgfQoKICAgIGZ1bmN0aW9uIFQodCwgZSwgciwgbiwgaSwgYSwgbykgewogICAgICBpID0gaSB8fCBtdDsKICAgICAgdmFyIHMgPSBpLmxhYmVsRmV0Y2hlciwKICAgICAgICAgIGwgPSBpLmxhYmVsRGF0YUluZGV4LAogICAgICAgICAgaCA9IGkubGFiZWxEaW1JbmRleCwKICAgICAgICAgIHUgPSByLmdldFNoYWxsb3coInNob3ciKSwKICAgICAgICAgIGMgPSBuLmdldFNoYWxsb3coInNob3ciKSwKICAgICAgICAgIGYgPSB1IHx8IGMgPyBZLnJldHJpZXZlMihzID8gcy5nZXRGb3JtYXR0ZWRMYWJlbChsLCAibm9ybWFsIiwgbnVsbCwgaCkgOiBudWxsLCBpLmRlZmF1bHRUZXh0KSA6IG51bGwsCiAgICAgICAgICBkID0gdSA/IGYgOiBudWxsLAogICAgICAgICAgdiA9IGMgPyBZLnJldHJpZXZlMihzID8gcy5nZXRGb3JtYXR0ZWRMYWJlbChsLCAiZW1waGFzaXMiLCBudWxsLCBoKSA6IG51bGwsIGYpIDogbnVsbDsKICAgICAgbnVsbCA9PSBkICYmIG51bGwgPT0gdiB8fCAoayh0LCByLCBhLCBpKSwgayhlLCBuLCBvLCBpLCAhMCkpLCB0LnRleHQgPSBkLCBlLnRleHQgPSB2OwogICAgfQoKICAgIGZ1bmN0aW9uIGsodCwgZSwgciwgbiwgaSkgewogICAgICByZXR1cm4gUCh0LCBlLCBuLCBpKSwgciAmJiBZLmV4dGVuZCh0LCByKSwgdC5ob3N0ICYmIHQuaG9zdC5kaXJ0eSAmJiB0Lmhvc3QuZGlydHkoITEpLCB0OwogICAgfQoKICAgIGZ1bmN0aW9uIEModCwgZSwgcikgewogICAgICB2YXIgbiwKICAgICAgICAgIGkgPSB7CiAgICAgICAgaXNSZWN0VGV4dDogITAKICAgICAgfTsKICAgICAgITEgPT09IHIgPyBuID0gITAgOiBpLmF1dG9Db2xvciA9IHIsIFAodCwgZSwgaSwgbiksIHQuaG9zdCAmJiB0Lmhvc3QuZGlydHkgJiYgdC5ob3N0LmRpcnR5KCExKTsKICAgIH0KCiAgICBmdW5jdGlvbiBQKHQsIGUsIHIsIG4pIHsKICAgICAgaWYgKHIgPSByIHx8IG10LCByLmlzUmVjdFRleHQpIHsKICAgICAgICB2YXIgaSA9IGUuZ2V0U2hhbGxvdygicG9zaXRpb24iKSB8fCAobiA/IG51bGwgOiAiaW5zaWRlIik7CiAgICAgICAgIm91dHNpZGUiID09PSBpICYmIChpID0gInRvcCIpLCB0LnRleHRQb3NpdGlvbiA9IGksIHQudGV4dE9mZnNldCA9IGUuZ2V0U2hhbGxvdygib2Zmc2V0Iik7CiAgICAgICAgdmFyIGEgPSBlLmdldFNoYWxsb3coInJvdGF0ZSIpOwogICAgICAgIG51bGwgIT0gYSAmJiAoYSAqPSBNYXRoLlBJIC8gMTgwKSwgdC50ZXh0Um90YXRpb24gPSBhLCB0LnRleHREaXN0YW5jZSA9IFkucmV0cmlldmUyKGUuZ2V0U2hhbGxvdygiZGlzdGFuY2UiKSwgbiA/IG51bGwgOiA1KTsKICAgICAgfQoKICAgICAgdmFyIG8sCiAgICAgICAgICBzID0gZS5lY01vZGVsLAogICAgICAgICAgbCA9IHMgJiYgcy5vcHRpb24udGV4dFN0eWxlLAogICAgICAgICAgaCA9IEkoZSk7CgogICAgICBpZiAoaCkgewogICAgICAgIG8gPSB7fTsKCiAgICAgICAgZm9yICh2YXIgdSBpbiBoKSB7CiAgICAgICAgICBpZiAoaC5oYXNPd25Qcm9wZXJ0eSh1KSkgewogICAgICAgICAgICB2YXIgYyA9IGUuZ2V0TW9kZWwoWyJyaWNoIiwgdV0pOwogICAgICAgICAgICBBKG9bdV0gPSB7fSwgYywgbCwgciwgbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdC5yaWNoID0gbywgQSh0LCBlLCBsLCByLCBuLCAhMCksIHIuZm9yY2VSaWNoICYmICFyLnRleHRTdHlsZSAmJiAoci50ZXh0U3R5bGUgPSB7fSksIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gSSh0KSB7CiAgICAgIGZvciAodmFyIGU7IHQgJiYgdCAhPT0gdC5lY01vZGVsOykgewogICAgICAgIHZhciByID0gKHQub3B0aW9uIHx8IG10KS5yaWNoOwoKICAgICAgICBpZiAocikgewogICAgICAgICAgZSA9IGUgfHwge307CgogICAgICAgICAgZm9yICh2YXIgbiBpbiByKSB7CiAgICAgICAgICAgIHIuaGFzT3duUHJvcGVydHkobikgJiYgKGVbbl0gPSAxKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHQgPSB0LnBhcmVudE1vZGVsOwogICAgICB9CgogICAgICByZXR1cm4gZTsKICAgIH0KCiAgICBmdW5jdGlvbiBBKHQsIGUsIHIsIG4sIGksIGEpIHsKICAgICAgaWYgKHIgPSAhaSAmJiByIHx8IG10LCB0LnRleHRGaWxsID0gTyhlLmdldFNoYWxsb3coImNvbG9yIiksIG4pIHx8IHIuY29sb3IsIHQudGV4dFN0cm9rZSA9IE8oZS5nZXRTaGFsbG93KCJ0ZXh0Qm9yZGVyQ29sb3IiKSwgbikgfHwgci50ZXh0Qm9yZGVyQ29sb3IsIHQudGV4dFN0cm9rZVdpZHRoID0gWS5yZXRyaWV2ZTIoZS5nZXRTaGFsbG93KCJ0ZXh0Qm9yZGVyV2lkdGgiKSwgci50ZXh0Qm9yZGVyV2lkdGgpLCAhaSkgewogICAgICAgIGlmIChhKSB7CiAgICAgICAgICB2YXIgbyA9IHQudGV4dFBvc2l0aW9uOwogICAgICAgICAgdC5pbnNpZGVSb2xsYmFjayA9IEQodCwgbywgbiksIHQuaW5zaWRlT3JpZ2luYWxUZXh0UG9zaXRpb24gPSBvLCB0Lmluc2lkZVJvbGxiYWNrT3B0ID0gbjsKICAgICAgICB9CgogICAgICAgIG51bGwgPT0gdC50ZXh0RmlsbCAmJiAodC50ZXh0RmlsbCA9IG4uYXV0b0NvbG9yKTsKICAgICAgfQoKICAgICAgdC5mb250U3R5bGUgPSBlLmdldFNoYWxsb3coImZvbnRTdHlsZSIpIHx8IHIuZm9udFN0eWxlLCB0LmZvbnRXZWlnaHQgPSBlLmdldFNoYWxsb3coImZvbnRXZWlnaHQiKSB8fCByLmZvbnRXZWlnaHQsIHQuZm9udFNpemUgPSBlLmdldFNoYWxsb3coImZvbnRTaXplIikgfHwgci5mb250U2l6ZSwgdC5mb250RmFtaWx5ID0gZS5nZXRTaGFsbG93KCJmb250RmFtaWx5IikgfHwgci5mb250RmFtaWx5LCB0LnRleHRBbGlnbiA9IGUuZ2V0U2hhbGxvdygiYWxpZ24iKSwgdC50ZXh0VmVydGljYWxBbGlnbiA9IGUuZ2V0U2hhbGxvdygidmVydGljYWxBbGlnbiIpIHx8IGUuZ2V0U2hhbGxvdygiYmFzZWxpbmUiKSwgdC50ZXh0TGluZUhlaWdodCA9IGUuZ2V0U2hhbGxvdygibGluZUhlaWdodCIpLCB0LnRleHRXaWR0aCA9IGUuZ2V0U2hhbGxvdygid2lkdGgiKSwgdC50ZXh0SGVpZ2h0ID0gZS5nZXRTaGFsbG93KCJoZWlnaHQiKSwgdC50ZXh0VGFnID0gZS5nZXRTaGFsbG93KCJ0YWciKSwgYSAmJiBuLmRpc2FibGVCb3ggfHwgKHQudGV4dEJhY2tncm91bmRDb2xvciA9IE8oZS5nZXRTaGFsbG93KCJiYWNrZ3JvdW5kQ29sb3IiKSwgbiksIHQudGV4dFBhZGRpbmcgPSBlLmdldFNoYWxsb3coInBhZGRpbmciKSwgdC50ZXh0Qm9yZGVyQ29sb3IgPSBPKGUuZ2V0U2hhbGxvdygiYm9yZGVyQ29sb3IiKSwgbiksIHQudGV4dEJvcmRlcldpZHRoID0gZS5nZXRTaGFsbG93KCJib3JkZXJXaWR0aCIpLCB0LnRleHRCb3JkZXJSYWRpdXMgPSBlLmdldFNoYWxsb3coImJvcmRlclJhZGl1cyIpLCB0LnRleHRCb3hTaGFkb3dDb2xvciA9IGUuZ2V0U2hhbGxvdygic2hhZG93Q29sb3IiKSwgdC50ZXh0Qm94U2hhZG93Qmx1ciA9IGUuZ2V0U2hhbGxvdygic2hhZG93Qmx1ciIpLCB0LnRleHRCb3hTaGFkb3dPZmZzZXRYID0gZS5nZXRTaGFsbG93KCJzaGFkb3dPZmZzZXRYIiksIHQudGV4dEJveFNoYWRvd09mZnNldFkgPSBlLmdldFNoYWxsb3coInNoYWRvd09mZnNldFkiKSksIHQudGV4dFNoYWRvd0NvbG9yID0gZS5nZXRTaGFsbG93KCJ0ZXh0U2hhZG93Q29sb3IiKSB8fCByLnRleHRTaGFkb3dDb2xvciwgdC50ZXh0U2hhZG93Qmx1ciA9IGUuZ2V0U2hhbGxvdygidGV4dFNoYWRvd0JsdXIiKSB8fCByLnRleHRTaGFkb3dCbHVyLCB0LnRleHRTaGFkb3dPZmZzZXRYID0gZS5nZXRTaGFsbG93KCJ0ZXh0U2hhZG93T2Zmc2V0WCIpIHx8IHIudGV4dFNoYWRvd09mZnNldFgsIHQudGV4dFNoYWRvd09mZnNldFkgPSBlLmdldFNoYWxsb3coInRleHRTaGFkb3dPZmZzZXRZIikgfHwgci50ZXh0U2hhZG93T2Zmc2V0WTsKICAgIH0KCiAgICBmdW5jdGlvbiBPKHQsIGUpIHsKICAgICAgcmV0dXJuICJhdXRvIiAhPT0gdCA/IHQgOiBlICYmIGUuYXV0b0NvbG9yID8gZS5hdXRvQ29sb3IgOiBudWxsOwogICAgfQoKICAgIGZ1bmN0aW9uIEQodCwgZSwgcikgewogICAgICB2YXIgbiwKICAgICAgICAgIGkgPSByLnVzZUluc2lkZVN0eWxlOwogICAgICByZXR1cm4gbnVsbCA9PSB0LnRleHRGaWxsICYmICExICE9PSBpICYmICghMCA9PT0gaSB8fCByLmlzUmVjdFRleHQgJiYgZSAmJiAic3RyaW5nIiA9PSB0eXBlb2YgZSAmJiBlLmluZGV4T2YoImluc2lkZSIpID49IDApICYmIChuID0gewogICAgICAgIHRleHRGaWxsOiBudWxsLAogICAgICAgIHRleHRTdHJva2U6IHQudGV4dFN0cm9rZSwKICAgICAgICB0ZXh0U3Ryb2tlV2lkdGg6IHQudGV4dFN0cm9rZVdpZHRoCiAgICAgIH0sIHQudGV4dEZpbGwgPSAiI2ZmZiIsIG51bGwgPT0gdC50ZXh0U3Ryb2tlICYmICh0LnRleHRTdHJva2UgPSByLmF1dG9Db2xvciwgbnVsbCA9PSB0LnRleHRTdHJva2VXaWR0aCAmJiAodC50ZXh0U3Ryb2tlV2lkdGggPSAyKSkpLCBuOwogICAgfQoKICAgIGZ1bmN0aW9uIEwodCkgewogICAgICB2YXIgZSA9IHQuaW5zaWRlUm9sbGJhY2s7CiAgICAgIGUgJiYgKHQudGV4dEZpbGwgPSBlLnRleHRGaWxsLCB0LnRleHRTdHJva2UgPSBlLnRleHRTdHJva2UsIHQudGV4dFN0cm9rZVdpZHRoID0gZS50ZXh0U3Ryb2tlV2lkdGgpOwogICAgfQoKICAgIGZ1bmN0aW9uIEYodCwgZSkgewogICAgICB2YXIgciA9IGUgfHwgZS5nZXRNb2RlbCgidGV4dFN0eWxlIik7CiAgICAgIHJldHVybiBbdC5mb250U3R5bGUgfHwgciAmJiByLmdldFNoYWxsb3coImZvbnRTdHlsZSIpIHx8ICIiLCB0LmZvbnRXZWlnaHQgfHwgciAmJiByLmdldFNoYWxsb3coImZvbnRXZWlnaHQiKSB8fCAiIiwgKHQuZm9udFNpemUgfHwgciAmJiByLmdldFNoYWxsb3coImZvbnRTaXplIikgfHwgMTIpICsgInB4IiwgdC5mb250RmFtaWx5IHx8IHIgJiYgci5nZXRTaGFsbG93KCJmb250RmFtaWx5IikgfHwgInNhbnMtc2VyaWYiXS5qb2luKCIgIik7CiAgICB9CgogICAgZnVuY3Rpb24gUih0LCBlLCByLCBuLCBpLCBhKSB7CiAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBpICYmIChhID0gaSwgaSA9IG51bGwpLCBuICYmIG4uaXNBbmltYXRpb25FbmFibGVkKCkpIHsKICAgICAgICB2YXIgbyA9IHQgPyAiVXBkYXRlIiA6ICIiLAogICAgICAgICAgICBzID0gbi5nZXRTaGFsbG93KCJhbmltYXRpb25EdXJhdGlvbiIgKyBvKSwKICAgICAgICAgICAgbCA9IG4uZ2V0U2hhbGxvdygiYW5pbWF0aW9uRWFzaW5nIiArIG8pLAogICAgICAgICAgICBoID0gbi5nZXRTaGFsbG93KCJhbmltYXRpb25EZWxheSIgKyBvKTsKICAgICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiBoICYmIChoID0gaChpLCBuLmdldEFuaW1hdGlvbkRlbGF5UGFyYW1zID8gbi5nZXRBbmltYXRpb25EZWxheVBhcmFtcyhlLCBpKSA6IG51bGwpKSwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgcyAmJiAocyA9IHMoaSkpLCBzID4gMCA/IGUuYW5pbWF0ZVRvKHIsIHMsIGggfHwgMCwgbCwgYSwgISFhKSA6IChlLnN0b3BBbmltYXRpb24oKSwgZS5hdHRyKHIpLCBhICYmIGEoKSk7CiAgICAgIH0gZWxzZSBlLnN0b3BBbmltYXRpb24oKSwgZS5hdHRyKHIpLCBhICYmIGEoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBCKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgUighMCwgdCwgZSwgciwgbiwgaSk7CiAgICB9CgogICAgZnVuY3Rpb24geih0LCBlLCByLCBuLCBpKSB7CiAgICAgIFIoITEsIHQsIGUsIHIsIG4sIGkpOwogICAgfQoKICAgIGZ1bmN0aW9uIE4odCwgZSkgewogICAgICBmb3IgKHZhciByID0gVS5pZGVudGl0eShbXSk7IHQgJiYgdCAhPT0gZTspIHsKICAgICAgICBVLm11bChyLCB0LmdldExvY2FsVHJhbnNmb3JtKCksIHIpLCB0ID0gdC5wYXJlbnQ7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQoKICAgIGZ1bmN0aW9uIEUodCwgZSwgcikgewogICAgICByZXR1cm4gZSAmJiAhWS5pc0FycmF5TGlrZShlKSAmJiAoZSA9IFEuZ2V0TG9jYWxUcmFuc2Zvcm0oZSkpLCByICYmIChlID0gVS5pbnZlcnQoW10sIGUpKSwgJC5hcHBseVRyYW5zZm9ybShbXSwgdCwgZSk7CiAgICB9CgogICAgZnVuY3Rpb24gVyh0LCBlLCByKSB7CiAgICAgIHZhciBuID0gMCA9PT0gZVs0XSB8fCAwID09PSBlWzVdIHx8IDAgPT09IGVbMF0gPyAxIDogTWF0aC5hYnMoMiAqIGVbNF0gLyBlWzBdKSwKICAgICAgICAgIGkgPSAwID09PSBlWzRdIHx8IDAgPT09IGVbNV0gfHwgMCA9PT0gZVsyXSA/IDEgOiBNYXRoLmFicygyICogZVs0XSAvIGVbMl0pLAogICAgICAgICAgYSA9IFsibGVmdCIgPT09IHQgPyAtbiA6ICJyaWdodCIgPT09IHQgPyBuIDogMCwgInRvcCIgPT09IHQgPyAtaSA6ICJib3R0b20iID09PSB0ID8gaSA6IDBdOwogICAgICByZXR1cm4gYSA9IEUoYSwgZSwgciksIE1hdGguYWJzKGFbMF0pID4gTWF0aC5hYnMoYVsxXSkgPyBhWzBdID4gMCA/ICJyaWdodCIgOiAibGVmdCIgOiBhWzFdID4gMCA/ICJib3R0b20iIDogInRvcCI7CiAgICB9CgogICAgZnVuY3Rpb24gcSh0LCBlLCByLCBuKSB7CiAgICAgIGZ1bmN0aW9uIGkodCkgewogICAgICAgIHZhciBlID0gewogICAgICAgICAgcG9zaXRpb246ICQuY2xvbmUodC5wb3NpdGlvbiksCiAgICAgICAgICByb3RhdGlvbjogdC5yb3RhdGlvbgogICAgICAgIH07CiAgICAgICAgcmV0dXJuIHQuc2hhcGUgJiYgKGUuc2hhcGUgPSBZLmV4dGVuZCh7fSwgdC5zaGFwZSkpLCBlOwogICAgICB9CgogICAgICBpZiAodCAmJiBlKSB7CiAgICAgICAgdmFyIGEgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUgPSB7fTsKICAgICAgICAgIHJldHVybiB0LnRyYXZlcnNlKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICF0LmlzR3JvdXAgJiYgdC5hbmlkICYmIChlW3QuYW5pZF0gPSB0KTsKICAgICAgICAgIH0pLCBlOwogICAgICAgIH0odCk7CgogICAgICAgIGUudHJhdmVyc2UoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGlmICghdC5pc0dyb3VwICYmIHQuYW5pZCkgewogICAgICAgICAgICB2YXIgZSA9IGFbdC5hbmlkXTsKCiAgICAgICAgICAgIGlmIChlKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBpKHQpOwogICAgICAgICAgICAgIHQuYXR0cihpKGUpKSwgQih0LCBuLCByLCB0LmRhdGFJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIEgodCwgZSkgewogICAgICByZXR1cm4gWS5tYXAodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgciA9IHRbMF07CiAgICAgICAgciA9IGd0KHIsIGUueCksIHIgPSBwdChyLCBlLnggKyBlLndpZHRoKTsKICAgICAgICB2YXIgbiA9IHRbMV07CiAgICAgICAgcmV0dXJuIG4gPSBndChuLCBlLnkpLCBuID0gcHQobiwgZS55ICsgZS5oZWlnaHQpLCBbciwgbl07CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGoodCwgZSkgewogICAgICB2YXIgciA9IGd0KHQueCwgZS54KSwKICAgICAgICAgIG4gPSBwdCh0LnggKyB0LndpZHRoLCBlLnggKyBlLndpZHRoKSwKICAgICAgICAgIGkgPSBndCh0LnksIGUueSksCiAgICAgICAgICBhID0gcHQodC55ICsgdC5oZWlnaHQsIGUueSArIGUuaGVpZ2h0KTsKICAgICAgaWYgKG4gPj0gciAmJiBhID49IGkpIHJldHVybiB7CiAgICAgICAgeDogciwKICAgICAgICB5OiBpLAogICAgICAgIHdpZHRoOiBuIC0gciwKICAgICAgICBoZWlnaHQ6IGEgLSBpCiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gWCh0LCBlLCByKSB7CiAgICAgIGUgPSBZLmV4dGVuZCh7CiAgICAgICAgcmVjdEhvdmVyOiAhMAogICAgICB9LCBlKTsKICAgICAgdmFyIG4gPSBlLnN0eWxlID0gewogICAgICAgIHN0cm9rZU5vU2NhbGU6ICEwCiAgICAgIH07CiAgICAgIGlmIChyID0gciB8fCB7CiAgICAgICAgeDogLTEsCiAgICAgICAgeTogLTEsCiAgICAgICAgd2lkdGg6IDIsCiAgICAgICAgaGVpZ2h0OiAyCiAgICAgIH0sIHQpIHJldHVybiAwID09PSB0LmluZGV4T2YoImltYWdlOi8vIikgPyAobi5pbWFnZSA9IHQuc2xpY2UoOCksIFkuZGVmYXVsdHMobiwgciksIG5ldyBLKGUpKSA6IGEodC5yZXBsYWNlKCJwYXRoOi8vIiwgIiIpLCBlLCByLCAiY2VudGVyIik7CiAgICB9CgogICAgdmFyIFkgPSByKDApLAogICAgICAgIFYgPSByKDM5KSwKICAgICAgICBHID0gcigxOCksCiAgICAgICAgVSA9IHIoOCksCiAgICAgICAgJCA9IHIoMiksCiAgICAgICAgWiA9IHIoMSksCiAgICAgICAgUSA9IHIoMTcpLAogICAgICAgIEsgPSByKDU4KTsKICAgIGUuSW1hZ2UgPSBLOwogICAgdmFyIEogPSByKDU5KTsKICAgIGUuR3JvdXAgPSBKOwogICAgdmFyIHR0ID0gcig2MCk7CiAgICBlLlRleHQgPSB0dDsKICAgIHZhciBldCA9IHIoNjEpOwogICAgZS5DaXJjbGUgPSBldDsKICAgIHZhciBydCA9IHIoNjIpOwogICAgZS5TZWN0b3IgPSBydDsKICAgIHZhciBudCA9IHIoNjQpOwogICAgZS5SaW5nID0gbnQ7CiAgICB2YXIgaXQgPSByKDY1KTsKICAgIGUuUG9seWdvbiA9IGl0OwogICAgdmFyIGF0ID0gcig2OCk7CiAgICBlLlBvbHlsaW5lID0gYXQ7CiAgICB2YXIgb3QgPSByKDY5KTsKICAgIGUuUmVjdCA9IG90OwogICAgdmFyIHN0ID0gcig3MCk7CiAgICBlLkxpbmUgPSBzdDsKICAgIHZhciBsdCA9IHIoNzEpOwogICAgZS5CZXppZXJDdXJ2ZSA9IGx0OwogICAgdmFyIGh0ID0gcig3Mik7CiAgICBlLkFyYyA9IGh0OwogICAgdmFyIHV0ID0gcig3Myk7CiAgICBlLkNvbXBvdW5kUGF0aCA9IHV0OwogICAgdmFyIGN0ID0gcig3NCk7CiAgICBlLkxpbmVhckdyYWRpZW50ID0gY3Q7CiAgICB2YXIgZnQgPSByKDc1KTsKICAgIGUuUmFkaWFsR3JhZGllbnQgPSBmdDsKICAgIHZhciBkdCA9IHIoMyk7CiAgICBlLkJvdW5kaW5nUmVjdCA9IGR0OwogICAgdmFyIHZ0ID0gTWF0aC5yb3VuZCwKICAgICAgICBndCA9IE1hdGgubWF4LAogICAgICAgIHB0ID0gTWF0aC5taW4sCiAgICAgICAgbXQgPSB7fSwKICAgICAgICB4dCA9IFYubWVyZ2VQYXRoOwogICAgZS5leHRlbmRTaGFwZSA9IG4sIGUuZXh0ZW5kUGF0aCA9IGksIGUubWFrZVBhdGggPSBhLCBlLm1ha2VJbWFnZSA9IG8sIGUubWVyZ2VQYXRoID0geHQsIGUucmVzaXplUGF0aCA9IGwsIGUuc3ViUGl4ZWxPcHRpbWl6ZUxpbmUgPSBoLCBlLnN1YlBpeGVsT3B0aW1pemVSZWN0ID0gdSwgZS5zdWJQaXhlbE9wdGltaXplID0gYywgZS5zZXRIb3ZlclN0eWxlID0gTSwgZS5zZXRMYWJlbFN0eWxlID0gVCwgZS5zZXRUZXh0U3R5bGUgPSBrLCBlLnNldFRleHQgPSBDLCBlLmdldEZvbnQgPSBGLCBlLnVwZGF0ZVByb3BzID0gQiwgZS5pbml0UHJvcHMgPSB6LCBlLmdldFRyYW5zZm9ybSA9IE4sIGUuYXBwbHlUcmFuc2Zvcm0gPSBFLCBlLnRyYW5zZm9ybURpcmVjdGlvbiA9IFcsIGUuZ3JvdXBUcmFuc2l0aW9uID0gcSwgZS5jbGlwUG9pbnRzQnlSZWN0ID0gSCwgZS5jbGlwUmVjdEJ5UmVjdCA9IGosIGUuY3JlYXRlSWNvbiA9IFg7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgciwgbiwgaSwgYSwgbywgcywgbCwgaCwgdSkgewogICAgICB2YXIgYyA9IGwgKiAocCAvIDE4MCksCiAgICAgICAgICBmID0gZyhjKSAqICh0IC0gcikgLyAyICsgdihjKSAqIChlIC0gbikgLyAyLAogICAgICAgICAgbSA9IC0xICogdihjKSAqICh0IC0gcikgLyAyICsgZyhjKSAqIChlIC0gbikgLyAyLAogICAgICAgICAgdyA9IGYgKiBmIC8gKG8gKiBvKSArIG0gKiBtIC8gKHMgKiBzKTsKICAgICAgdyA+IDEgJiYgKG8gKj0gZCh3KSwgcyAqPSBkKHcpKTsKCiAgICAgIHZhciBfID0gKGkgPT09IGEgPyAtMSA6IDEpICogZCgobyAqIG8gKiAocyAqIHMpIC0gbyAqIG8gKiAobSAqIG0pIC0gcyAqIHMgKiAoZiAqIGYpKSAvIChvICogbyAqIChtICogbSkgKyBzICogcyAqIChmICogZikpKSB8fCAwLAogICAgICAgICAgYiA9IF8gKiBvICogbSAvIHMsCiAgICAgICAgICBTID0gXyAqIC1zICogZiAvIG8sCiAgICAgICAgICBNID0gKHQgKyByKSAvIDIgKyBnKGMpICogYiAtIHYoYykgKiBTLAogICAgICAgICAgVCA9IChlICsgbikgLyAyICsgdihjKSAqIGIgKyBnKGMpICogUywKICAgICAgICAgIGsgPSB5KFsxLCAwXSwgWyhmIC0gYikgLyBvLCAobSAtIFMpIC8gc10pLAogICAgICAgICAgQyA9IFsoZiAtIGIpIC8gbywgKG0gLSBTKSAvIHNdLAogICAgICAgICAgUCA9IFsoLTEgKiBmIC0gYikgLyBvLCAoLTEgKiBtIC0gUykgLyBzXSwKICAgICAgICAgIEkgPSB5KEMsIFApOwoKICAgICAgeChDLCBQKSA8PSAtMSAmJiAoSSA9IHApLCB4KEMsIFApID49IDEgJiYgKEkgPSAwKSwgMCA9PT0gYSAmJiBJID4gMCAmJiAoSSAtPSAyICogcCksIDEgPT09IGEgJiYgSSA8IDAgJiYgKEkgKz0gMiAqIHApLCB1LmFkZERhdGEoaCwgTSwgVCwgbywgcywgaywgSSwgYywgYSk7CiAgICB9CgogICAgZnVuY3Rpb24gaSh0KSB7CiAgICAgIGlmICghdCkgcmV0dXJuIFtdOwogICAgICB2YXIgZSwKICAgICAgICAgIHIgPSB0LnJlcGxhY2UoLy0vZywgIiAtIikucmVwbGFjZSgvICAvZywgIiAiKS5yZXBsYWNlKC8gL2csICIsIikucmVwbGFjZSgvLCwvZywgIiwiKTsKCiAgICAgIGZvciAoZSA9IDA7IGUgPCBmLmxlbmd0aDsgZSsrKSB7CiAgICAgICAgciA9IHIucmVwbGFjZShuZXcgUmVnRXhwKGZbZV0sICJnIiksICJ8IiArIGZbZV0pOwogICAgICB9CgogICAgICB2YXIgaSwKICAgICAgICAgIGEgPSByLnNwbGl0KCJ8IiksCiAgICAgICAgICBvID0gMCwKICAgICAgICAgIHMgPSAwLAogICAgICAgICAgbCA9IG5ldyB1KCksCiAgICAgICAgICBoID0gdS5DTUQ7CgogICAgICBmb3IgKGUgPSAxOyBlIDwgYS5sZW5ndGg7IGUrKykgewogICAgICAgIHZhciBjLAogICAgICAgICAgICBkID0gYVtlXSwKICAgICAgICAgICAgdiA9IGQuY2hhckF0KDApLAogICAgICAgICAgICBnID0gMCwKICAgICAgICAgICAgcCA9IGQuc2xpY2UoMSkucmVwbGFjZSgvZSwtL2csICJlLSIpLnNwbGl0KCIsIik7CiAgICAgICAgcC5sZW5ndGggPiAwICYmICIiID09PSBwWzBdICYmIHAuc2hpZnQoKTsKCiAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBwLmxlbmd0aDsgbSsrKSB7CiAgICAgICAgICBwW21dID0gcGFyc2VGbG9hdChwW21dKTsKICAgICAgICB9CgogICAgICAgIGZvciAoOyBnIDwgcC5sZW5ndGggJiYgIWlzTmFOKHBbZ10pICYmICFpc05hTihwWzBdKTspIHsKICAgICAgICAgIHZhciB4LAogICAgICAgICAgICAgIHksCiAgICAgICAgICAgICAgdywKICAgICAgICAgICAgICBfLAogICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgUywKICAgICAgICAgICAgICBNLAogICAgICAgICAgICAgIFQgPSBvLAogICAgICAgICAgICAgIGsgPSBzOwoKICAgICAgICAgIHN3aXRjaCAodikgewogICAgICAgICAgICBjYXNlICJsIjoKICAgICAgICAgICAgICBvICs9IHBbZysrXSwgcyArPSBwW2crK10sIGMgPSBoLkwsIGwuYWRkRGF0YShjLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIkwiOgogICAgICAgICAgICAgIG8gPSBwW2crK10sIHMgPSBwW2crK10sIGMgPSBoLkwsIGwuYWRkRGF0YShjLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIm0iOgogICAgICAgICAgICAgIG8gKz0gcFtnKytdLCBzICs9IHBbZysrXSwgYyA9IGguTSwgbC5hZGREYXRhKGMsIG8sIHMpLCB2ID0gImwiOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiTSI6CiAgICAgICAgICAgICAgbyA9IHBbZysrXSwgcyA9IHBbZysrXSwgYyA9IGguTSwgbC5hZGREYXRhKGMsIG8sIHMpLCB2ID0gIkwiOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiaCI6CiAgICAgICAgICAgICAgbyArPSBwW2crK10sIGMgPSBoLkwsIGwuYWRkRGF0YShjLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIkgiOgogICAgICAgICAgICAgIG8gPSBwW2crK10sIGMgPSBoLkwsIGwuYWRkRGF0YShjLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInYiOgogICAgICAgICAgICAgIHMgKz0gcFtnKytdLCBjID0gaC5MLCBsLmFkZERhdGEoYywgbywgcyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJWIjoKICAgICAgICAgICAgICBzID0gcFtnKytdLCBjID0gaC5MLCBsLmFkZERhdGEoYywgbywgcyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJDIjoKICAgICAgICAgICAgICBjID0gaC5DLCBsLmFkZERhdGEoYywgcFtnKytdLCBwW2crK10sIHBbZysrXSwgcFtnKytdLCBwW2crK10sIHBbZysrXSksIG8gPSBwW2cgLSAyXSwgcyA9IHBbZyAtIDFdOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiYyI6CiAgICAgICAgICAgICAgYyA9IGguQywgbC5hZGREYXRhKGMsIHBbZysrXSArIG8sIHBbZysrXSArIHMsIHBbZysrXSArIG8sIHBbZysrXSArIHMsIHBbZysrXSArIG8sIHBbZysrXSArIHMpLCBvICs9IHBbZyAtIDJdLCBzICs9IHBbZyAtIDFdOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiUyI6CiAgICAgICAgICAgICAgeCA9IG8sIHkgPSBzOwogICAgICAgICAgICAgIHZhciBDID0gbC5sZW4oKSwKICAgICAgICAgICAgICAgICAgUCA9IGwuZGF0YTsKICAgICAgICAgICAgICBpID09PSBoLkMgJiYgKHggKz0gbyAtIFBbQyAtIDRdLCB5ICs9IHMgLSBQW0MgLSAzXSksIGMgPSBoLkMsIFQgPSBwW2crK10sIGsgPSBwW2crK10sIG8gPSBwW2crK10sIHMgPSBwW2crK10sIGwuYWRkRGF0YShjLCB4LCB5LCBULCBrLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInMiOgogICAgICAgICAgICAgIHggPSBvLCB5ID0gczsKICAgICAgICAgICAgICB2YXIgQyA9IGwubGVuKCksCiAgICAgICAgICAgICAgICAgIFAgPSBsLmRhdGE7CiAgICAgICAgICAgICAgaSA9PT0gaC5DICYmICh4ICs9IG8gLSBQW0MgLSA0XSwgeSArPSBzIC0gUFtDIC0gM10pLCBjID0gaC5DLCBUID0gbyArIHBbZysrXSwgayA9IHMgKyBwW2crK10sIG8gKz0gcFtnKytdLCBzICs9IHBbZysrXSwgbC5hZGREYXRhKGMsIHgsIHksIFQsIGssIG8sIHMpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiUSI6CiAgICAgICAgICAgICAgVCA9IHBbZysrXSwgayA9IHBbZysrXSwgbyA9IHBbZysrXSwgcyA9IHBbZysrXSwgYyA9IGguUSwgbC5hZGREYXRhKGMsIFQsIGssIG8sIHMpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAicSI6CiAgICAgICAgICAgICAgVCA9IHBbZysrXSArIG8sIGsgPSBwW2crK10gKyBzLCBvICs9IHBbZysrXSwgcyArPSBwW2crK10sIGMgPSBoLlEsIGwuYWRkRGF0YShjLCBULCBrLCBvLCBzKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIlQiOgogICAgICAgICAgICAgIHggPSBvLCB5ID0gczsKICAgICAgICAgICAgICB2YXIgQyA9IGwubGVuKCksCiAgICAgICAgICAgICAgICAgIFAgPSBsLmRhdGE7CiAgICAgICAgICAgICAgaSA9PT0gaC5RICYmICh4ICs9IG8gLSBQW0MgLSA0XSwgeSArPSBzIC0gUFtDIC0gM10pLCBvID0gcFtnKytdLCBzID0gcFtnKytdLCBjID0gaC5RLCBsLmFkZERhdGEoYywgeCwgeSwgbywgcyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJ0IjoKICAgICAgICAgICAgICB4ID0gbywgeSA9IHM7CiAgICAgICAgICAgICAgdmFyIEMgPSBsLmxlbigpLAogICAgICAgICAgICAgICAgICBQID0gbC5kYXRhOwogICAgICAgICAgICAgIGkgPT09IGguUSAmJiAoeCArPSBvIC0gUFtDIC0gNF0sIHkgKz0gcyAtIFBbQyAtIDNdKSwgbyArPSBwW2crK10sIHMgKz0gcFtnKytdLCBjID0gaC5RLCBsLmFkZERhdGEoYywgeCwgeSwgbywgcyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJBIjoKICAgICAgICAgICAgICB3ID0gcFtnKytdLCBfID0gcFtnKytdLCBiID0gcFtnKytdLCBTID0gcFtnKytdLCBNID0gcFtnKytdLCBUID0gbywgayA9IHMsIG8gPSBwW2crK10sIHMgPSBwW2crK10sIGMgPSBoLkEsIG4oVCwgaywgbywgcywgUywgTSwgdywgXywgYiwgYywgbCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJhIjoKICAgICAgICAgICAgICB3ID0gcFtnKytdLCBfID0gcFtnKytdLCBiID0gcFtnKytdLCBTID0gcFtnKytdLCBNID0gcFtnKytdLCBUID0gbywgayA9IHMsIG8gKz0gcFtnKytdLCBzICs9IHBbZysrXSwgYyA9IGguQSwgbihULCBrLCBvLCBzLCBTLCBNLCB3LCBfLCBiLCBjLCBsKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICJ6IiAhPT0gdiAmJiAiWiIgIT09IHYgfHwgKGMgPSBoLlosIGwuYWRkRGF0YShjKSksIGkgPSBjOwogICAgICB9CgogICAgICByZXR1cm4gbC50b1N0YXRpYygpLCBsOwogICAgfQoKICAgIGZ1bmN0aW9uIGEodCwgZSkgewogICAgICB2YXIgciA9IGkodCk7CiAgICAgIHJldHVybiBlID0gZSB8fCB7fSwgZS5idWlsZFBhdGggPSBmdW5jdGlvbiAodCkgewogICAgICAgIGlmICh0LnNldERhdGEpIHsKICAgICAgICAgIHQuc2V0RGF0YShyLmRhdGEpOwogICAgICAgICAgdmFyIGUgPSB0LmdldENvbnRleHQoKTsKICAgICAgICAgIGUgJiYgdC5yZWJ1aWxkUGF0aChlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGUgPSB0OwogICAgICAgICAgci5yZWJ1aWxkUGF0aChlKTsKICAgICAgICB9CiAgICAgIH0sIGUuYXBwbHlUcmFuc2Zvcm0gPSBmdW5jdGlvbiAodCkgewogICAgICAgIGMociwgdCksIHRoaXMuZGlydHkoITApOwogICAgICB9LCBlOwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCwgZSkgewogICAgICByZXR1cm4gbmV3IGgoYSh0LCBlKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcyh0LCBlKSB7CiAgICAgIHJldHVybiBoLmV4dGVuZChhKHQsIGUpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQsIGUpIHsKICAgICAgZm9yICh2YXIgciA9IFtdLCBuID0gdC5sZW5ndGgsIGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgdmFyIGEgPSB0W2ldOwogICAgICAgIGEucGF0aCB8fCBhLmNyZWF0ZVBhdGhQcm94eSgpLCBhLl9fZGlydHlQYXRoICYmIGEuYnVpbGRQYXRoKGEucGF0aCwgYS5zaGFwZSwgITApLCByLnB1c2goYS5wYXRoKTsKICAgICAgfQoKICAgICAgdmFyIG8gPSBuZXcgaChlKTsKICAgICAgcmV0dXJuIG8uY3JlYXRlUGF0aFByb3h5KCksIG8uYnVpbGRQYXRoID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LmFwcGVuZFBhdGgocik7CiAgICAgICAgdmFyIGUgPSB0LmdldENvbnRleHQoKTsKICAgICAgICBlICYmIHQucmVidWlsZFBhdGgoZSk7CiAgICAgIH0sIG87CiAgICB9CgogICAgdmFyIGggPSByKDEpLAogICAgICAgIHUgPSByKDYpLAogICAgICAgIGMgPSByKDU3KSwKICAgICAgICBmID0gWyJtIiwgIk0iLCAibCIsICJMIiwgInYiLCAiViIsICJoIiwgIkgiLCAieiIsICJaIiwgImMiLCAiQyIsICJxIiwgIlEiLCAidCIsICJUIiwgInMiLCAiUyIsICJhIiwgIkEiXSwKICAgICAgICBkID0gTWF0aC5zcXJ0LAogICAgICAgIHYgPSBNYXRoLnNpbiwKICAgICAgICBnID0gTWF0aC5jb3MsCiAgICAgICAgcCA9IE1hdGguUEksCiAgICAgICAgbSA9IGZ1bmN0aW9uIG0odCkgewogICAgICByZXR1cm4gTWF0aC5zcXJ0KHRbMF0gKiB0WzBdICsgdFsxXSAqIHRbMV0pOwogICAgfSwKICAgICAgICB4ID0gZnVuY3Rpb24geCh0LCBlKSB7CiAgICAgIHJldHVybiAodFswXSAqIGVbMF0gKyB0WzFdICogZVsxXSkgLyAobSh0KSAqIG0oZSkpOwogICAgfSwKICAgICAgICB5ID0gZnVuY3Rpb24geSh0LCBlKSB7CiAgICAgIHJldHVybiAodFswXSAqIGVbMV0gPCB0WzFdICogZVswXSA/IC0xIDogMSkgKiBNYXRoLmFjb3MoeCh0LCBlKSk7CiAgICB9OwoKICAgIGUuY3JlYXRlRnJvbVN0cmluZyA9IG8sIGUuZXh0ZW5kRnJvbVN0cmluZyA9IHMsIGUubWVyZ2VQYXRoID0gbDsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgZnVuY3Rpb24gcih0LCBlLCByKSB7CiAgICAgIHZhciBuID0gbnVsbCA9PSBlLnggPyAwIDogZS54LAogICAgICAgICAgaSA9IG51bGwgPT0gZS54MiA/IDEgOiBlLngyLAogICAgICAgICAgYSA9IG51bGwgPT0gZS55ID8gMCA6IGUueSwKICAgICAgICAgIG8gPSBudWxsID09IGUueTIgPyAwIDogZS55MjsKICAgICAgcmV0dXJuIGUuZ2xvYmFsIHx8IChuID0gbiAqIHIud2lkdGggKyByLngsIGkgPSBpICogci53aWR0aCArIHIueCwgYSA9IGEgKiByLmhlaWdodCArIHIueSwgbyA9IG8gKiByLmhlaWdodCArIHIueSksIHQuY3JlYXRlTGluZWFyR3JhZGllbnQobiwgYSwgaSwgbyk7CiAgICB9CgogICAgZnVuY3Rpb24gbih0LCBlLCByKSB7CiAgICAgIHZhciBuID0gci53aWR0aCwKICAgICAgICAgIGkgPSByLmhlaWdodCwKICAgICAgICAgIGEgPSBNYXRoLm1pbihuLCBpKSwKICAgICAgICAgIG8gPSBudWxsID09IGUueCA/IC41IDogZS54LAogICAgICAgICAgcyA9IG51bGwgPT0gZS55ID8gLjUgOiBlLnksCiAgICAgICAgICBsID0gbnVsbCA9PSBlLnIgPyAuNSA6IGUucjsKICAgICAgcmV0dXJuIGUuZ2xvYmFsIHx8IChvID0gbyAqIG4gKyByLngsIHMgPSBzICogaSArIHIueSwgbCAqPSBhKSwgdC5jcmVhdGVSYWRpYWxHcmFkaWVudChvLCBzLCAwLCBvLCBzLCBsKTsKICAgIH0KCiAgICB2YXIgaSA9IFtbInNoYWRvd0JsdXIiLCAwXSwgWyJzaGFkb3dPZmZzZXRYIiwgMF0sIFsic2hhZG93T2Zmc2V0WSIsIDBdLCBbInNoYWRvd0NvbG9yIiwgIiMwMDAiXSwgWyJsaW5lQ2FwIiwgImJ1dHQiXSwgWyJsaW5lSm9pbiIsICJtaXRlciJdLCBbIm1pdGVyTGltaXQiLCAxMF1dLAogICAgICAgIGEgPSBmdW5jdGlvbiBhKHQsIGUpIHsKICAgICAgdGhpcy5leHRlbmRGcm9tKHQsICExKSwgdGhpcy5ob3N0ID0gZTsKICAgIH07CgogICAgYS5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBhLAogICAgICBob3N0OiBudWxsLAogICAgICBmaWxsOiAiIzAwMCIsCiAgICAgIHN0cm9rZTogbnVsbCwKICAgICAgb3BhY2l0eTogMSwKICAgICAgbGluZURhc2g6IG51bGwsCiAgICAgIGxpbmVEYXNoT2Zmc2V0OiAwLAogICAgICBzaGFkb3dCbHVyOiAwLAogICAgICBzaGFkb3dPZmZzZXRYOiAwLAogICAgICBzaGFkb3dPZmZzZXRZOiAwLAogICAgICBsaW5lV2lkdGg6IDEsCiAgICAgIHN0cm9rZU5vU2NhbGU6ICExLAogICAgICB0ZXh0OiBudWxsLAogICAgICBmb250OiBudWxsLAogICAgICB0ZXh0Rm9udDogbnVsbCwKICAgICAgZm9udFN0eWxlOiBudWxsLAogICAgICBmb250V2VpZ2h0OiBudWxsLAogICAgICBmb250U2l6ZTogbnVsbCwKICAgICAgZm9udEZhbWlseTogbnVsbCwKICAgICAgdGV4dFRhZzogbnVsbCwKICAgICAgdGV4dEZpbGw6ICIjMDAwIiwKICAgICAgdGV4dFN0cm9rZTogbnVsbCwKICAgICAgdGV4dFdpZHRoOiBudWxsLAogICAgICB0ZXh0SGVpZ2h0OiBudWxsLAogICAgICB0ZXh0U3Ryb2tlV2lkdGg6IDAsCiAgICAgIHRleHRMaW5lSGVpZ2h0OiBudWxsLAogICAgICB0ZXh0UG9zaXRpb246ICJpbnNpZGUiLAogICAgICB0ZXh0UmVjdDogbnVsbCwKICAgICAgdGV4dE9mZnNldDogbnVsbCwKICAgICAgdGV4dEFsaWduOiBudWxsLAogICAgICB0ZXh0VmVydGljYWxBbGlnbjogbnVsbCwKICAgICAgdGV4dERpc3RhbmNlOiA1LAogICAgICB0ZXh0U2hhZG93Q29sb3I6ICJ0cmFuc3BhcmVudCIsCiAgICAgIHRleHRTaGFkb3dCbHVyOiAwLAogICAgICB0ZXh0U2hhZG93T2Zmc2V0WDogMCwKICAgICAgdGV4dFNoYWRvd09mZnNldFk6IDAsCiAgICAgIHRleHRCb3hTaGFkb3dDb2xvcjogInRyYW5zcGFyZW50IiwKICAgICAgdGV4dEJveFNoYWRvd0JsdXI6IDAsCiAgICAgIHRleHRCb3hTaGFkb3dPZmZzZXRYOiAwLAogICAgICB0ZXh0Qm94U2hhZG93T2Zmc2V0WTogMCwKICAgICAgdHJhbnNmb3JtVGV4dDogITEsCiAgICAgIHRleHRSb3RhdGlvbjogMCwKICAgICAgdGV4dE9yaWdpbjogbnVsbCwKICAgICAgdGV4dEJhY2tncm91bmRDb2xvcjogbnVsbCwKICAgICAgdGV4dEJvcmRlckNvbG9yOiBudWxsLAogICAgICB0ZXh0Qm9yZGVyV2lkdGg6IDAsCiAgICAgIHRleHRCb3JkZXJSYWRpdXM6IDAsCiAgICAgIHRleHRQYWRkaW5nOiBudWxsLAogICAgICByaWNoOiBudWxsLAogICAgICB0cnVuY2F0ZTogbnVsbCwKICAgICAgYmxlbmQ6IG51bGwsCiAgICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQodCwgZSwgcikgewogICAgICAgIGZvciAodmFyIG4gPSB0aGlzLCBhID0gciAmJiByLnN0eWxlLCBvID0gIWEsIHMgPSAwOyBzIDwgaS5sZW5ndGg7IHMrKykgewogICAgICAgICAgdmFyIGwgPSBpW3NdLAogICAgICAgICAgICAgIGggPSBsWzBdOwogICAgICAgICAgKG8gfHwgbltoXSAhPT0gYVtoXSkgJiYgKHRbaF0gPSBuW2hdIHx8IGxbMV0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKChvIHx8IG4uZmlsbCAhPT0gYS5maWxsKSAmJiAodC5maWxsU3R5bGUgPSBuLmZpbGwpLCAobyB8fCBuLnN0cm9rZSAhPT0gYS5zdHJva2UpICYmICh0LnN0cm9rZVN0eWxlID0gbi5zdHJva2UpLCAobyB8fCBuLm9wYWNpdHkgIT09IGEub3BhY2l0eSkgJiYgKHQuZ2xvYmFsQWxwaGEgPSBudWxsID09IG4ub3BhY2l0eSA/IDEgOiBuLm9wYWNpdHkpLCAobyB8fCBuLmJsZW5kICE9PSBhLmJsZW5kKSAmJiAodC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBuLmJsZW5kIHx8ICJzb3VyY2Utb3ZlciIpLCB0aGlzLmhhc1N0cm9rZSgpKSB7CiAgICAgICAgICB2YXIgdSA9IG4ubGluZVdpZHRoOwogICAgICAgICAgdC5saW5lV2lkdGggPSB1IC8gKHRoaXMuc3Ryb2tlTm9TY2FsZSAmJiBlICYmIGUuZ2V0TGluZVNjYWxlID8gZS5nZXRMaW5lU2NhbGUoKSA6IDEpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaGFzRmlsbDogZnVuY3Rpb24gaGFzRmlsbCgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuZmlsbDsKICAgICAgICByZXR1cm4gbnVsbCAhPSB0ICYmICJub25lIiAhPT0gdDsKICAgICAgfSwKICAgICAgaGFzU3Ryb2tlOiBmdW5jdGlvbiBoYXNTdHJva2UoKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLnN0cm9rZTsKICAgICAgICByZXR1cm4gbnVsbCAhPSB0ICYmICJub25lIiAhPT0gdCAmJiB0aGlzLmxpbmVXaWR0aCA+IDA7CiAgICAgIH0sCiAgICAgIGV4dGVuZEZyb206IGZ1bmN0aW9uIGV4dGVuZEZyb20odCwgZSkgewogICAgICAgIGlmICh0KSBmb3IgKHZhciByIGluIHQpIHsKICAgICAgICAgICF0Lmhhc093blByb3BlcnR5KHIpIHx8ICEwICE9PSBlICYmICghMSA9PT0gZSA/IHRoaXMuaGFzT3duUHJvcGVydHkocikgOiBudWxsID09IHRbcl0pIHx8ICh0aGlzW3JdID0gdFtyXSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh0LCBlKSB7CiAgICAgICAgInN0cmluZyIgPT0gdHlwZW9mIHQgPyB0aGlzW3RdID0gZSA6IHRoaXMuZXh0ZW5kRnJvbSh0LCAhMCk7CiAgICAgIH0sCiAgICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZSgpIHsKICAgICAgICB2YXIgdCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKCk7CiAgICAgICAgcmV0dXJuIHQuZXh0ZW5kRnJvbSh0aGlzLCAhMCksIHQ7CiAgICAgIH0sCiAgICAgIGdldEdyYWRpZW50OiBmdW5jdGlvbiBnZXRHcmFkaWVudCh0LCBlLCBpKSB7CiAgICAgICAgZm9yICh2YXIgYSA9ICJyYWRpYWwiID09PSBlLnR5cGUgPyBuIDogciwgbyA9IGEodCwgZSwgaSksIHMgPSBlLmNvbG9yU3RvcHMsIGwgPSAwOyBsIDwgcy5sZW5ndGg7IGwrKykgewogICAgICAgICAgby5hZGRDb2xvclN0b3Aoc1tsXS5vZmZzZXQsIHNbbF0uY29sb3IpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG87CiAgICAgIH0KICAgIH07CgogICAgZm9yICh2YXIgbyA9IGEucHJvdG90eXBlLCBzID0gMDsgcyA8IGkubGVuZ3RoOyBzKyspIHsKICAgICAgdmFyIGwgPSBpW3NdOwogICAgICBsWzBdIGluIG8gfHwgKG9bbFswXV0gPSBsWzFdKTsKICAgIH0KCiAgICBhLmdldEdyYWRpZW50ID0gby5nZXRHcmFkaWVudDsKICAgIHZhciBoID0gYTsKICAgIHQuZXhwb3J0cyA9IGg7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIGZ1bmN0aW9uIHIoKSB7CiAgICAgIHJldHVybiBuKys7CiAgICB9CgogICAgdmFyIG4gPSAyMzExOwogICAgdC5leHBvcnRzID0gcjsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsCiAgICAgICAgbiA9IGZ1bmN0aW9uIG4oKSB7CiAgICAgIHRoaXMuXyRoYW5kbGVycyA9IHt9OwogICAgfTsKCiAgICBuLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IG4sCiAgICAgIG9uZTogZnVuY3Rpb24gb25lKHQsIGUsIHIpIHsKICAgICAgICB2YXIgbiA9IHRoaXMuXyRoYW5kbGVyczsKICAgICAgICBpZiAoIWUgfHwgIXQpIHJldHVybiB0aGlzOwogICAgICAgIG5bdF0gfHwgKG5bdF0gPSBbXSk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgblt0XS5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKG5bdF1baV0uaCA9PT0gZSkgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gblt0XS5wdXNoKHsKICAgICAgICAgIGg6IGUsCiAgICAgICAgICBvbmU6ICEwLAogICAgICAgICAgY3R4OiByIHx8IHRoaXMKICAgICAgICB9KSwgdGhpczsKICAgICAgfSwKICAgICAgb246IGZ1bmN0aW9uIG9uKHQsIGUsIHIpIHsKICAgICAgICB2YXIgbiA9IHRoaXMuXyRoYW5kbGVyczsKICAgICAgICBpZiAoIWUgfHwgIXQpIHJldHVybiB0aGlzOwogICAgICAgIG5bdF0gfHwgKG5bdF0gPSBbXSk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgblt0XS5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKG5bdF1baV0uaCA9PT0gZSkgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gblt0XS5wdXNoKHsKICAgICAgICAgIGg6IGUsCiAgICAgICAgICBvbmU6ICExLAogICAgICAgICAgY3R4OiByIHx8IHRoaXMKICAgICAgICB9KSwgdGhpczsKICAgICAgfSwKICAgICAgaXNTaWxlbnQ6IGZ1bmN0aW9uIGlzU2lsZW50KHQpIHsKICAgICAgICB2YXIgZSA9IHRoaXMuXyRoYW5kbGVyczsKICAgICAgICByZXR1cm4gZVt0XSAmJiBlW3RdLmxlbmd0aDsKICAgICAgfSwKICAgICAgb2ZmOiBmdW5jdGlvbiBvZmYodCwgZSkgewogICAgICAgIHZhciByID0gdGhpcy5fJGhhbmRsZXJzOwogICAgICAgIGlmICghdCkgcmV0dXJuIHRoaXMuXyRoYW5kbGVycyA9IHt9LCB0aGlzOwoKICAgICAgICBpZiAoZSkgewogICAgICAgICAgaWYgKHJbdF0pIHsKICAgICAgICAgICAgZm9yICh2YXIgbiA9IFtdLCBpID0gMCwgYSA9IHJbdF0ubGVuZ3RoOyBpIDwgYTsgaSsrKSB7CiAgICAgICAgICAgICAgclt0XVtpXS5oICE9IGUgJiYgbi5wdXNoKHJbdF1baV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByW3RdID0gbjsKICAgICAgICAgIH0KCiAgICAgICAgICByW3RdICYmIDAgPT09IHJbdF0ubGVuZ3RoICYmIGRlbGV0ZSByW3RdOwogICAgICAgIH0gZWxzZSBkZWxldGUgclt0XTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uIHRyaWdnZXIodCkgewogICAgICAgIGlmICh0aGlzLl8kaGFuZGxlcnNbdF0pIHsKICAgICAgICAgIHZhciBlID0gYXJndW1lbnRzLAogICAgICAgICAgICAgIG4gPSBlLmxlbmd0aDsKICAgICAgICAgIG4gPiAzICYmIChlID0gci5jYWxsKGUsIDEpKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fJGhhbmRsZXJzW3RdLCBhID0gaS5sZW5ndGgsIG8gPSAwOyBvIDwgYTspIHsKICAgICAgICAgICAgc3dpdGNoIChuKSB7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgaVtvXS5oLmNhbGwoaVtvXS5jdHgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGlbb10uaC5jYWxsKGlbb10uY3R4LCBlWzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpW29dLmguY2FsbChpW29dLmN0eCwgZVsxXSwgZVsyXSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlbb10uaC5hcHBseShpW29dLmN0eCwgZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlbb10ub25lID8gKGkuc3BsaWNlKG8sIDEpLCBhLS0pIDogbysrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIHRyaWdnZXJXaXRoQ29udGV4dDogZnVuY3Rpb24gdHJpZ2dlcldpdGhDb250ZXh0KHQpIHsKICAgICAgICBpZiAodGhpcy5fJGhhbmRsZXJzW3RdKSB7CiAgICAgICAgICB2YXIgZSA9IGFyZ3VtZW50cywKICAgICAgICAgICAgICBuID0gZS5sZW5ndGg7CiAgICAgICAgICBuID4gNCAmJiAoZSA9IHIuY2FsbChlLCAxLCBlLmxlbmd0aCAtIDEpKTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gZVtlLmxlbmd0aCAtIDFdLCBhID0gdGhpcy5fJGhhbmRsZXJzW3RdLCBvID0gYS5sZW5ndGgsIHMgPSAwOyBzIDwgbzspIHsKICAgICAgICAgICAgc3dpdGNoIChuKSB7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgYVtzXS5oLmNhbGwoaSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgYVtzXS5oLmNhbGwoaSwgZVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgYVtzXS5oLmNhbGwoaSwgZVsxXSwgZVsyXSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGFbc10uaC5hcHBseShpLCBlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYVtzXS5vbmUgPyAoYS5zcGxpY2UocywgMSksIG8tLSkgOiBzKys7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIHZhciBpID0gbjsKICAgIHQuZXhwb3J0cyA9IGk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcig0NCksCiAgICAgICAgaSA9IHIoNDcpLAogICAgICAgIGEgPSByKDApLAogICAgICAgIG8gPSBhLmlzU3RyaW5nLAogICAgICAgIHMgPSBhLmlzRnVuY3Rpb24sCiAgICAgICAgbCA9IGEuaXNPYmplY3QsCiAgICAgICAgaCA9IGEuaXNBcnJheUxpa2UsCiAgICAgICAgdSA9IGEuaW5kZXhPZiwKICAgICAgICBjID0gZnVuY3Rpb24gYygpIHsKICAgICAgdGhpcy5hbmltYXRvcnMgPSBbXTsKICAgIH07CgogICAgYy5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBjLAogICAgICBhbmltYXRlOiBmdW5jdGlvbiBhbmltYXRlKHQsIGUpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgYSA9ICExLAogICAgICAgICAgICBvID0gdGhpcywKICAgICAgICAgICAgcyA9IHRoaXMuX196cjsKCiAgICAgICAgaWYgKHQpIHsKICAgICAgICAgIHZhciBsID0gdC5zcGxpdCgiLiIpLAogICAgICAgICAgICAgIGggPSBvOwogICAgICAgICAgYSA9ICJzaGFwZSIgPT09IGxbMF07CgogICAgICAgICAgZm9yICh2YXIgYyA9IDAsIGYgPSBsLmxlbmd0aDsgYyA8IGY7IGMrKykgewogICAgICAgICAgICBoICYmIChoID0gaFtsW2NdXSk7CiAgICAgICAgICB9CgogICAgICAgICAgaCAmJiAociA9IGgpOwogICAgICAgIH0gZWxzZSByID0gbzsKCiAgICAgICAgaWYgKCFyKSByZXR1cm4gdm9pZCBpKCdQcm9wZXJ0eSAiJyArIHQgKyAnIiBpcyBub3QgZXhpc3RlZCBpbiBlbGVtZW50ICcgKyBvLmlkKTsKICAgICAgICB2YXIgZCA9IG8uYW5pbWF0b3JzLAogICAgICAgICAgICB2ID0gbmV3IG4ociwgZSk7CiAgICAgICAgcmV0dXJuIHYuZHVyaW5nKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBvLmRpcnR5KGEpOwogICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKCkgewogICAgICAgICAgZC5zcGxpY2UodShkLCB2KSwgMSk7CiAgICAgICAgfSksIGQucHVzaCh2KSwgcyAmJiBzLmFuaW1hdGlvbi5hZGRBbmltYXRvcih2KSwgdjsKICAgICAgfSwKICAgICAgc3RvcEFuaW1hdGlvbjogZnVuY3Rpb24gc3RvcEFuaW1hdGlvbih0KSB7CiAgICAgICAgZm9yICh2YXIgZSA9IHRoaXMuYW5pbWF0b3JzLCByID0gZS5sZW5ndGgsIG4gPSAwOyBuIDwgcjsgbisrKSB7CiAgICAgICAgICBlW25dLnN0b3AodCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZS5sZW5ndGggPSAwLCB0aGlzOwogICAgICB9LAogICAgICBhbmltYXRlVG86IGZ1bmN0aW9uIGFuaW1hdGVUbyh0LCBlLCByLCBuLCBpLCBhKSB7CiAgICAgICAgZnVuY3Rpb24gbCgpIHsKICAgICAgICAgIC0tdSB8fCBpICYmIGkoKTsKICAgICAgICB9CgogICAgICAgIG8ocikgPyAoaSA9IG4sIG4gPSByLCByID0gMCkgOiBzKG4pID8gKGkgPSBuLCBuID0gImxpbmVhciIsIHIgPSAwKSA6IHMocikgPyAoaSA9IHIsIHIgPSAwKSA6IHMoZSkgPyAoaSA9IGUsIGUgPSA1MDApIDogZSB8fCAoZSA9IDUwMCksIHRoaXMuc3RvcEFuaW1hdGlvbigpLCB0aGlzLl9hbmltYXRlVG9TaGFsbG93KCIiLCB0aGlzLCB0LCBlLCByKTsKICAgICAgICB2YXIgaCA9IHRoaXMuYW5pbWF0b3JzLnNsaWNlKCksCiAgICAgICAgICAgIHUgPSBoLmxlbmd0aDsKICAgICAgICB1IHx8IGkgJiYgaSgpOwoKICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IGgubGVuZ3RoOyBjKyspIHsKICAgICAgICAgIGhbY10uZG9uZShsKS5zdGFydChuLCBhKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIF9hbmltYXRlVG9TaGFsbG93OiBmdW5jdGlvbiBfYW5pbWF0ZVRvU2hhbGxvdyh0LCBlLCByLCBuLCBpKSB7CiAgICAgICAgdmFyIGEgPSB7fSwKICAgICAgICAgICAgbyA9IDA7CgogICAgICAgIGZvciAodmFyIHMgaW4gcikgewogICAgICAgICAgaWYgKHIuaGFzT3duUHJvcGVydHkocykpIGlmIChudWxsICE9IGVbc10pIGwocltzXSkgJiYgIWgocltzXSkgPyB0aGlzLl9hbmltYXRlVG9TaGFsbG93KHQgPyB0ICsgIi4iICsgcyA6IHMsIGVbc10sIHJbc10sIG4sIGkpIDogKGFbc10gPSByW3NdLCBvKyspO2Vsc2UgaWYgKG51bGwgIT0gcltzXSkgaWYgKHQpIHsKICAgICAgICAgICAgdmFyIHUgPSB7fTsKICAgICAgICAgICAgdVt0XSA9IHt9LCB1W3RdW3NdID0gcltzXSwgdGhpcy5hdHRyKHUpOwogICAgICAgICAgfSBlbHNlIHRoaXMuYXR0cihzLCByW3NdKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvID4gMCAmJiB0aGlzLmFuaW1hdGUodCwgITEpLndoZW4obnVsbCA9PSBuID8gNTAwIDogbiwgYSkuZGVsYXkoaSB8fCAwKSwgdGhpczsKICAgICAgfQogICAgfTsKICAgIHZhciBmID0gYzsKICAgIHQuZXhwb3J0cyA9IGY7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSkgewogICAgICByZXR1cm4gdFtlXTsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQsIGUsIHIpIHsKICAgICAgdFtlXSA9IHI7CiAgICB9CgogICAgZnVuY3Rpb24gYSh0LCBlLCByKSB7CiAgICAgIHJldHVybiAoZSAtIHQpICogciArIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gbyh0LCBlLCByKSB7CiAgICAgIHJldHVybiByID4gLjUgPyBlIDogdDsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgdmFyIG8gPSB0Lmxlbmd0aDsKICAgICAgaWYgKDEgPT0gaSkgZm9yICh2YXIgcyA9IDA7IHMgPCBvOyBzKyspIHsKICAgICAgICBuW3NdID0gYSh0W3NdLCBlW3NdLCByKTsKICAgICAgfSBlbHNlIGZvciAodmFyIGwgPSBvICYmIHRbMF0ubGVuZ3RoLCBzID0gMDsgcyA8IG87IHMrKykgewogICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgbDsgaCsrKSB7CiAgICAgICAgICBuW3NdW2hdID0gYSh0W3NdW2hdLCBlW3NdW2hdLCByKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBsKHQsIGUsIHIpIHsKICAgICAgdmFyIG4gPSB0Lmxlbmd0aCwKICAgICAgICAgIGkgPSBlLmxlbmd0aDsKCiAgICAgIGlmIChuICE9PSBpKSB7CiAgICAgICAgaWYgKG4gPiBpKSB0Lmxlbmd0aCA9IGk7ZWxzZSBmb3IgKHZhciBhID0gbjsgYSA8IGk7IGErKykgewogICAgICAgICAgdC5wdXNoKDEgPT09IHIgPyBlW2FdIDogdy5jYWxsKGVbYV0pKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAodmFyIG8gPSB0WzBdICYmIHRbMF0ubGVuZ3RoLCBhID0gMDsgYSA8IHQubGVuZ3RoOyBhKyspIHsKICAgICAgICBpZiAoMSA9PT0gcikgaXNOYU4odFthXSkgJiYgKHRbYV0gPSBlW2FdKTtlbHNlIGZvciAodmFyIHMgPSAwOyBzIDwgbzsgcysrKSB7CiAgICAgICAgICBpc05hTih0W2FdW3NdKSAmJiAodFthXVtzXSA9IGVbYV1bc10pOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGgodCwgZSwgcikgewogICAgICBpZiAodCA9PT0gZSkgcmV0dXJuICEwOwogICAgICB2YXIgbiA9IHQubGVuZ3RoOwogICAgICBpZiAobiAhPT0gZS5sZW5ndGgpIHJldHVybiAhMTsKCiAgICAgIGlmICgxID09PSByKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGlmICh0W2ldICE9PSBlW2ldKSByZXR1cm4gITE7CiAgICAgICAgfQogICAgICB9IGVsc2UgZm9yICh2YXIgYSA9IHRbMF0ubGVuZ3RoLCBpID0gMDsgaSA8IG47IGkrKykgewogICAgICAgIGZvciAodmFyIG8gPSAwOyBvIDwgYTsgbysrKSB7CiAgICAgICAgICBpZiAodFtpXVtvXSAhPT0gZVtpXVtvXSkgcmV0dXJuICExOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuICEwOwogICAgfQoKICAgIGZ1bmN0aW9uIHUodCwgZSwgciwgbiwgaSwgYSwgbywgcywgbCkgewogICAgICB2YXIgaCA9IHQubGVuZ3RoOwogICAgICBpZiAoMSA9PSBsKSBmb3IgKHZhciB1ID0gMDsgdSA8IGg7IHUrKykgewogICAgICAgIHNbdV0gPSBjKHRbdV0sIGVbdV0sIHJbdV0sIG5bdV0sIGksIGEsIG8pOwogICAgICB9IGVsc2UgZm9yICh2YXIgZiA9IHRbMF0ubGVuZ3RoLCB1ID0gMDsgdSA8IGg7IHUrKykgewogICAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgZjsgZCsrKSB7CiAgICAgICAgICBzW3VdW2RdID0gYyh0W3VdW2RdLCBlW3VdW2RdLCByW3VdW2RdLCBuW3VdW2RdLCBpLCBhLCBvKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjKHQsIGUsIHIsIG4sIGksIGEsIG8pIHsKICAgICAgdmFyIHMgPSAuNSAqIChyIC0gdCksCiAgICAgICAgICBsID0gLjUgKiAobiAtIGUpOwogICAgICByZXR1cm4gKDIgKiAoZSAtIHIpICsgcyArIGwpICogbyArICgtMyAqIChlIC0gcikgLSAyICogcyAtIGwpICogYSArIHMgKiBpICsgZTsKICAgIH0KCiAgICBmdW5jdGlvbiBmKHQpIHsKICAgICAgaWYgKHkodCkpIHsKICAgICAgICB2YXIgZSA9IHQubGVuZ3RoOwoKICAgICAgICBpZiAoeSh0WzBdKSkgewogICAgICAgICAgZm9yICh2YXIgciA9IFtdLCBuID0gMDsgbiA8IGU7IG4rKykgewogICAgICAgICAgICByLnB1c2gody5jYWxsKHRbbl0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB3LmNhbGwodCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0OwogICAgfQoKICAgIGZ1bmN0aW9uIGQodCkgewogICAgICByZXR1cm4gdFswXSA9IE1hdGguZmxvb3IodFswXSksIHRbMV0gPSBNYXRoLmZsb29yKHRbMV0pLCB0WzJdID0gTWF0aC5mbG9vcih0WzJdKSwgInJnYmEoIiArIHQuam9pbigiLCIpICsgIikiOwogICAgfQoKICAgIGZ1bmN0aW9uIHYodCkgewogICAgICB2YXIgZSA9IHRbdC5sZW5ndGggLSAxXS52YWx1ZTsKICAgICAgcmV0dXJuIHkoZSAmJiBlWzBdKSA/IDIgOiAxOwogICAgfQoKICAgIGZ1bmN0aW9uIGcodCwgZSwgciwgbiwgaSwgZikgewogICAgICB2YXIgZyA9IHQuX2dldHRlciwKICAgICAgICAgIHggPSB0Ll9zZXR0ZXIsCiAgICAgICAgICB3ID0gInNwbGluZSIgPT09IGUsCiAgICAgICAgICBfID0gbi5sZW5ndGg7CgogICAgICBpZiAoXykgewogICAgICAgIHZhciBiLAogICAgICAgICAgICBTID0gblswXS52YWx1ZSwKICAgICAgICAgICAgTSA9IHkoUyksCiAgICAgICAgICAgIFQgPSAhMSwKICAgICAgICAgICAgayA9ICExLAogICAgICAgICAgICBDID0gTSA/IHYobikgOiAwOwogICAgICAgIG4uc29ydChmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgcmV0dXJuIHQudGltZSAtIGUudGltZTsKICAgICAgICB9KSwgYiA9IG5bXyAtIDFdLnRpbWU7CgogICAgICAgIGZvciAodmFyIFAgPSBbXSwgSSA9IFtdLCBBID0gblswXS52YWx1ZSwgTyA9ICEwLCBEID0gMDsgRCA8IF87IEQrKykgewogICAgICAgICAgUC5wdXNoKG5bRF0udGltZSAvIGIpOwogICAgICAgICAgdmFyIEwgPSBuW0RdLnZhbHVlOwoKICAgICAgICAgIGlmIChNICYmIGgoTCwgQSwgQykgfHwgIU0gJiYgTCA9PT0gQSB8fCAoTyA9ICExKSwgQSA9IEwsICJzdHJpbmciID09IHR5cGVvZiBMKSB7CiAgICAgICAgICAgIHZhciBGID0gbS5wYXJzZShMKTsKICAgICAgICAgICAgRiA/IChMID0gRiwgVCA9ICEwKSA6IGsgPSAhMDsKICAgICAgICAgIH0KCiAgICAgICAgICBJLnB1c2goTCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZiB8fCAhTykgewogICAgICAgICAgZm9yICh2YXIgUiA9IElbXyAtIDFdLCBEID0gMDsgRCA8IF8gLSAxOyBEKyspIHsKICAgICAgICAgICAgTSA/IGwoSVtEXSwgUiwgQykgOiAhaXNOYU4oSVtEXSkgfHwgaXNOYU4oUikgfHwgayB8fCBUIHx8IChJW0RdID0gUik7CiAgICAgICAgICB9CgogICAgICAgICAgTSAmJiBsKGcodC5fdGFyZ2V0LCBpKSwgUiwgQyk7CiAgICAgICAgICB2YXIgQiwKICAgICAgICAgICAgICB6LAogICAgICAgICAgICAgIE4sCiAgICAgICAgICAgICAgRSwKICAgICAgICAgICAgICBXLAogICAgICAgICAgICAgIHEsCiAgICAgICAgICAgICAgSCA9IDAsCiAgICAgICAgICAgICAgaiA9IDA7CiAgICAgICAgICBpZiAoVCkgdmFyIFggPSBbMCwgMCwgMCwgMF07CgogICAgICAgICAgdmFyIFkgPSBmdW5jdGlvbiBZKHQsIGUpIHsKICAgICAgICAgICAgdmFyIHI7CiAgICAgICAgICAgIGlmIChlIDwgMCkgciA9IDA7ZWxzZSBpZiAoZSA8IGopIHsKICAgICAgICAgICAgICBmb3IgKEIgPSBNYXRoLm1pbihIICsgMSwgXyAtIDEpLCByID0gQjsgciA+PSAwICYmICEoUFtyXSA8PSBlKTsgci0tKSB7CiAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByID0gTWF0aC5taW4ociwgXyAtIDIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZvciAociA9IEg7IHIgPCBfICYmICEoUFtyXSA+IGUpOyByKyspIHsKICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHIgPSBNYXRoLm1pbihyIC0gMSwgXyAtIDIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEggPSByLCBqID0gZTsKICAgICAgICAgICAgdmFyIG4gPSBQW3IgKyAxXSAtIFBbcl07CiAgICAgICAgICAgIGlmICgwICE9PSBuKSBpZiAoeiA9IChlIC0gUFtyXSkgLyBuLCB3KSB7CiAgICAgICAgICAgICAgaWYgKEUgPSBJW3JdLCBOID0gSVswID09PSByID8gciA6IHIgLSAxXSwgVyA9IElbciA+IF8gLSAyID8gXyAtIDEgOiByICsgMV0sIHEgPSBJW3IgPiBfIC0gMyA/IF8gLSAxIDogciArIDJdLCBNKSB1KE4sIEUsIFcsIHEsIHosIHogKiB6LCB6ICogeiAqIHosIGcodCwgaSksIEMpO2Vsc2UgewogICAgICAgICAgICAgICAgdmFyIGw7CiAgICAgICAgICAgICAgICBpZiAoVCkgbCA9IHUoTiwgRSwgVywgcSwgeiwgeiAqIHosIHogKiB6ICogeiwgWCwgMSksIGwgPSBkKFgpO2Vsc2UgewogICAgICAgICAgICAgICAgICBpZiAoaykgcmV0dXJuIG8oRSwgVywgeik7CiAgICAgICAgICAgICAgICAgIGwgPSBjKE4sIEUsIFcsIHEsIHosIHogKiB6LCB6ICogeiAqIHopOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeCh0LCBpLCBsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoTSkgcyhJW3JdLCBJW3IgKyAxXSwgeiwgZyh0LCBpKSwgQyk7ZWxzZSB7CiAgICAgICAgICAgICAgdmFyIGw7CiAgICAgICAgICAgICAgaWYgKFQpIHMoSVtyXSwgSVtyICsgMV0sIHosIFgsIDEpLCBsID0gZChYKTtlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChrKSByZXR1cm4gbyhJW3JdLCBJW3IgKyAxXSwgeik7CiAgICAgICAgICAgICAgICBsID0gYShJW3JdLCBJW3IgKyAxXSwgeik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHgodCwgaSwgbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAgICAgViA9IG5ldyBwKHsKICAgICAgICAgICAgdGFyZ2V0OiB0Ll90YXJnZXQsCiAgICAgICAgICAgIGxpZmU6IGIsCiAgICAgICAgICAgIGxvb3A6IHQuX2xvb3AsCiAgICAgICAgICAgIGRlbGF5OiB0Ll9kZWxheSwKICAgICAgICAgICAgb25mcmFtZTogWSwKICAgICAgICAgICAgb25kZXN0cm95OiByCiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gZSAmJiAic3BsaW5lIiAhPT0gZSAmJiAoVi5lYXNpbmcgPSBlKSwgVjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICB2YXIgcCA9IHIoNDUpLAogICAgICAgIG0gPSByKDE4KSwKICAgICAgICB4ID0gcigwKSwKICAgICAgICB5ID0geC5pc0FycmF5TGlrZSwKICAgICAgICB3ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLAogICAgICAgIF8gPSBmdW5jdGlvbiBfKHQsIGUsIHIsIGEpIHsKICAgICAgdGhpcy5fdHJhY2tzID0ge30sIHRoaXMuX3RhcmdldCA9IHQsIHRoaXMuX2xvb3AgPSBlIHx8ICExLCB0aGlzLl9nZXR0ZXIgPSByIHx8IG4sIHRoaXMuX3NldHRlciA9IGEgfHwgaSwgdGhpcy5fY2xpcENvdW50ID0gMCwgdGhpcy5fZGVsYXkgPSAwLCB0aGlzLl9kb25lTGlzdCA9IFtdLCB0aGlzLl9vbmZyYW1lTGlzdCA9IFtdLCB0aGlzLl9jbGlwTGlzdCA9IFtdOwogICAgfTsKCiAgICBfLnByb3RvdHlwZSA9IHsKICAgICAgd2hlbjogZnVuY3Rpb24gd2hlbih0LCBlKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLl90cmFja3M7CgogICAgICAgIGZvciAodmFyIG4gaW4gZSkgewogICAgICAgICAgaWYgKGUuaGFzT3duUHJvcGVydHkobikpIHsKICAgICAgICAgICAgaWYgKCFyW25dKSB7CiAgICAgICAgICAgICAgcltuXSA9IFtdOwoKICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuX2dldHRlcih0aGlzLl90YXJnZXQsIG4pOwoKICAgICAgICAgICAgICBpZiAobnVsbCA9PSBpKSBjb250aW51ZTsKICAgICAgICAgICAgICAwICE9PSB0ICYmIHJbbl0ucHVzaCh7CiAgICAgICAgICAgICAgICB0aW1lOiAwLAogICAgICAgICAgICAgICAgdmFsdWU6IGYoaSkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcltuXS5wdXNoKHsKICAgICAgICAgICAgICB0aW1lOiB0LAogICAgICAgICAgICAgIHZhbHVlOiBlW25dCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIGR1cmluZzogZnVuY3Rpb24gZHVyaW5nKHQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb25mcmFtZUxpc3QucHVzaCh0KSwgdGhpczsKICAgICAgfSwKICAgICAgcGF1c2U6IGZ1bmN0aW9uIHBhdXNlKCkgewogICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgdGhpcy5fY2xpcExpc3QubGVuZ3RoOyB0KyspIHsKICAgICAgICAgIHRoaXMuX2NsaXBMaXN0W3RdLnBhdXNlKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9wYXVzZWQgPSAhMDsKICAgICAgfSwKICAgICAgcmVzdW1lOiBmdW5jdGlvbiByZXN1bWUoKSB7CiAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCB0aGlzLl9jbGlwTGlzdC5sZW5ndGg7IHQrKykgewogICAgICAgICAgdGhpcy5fY2xpcExpc3RbdF0ucmVzdW1lKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9wYXVzZWQgPSAhMTsKICAgICAgfSwKICAgICAgaXNQYXVzZWQ6IGZ1bmN0aW9uIGlzUGF1c2VkKCkgewogICAgICAgIHJldHVybiAhIXRoaXMuX3BhdXNlZDsKICAgICAgfSwKICAgICAgX2RvbmVDYWxsYmFjazogZnVuY3Rpb24gX2RvbmVDYWxsYmFjaygpIHsKICAgICAgICB0aGlzLl90cmFja3MgPSB7fSwgdGhpcy5fY2xpcExpc3QubGVuZ3RoID0gMDsKCiAgICAgICAgZm9yICh2YXIgdCA9IHRoaXMuX2RvbmVMaXN0LCBlID0gdC5sZW5ndGgsIHIgPSAwOyByIDwgZTsgcisrKSB7CiAgICAgICAgICB0W3JdLmNhbGwodGhpcyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBzdGFydDogZnVuY3Rpb24gc3RhcnQodCwgZSkgewogICAgICAgIHZhciByLAogICAgICAgICAgICBuID0gdGhpcywKICAgICAgICAgICAgaSA9IDAsCiAgICAgICAgICAgIGEgPSBmdW5jdGlvbiBhKCkgewogICAgICAgICAgLS1pIHx8IG4uX2RvbmVDYWxsYmFjaygpOwogICAgICAgIH07CgogICAgICAgIGZvciAodmFyIG8gaW4gdGhpcy5fdHJhY2tzKSB7CiAgICAgICAgICBpZiAodGhpcy5fdHJhY2tzLmhhc093blByb3BlcnR5KG8pKSB7CiAgICAgICAgICAgIHZhciBzID0gZyh0aGlzLCB0LCBhLCB0aGlzLl90cmFja3Nbb10sIG8sIGUpOwogICAgICAgICAgICBzICYmICh0aGlzLl9jbGlwTGlzdC5wdXNoKHMpLCBpKyssIHRoaXMuYW5pbWF0aW9uICYmIHRoaXMuYW5pbWF0aW9uLmFkZENsaXAocyksIHIgPSBzKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChyKSB7CiAgICAgICAgICB2YXIgbCA9IHIub25mcmFtZTsKCiAgICAgICAgICByLm9uZnJhbWUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICBsKHQsIGUpOwoKICAgICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCBuLl9vbmZyYW1lTGlzdC5sZW5ndGg7IHIrKykgewogICAgICAgICAgICAgIG4uX29uZnJhbWVMaXN0W3JdKHQsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGkgfHwgdGhpcy5fZG9uZUNhbGxiYWNrKCksIHRoaXM7CiAgICAgIH0sCiAgICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AodCkgewogICAgICAgIGZvciAodmFyIGUgPSB0aGlzLl9jbGlwTGlzdCwgciA9IHRoaXMuYW5pbWF0aW9uLCBuID0gMDsgbiA8IGUubGVuZ3RoOyBuKyspIHsKICAgICAgICAgIHZhciBpID0gZVtuXTsKICAgICAgICAgIHQgJiYgaS5vbmZyYW1lKHRoaXMuX3RhcmdldCwgMSksIHIgJiYgci5yZW1vdmVDbGlwKGkpOwogICAgICAgIH0KCiAgICAgICAgZS5sZW5ndGggPSAwOwogICAgICB9LAogICAgICBkZWxheTogZnVuY3Rpb24gZGVsYXkodCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZWxheSA9IHQsIHRoaXM7CiAgICAgIH0sCiAgICAgIGRvbmU6IGZ1bmN0aW9uIGRvbmUodCkgewogICAgICAgIHJldHVybiB0ICYmIHRoaXMuX2RvbmVMaXN0LnB1c2godCksIHRoaXM7CiAgICAgIH0sCiAgICAgIGdldENsaXBzOiBmdW5jdGlvbiBnZXRDbGlwcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2xpcExpc3Q7CiAgICAgIH0KICAgIH07CiAgICB2YXIgYiA9IF87CiAgICB0LmV4cG9ydHMgPSBiOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgdGhpcy5fdGFyZ2V0ID0gdC50YXJnZXQsIHRoaXMuX2xpZmUgPSB0LmxpZmUgfHwgMWUzLCB0aGlzLl9kZWxheSA9IHQuZGVsYXkgfHwgMCwgdGhpcy5faW5pdGlhbGl6ZWQgPSAhMSwgdGhpcy5sb29wID0gbnVsbCAhPSB0Lmxvb3AgJiYgdC5sb29wLCB0aGlzLmdhcCA9IHQuZ2FwIHx8IDAsIHRoaXMuZWFzaW5nID0gdC5lYXNpbmcgfHwgIkxpbmVhciIsIHRoaXMub25mcmFtZSA9IHQub25mcmFtZSwgdGhpcy5vbmRlc3Ryb3kgPSB0Lm9uZGVzdHJveSwgdGhpcy5vbnJlc3RhcnQgPSB0Lm9ucmVzdGFydCwgdGhpcy5fcGF1c2VkVGltZSA9IDAsIHRoaXMuX3BhdXNlZCA9ICExOwogICAgfQoKICAgIHZhciBpID0gcig0Nik7CiAgICBuLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IG4sCiAgICAgIHN0ZXA6IGZ1bmN0aW9uIHN0ZXAodCwgZSkgewogICAgICAgIGlmICh0aGlzLl9pbml0aWFsaXplZCB8fCAodGhpcy5fc3RhcnRUaW1lID0gdCArIHRoaXMuX2RlbGF5LCB0aGlzLl9pbml0aWFsaXplZCA9ICEwKSwgdGhpcy5fcGF1c2VkKSByZXR1cm4gdm9pZCAodGhpcy5fcGF1c2VkVGltZSArPSBlKTsKICAgICAgICB2YXIgciA9ICh0IC0gdGhpcy5fc3RhcnRUaW1lIC0gdGhpcy5fcGF1c2VkVGltZSkgLyB0aGlzLl9saWZlOwoKICAgICAgICBpZiAoIShyIDwgMCkpIHsKICAgICAgICAgIHIgPSBNYXRoLm1pbihyLCAxKTsKICAgICAgICAgIHZhciBuID0gdGhpcy5lYXNpbmcsCiAgICAgICAgICAgICAgYSA9ICJzdHJpbmciID09IHR5cGVvZiBuID8gaVtuXSA6IG4sCiAgICAgICAgICAgICAgbyA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGEgPyBhKHIpIDogcjsKICAgICAgICAgIHJldHVybiB0aGlzLmZpcmUoImZyYW1lIiwgbyksIDEgPT0gciA/IHRoaXMubG9vcCA/ICh0aGlzLnJlc3RhcnQodCksICJyZXN0YXJ0IikgOiAodGhpcy5fbmVlZHNSZW1vdmUgPSAhMCwgImRlc3Ryb3kiKSA6IG51bGw7CiAgICAgICAgfQogICAgICB9LAogICAgICByZXN0YXJ0OiBmdW5jdGlvbiByZXN0YXJ0KHQpIHsKICAgICAgICB2YXIgZSA9ICh0IC0gdGhpcy5fc3RhcnRUaW1lIC0gdGhpcy5fcGF1c2VkVGltZSkgJSB0aGlzLl9saWZlOwogICAgICAgIHRoaXMuX3N0YXJ0VGltZSA9IHQgLSBlICsgdGhpcy5nYXAsIHRoaXMuX3BhdXNlZFRpbWUgPSAwLCB0aGlzLl9uZWVkc1JlbW92ZSA9ICExOwogICAgICB9LAogICAgICBmaXJlOiBmdW5jdGlvbiBmaXJlKHQsIGUpIHsKICAgICAgICB0ID0gIm9uIiArIHQsIHRoaXNbdF0gJiYgdGhpc1t0XSh0aGlzLl90YXJnZXQsIGUpOwogICAgICB9LAogICAgICBwYXVzZTogZnVuY3Rpb24gcGF1c2UoKSB7CiAgICAgICAgdGhpcy5fcGF1c2VkID0gITA7CiAgICAgIH0sCiAgICAgIHJlc3VtZTogZnVuY3Rpb24gcmVzdW1lKCkgewogICAgICAgIHRoaXMuX3BhdXNlZCA9ICExOwogICAgICB9CiAgICB9OwogICAgdmFyIGEgPSBuOwogICAgdC5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHIgPSB7CiAgICAgIGxpbmVhcjogZnVuY3Rpb24gbGluZWFyKHQpIHsKICAgICAgICByZXR1cm4gdDsKICAgICAgfSwKICAgICAgcXVhZHJhdGljSW46IGZ1bmN0aW9uIHF1YWRyYXRpY0luKHQpIHsKICAgICAgICByZXR1cm4gdCAqIHQ7CiAgICAgIH0sCiAgICAgIHF1YWRyYXRpY091dDogZnVuY3Rpb24gcXVhZHJhdGljT3V0KHQpIHsKICAgICAgICByZXR1cm4gdCAqICgyIC0gdCk7CiAgICAgIH0sCiAgICAgIHF1YWRyYXRpY0luT3V0OiBmdW5jdGlvbiBxdWFkcmF0aWNJbk91dCh0KSB7CiAgICAgICAgcmV0dXJuICh0ICo9IDIpIDwgMSA/IC41ICogdCAqIHQgOiAtLjUgKiAoLS10ICogKHQgLSAyKSAtIDEpOwogICAgICB9LAogICAgICBjdWJpY0luOiBmdW5jdGlvbiBjdWJpY0luKHQpIHsKICAgICAgICByZXR1cm4gdCAqIHQgKiB0OwogICAgICB9LAogICAgICBjdWJpY091dDogZnVuY3Rpb24gY3ViaWNPdXQodCkgewogICAgICAgIHJldHVybiAtLXQgKiB0ICogdCArIDE7CiAgICAgIH0sCiAgICAgIGN1YmljSW5PdXQ6IGZ1bmN0aW9uIGN1YmljSW5PdXQodCkgewogICAgICAgIHJldHVybiAodCAqPSAyKSA8IDEgPyAuNSAqIHQgKiB0ICogdCA6IC41ICogKCh0IC09IDIpICogdCAqIHQgKyAyKTsKICAgICAgfSwKICAgICAgcXVhcnRpY0luOiBmdW5jdGlvbiBxdWFydGljSW4odCkgewogICAgICAgIHJldHVybiB0ICogdCAqIHQgKiB0OwogICAgICB9LAogICAgICBxdWFydGljT3V0OiBmdW5jdGlvbiBxdWFydGljT3V0KHQpIHsKICAgICAgICByZXR1cm4gMSAtIC0tdCAqIHQgKiB0ICogdDsKICAgICAgfSwKICAgICAgcXVhcnRpY0luT3V0OiBmdW5jdGlvbiBxdWFydGljSW5PdXQodCkgewogICAgICAgIHJldHVybiAodCAqPSAyKSA8IDEgPyAuNSAqIHQgKiB0ICogdCAqIHQgOiAtLjUgKiAoKHQgLT0gMikgKiB0ICogdCAqIHQgLSAyKTsKICAgICAgfSwKICAgICAgcXVpbnRpY0luOiBmdW5jdGlvbiBxdWludGljSW4odCkgewogICAgICAgIHJldHVybiB0ICogdCAqIHQgKiB0ICogdDsKICAgICAgfSwKICAgICAgcXVpbnRpY091dDogZnVuY3Rpb24gcXVpbnRpY091dCh0KSB7CiAgICAgICAgcmV0dXJuIC0tdCAqIHQgKiB0ICogdCAqIHQgKyAxOwogICAgICB9LAogICAgICBxdWludGljSW5PdXQ6IGZ1bmN0aW9uIHF1aW50aWNJbk91dCh0KSB7CiAgICAgICAgcmV0dXJuICh0ICo9IDIpIDwgMSA/IC41ICogdCAqIHQgKiB0ICogdCAqIHQgOiAuNSAqICgodCAtPSAyKSAqIHQgKiB0ICogdCAqIHQgKyAyKTsKICAgICAgfSwKICAgICAgc2ludXNvaWRhbEluOiBmdW5jdGlvbiBzaW51c29pZGFsSW4odCkgewogICAgICAgIHJldHVybiAxIC0gTWF0aC5jb3ModCAqIE1hdGguUEkgLyAyKTsKICAgICAgfSwKICAgICAgc2ludXNvaWRhbE91dDogZnVuY3Rpb24gc2ludXNvaWRhbE91dCh0KSB7CiAgICAgICAgcmV0dXJuIE1hdGguc2luKHQgKiBNYXRoLlBJIC8gMik7CiAgICAgIH0sCiAgICAgIHNpbnVzb2lkYWxJbk91dDogZnVuY3Rpb24gc2ludXNvaWRhbEluT3V0KHQpIHsKICAgICAgICByZXR1cm4gLjUgKiAoMSAtIE1hdGguY29zKE1hdGguUEkgKiB0KSk7CiAgICAgIH0sCiAgICAgIGV4cG9uZW50aWFsSW46IGZ1bmN0aW9uIGV4cG9uZW50aWFsSW4odCkgewogICAgICAgIHJldHVybiAwID09PSB0ID8gMCA6IE1hdGgucG93KDEwMjQsIHQgLSAxKTsKICAgICAgfSwKICAgICAgZXhwb25lbnRpYWxPdXQ6IGZ1bmN0aW9uIGV4cG9uZW50aWFsT3V0KHQpIHsKICAgICAgICByZXR1cm4gMSA9PT0gdCA/IDEgOiAxIC0gTWF0aC5wb3coMiwgLTEwICogdCk7CiAgICAgIH0sCiAgICAgIGV4cG9uZW50aWFsSW5PdXQ6IGZ1bmN0aW9uIGV4cG9uZW50aWFsSW5PdXQodCkgewogICAgICAgIHJldHVybiAwID09PSB0ID8gMCA6IDEgPT09IHQgPyAxIDogKHQgKj0gMikgPCAxID8gLjUgKiBNYXRoLnBvdygxMDI0LCB0IC0gMSkgOiAuNSAqICgyIC0gTWF0aC5wb3coMiwgLTEwICogKHQgLSAxKSkpOwogICAgICB9LAogICAgICBjaXJjdWxhckluOiBmdW5jdGlvbiBjaXJjdWxhckluKHQpIHsKICAgICAgICByZXR1cm4gMSAtIE1hdGguc3FydCgxIC0gdCAqIHQpOwogICAgICB9LAogICAgICBjaXJjdWxhck91dDogZnVuY3Rpb24gY2lyY3VsYXJPdXQodCkgewogICAgICAgIHJldHVybiBNYXRoLnNxcnQoMSAtIC0tdCAqIHQpOwogICAgICB9LAogICAgICBjaXJjdWxhckluT3V0OiBmdW5jdGlvbiBjaXJjdWxhckluT3V0KHQpIHsKICAgICAgICByZXR1cm4gKHQgKj0gMikgPCAxID8gLS41ICogKE1hdGguc3FydCgxIC0gdCAqIHQpIC0gMSkgOiAuNSAqIChNYXRoLnNxcnQoMSAtICh0IC09IDIpICogdCkgKyAxKTsKICAgICAgfSwKICAgICAgZWxhc3RpY0luOiBmdW5jdGlvbiBlbGFzdGljSW4odCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICByID0gLjE7CiAgICAgICAgcmV0dXJuIDAgPT09IHQgPyAwIDogMSA9PT0gdCA/IDEgOiAoIXIgfHwgciA8IDEgPyAociA9IDEsIGUgPSAuMSkgOiBlID0gLjQgKiBNYXRoLmFzaW4oMSAvIHIpIC8gKDIgKiBNYXRoLlBJKSwgLXIgKiBNYXRoLnBvdygyLCAxMCAqICh0IC09IDEpKSAqIE1hdGguc2luKCh0IC0gZSkgKiAoMiAqIE1hdGguUEkpIC8gLjQpKTsKICAgICAgfSwKICAgICAgZWxhc3RpY091dDogZnVuY3Rpb24gZWxhc3RpY091dCh0KSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHIgPSAuMTsKICAgICAgICByZXR1cm4gMCA9PT0gdCA/IDAgOiAxID09PSB0ID8gMSA6ICghciB8fCByIDwgMSA/IChyID0gMSwgZSA9IC4xKSA6IGUgPSAuNCAqIE1hdGguYXNpbigxIC8gcikgLyAoMiAqIE1hdGguUEkpLCByICogTWF0aC5wb3coMiwgLTEwICogdCkgKiBNYXRoLnNpbigodCAtIGUpICogKDIgKiBNYXRoLlBJKSAvIC40KSArIDEpOwogICAgICB9LAogICAgICBlbGFzdGljSW5PdXQ6IGZ1bmN0aW9uIGVsYXN0aWNJbk91dCh0KSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIHIgPSAuMTsKICAgICAgICByZXR1cm4gMCA9PT0gdCA/IDAgOiAxID09PSB0ID8gMSA6ICghciB8fCByIDwgMSA/IChyID0gMSwgZSA9IC4xKSA6IGUgPSAuNCAqIE1hdGguYXNpbigxIC8gcikgLyAoMiAqIE1hdGguUEkpLCAodCAqPSAyKSA8IDEgPyByICogTWF0aC5wb3coMiwgMTAgKiAodCAtPSAxKSkgKiBNYXRoLnNpbigodCAtIGUpICogKDIgKiBNYXRoLlBJKSAvIC40KSAqIC0uNSA6IHIgKiBNYXRoLnBvdygyLCAtMTAgKiAodCAtPSAxKSkgKiBNYXRoLnNpbigodCAtIGUpICogKDIgKiBNYXRoLlBJKSAvIC40KSAqIC41ICsgMSk7CiAgICAgIH0sCiAgICAgIGJhY2tJbjogZnVuY3Rpb24gYmFja0luKHQpIHsKICAgICAgICB2YXIgZSA9IDEuNzAxNTg7CiAgICAgICAgcmV0dXJuIHQgKiB0ICogKChlICsgMSkgKiB0IC0gZSk7CiAgICAgIH0sCiAgICAgIGJhY2tPdXQ6IGZ1bmN0aW9uIGJhY2tPdXQodCkgewogICAgICAgIHZhciBlID0gMS43MDE1ODsKICAgICAgICByZXR1cm4gLS10ICogdCAqICgoZSArIDEpICogdCArIGUpICsgMTsKICAgICAgfSwKICAgICAgYmFja0luT3V0OiBmdW5jdGlvbiBiYWNrSW5PdXQodCkgewogICAgICAgIHZhciBlID0gMi41OTQ5MDk1OwogICAgICAgIHJldHVybiAodCAqPSAyKSA8IDEgPyB0ICogdCAqICgoZSArIDEpICogdCAtIGUpICogLjUgOiAuNSAqICgodCAtPSAyKSAqIHQgKiAoKGUgKyAxKSAqIHQgKyBlKSArIDIpOwogICAgICB9LAogICAgICBib3VuY2VJbjogZnVuY3Rpb24gYm91bmNlSW4odCkgewogICAgICAgIHJldHVybiAxIC0gci5ib3VuY2VPdXQoMSAtIHQpOwogICAgICB9LAogICAgICBib3VuY2VPdXQ6IGZ1bmN0aW9uIGJvdW5jZU91dCh0KSB7CiAgICAgICAgcmV0dXJuIHQgPCAxIC8gMi43NSA/IDcuNTYyNSAqIHQgKiB0IDogdCA8IDIgLyAyLjc1ID8gNy41NjI1ICogKHQgLT0gMS41IC8gMi43NSkgKiB0ICsgLjc1IDogdCA8IDIuNSAvIDIuNzUgPyA3LjU2MjUgKiAodCAtPSAyLjI1IC8gMi43NSkgKiB0ICsgLjkzNzUgOiA3LjU2MjUgKiAodCAtPSAyLjYyNSAvIDIuNzUpICogdCArIC45ODQzNzU7CiAgICAgIH0sCiAgICAgIGJvdW5jZUluT3V0OiBmdW5jdGlvbiBib3VuY2VJbk91dCh0KSB7CiAgICAgICAgcmV0dXJuIHQgPCAuNSA/IC41ICogci5ib3VuY2VJbigyICogdCkgOiAuNSAqIHIuYm91bmNlT3V0KDIgKiB0IC0gMSkgKyAuNTsKICAgICAgfQogICAgfSwKICAgICAgICBuID0gcjsKICAgIHQuZXhwb3J0cyA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxOSksCiAgICAgICAgaSA9IG4uZGVidWdNb2RlLAogICAgICAgIGEgPSBmdW5jdGlvbiBhKCkge307CgogICAgMSA9PT0gaSA/IGEgPSBmdW5jdGlvbiBhKCkgewogICAgICBmb3IgKHZhciB0IGluIGFyZ3VtZW50cykgewogICAgICAgIHRocm93IG5ldyBFcnJvcihhcmd1bWVudHNbdF0pOwogICAgICB9CiAgICB9IDogaSA+IDEgJiYgKGEgPSBmdW5jdGlvbiBhKCkgewogICAgICBmb3IgKHZhciB0IGluIGFyZ3VtZW50cykgewogICAgICAgIGNvbnNvbGUubG9nKGFyZ3VtZW50c1t0XSk7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIG8gPSBhOwogICAgdC5leHBvcnRzID0gbzsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDIwKSwKICAgICAgICBpID0gcigzKSwKICAgICAgICBhID0gbmV3IGkoKSwKICAgICAgICBvID0gZnVuY3Rpb24gbygpIHt9OwoKICAgIG8ucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogbywKICAgICAgZHJhd1JlY3RUZXh0OiBmdW5jdGlvbiBkcmF3UmVjdFRleHQodCwgZSkgewogICAgICAgIHZhciByID0gdGhpcy5zdHlsZTsKICAgICAgICBlID0gci50ZXh0UmVjdCB8fCBlLCB0aGlzLl9fZGlydHkgJiYgbi5ub3JtYWxpemVUZXh0U3R5bGUociwgITApOwogICAgICAgIHZhciBpID0gci50ZXh0OwoKICAgICAgICBpZiAobnVsbCAhPSBpICYmIChpICs9ICIiKSwgbi5uZWVkRHJhd1RleHQoaSwgcikpIHsKICAgICAgICAgIHQuc2F2ZSgpOwogICAgICAgICAgdmFyIG8gPSB0aGlzLnRyYW5zZm9ybTsKICAgICAgICAgIHIudHJhbnNmb3JtVGV4dCA/IHRoaXMuc2V0VHJhbnNmb3JtKHQpIDogbyAmJiAoYS5jb3B5KGUpLCBhLmFwcGx5VHJhbnNmb3JtKG8pLCBlID0gYSksIG4ucmVuZGVyVGV4dCh0aGlzLCB0LCBpLCByLCBlKSwgdC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgdmFyIHMgPSBvOwogICAgdC5leHBvcnRzID0gczsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0LCBlLCByKSB7CiAgICAgIGlmICgwICE9PSB0Lmxlbmd0aCkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBpID0gdFswXSwKICAgICAgICAgICAgYSA9IGlbMF0sCiAgICAgICAgICAgIG8gPSBpWzBdLAogICAgICAgICAgICBzID0gaVsxXSwKICAgICAgICAgICAgbCA9IGlbMV07CgogICAgICAgIGZvciAobiA9IDE7IG4gPCB0Lmxlbmd0aDsgbisrKSB7CiAgICAgICAgICBpID0gdFtuXSwgYSA9IHUoYSwgaVswXSksIG8gPSBjKG8sIGlbMF0pLCBzID0gdShzLCBpWzFdKSwgbCA9IGMobCwgaVsxXSk7CiAgICAgICAgfQoKICAgICAgICBlWzBdID0gYSwgZVsxXSA9IHMsIHJbMF0gPSBvLCByWzFdID0gbDsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSwgciwgbiwgaSwgYSkgewogICAgICBpWzBdID0gdSh0LCByKSwgaVsxXSA9IHUoZSwgbiksIGFbMF0gPSBjKHQsIHIpLCBhWzFdID0gYyhlLCBuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhKHQsIGUsIHIsIG4sIGksIGEsIG8sIHMsIGwsIGYpIHsKICAgICAgdmFyIGQsCiAgICAgICAgICB2ID0gaC5jdWJpY0V4dHJlbWEsCiAgICAgICAgICBnID0gaC5jdWJpY0F0LAogICAgICAgICAgcCA9IHYodCwgciwgaSwgbywgeCk7CgogICAgICBmb3IgKGxbMF0gPSAxIC8gMCwgbFsxXSA9IDEgLyAwLCBmWzBdID0gLTEgLyAwLCBmWzFdID0gLTEgLyAwLCBkID0gMDsgZCA8IHA7IGQrKykgewogICAgICAgIHZhciBtID0gZyh0LCByLCBpLCBvLCB4W2RdKTsKICAgICAgICBsWzBdID0gdShtLCBsWzBdKSwgZlswXSA9IGMobSwgZlswXSk7CiAgICAgIH0KCiAgICAgIGZvciAocCA9IHYoZSwgbiwgYSwgcywgeSksIGQgPSAwOyBkIDwgcDsgZCsrKSB7CiAgICAgICAgdmFyIHcgPSBnKGUsIG4sIGEsIHMsIHlbZF0pOwogICAgICAgIGxbMV0gPSB1KHcsIGxbMV0pLCBmWzFdID0gYyh3LCBmWzFdKTsKICAgICAgfQoKICAgICAgbFswXSA9IHUodCwgbFswXSksIGZbMF0gPSBjKHQsIGZbMF0pLCBsWzBdID0gdShvLCBsWzBdKSwgZlswXSA9IGMobywgZlswXSksIGxbMV0gPSB1KGUsIGxbMV0pLCBmWzFdID0gYyhlLCBmWzFdKSwgbFsxXSA9IHUocywgbFsxXSksIGZbMV0gPSBjKHMsIGZbMV0pOwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCwgZSwgciwgbiwgaSwgYSwgbywgcykgewogICAgICB2YXIgbCA9IGgucXVhZHJhdGljRXh0cmVtdW0sCiAgICAgICAgICBmID0gaC5xdWFkcmF0aWNBdCwKICAgICAgICAgIGQgPSBjKHUobCh0LCByLCBpKSwgMSksIDApLAogICAgICAgICAgdiA9IGModShsKGUsIG4sIGEpLCAxKSwgMCksCiAgICAgICAgICBnID0gZih0LCByLCBpLCBkKSwKICAgICAgICAgIHAgPSBmKGUsIG4sIGEsIHYpOwogICAgICBvWzBdID0gdSh0LCBpLCBnKSwgb1sxXSA9IHUoZSwgYSwgcCksIHNbMF0gPSBjKHQsIGksIGcpLCBzWzFdID0gYyhlLCBhLCBwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIGUsIHIsIG4sIGksIGEsIG8sIHMsIGgpIHsKICAgICAgdmFyIHUgPSBsLm1pbiwKICAgICAgICAgIGMgPSBsLm1heCwKICAgICAgICAgIHggPSBNYXRoLmFicyhpIC0gYSk7CiAgICAgIGlmICh4ICUgdiA8IDFlLTQgJiYgeCA+IDFlLTQpIHJldHVybiBzWzBdID0gdCAtIHIsIHNbMV0gPSBlIC0gbiwgaFswXSA9IHQgKyByLCB2b2lkIChoWzFdID0gZSArIG4pOwoKICAgICAgaWYgKGdbMF0gPSBkKGkpICogciArIHQsIGdbMV0gPSBmKGkpICogbiArIGUsIHBbMF0gPSBkKGEpICogciArIHQsIHBbMV0gPSBmKGEpICogbiArIGUsIHUocywgZywgcCksIGMoaCwgZywgcCksIGkgJT0gdiwgaSA8IDAgJiYgKGkgKz0gdiksIGEgJT0gdiwgYSA8IDAgJiYgKGEgKz0gdiksIGkgPiBhICYmICFvID8gYSArPSB2IDogaSA8IGEgJiYgbyAmJiAoaSArPSB2KSwgbykgewogICAgICAgIHZhciB5ID0gYTsKICAgICAgICBhID0gaSwgaSA9IHk7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIHcgPSAwOyB3IDwgYTsgdyArPSBNYXRoLlBJIC8gMikgewogICAgICAgIHcgPiBpICYmIChtWzBdID0gZCh3KSAqIHIgKyB0LCBtWzFdID0gZih3KSAqIG4gKyBlLCB1KHMsIG0sIHMpLCBjKGgsIG0sIGgpKTsKICAgICAgfQogICAgfQoKICAgIHZhciBsID0gcigyKSwKICAgICAgICBoID0gcig0KSwKICAgICAgICB1ID0gTWF0aC5taW4sCiAgICAgICAgYyA9IE1hdGgubWF4LAogICAgICAgIGYgPSBNYXRoLnNpbiwKICAgICAgICBkID0gTWF0aC5jb3MsCiAgICAgICAgdiA9IDIgKiBNYXRoLlBJLAogICAgICAgIGcgPSBsLmNyZWF0ZSgpLAogICAgICAgIHAgPSBsLmNyZWF0ZSgpLAogICAgICAgIG0gPSBsLmNyZWF0ZSgpLAogICAgICAgIHggPSBbXSwKICAgICAgICB5ID0gW107CiAgICBlLmZyb21Qb2ludHMgPSBuLCBlLmZyb21MaW5lID0gaSwgZS5mcm9tQ3ViaWMgPSBhLCBlLmZyb21RdWFkcmF0aWMgPSBvLCBlLmZyb21BcmMgPSBzOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUpIHsKICAgICAgcmV0dXJuIE1hdGguYWJzKHQgLSBlKSA8IGI7CiAgICB9CgogICAgZnVuY3Rpb24gaSgpIHsKICAgICAgdmFyIHQgPSBNWzBdOwogICAgICBNWzBdID0gTVsxXSwgTVsxXSA9IHQ7CiAgICB9CgogICAgZnVuY3Rpb24gYSh0LCBlLCByLCBuLCBhLCBvLCBzLCBsLCBoLCB1KSB7CiAgICAgIGlmICh1ID4gZSAmJiB1ID4gbiAmJiB1ID4gbyAmJiB1ID4gbCB8fCB1IDwgZSAmJiB1IDwgbiAmJiB1IDwgbyAmJiB1IDwgbCkgcmV0dXJuIDA7CiAgICAgIHZhciBjID0geC5jdWJpY1Jvb3RBdChlLCBuLCBvLCBsLCB1LCBTKTsKICAgICAgaWYgKDAgPT09IGMpIHJldHVybiAwOwoKICAgICAgZm9yICh2YXIgZiwgZCwgdiA9IDAsIGcgPSAtMSwgcCA9IDA7IHAgPCBjOyBwKyspIHsKICAgICAgICB2YXIgbSA9IFNbcF0sCiAgICAgICAgICAgIHkgPSAwID09PSBtIHx8IDEgPT09IG0gPyAuNSA6IDE7CiAgICAgICAgeC5jdWJpY0F0KHQsIHIsIGEsIHMsIG0pIDwgaCB8fCAoZyA8IDAgJiYgKGcgPSB4LmN1YmljRXh0cmVtYShlLCBuLCBvLCBsLCBNKSwgTVsxXSA8IE1bMF0gJiYgZyA+IDEgJiYgaSgpLCBmID0geC5jdWJpY0F0KGUsIG4sIG8sIGwsIE1bMF0pLCBnID4gMSAmJiAoZCA9IHguY3ViaWNBdChlLCBuLCBvLCBsLCBNWzFdKSkpLCAyID09IGcgPyBtIDwgTVswXSA/IHYgKz0gZiA8IGUgPyB5IDogLXkgOiBtIDwgTVsxXSA/IHYgKz0gZCA8IGYgPyB5IDogLXkgOiB2ICs9IGwgPCBkID8geSA6IC15IDogbSA8IE1bMF0gPyB2ICs9IGYgPCBlID8geSA6IC15IDogdiArPSBsIDwgZiA/IHkgOiAteSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2OwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCwgZSwgciwgbiwgaSwgYSwgbywgcykgewogICAgICBpZiAocyA+IGUgJiYgcyA+IG4gJiYgcyA+IGEgfHwgcyA8IGUgJiYgcyA8IG4gJiYgcyA8IGEpIHJldHVybiAwOwogICAgICB2YXIgbCA9IHgucXVhZHJhdGljUm9vdEF0KGUsIG4sIGEsIHMsIFMpOwogICAgICBpZiAoMCA9PT0gbCkgcmV0dXJuIDA7CiAgICAgIHZhciBoID0geC5xdWFkcmF0aWNFeHRyZW11bShlLCBuLCBhKTsKCiAgICAgIGlmIChoID49IDAgJiYgaCA8PSAxKSB7CiAgICAgICAgZm9yICh2YXIgdSA9IDAsIGMgPSB4LnF1YWRyYXRpY0F0KGUsIG4sIGEsIGgpLCBmID0gMDsgZiA8IGw7IGYrKykgewogICAgICAgICAgdmFyIGQgPSAwID09PSBTW2ZdIHx8IDEgPT09IFNbZl0gPyAuNSA6IDEsCiAgICAgICAgICAgICAgdiA9IHgucXVhZHJhdGljQXQodCwgciwgaSwgU1tmXSk7CiAgICAgICAgICB2IDwgbyB8fCAoU1tmXSA8IGggPyB1ICs9IGMgPCBlID8gZCA6IC1kIDogdSArPSBhIDwgYyA/IGQgOiAtZCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdTsKICAgICAgfQoKICAgICAgdmFyIGQgPSAwID09PSBTWzBdIHx8IDEgPT09IFNbMF0gPyAuNSA6IDEsCiAgICAgICAgICB2ID0geC5xdWFkcmF0aWNBdCh0LCByLCBpLCBTWzBdKTsKICAgICAgcmV0dXJuIHYgPCBvID8gMCA6IGEgPCBlID8gZCA6IC1kOwogICAgfQoKICAgIGZ1bmN0aW9uIHModCwgZSwgciwgbiwgaSwgYSwgbywgcykgewogICAgICBpZiAoKHMgLT0gZSkgPiByIHx8IHMgPCAtcikgcmV0dXJuIDA7CiAgICAgIHZhciBsID0gTWF0aC5zcXJ0KHIgKiByIC0gcyAqIHMpOwogICAgICBTWzBdID0gLWwsIFNbMV0gPSBsOwogICAgICB2YXIgaCA9IE1hdGguYWJzKG4gLSBpKTsKICAgICAgaWYgKGggPCAxZS00KSByZXR1cm4gMDsKCiAgICAgIGlmIChoICUgXyA8IDFlLTQpIHsKICAgICAgICBuID0gMCwgaSA9IF87CiAgICAgICAgdmFyIHUgPSBhID8gMSA6IC0xOwogICAgICAgIHJldHVybiBvID49IFNbMF0gKyB0ICYmIG8gPD0gU1sxXSArIHQgPyB1IDogMDsKICAgICAgfQoKICAgICAgaWYgKGEpIHsKICAgICAgICB2YXIgbCA9IG47CiAgICAgICAgbiA9IG0oaSksIGkgPSBtKGwpOwogICAgICB9IGVsc2UgbiA9IG0obiksIGkgPSBtKGkpOwoKICAgICAgbiA+IGkgJiYgKGkgKz0gXyk7CgogICAgICBmb3IgKHZhciBjID0gMCwgZiA9IDA7IGYgPCAyOyBmKyspIHsKICAgICAgICB2YXIgZCA9IFNbZl07CgogICAgICAgIGlmIChkICsgdCA+IG8pIHsKICAgICAgICAgIHZhciB2ID0gTWF0aC5hdGFuMihzLCBkKSwKICAgICAgICAgICAgICB1ID0gYSA/IDEgOiAtMTsKICAgICAgICAgIHYgPCAwICYmICh2ID0gXyArIHYpLCAodiA+PSBuICYmIHYgPD0gaSB8fCB2ICsgXyA+PSBuICYmIHYgKyBfIDw9IGkpICYmICh2ID4gTWF0aC5QSSAvIDIgJiYgdiA8IDEuNSAqIE1hdGguUEkgJiYgKHUgPSAtdSksIGMgKz0gdSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQsIGUsIHIsIGksIGwpIHsKICAgICAgZm9yICh2YXIgaCA9IDAsIHUgPSAwLCBjID0gMCwgcCA9IDAsIG0gPSAwLCB4ID0gMDsgeCA8IHQubGVuZ3RoOykgewogICAgICAgIHZhciBfID0gdFt4KytdOwoKICAgICAgICBzd2l0Y2ggKF8gPT09IHcuTSAmJiB4ID4gMSAmJiAociB8fCAoaCArPSB5KHUsIGMsIHAsIG0sIGksIGwpKSksIDEgPT0geCAmJiAodSA9IHRbeF0sIGMgPSB0W3ggKyAxXSwgcCA9IHUsIG0gPSBjKSwgXykgewogICAgICAgICAgY2FzZSB3Lk06CiAgICAgICAgICAgIHAgPSB0W3grK10sIG0gPSB0W3grK10sIHUgPSBwLCBjID0gbTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSB3Lkw6CiAgICAgICAgICAgIGlmIChyKSB7CiAgICAgICAgICAgICAgaWYgKGYuY29udGFpblN0cm9rZSh1LCBjLCB0W3hdLCB0W3ggKyAxXSwgZSwgaSwgbCkpIHJldHVybiAhMDsKICAgICAgICAgICAgfSBlbHNlIGggKz0geSh1LCBjLCB0W3hdLCB0W3ggKyAxXSwgaSwgbCkgfHwgMDsKCiAgICAgICAgICAgIHUgPSB0W3grK10sIGMgPSB0W3grK107CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2Ugdy5DOgogICAgICAgICAgICBpZiAocikgewogICAgICAgICAgICAgIGlmIChkLmNvbnRhaW5TdHJva2UodSwgYywgdFt4KytdLCB0W3grK10sIHRbeCsrXSwgdFt4KytdLCB0W3hdLCB0W3ggKyAxXSwgZSwgaSwgbCkpIHJldHVybiAhMDsKICAgICAgICAgICAgfSBlbHNlIGggKz0gYSh1LCBjLCB0W3grK10sIHRbeCsrXSwgdFt4KytdLCB0W3grK10sIHRbeF0sIHRbeCArIDFdLCBpLCBsKSB8fCAwOwoKICAgICAgICAgICAgdSA9IHRbeCsrXSwgYyA9IHRbeCsrXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSB3LlE6CiAgICAgICAgICAgIGlmIChyKSB7CiAgICAgICAgICAgICAgaWYgKHYuY29udGFpblN0cm9rZSh1LCBjLCB0W3grK10sIHRbeCsrXSwgdFt4XSwgdFt4ICsgMV0sIGUsIGksIGwpKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0gZWxzZSBoICs9IG8odSwgYywgdFt4KytdLCB0W3grK10sIHRbeF0sIHRbeCArIDFdLCBpLCBsKSB8fCAwOwoKICAgICAgICAgICAgdSA9IHRbeCsrXSwgYyA9IHRbeCsrXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSB3LkE6CiAgICAgICAgICAgIHZhciBiID0gdFt4KytdLAogICAgICAgICAgICAgICAgUyA9IHRbeCsrXSwKICAgICAgICAgICAgICAgIE0gPSB0W3grK10sCiAgICAgICAgICAgICAgICBUID0gdFt4KytdLAogICAgICAgICAgICAgICAgayA9IHRbeCsrXSwKICAgICAgICAgICAgICAgIEMgPSB0W3grK10sCiAgICAgICAgICAgICAgICBQID0gKHRbeCsrXSwgMSAtIHRbeCsrXSksCiAgICAgICAgICAgICAgICBJID0gTWF0aC5jb3MoaykgKiBNICsgYiwKICAgICAgICAgICAgICAgIEEgPSBNYXRoLnNpbihrKSAqIFQgKyBTOwogICAgICAgICAgICB4ID4gMSA/IGggKz0geSh1LCBjLCBJLCBBLCBpLCBsKSA6IChwID0gSSwgbSA9IEEpOwogICAgICAgICAgICB2YXIgTyA9IChpIC0gYikgKiBUIC8gTSArIGI7CgogICAgICAgICAgICBpZiAocikgewogICAgICAgICAgICAgIGlmIChnLmNvbnRhaW5TdHJva2UoYiwgUywgVCwgaywgayArIEMsIFAsIGUsIE8sIGwpKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0gZWxzZSBoICs9IHMoYiwgUywgVCwgaywgayArIEMsIFAsIE8sIGwpOwoKICAgICAgICAgICAgdSA9IE1hdGguY29zKGsgKyBDKSAqIE0gKyBiLCBjID0gTWF0aC5zaW4oayArIEMpICogVCArIFM7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2Ugdy5SOgogICAgICAgICAgICBwID0gdSA9IHRbeCsrXSwgbSA9IGMgPSB0W3grK107CiAgICAgICAgICAgIHZhciBEID0gdFt4KytdLAogICAgICAgICAgICAgICAgTCA9IHRbeCsrXSwKICAgICAgICAgICAgICAgIEkgPSBwICsgRCwKICAgICAgICAgICAgICAgIEEgPSBtICsgTDsKCiAgICAgICAgICAgIGlmIChyKSB7CiAgICAgICAgICAgICAgaWYgKGYuY29udGFpblN0cm9rZShwLCBtLCBJLCBtLCBlLCBpLCBsKSB8fCBmLmNvbnRhaW5TdHJva2UoSSwgbSwgSSwgQSwgZSwgaSwgbCkgfHwgZi5jb250YWluU3Ryb2tlKEksIEEsIHAsIEEsIGUsIGksIGwpIHx8IGYuY29udGFpblN0cm9rZShwLCBBLCBwLCBtLCBlLCBpLCBsKSkgcmV0dXJuICEwOwogICAgICAgICAgICB9IGVsc2UgaCArPSB5KEksIG0sIEksIEEsIGksIGwpLCBoICs9IHkocCwgQSwgcCwgbSwgaSwgbCk7CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIHcuWjoKICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICBpZiAoZi5jb250YWluU3Ryb2tlKHUsIGMsIHAsIG0sIGUsIGksIGwpKSByZXR1cm4gITA7CiAgICAgICAgICAgIH0gZWxzZSBoICs9IHkodSwgYywgcCwgbSwgaSwgbCk7CgogICAgICAgICAgICB1ID0gcCwgYyA9IG07CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gciB8fCBuKGMsIG0pIHx8IChoICs9IHkodSwgYywgcCwgbSwgaSwgbCkgfHwgMCksIDAgIT09IGg7CiAgICB9CgogICAgZnVuY3Rpb24gaCh0LCBlLCByKSB7CiAgICAgIHJldHVybiBsKHQsIDAsICExLCBlLCByKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1KHQsIGUsIHIsIG4pIHsKICAgICAgcmV0dXJuIGwodCwgZSwgITAsIHIsIG4pOwogICAgfQoKICAgIHZhciBjID0gcig2KSwKICAgICAgICBmID0gcig1MSksCiAgICAgICAgZCA9IHIoNTIpLAogICAgICAgIHYgPSByKDUzKSwKICAgICAgICBnID0gcig1NCksCiAgICAgICAgcCA9IHIoMjIpLAogICAgICAgIG0gPSBwLm5vcm1hbGl6ZVJhZGlhbiwKICAgICAgICB4ID0gcig0KSwKICAgICAgICB5ID0gcig1NSksCiAgICAgICAgdyA9IGMuQ01ELAogICAgICAgIF8gPSAyICogTWF0aC5QSSwKICAgICAgICBiID0gMWUtNCwKICAgICAgICBTID0gWy0xLCAtMSwgLTFdLAogICAgICAgIE0gPSBbLTEsIC0xXTsKCiAgICBlLmNvbnRhaW4gPSBoLCBlLmNvbnRhaW5TdHJva2UgPSB1OwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICBmdW5jdGlvbiByKHQsIGUsIHIsIG4sIGksIGEsIG8pIHsKICAgICAgaWYgKDAgPT09IGkpIHJldHVybiAhMTsKICAgICAgdmFyIHMgPSBpLAogICAgICAgICAgbCA9IDAsCiAgICAgICAgICBoID0gdDsKICAgICAgaWYgKG8gPiBlICsgcyAmJiBvID4gbiArIHMgfHwgbyA8IGUgLSBzICYmIG8gPCBuIC0gcyB8fCBhID4gdCArIHMgJiYgYSA+IHIgKyBzIHx8IGEgPCB0IC0gcyAmJiBhIDwgciAtIHMpIHJldHVybiAhMTsKICAgICAgaWYgKHQgPT09IHIpIHJldHVybiBNYXRoLmFicyhhIC0gdCkgPD0gcyAvIDI7CiAgICAgIGwgPSAoZSAtIG4pIC8gKHQgLSByKSwgaCA9ICh0ICogbiAtIHIgKiBlKSAvICh0IC0gcik7CiAgICAgIHZhciB1ID0gbCAqIGEgLSBvICsgaDsKICAgICAgcmV0dXJuIHUgKiB1IC8gKGwgKiBsICsgMSkgPD0gcyAvIDIgKiBzIC8gMjsKICAgIH0KCiAgICBlLmNvbnRhaW5TdHJva2UgPSByOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUsIHIsIG4sIGEsIG8sIHMsIGwsIGgsIHUsIGMpIHsKICAgICAgaWYgKDAgPT09IGgpIHJldHVybiAhMTsKICAgICAgdmFyIGYgPSBoOwogICAgICByZXR1cm4gIShjID4gZSArIGYgJiYgYyA+IG4gKyBmICYmIGMgPiBvICsgZiAmJiBjID4gbCArIGYgfHwgYyA8IGUgLSBmICYmIGMgPCBuIC0gZiAmJiBjIDwgbyAtIGYgJiYgYyA8IGwgLSBmIHx8IHUgPiB0ICsgZiAmJiB1ID4gciArIGYgJiYgdSA+IGEgKyBmICYmIHUgPiBzICsgZiB8fCB1IDwgdCAtIGYgJiYgdSA8IHIgLSBmICYmIHUgPCBhIC0gZiAmJiB1IDwgcyAtIGYpICYmIGkuY3ViaWNQcm9qZWN0UG9pbnQodCwgZSwgciwgbiwgYSwgbywgcywgbCwgdSwgYywgbnVsbCkgPD0gZiAvIDI7CiAgICB9CgogICAgdmFyIGkgPSByKDQpOwogICAgZS5jb250YWluU3Ryb2tlID0gbjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0LCBlLCByLCBuLCBpLCBvLCBzLCBsLCBoKSB7CiAgICAgIGlmICgwID09PSBzKSByZXR1cm4gITE7CiAgICAgIHZhciB1ID0gczsKICAgICAgcmV0dXJuICEoaCA+IGUgKyB1ICYmIGggPiBuICsgdSAmJiBoID4gbyArIHUgfHwgaCA8IGUgLSB1ICYmIGggPCBuIC0gdSAmJiBoIDwgbyAtIHUgfHwgbCA+IHQgKyB1ICYmIGwgPiByICsgdSAmJiBsID4gaSArIHUgfHwgbCA8IHQgLSB1ICYmIGwgPCByIC0gdSAmJiBsIDwgaSAtIHUpICYmIGEodCwgZSwgciwgbiwgaSwgbywgbCwgaCwgbnVsbCkgPD0gdSAvIDI7CiAgICB9CgogICAgdmFyIGkgPSByKDQpLAogICAgICAgIGEgPSBpLnF1YWRyYXRpY1Byb2plY3RQb2ludDsKICAgIGUuY29udGFpblN0cm9rZSA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgciwgbiwgaSwgcywgbCwgaCwgdSkgewogICAgICBpZiAoMCA9PT0gbCkgcmV0dXJuICExOwogICAgICB2YXIgYyA9IGw7CiAgICAgIGggLT0gdCwgdSAtPSBlOwogICAgICB2YXIgZiA9IE1hdGguc3FydChoICogaCArIHUgKiB1KTsKICAgICAgaWYgKGYgLSBjID4gciB8fCBmICsgYyA8IHIpIHJldHVybiAhMTsKICAgICAgaWYgKE1hdGguYWJzKG4gLSBpKSAlIG8gPCAxZS00KSByZXR1cm4gITA7CgogICAgICBpZiAocykgewogICAgICAgIHZhciBkID0gbjsKICAgICAgICBuID0gYShpKSwgaSA9IGEoZCk7CiAgICAgIH0gZWxzZSBuID0gYShuKSwgaSA9IGEoaSk7CgogICAgICBuID4gaSAmJiAoaSArPSBvKTsKICAgICAgdmFyIHYgPSBNYXRoLmF0YW4yKHUsIGgpOwogICAgICByZXR1cm4gdiA8IDAgJiYgKHYgKz0gbyksIHYgPj0gbiAmJiB2IDw9IGkgfHwgdiArIG8gPj0gbiAmJiB2ICsgbyA8PSBpOwogICAgfQoKICAgIHZhciBpID0gcigyMiksCiAgICAgICAgYSA9IGkubm9ybWFsaXplUmFkaWFuLAogICAgICAgIG8gPSAyICogTWF0aC5QSTsKICAgIGUuY29udGFpblN0cm9rZSA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIGZ1bmN0aW9uIHIodCwgZSwgciwgbiwgaSwgYSkgewogICAgICBpZiAoYSA+IGUgJiYgYSA+IG4gfHwgYSA8IGUgJiYgYSA8IG4pIHJldHVybiAwOwogICAgICBpZiAobiA9PT0gZSkgcmV0dXJuIDA7CiAgICAgIHZhciBvID0gbiA8IGUgPyAxIDogLTEsCiAgICAgICAgICBzID0gKGEgLSBlKSAvIChuIC0gZSk7CiAgICAgIHJldHVybiAxICE9PSBzICYmIDAgIT09IHMgfHwgKG8gPSBuIDwgZSA/IC41IDogLS41KSwgcyAqIChyIC0gdCkgKyB0ID4gaSA/IG8gOiAwOwogICAgfQoKICAgIHQuZXhwb3J0cyA9IHI7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHZhciByID0gZnVuY3Rpb24gcih0LCBlKSB7CiAgICAgIHRoaXMuaW1hZ2UgPSB0LCB0aGlzLnJlcGVhdCA9IGUsIHRoaXMudHlwZSA9ICJwYXR0ZXJuIjsKICAgIH07CgogICAgci5wcm90b3R5cGUuZ2V0Q2FudmFzUGF0dGVybiA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0LmNyZWF0ZVBhdHRlcm4odGhpcy5pbWFnZSwgdGhpcy5yZXBlYXQgfHwgInJlcGVhdCIpOwogICAgfTsKCiAgICB2YXIgbiA9IHI7CiAgICB0LmV4cG9ydHMgPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQsIGUpIHsKICAgICAgdmFyIHIsCiAgICAgICAgICBuLAogICAgICAgICAgaSwKICAgICAgICAgIGEsCiAgICAgICAgICBjLAogICAgICAgICAgZiwKICAgICAgICAgIGQgPSB0LmRhdGEsCiAgICAgICAgICB2ID0gcy5NLAogICAgICAgICAgZyA9IHMuQywKICAgICAgICAgIHAgPSBzLkwsCiAgICAgICAgICBtID0gcy5SLAogICAgICAgICAgeCA9IHMuQSwKICAgICAgICAgIHkgPSBzLlE7CgogICAgICBmb3IgKGkgPSAwLCBhID0gMDsgaSA8IGQubGVuZ3RoOykgewogICAgICAgIHN3aXRjaCAociA9IGRbaSsrXSwgYSA9IGksIG4gPSAwLCByKSB7CiAgICAgICAgICBjYXNlIHY6CiAgICAgICAgICBjYXNlIHA6CiAgICAgICAgICAgIG4gPSAxOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIGc6CiAgICAgICAgICAgIG4gPSAzOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIHk6CiAgICAgICAgICAgIG4gPSAyOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIHg6CiAgICAgICAgICAgIHZhciB3ID0gZVs0XSwKICAgICAgICAgICAgICAgIF8gPSBlWzVdLAogICAgICAgICAgICAgICAgYiA9IGgoZVswXSAqIGVbMF0gKyBlWzFdICogZVsxXSksCiAgICAgICAgICAgICAgICBTID0gaChlWzJdICogZVsyXSArIGVbM10gKiBlWzNdKSwKICAgICAgICAgICAgICAgIE0gPSB1KC1lWzFdIC8gUywgZVswXSAvIGIpOwogICAgICAgICAgICBkW2ldICo9IGIsIGRbaSsrXSArPSB3LCBkW2ldICo9IFMsIGRbaSsrXSArPSBfLCBkW2krK10gKj0gYiwgZFtpKytdICo9IFMsIGRbaSsrXSArPSBNLCBkW2krK10gKz0gTSwgaSArPSAyLCBhID0gaTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBtOgogICAgICAgICAgICBmWzBdID0gZFtpKytdLCBmWzFdID0gZFtpKytdLCBvKGYsIGYsIGUpLCBkW2ErK10gPSBmWzBdLCBkW2ErK10gPSBmWzFdLCBmWzBdICs9IGRbaSsrXSwgZlsxXSArPSBkW2krK10sIG8oZiwgZiwgZSksIGRbYSsrXSA9IGZbMF0sIGRbYSsrXSA9IGZbMV07CiAgICAgICAgfQoKICAgICAgICBmb3IgKGMgPSAwOyBjIDwgbjsgYysrKSB7CiAgICAgICAgICB2YXIgZiA9IGxbY107CiAgICAgICAgICBmWzBdID0gZFtpKytdLCBmWzFdID0gZFtpKytdLCBvKGYsIGYsIGUpLCBkW2ErK10gPSBmWzBdLCBkW2ErK10gPSBmWzFdOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHZhciBpID0gcig2KSwKICAgICAgICBhID0gcigyKSwKICAgICAgICBvID0gYS5hcHBseVRyYW5zZm9ybSwKICAgICAgICBzID0gaS5DTUQsCiAgICAgICAgbCA9IFtbXSwgW10sIFtdXSwKICAgICAgICBoID0gTWF0aC5zcXJ0LAogICAgICAgIHUgPSBNYXRoLmF0YW4yOwogICAgdC5leHBvcnRzID0gbjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIGkuY2FsbCh0aGlzLCB0KTsKICAgIH0KCiAgICB2YXIgaSA9IHIoMTIpLAogICAgICAgIGEgPSByKDMpLAogICAgICAgIG8gPSByKDApLAogICAgICAgIHMgPSByKDEwKTsKICAgIG4ucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogbiwKICAgICAgdHlwZTogImltYWdlIiwKICAgICAgYnJ1c2g6IGZ1bmN0aW9uIGJydXNoKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHRoaXMuc3R5bGUsCiAgICAgICAgICAgIG4gPSByLmltYWdlOwogICAgICAgIHIuYmluZCh0LCB0aGlzLCBlKTsKICAgICAgICB2YXIgaSA9IHRoaXMuX2ltYWdlID0gcy5jcmVhdGVPclVwZGF0ZUltYWdlKG4sIHRoaXMuX2ltYWdlLCB0aGlzLCB0aGlzLm9ubG9hZCk7CgogICAgICAgIGlmIChpICYmIHMuaXNJbWFnZVJlYWR5KGkpKSB7CiAgICAgICAgICB2YXIgYSA9IHIueCB8fCAwLAogICAgICAgICAgICAgIG8gPSByLnkgfHwgMCwKICAgICAgICAgICAgICBsID0gci53aWR0aCwKICAgICAgICAgICAgICBoID0gci5oZWlnaHQsCiAgICAgICAgICAgICAgdSA9IGkud2lkdGggLyBpLmhlaWdodDsKCiAgICAgICAgICBpZiAobnVsbCA9PSBsICYmIG51bGwgIT0gaCA/IGwgPSBoICogdSA6IG51bGwgPT0gaCAmJiBudWxsICE9IGwgPyBoID0gbCAvIHUgOiBudWxsID09IGwgJiYgbnVsbCA9PSBoICYmIChsID0gaS53aWR0aCwgaCA9IGkuaGVpZ2h0KSwgdGhpcy5zZXRUcmFuc2Zvcm0odCksIHIuc1dpZHRoICYmIHIuc0hlaWdodCkgewogICAgICAgICAgICB2YXIgYyA9IHIuc3ggfHwgMCwKICAgICAgICAgICAgICAgIGYgPSByLnN5IHx8IDA7CiAgICAgICAgICAgIHQuZHJhd0ltYWdlKGksIGMsIGYsIHIuc1dpZHRoLCByLnNIZWlnaHQsIGEsIG8sIGwsIGgpOwogICAgICAgICAgfSBlbHNlIGlmIChyLnN4ICYmIHIuc3kpIHsKICAgICAgICAgICAgdmFyIGMgPSByLnN4LAogICAgICAgICAgICAgICAgZiA9IHIuc3ksCiAgICAgICAgICAgICAgICBkID0gbCAtIGMsCiAgICAgICAgICAgICAgICB2ID0gaCAtIGY7CiAgICAgICAgICAgIHQuZHJhd0ltYWdlKGksIGMsIGYsIGQsIHYsIGEsIG8sIGwsIGgpOwogICAgICAgICAgfSBlbHNlIHQuZHJhd0ltYWdlKGksIGEsIG8sIGwsIGgpOwoKICAgICAgICAgIHRoaXMucmVzdG9yZVRyYW5zZm9ybSh0KSwgbnVsbCAhPSByLnRleHQgJiYgdGhpcy5kcmF3UmVjdFRleHQodCwgdGhpcy5nZXRCb3VuZGluZ1JlY3QoKSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBnZXRCb3VuZGluZ1JlY3Q6IGZ1bmN0aW9uIGdldEJvdW5kaW5nUmVjdCgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuc3R5bGU7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlY3QgfHwgKHRoaXMuX3JlY3QgPSBuZXcgYSh0LnggfHwgMCwgdC55IHx8IDAsIHQud2lkdGggfHwgMCwgdC5oZWlnaHQgfHwgMCkpLCB0aGlzLl9yZWN0OwogICAgICB9CiAgICB9LCBvLmluaGVyaXRzKG4sIGkpOwogICAgdmFyIGwgPSBuOwogICAgdC5leHBvcnRzID0gbDsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDApLAogICAgICAgIGkgPSByKDE2KSwKICAgICAgICBhID0gcigzKSwKICAgICAgICBvID0gZnVuY3Rpb24gbyh0KSB7CiAgICAgIHQgPSB0IHx8IHt9LCBpLmNhbGwodGhpcywgdCk7CgogICAgICBmb3IgKHZhciBlIGluIHQpIHsKICAgICAgICB0Lmhhc093blByb3BlcnR5KGUpICYmICh0aGlzW2VdID0gdFtlXSk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2NoaWxkcmVuID0gW10sIHRoaXMuX19zdG9yYWdlID0gbnVsbCwgdGhpcy5fX2RpcnR5ID0gITA7CiAgICB9OwoKICAgIG8ucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogbywKICAgICAgaXNHcm91cDogITAsCiAgICAgIHR5cGU6ICJncm91cCIsCiAgICAgIHNpbGVudDogITEsCiAgICAgIGNoaWxkcmVuOiBmdW5jdGlvbiBjaGlsZHJlbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4uc2xpY2UoKTsKICAgICAgfSwKICAgICAgY2hpbGRBdDogZnVuY3Rpb24gY2hpbGRBdCh0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuW3RdOwogICAgICB9LAogICAgICBjaGlsZE9mTmFtZTogZnVuY3Rpb24gY2hpbGRPZk5hbWUodCkgewogICAgICAgIGZvciAodmFyIGUgPSB0aGlzLl9jaGlsZHJlbiwgciA9IDA7IHIgPCBlLmxlbmd0aDsgcisrKSB7CiAgICAgICAgICBpZiAoZVtyXS5uYW1lID09PSB0KSByZXR1cm4gZVtyXTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNoaWxkQ291bnQ6IGZ1bmN0aW9uIGNoaWxkQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsKICAgICAgfSwKICAgICAgYWRkOiBmdW5jdGlvbiBhZGQodCkgewogICAgICAgIHJldHVybiB0ICYmIHQgIT09IHRoaXMgJiYgdC5wYXJlbnQgIT09IHRoaXMgJiYgKHRoaXMuX2NoaWxkcmVuLnB1c2godCksIHRoaXMuX2RvQWRkKHQpKSwgdGhpczsKICAgICAgfSwKICAgICAgYWRkQmVmb3JlOiBmdW5jdGlvbiBhZGRCZWZvcmUodCwgZSkgewogICAgICAgIGlmICh0ICYmIHQgIT09IHRoaXMgJiYgdC5wYXJlbnQgIT09IHRoaXMgJiYgZSAmJiBlLnBhcmVudCA9PT0gdGhpcykgewogICAgICAgICAgdmFyIHIgPSB0aGlzLl9jaGlsZHJlbiwKICAgICAgICAgICAgICBuID0gci5pbmRleE9mKGUpOwogICAgICAgICAgbiA+PSAwICYmIChyLnNwbGljZShuLCAwLCB0KSwgdGhpcy5fZG9BZGQodCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIF9kb0FkZDogZnVuY3Rpb24gX2RvQWRkKHQpIHsKICAgICAgICB0LnBhcmVudCAmJiB0LnBhcmVudC5yZW1vdmUodCksIHQucGFyZW50ID0gdGhpczsKICAgICAgICB2YXIgZSA9IHRoaXMuX19zdG9yYWdlLAogICAgICAgICAgICByID0gdGhpcy5fX3pyOwogICAgICAgIGUgJiYgZSAhPT0gdC5fX3N0b3JhZ2UgJiYgKGUuYWRkVG9TdG9yYWdlKHQpLCB0IGluc3RhbmNlb2YgbyAmJiB0LmFkZENoaWxkcmVuVG9TdG9yYWdlKGUpKSwgciAmJiByLnJlZnJlc2goKTsKICAgICAgfSwKICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUodCkgewogICAgICAgIHZhciBlID0gdGhpcy5fX3pyLAogICAgICAgICAgICByID0gdGhpcy5fX3N0b3JhZ2UsCiAgICAgICAgICAgIGkgPSB0aGlzLl9jaGlsZHJlbiwKICAgICAgICAgICAgYSA9IG4uaW5kZXhPZihpLCB0KTsKICAgICAgICByZXR1cm4gYSA8IDAgPyB0aGlzIDogKGkuc3BsaWNlKGEsIDEpLCB0LnBhcmVudCA9IG51bGwsIHIgJiYgKHIuZGVsRnJvbVN0b3JhZ2UodCksIHQgaW5zdGFuY2VvZiBvICYmIHQuZGVsQ2hpbGRyZW5Gcm9tU3RvcmFnZShyKSksIGUgJiYgZS5yZWZyZXNoKCksIHRoaXMpOwogICAgICB9LAogICAgICByZW1vdmVBbGw6IGZ1bmN0aW9uIHJlbW92ZUFsbCgpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgZSwKICAgICAgICAgICAgciA9IHRoaXMuX2NoaWxkcmVuLAogICAgICAgICAgICBuID0gdGhpcy5fX3N0b3JhZ2U7CgogICAgICAgIGZvciAoZSA9IDA7IGUgPCByLmxlbmd0aDsgZSsrKSB7CiAgICAgICAgICB0ID0gcltlXSwgbiAmJiAobi5kZWxGcm9tU3RvcmFnZSh0KSwgdCBpbnN0YW5jZW9mIG8gJiYgdC5kZWxDaGlsZHJlbkZyb21TdG9yYWdlKG4pKSwgdC5wYXJlbnQgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHIubGVuZ3RoID0gMCwgdGhpczsKICAgICAgfSwKICAgICAgZWFjaENoaWxkOiBmdW5jdGlvbiBlYWNoQ2hpbGQodCwgZSkgewogICAgICAgIGZvciAodmFyIHIgPSB0aGlzLl9jaGlsZHJlbiwgbiA9IDA7IG4gPCByLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICB2YXIgaSA9IHJbbl07CiAgICAgICAgICB0LmNhbGwoZSwgaSwgbik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgdHJhdmVyc2U6IGZ1bmN0aW9uIHRyYXZlcnNlKHQsIGUpIHsKICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IHRoaXMuX2NoaWxkcmVuLmxlbmd0aDsgcisrKSB7CiAgICAgICAgICB2YXIgbiA9IHRoaXMuX2NoaWxkcmVuW3JdOwogICAgICAgICAgdC5jYWxsKGUsIG4pLCAiZ3JvdXAiID09PSBuLnR5cGUgJiYgbi50cmF2ZXJzZSh0LCBlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBhZGRDaGlsZHJlblRvU3RvcmFnZTogZnVuY3Rpb24gYWRkQ2hpbGRyZW5Ub1N0b3JhZ2UodCkgewogICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdGhpcy5fY2hpbGRyZW4ubGVuZ3RoOyBlKyspIHsKICAgICAgICAgIHZhciByID0gdGhpcy5fY2hpbGRyZW5bZV07CiAgICAgICAgICB0LmFkZFRvU3RvcmFnZShyKSwgciBpbnN0YW5jZW9mIG8gJiYgci5hZGRDaGlsZHJlblRvU3RvcmFnZSh0KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlbENoaWxkcmVuRnJvbVN0b3JhZ2U6IGZ1bmN0aW9uIGRlbENoaWxkcmVuRnJvbVN0b3JhZ2UodCkgewogICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdGhpcy5fY2hpbGRyZW4ubGVuZ3RoOyBlKyspIHsKICAgICAgICAgIHZhciByID0gdGhpcy5fY2hpbGRyZW5bZV07CiAgICAgICAgICB0LmRlbEZyb21TdG9yYWdlKHIpLCByIGluc3RhbmNlb2YgbyAmJiByLmRlbENoaWxkcmVuRnJvbVN0b3JhZ2UodCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkaXJ0eTogZnVuY3Rpb24gZGlydHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX19kaXJ0eSA9ICEwLCB0aGlzLl9fenIgJiYgdGhpcy5fX3pyLnJlZnJlc2goKSwgdGhpczsKICAgICAgfSwKICAgICAgZ2V0Qm91bmRpbmdSZWN0OiBmdW5jdGlvbiBnZXRCb3VuZGluZ1JlY3QodCkgewogICAgICAgIGZvciAodmFyIGUgPSBudWxsLCByID0gbmV3IGEoMCwgMCwgMCwgMCksIG4gPSB0IHx8IHRoaXMuX2NoaWxkcmVuLCBpID0gW10sIG8gPSAwOyBvIDwgbi5sZW5ndGg7IG8rKykgewogICAgICAgICAgdmFyIHMgPSBuW29dOwoKICAgICAgICAgIGlmICghcy5pZ25vcmUgJiYgIXMuaW52aXNpYmxlKSB7CiAgICAgICAgICAgIHZhciBsID0gcy5nZXRCb3VuZGluZ1JlY3QoKSwKICAgICAgICAgICAgICAgIGggPSBzLmdldExvY2FsVHJhbnNmb3JtKGkpOwogICAgICAgICAgICBoID8gKHIuY29weShsKSwgci5hcHBseVRyYW5zZm9ybShoKSwgZSA9IGUgfHwgci5jbG9uZSgpLCBlLnVuaW9uKHIpKSA6IChlID0gZSB8fCBsLmNsb25lKCksIGUudW5pb24obCkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGUgfHwgcjsKICAgICAgfQogICAgfSwgbi5pbmhlcml0cyhvLCBpKTsKICAgIHZhciBzID0gbzsKICAgIHQuZXhwb3J0cyA9IHM7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxMiksCiAgICAgICAgaSA9IHIoMCksCiAgICAgICAgYSA9IHIoNSksCiAgICAgICAgbyA9IHIoMjApLAogICAgICAgIHMgPSBmdW5jdGlvbiBzKHQpIHsKICAgICAgbi5jYWxsKHRoaXMsIHQpOwogICAgfTsKCiAgICBzLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IHMsCiAgICAgIHR5cGU6ICJ0ZXh0IiwKICAgICAgYnJ1c2g6IGZ1bmN0aW9uIGJydXNoKHQsIGUpIHsKICAgICAgICB2YXIgciA9IHRoaXMuc3R5bGU7CiAgICAgICAgdGhpcy5fX2RpcnR5ICYmIG8ubm9ybWFsaXplVGV4dFN0eWxlKHIsICEwKSwgci5maWxsID0gci5zdHJva2UgPSByLnNoYWRvd0JsdXIgPSByLnNoYWRvd0NvbG9yID0gci5zaGFkb3dPZmZzZXRYID0gci5zaGFkb3dPZmZzZXRZID0gbnVsbDsKICAgICAgICB2YXIgbiA9IHIudGV4dDsKICAgICAgICBudWxsICE9IG4gJiYgKG4gKz0gIiIpLCByLmJpbmQodCwgdGhpcywgZSksIG8ubmVlZERyYXdUZXh0KG4sIHIpICYmICh0aGlzLnNldFRyYW5zZm9ybSh0KSwgby5yZW5kZXJUZXh0KHRoaXMsIHQsIG4sIHIpLCB0aGlzLnJlc3RvcmVUcmFuc2Zvcm0odCkpOwogICAgICB9LAogICAgICBnZXRCb3VuZGluZ1JlY3Q6IGZ1bmN0aW9uIGdldEJvdW5kaW5nUmVjdCgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMuc3R5bGU7CgogICAgICAgIGlmICh0aGlzLl9fZGlydHkgJiYgby5ub3JtYWxpemVUZXh0U3R5bGUodCwgITApLCAhdGhpcy5fcmVjdCkgewogICAgICAgICAgdmFyIGUgPSB0LnRleHQ7CiAgICAgICAgICBudWxsICE9IGUgPyBlICs9ICIiIDogZSA9ICIiOwogICAgICAgICAgdmFyIHIgPSBhLmdldEJvdW5kaW5nUmVjdCh0LnRleHQgKyAiIiwgdC5mb250LCB0LnRleHRBbGlnbiwgdC50ZXh0VmVydGljYWxBbGlnbiwgdC50ZXh0UGFkZGluZywgdC5yaWNoKTsKCiAgICAgICAgICBpZiAoci54ICs9IHQueCB8fCAwLCByLnkgKz0gdC55IHx8IDAsIG8uZ2V0U3Ryb2tlKHQudGV4dFN0cm9rZSwgdC50ZXh0U3Ryb2tlV2lkdGgpKSB7CiAgICAgICAgICAgIHZhciBuID0gdC50ZXh0U3Ryb2tlV2lkdGg7CiAgICAgICAgICAgIHIueCAtPSBuIC8gMiwgci55IC09IG4gLyAyLCByLndpZHRoICs9IG4sIHIuaGVpZ2h0ICs9IG47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fcmVjdCA9IHI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy5fcmVjdDsKICAgICAgfQogICAgfSwgaS5pbmhlcml0cyhzLCBuKTsKICAgIHZhciBsID0gczsKICAgIHQuZXhwb3J0cyA9IGw7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxKSwKICAgICAgICBpID0gbi5leHRlbmQoewogICAgICB0eXBlOiAiY2lyY2xlIiwKICAgICAgc2hhcGU6IHsKICAgICAgICBjeDogMCwKICAgICAgICBjeTogMCwKICAgICAgICByOiAwCiAgICAgIH0sCiAgICAgIGJ1aWxkUGF0aDogZnVuY3Rpb24gYnVpbGRQYXRoKHQsIGUsIHIpIHsKICAgICAgICByICYmIHQubW92ZVRvKGUuY3ggKyBlLnIsIGUuY3kpLCB0LmFyYyhlLmN4LCBlLmN5LCBlLnIsIDAsIDIgKiBNYXRoLlBJLCAhMCk7CiAgICAgIH0KICAgIH0pOwogICAgdC5leHBvcnRzID0gaTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDEpLAogICAgICAgIGkgPSByKDYzKSwKICAgICAgICBhID0gbi5leHRlbmQoewogICAgICB0eXBlOiAic2VjdG9yIiwKICAgICAgc2hhcGU6IHsKICAgICAgICBjeDogMCwKICAgICAgICBjeTogMCwKICAgICAgICByMDogMCwKICAgICAgICByOiAwLAogICAgICAgIHN0YXJ0QW5nbGU6IDAsCiAgICAgICAgZW5kQW5nbGU6IDIgKiBNYXRoLlBJLAogICAgICAgIGNsb2Nrd2lzZTogITAKICAgICAgfSwKICAgICAgYnJ1c2g6IGkobi5wcm90b3R5cGUuYnJ1c2gpLAogICAgICBidWlsZFBhdGg6IGZ1bmN0aW9uIGJ1aWxkUGF0aCh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSBlLmN4LAogICAgICAgICAgICBuID0gZS5jeSwKICAgICAgICAgICAgaSA9IE1hdGgubWF4KGUucjAgfHwgMCwgMCksCiAgICAgICAgICAgIGEgPSBNYXRoLm1heChlLnIsIDApLAogICAgICAgICAgICBvID0gZS5zdGFydEFuZ2xlLAogICAgICAgICAgICBzID0gZS5lbmRBbmdsZSwKICAgICAgICAgICAgbCA9IGUuY2xvY2t3aXNlLAogICAgICAgICAgICBoID0gTWF0aC5jb3MobyksCiAgICAgICAgICAgIHUgPSBNYXRoLnNpbihvKTsKICAgICAgICB0Lm1vdmVUbyhoICogaSArIHIsIHUgKiBpICsgbiksIHQubGluZVRvKGggKiBhICsgciwgdSAqIGEgKyBuKSwgdC5hcmMociwgbiwgYSwgbywgcywgIWwpLCB0LmxpbmVUbyhNYXRoLmNvcyhzKSAqIGkgKyByLCBNYXRoLnNpbihzKSAqIGkgKyBuKSwgMCAhPT0gaSAmJiB0LmFyYyhyLCBuLCBpLCBzLCBvLCBsKSwgdC5jbG9zZVBhdGgoKTsKICAgICAgfQogICAgfSk7CiAgICB0LmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgcmV0dXJuIGkuYnJvd3Nlci5pZSAmJiBpLmJyb3dzZXIudmVyc2lvbiA+PSAxMSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgciA9IHRoaXMuX19jbGlwUGF0aHMsCiAgICAgICAgICAgIG4gPSB0aGlzLnN0eWxlOwogICAgICAgIGlmIChyKSBmb3IgKHZhciBpID0gMDsgaSA8IHIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBvID0gcltpXSwKICAgICAgICAgICAgICBzID0gbyAmJiBvLnNoYXBlLAogICAgICAgICAgICAgIGwgPSBvICYmIG8udHlwZTsKCiAgICAgICAgICBpZiAocyAmJiAoInNlY3RvciIgPT09IGwgJiYgcy5zdGFydEFuZ2xlID09PSBzLmVuZEFuZ2xlIHx8ICJyZWN0IiA9PT0gbCAmJiAoIXMud2lkdGggfHwgIXMuaGVpZ2h0KSkpIHsKICAgICAgICAgICAgZm9yICh2YXIgaCA9IDA7IGggPCBhLmxlbmd0aDsgaCsrKSB7CiAgICAgICAgICAgICAgYVtoXVsyXSA9IG5bYVtoXVswXV0sIG5bYVtoXVswXV0gPSBhW2hdWzFdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBlID0gITA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBlKSBmb3IgKHZhciBoID0gMDsgaCA8IGEubGVuZ3RoOyBoKyspIHsKICAgICAgICAgIG5bYVtoXVswXV0gPSBhW2hdWzJdOwogICAgICAgIH0KICAgICAgfSA6IHQ7CiAgICB9CgogICAgdmFyIGkgPSByKDE1KSwKICAgICAgICBhID0gW1sic2hhZG93Qmx1ciIsIDBdLCBbInNoYWRvd0NvbG9yIiwgIiMwMDAiXSwgWyJzaGFkb3dPZmZzZXRYIiwgMF0sIFsic2hhZG93T2Zmc2V0WSIsIDBdXTsKICAgIHQuZXhwb3J0cyA9IG47CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxKSwKICAgICAgICBpID0gbi5leHRlbmQoewogICAgICB0eXBlOiAicmluZyIsCiAgICAgIHNoYXBlOiB7CiAgICAgICAgY3g6IDAsCiAgICAgICAgY3k6IDAsCiAgICAgICAgcjogMCwKICAgICAgICByMDogMAogICAgICB9LAogICAgICBidWlsZFBhdGg6IGZ1bmN0aW9uIGJ1aWxkUGF0aCh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSBlLmN4LAogICAgICAgICAgICBuID0gZS5jeSwKICAgICAgICAgICAgaSA9IDIgKiBNYXRoLlBJOwogICAgICAgIHQubW92ZVRvKHIgKyBlLnIsIG4pLCB0LmFyYyhyLCBuLCBlLnIsIDAsIGksICExKSwgdC5tb3ZlVG8ociArIGUucjAsIG4pLCB0LmFyYyhyLCBuLCBlLnIwLCAwLCBpLCAhMCk7CiAgICAgIH0KICAgIH0pOwogICAgdC5leHBvcnRzID0gaTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDEpLAogICAgICAgIGkgPSByKDIzKSwKICAgICAgICBhID0gbi5leHRlbmQoewogICAgICB0eXBlOiAicG9seWdvbiIsCiAgICAgIHNoYXBlOiB7CiAgICAgICAgcG9pbnRzOiBudWxsLAogICAgICAgIHNtb290aDogITEsCiAgICAgICAgc21vb3RoQ29uc3RyYWludDogbnVsbAogICAgICB9LAogICAgICBidWlsZFBhdGg6IGZ1bmN0aW9uIGJ1aWxkUGF0aCh0LCBlKSB7CiAgICAgICAgaS5idWlsZFBhdGgodCwgZSwgITApOwogICAgICB9CiAgICB9KTsKICAgIHQuZXhwb3J0cyA9IGE7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgciwgbiwgaSwgYSwgbykgewogICAgICB2YXIgcyA9IC41ICogKHIgLSB0KSwKICAgICAgICAgIGwgPSAuNSAqIChuIC0gZSk7CiAgICAgIHJldHVybiAoMiAqIChlIC0gcikgKyBzICsgbCkgKiBvICsgKC0zICogKGUgLSByKSAtIDIgKiBzIC0gbCkgKiBhICsgcyAqIGkgKyBlOwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCwgZSkgewogICAgICBmb3IgKHZhciByID0gdC5sZW5ndGgsIGkgPSBbXSwgYSA9IDAsIHMgPSAxOyBzIDwgcjsgcysrKSB7CiAgICAgICAgYSArPSBvKHRbcyAtIDFdLCB0W3NdKTsKICAgICAgfQoKICAgICAgdmFyIGwgPSBhIC8gMjsKICAgICAgbCA9IGwgPCByID8gciA6IGw7CgogICAgICBmb3IgKHZhciBzID0gMDsgcyA8IGw7IHMrKykgewogICAgICAgIHZhciBoLAogICAgICAgICAgICB1LAogICAgICAgICAgICBjLAogICAgICAgICAgICBmID0gcyAvIChsIC0gMSkgKiAoZSA/IHIgOiByIC0gMSksCiAgICAgICAgICAgIGQgPSBNYXRoLmZsb29yKGYpLAogICAgICAgICAgICB2ID0gZiAtIGQsCiAgICAgICAgICAgIGcgPSB0W2QgJSByXTsKICAgICAgICBlID8gKGggPSB0WyhkIC0gMSArIHIpICUgcl0sIHUgPSB0WyhkICsgMSkgJSByXSwgYyA9IHRbKGQgKyAyKSAlIHJdKSA6IChoID0gdFswID09PSBkID8gZCA6IGQgLSAxXSwgdSA9IHRbZCA+IHIgLSAyID8gciAtIDEgOiBkICsgMV0sIGMgPSB0W2QgPiByIC0gMyA/IHIgLSAxIDogZCArIDJdKTsKICAgICAgICB2YXIgcCA9IHYgKiB2LAogICAgICAgICAgICBtID0gdiAqIHA7CiAgICAgICAgaS5wdXNoKFtuKGhbMF0sIGdbMF0sIHVbMF0sIGNbMF0sIHYsIHAsIG0pLCBuKGhbMV0sIGdbMV0sIHVbMV0sIGNbMV0sIHYsIHAsIG0pXSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpOwogICAgfQoKICAgIHZhciBhID0gcigyKSwKICAgICAgICBvID0gYS5kaXN0YW5jZTsKICAgIHQuZXhwb3J0cyA9IGk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgciwgbikgewogICAgICB2YXIgaSwKICAgICAgICAgIGYsCiAgICAgICAgICBkLAogICAgICAgICAgdiwKICAgICAgICAgIGcgPSBbXSwKICAgICAgICAgIHAgPSBbXSwKICAgICAgICAgIG0gPSBbXSwKICAgICAgICAgIHggPSBbXTsKCiAgICAgIGlmIChuKSB7CiAgICAgICAgZCA9IFsxIC8gMCwgMSAvIDBdLCB2ID0gWy0xIC8gMCwgLTEgLyAwXTsKCiAgICAgICAgZm9yICh2YXIgeSA9IDAsIHcgPSB0Lmxlbmd0aDsgeSA8IHc7IHkrKykgewogICAgICAgICAgYShkLCBkLCB0W3ldKSwgbyh2LCB2LCB0W3ldKTsKICAgICAgICB9CgogICAgICAgIGEoZCwgZCwgblswXSksIG8odiwgdiwgblsxXSk7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIHkgPSAwLCB3ID0gdC5sZW5ndGg7IHkgPCB3OyB5KyspIHsKICAgICAgICB2YXIgXyA9IHRbeV07CiAgICAgICAgaWYgKHIpIGkgPSB0W3kgPyB5IC0gMSA6IHcgLSAxXSwgZiA9IHRbKHkgKyAxKSAlIHddO2Vsc2UgewogICAgICAgICAgaWYgKDAgPT09IHkgfHwgeSA9PT0gdyAtIDEpIHsKICAgICAgICAgICAgZy5wdXNoKHUodFt5XSkpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpID0gdFt5IC0gMV0sIGYgPSB0W3kgKyAxXTsKICAgICAgICB9CiAgICAgICAgYyhwLCBmLCBpKSwgcyhwLCBwLCBlKTsKICAgICAgICB2YXIgYiA9IGwoXywgaSksCiAgICAgICAgICAgIFMgPSBsKF8sIGYpLAogICAgICAgICAgICBNID0gYiArIFM7CiAgICAgICAgMCAhPT0gTSAmJiAoYiAvPSBNLCBTIC89IE0pLCBzKG0sIHAsIC1iKSwgcyh4LCBwLCBTKTsKICAgICAgICB2YXIgVCA9IGgoW10sIF8sIG0pLAogICAgICAgICAgICBrID0gaChbXSwgXywgeCk7CiAgICAgICAgbiAmJiAobyhULCBULCBkKSwgYShULCBULCB2KSwgbyhrLCBrLCBkKSwgYShrLCBrLCB2KSksIGcucHVzaChUKSwgZy5wdXNoKGspOwogICAgICB9CgogICAgICByZXR1cm4gciAmJiBnLnB1c2goZy5zaGlmdCgpKSwgZzsKICAgIH0KCiAgICB2YXIgaSA9IHIoMiksCiAgICAgICAgYSA9IGkubWluLAogICAgICAgIG8gPSBpLm1heCwKICAgICAgICBzID0gaS5zY2FsZSwKICAgICAgICBsID0gaS5kaXN0YW5jZSwKICAgICAgICBoID0gaS5hZGQsCiAgICAgICAgdSA9IGkuY2xvbmUsCiAgICAgICAgYyA9IGkuc3ViOwogICAgdC5leHBvcnRzID0gbjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDEpLAogICAgICAgIGkgPSByKDIzKSwKICAgICAgICBhID0gbi5leHRlbmQoewogICAgICB0eXBlOiAicG9seWxpbmUiLAogICAgICBzaGFwZTogewogICAgICAgIHBvaW50czogbnVsbCwKICAgICAgICBzbW9vdGg6ICExLAogICAgICAgIHNtb290aENvbnN0cmFpbnQ6IG51bGwKICAgICAgfSwKICAgICAgc3R5bGU6IHsKICAgICAgICBzdHJva2U6ICIjMDAwIiwKICAgICAgICBmaWxsOiBudWxsCiAgICAgIH0sCiAgICAgIGJ1aWxkUGF0aDogZnVuY3Rpb24gYnVpbGRQYXRoKHQsIGUpIHsKICAgICAgICBpLmJ1aWxkUGF0aCh0LCBlLCAhMSk7CiAgICAgIH0KICAgIH0pOwogICAgdC5leHBvcnRzID0gYTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDEpLAogICAgICAgIGkgPSByKDIxKSwKICAgICAgICBhID0gbi5leHRlbmQoewogICAgICB0eXBlOiAicmVjdCIsCiAgICAgIHNoYXBlOiB7CiAgICAgICAgcjogMCwKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAsCiAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgaGVpZ2h0OiAwCiAgICAgIH0sCiAgICAgIGJ1aWxkUGF0aDogZnVuY3Rpb24gYnVpbGRQYXRoKHQsIGUpIHsKICAgICAgICB2YXIgciA9IGUueCwKICAgICAgICAgICAgbiA9IGUueSwKICAgICAgICAgICAgYSA9IGUud2lkdGgsCiAgICAgICAgICAgIG8gPSBlLmhlaWdodDsKICAgICAgICBlLnIgPyBpLmJ1aWxkUGF0aCh0LCBlKSA6IHQucmVjdChyLCBuLCBhLCBvKSwgdC5jbG9zZVBhdGgoKTsKICAgICAgfQogICAgfSk7CiAgICB0LmV4cG9ydHMgPSBhOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMSksCiAgICAgICAgaSA9IG4uZXh0ZW5kKHsKICAgICAgdHlwZTogImxpbmUiLAogICAgICBzaGFwZTogewogICAgICAgIHgxOiAwLAogICAgICAgIHkxOiAwLAogICAgICAgIHgyOiAwLAogICAgICAgIHkyOiAwLAogICAgICAgIHBlcmNlbnQ6IDEKICAgICAgfSwKICAgICAgc3R5bGU6IHsKICAgICAgICBzdHJva2U6ICIjMDAwIiwKICAgICAgICBmaWxsOiBudWxsCiAgICAgIH0sCiAgICAgIGJ1aWxkUGF0aDogZnVuY3Rpb24gYnVpbGRQYXRoKHQsIGUpIHsKICAgICAgICB2YXIgciA9IGUueDEsCiAgICAgICAgICAgIG4gPSBlLnkxLAogICAgICAgICAgICBpID0gZS54MiwKICAgICAgICAgICAgYSA9IGUueTIsCiAgICAgICAgICAgIG8gPSBlLnBlcmNlbnQ7CiAgICAgICAgMCAhPT0gbyAmJiAodC5tb3ZlVG8ociwgbiksIG8gPCAxICYmIChpID0gciAqICgxIC0gbykgKyBpICogbywgYSA9IG4gKiAoMSAtIG8pICsgYSAqIG8pLCB0LmxpbmVUbyhpLCBhKSk7CiAgICAgIH0sCiAgICAgIHBvaW50QXQ6IGZ1bmN0aW9uIHBvaW50QXQodCkgewogICAgICAgIHZhciBlID0gdGhpcy5zaGFwZTsKICAgICAgICByZXR1cm4gW2UueDEgKiAoMSAtIHQpICsgZS54MiAqIHQsIGUueTEgKiAoMSAtIHQpICsgZS55MiAqIHRdOwogICAgICB9CiAgICB9KTsKICAgIHQuZXhwb3J0cyA9IGk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIGZ1bmN0aW9uIG4odCwgZSwgcikgewogICAgICB2YXIgbiA9IHQuY3B4MiwKICAgICAgICAgIGkgPSB0LmNweTI7CiAgICAgIHJldHVybiBudWxsID09PSBuIHx8IG51bGwgPT09IGkgPyBbKHIgPyBmIDogdSkodC54MSwgdC5jcHgxLCB0LmNweDIsIHQueDIsIGUpLCAociA/IGYgOiB1KSh0LnkxLCB0LmNweTEsIHQuY3B5MiwgdC55MiwgZSldIDogWyhyID8gYyA6IGgpKHQueDEsIHQuY3B4MSwgdC54MiwgZSksIChyID8gYyA6IGgpKHQueTEsIHQuY3B5MSwgdC55MiwgZSldOwogICAgfQoKICAgIHZhciBpID0gcigxKSwKICAgICAgICBhID0gcigyKSwKICAgICAgICBvID0gcig0KSwKICAgICAgICBzID0gby5xdWFkcmF0aWNTdWJkaXZpZGUsCiAgICAgICAgbCA9IG8uY3ViaWNTdWJkaXZpZGUsCiAgICAgICAgaCA9IG8ucXVhZHJhdGljQXQsCiAgICAgICAgdSA9IG8uY3ViaWNBdCwKICAgICAgICBjID0gby5xdWFkcmF0aWNEZXJpdmF0aXZlQXQsCiAgICAgICAgZiA9IG8uY3ViaWNEZXJpdmF0aXZlQXQsCiAgICAgICAgZCA9IFtdLAogICAgICAgIHYgPSBpLmV4dGVuZCh7CiAgICAgIHR5cGU6ICJiZXppZXItY3VydmUiLAogICAgICBzaGFwZTogewogICAgICAgIHgxOiAwLAogICAgICAgIHkxOiAwLAogICAgICAgIHgyOiAwLAogICAgICAgIHkyOiAwLAogICAgICAgIGNweDE6IDAsCiAgICAgICAgY3B5MTogMCwKICAgICAgICBwZXJjZW50OiAxCiAgICAgIH0sCiAgICAgIHN0eWxlOiB7CiAgICAgICAgc3Ryb2tlOiAiIzAwMCIsCiAgICAgICAgZmlsbDogbnVsbAogICAgICB9LAogICAgICBidWlsZFBhdGg6IGZ1bmN0aW9uIGJ1aWxkUGF0aCh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSBlLngxLAogICAgICAgICAgICBuID0gZS55MSwKICAgICAgICAgICAgaSA9IGUueDIsCiAgICAgICAgICAgIGEgPSBlLnkyLAogICAgICAgICAgICBvID0gZS5jcHgxLAogICAgICAgICAgICBoID0gZS5jcHkxLAogICAgICAgICAgICB1ID0gZS5jcHgyLAogICAgICAgICAgICBjID0gZS5jcHkyLAogICAgICAgICAgICBmID0gZS5wZXJjZW50OwogICAgICAgIDAgIT09IGYgJiYgKHQubW92ZVRvKHIsIG4pLCBudWxsID09IHUgfHwgbnVsbCA9PSBjID8gKGYgPCAxICYmIChzKHIsIG8sIGksIGYsIGQpLCBvID0gZFsxXSwgaSA9IGRbMl0sIHMobiwgaCwgYSwgZiwgZCksIGggPSBkWzFdLCBhID0gZFsyXSksIHQucXVhZHJhdGljQ3VydmVUbyhvLCBoLCBpLCBhKSkgOiAoZiA8IDEgJiYgKGwociwgbywgdSwgaSwgZiwgZCksIG8gPSBkWzFdLCB1ID0gZFsyXSwgaSA9IGRbM10sIGwobiwgaCwgYywgYSwgZiwgZCksIGggPSBkWzFdLCBjID0gZFsyXSwgYSA9IGRbM10pLCB0LmJlemllckN1cnZlVG8obywgaCwgdSwgYywgaSwgYSkpKTsKICAgICAgfSwKICAgICAgcG9pbnRBdDogZnVuY3Rpb24gcG9pbnRBdCh0KSB7CiAgICAgICAgcmV0dXJuIG4odGhpcy5zaGFwZSwgdCwgITEpOwogICAgICB9LAogICAgICB0YW5nZW50QXQ6IGZ1bmN0aW9uIHRhbmdlbnRBdCh0KSB7CiAgICAgICAgdmFyIGUgPSBuKHRoaXMuc2hhcGUsIHQsICEwKTsKICAgICAgICByZXR1cm4gYS5ub3JtYWxpemUoZSwgZSk7CiAgICAgIH0KICAgIH0pOwogICAgdC5leHBvcnRzID0gdjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDEpLAogICAgICAgIGkgPSBuLmV4dGVuZCh7CiAgICAgIHR5cGU6ICJhcmMiLAogICAgICBzaGFwZTogewogICAgICAgIGN4OiAwLAogICAgICAgIGN5OiAwLAogICAgICAgIHI6IDAsCiAgICAgICAgc3RhcnRBbmdsZTogMCwKICAgICAgICBlbmRBbmdsZTogMiAqIE1hdGguUEksCiAgICAgICAgY2xvY2t3aXNlOiAhMAogICAgICB9LAogICAgICBzdHlsZTogewogICAgICAgIHN0cm9rZTogIiMwMDAiLAogICAgICAgIGZpbGw6IG51bGwKICAgICAgfSwKICAgICAgYnVpbGRQYXRoOiBmdW5jdGlvbiBidWlsZFBhdGgodCwgZSkgewogICAgICAgIHZhciByID0gZS5jeCwKICAgICAgICAgICAgbiA9IGUuY3ksCiAgICAgICAgICAgIGkgPSBNYXRoLm1heChlLnIsIDApLAogICAgICAgICAgICBhID0gZS5zdGFydEFuZ2xlLAogICAgICAgICAgICBvID0gZS5lbmRBbmdsZSwKICAgICAgICAgICAgcyA9IGUuY2xvY2t3aXNlLAogICAgICAgICAgICBsID0gTWF0aC5jb3MoYSksCiAgICAgICAgICAgIGggPSBNYXRoLnNpbihhKTsKICAgICAgICB0Lm1vdmVUbyhsICogaSArIHIsIGggKiBpICsgbiksIHQuYXJjKHIsIG4sIGksIGEsIG8sICFzKTsKICAgICAgfQogICAgfSk7CiAgICB0LmV4cG9ydHMgPSBpOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMSksCiAgICAgICAgaSA9IG4uZXh0ZW5kKHsKICAgICAgdHlwZTogImNvbXBvdW5kIiwKICAgICAgc2hhcGU6IHsKICAgICAgICBwYXRoczogbnVsbAogICAgICB9LAogICAgICBfdXBkYXRlUGF0aERpcnR5OiBmdW5jdGlvbiBfdXBkYXRlUGF0aERpcnR5KCkgewogICAgICAgIGZvciAodmFyIHQgPSB0aGlzLl9fZGlydHlQYXRoLCBlID0gdGhpcy5zaGFwZS5wYXRocywgciA9IDA7IHIgPCBlLmxlbmd0aDsgcisrKSB7CiAgICAgICAgICB0ID0gdCB8fCBlW3JdLl9fZGlydHlQYXRoOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fX2RpcnR5UGF0aCA9IHQsIHRoaXMuX19kaXJ0eSA9IHRoaXMuX19kaXJ0eSB8fCB0OwogICAgICB9LAogICAgICBiZWZvcmVCcnVzaDogZnVuY3Rpb24gYmVmb3JlQnJ1c2goKSB7CiAgICAgICAgdGhpcy5fdXBkYXRlUGF0aERpcnR5KCk7CgogICAgICAgIGZvciAodmFyIHQgPSB0aGlzLnNoYXBlLnBhdGhzIHx8IFtdLCBlID0gdGhpcy5nZXRHbG9iYWxTY2FsZSgpLCByID0gMDsgciA8IHQubGVuZ3RoOyByKyspIHsKICAgICAgICAgIHRbcl0ucGF0aCB8fCB0W3JdLmNyZWF0ZVBhdGhQcm94eSgpLCB0W3JdLnBhdGguc2V0U2NhbGUoZVswXSwgZVsxXSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBidWlsZFBhdGg6IGZ1bmN0aW9uIGJ1aWxkUGF0aCh0LCBlKSB7CiAgICAgICAgZm9yICh2YXIgciA9IGUucGF0aHMgfHwgW10sIG4gPSAwOyBuIDwgci5sZW5ndGg7IG4rKykgewogICAgICAgICAgcltuXS5idWlsZFBhdGgodCwgcltuXS5zaGFwZSwgITApOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYWZ0ZXJCcnVzaDogZnVuY3Rpb24gYWZ0ZXJCcnVzaCgpIHsKICAgICAgICBmb3IgKHZhciB0ID0gdGhpcy5zaGFwZS5wYXRocyB8fCBbXSwgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB7CiAgICAgICAgICB0W2VdLl9fZGlydHlQYXRoID0gITE7CiAgICAgICAgfQogICAgICB9LAogICAgICBnZXRCb3VuZGluZ1JlY3Q6IGZ1bmN0aW9uIGdldEJvdW5kaW5nUmVjdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlUGF0aERpcnR5KCksIG4ucHJvdG90eXBlLmdldEJvdW5kaW5nUmVjdC5jYWxsKHRoaXMpOwogICAgICB9CiAgICB9KTsKICAgIHQuZXhwb3J0cyA9IGk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigwKSwKICAgICAgICBpID0gcigyNCksCiAgICAgICAgYSA9IGZ1bmN0aW9uIGEodCwgZSwgciwgbiwgX2EsIG8pIHsKICAgICAgdGhpcy54ID0gbnVsbCA9PSB0ID8gMCA6IHQsIHRoaXMueSA9IG51bGwgPT0gZSA/IDAgOiBlLCB0aGlzLngyID0gbnVsbCA9PSByID8gMSA6IHIsIHRoaXMueTIgPSBudWxsID09IG4gPyAwIDogbiwgdGhpcy50eXBlID0gImxpbmVhciIsIHRoaXMuZ2xvYmFsID0gbyB8fCAhMSwgaS5jYWxsKHRoaXMsIF9hKTsKICAgIH07CgogICAgYS5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBhCiAgICB9LCBuLmluaGVyaXRzKGEsIGkpOwogICAgdmFyIG8gPSBhOwogICAgdC5leHBvcnRzID0gbzsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDApLAogICAgICAgIGkgPSByKDI0KSwKICAgICAgICBhID0gZnVuY3Rpb24gYSh0LCBlLCByLCBuLCBfYTIpIHsKICAgICAgdGhpcy54ID0gbnVsbCA9PSB0ID8gLjUgOiB0LCB0aGlzLnkgPSBudWxsID09IGUgPyAuNSA6IGUsIHRoaXMuciA9IG51bGwgPT0gciA/IC41IDogciwgdGhpcy50eXBlID0gInJhZGlhbCIsIHRoaXMuZ2xvYmFsID0gX2EyIHx8ICExLCBpLmNhbGwodGhpcywgbik7CiAgICB9OwoKICAgIGEucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogYQogICAgfSwgbi5pbmhlcml0cyhhLCBpKTsKICAgIHZhciBvID0gYTsKICAgIHQuZXhwb3J0cyA9IG87CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigxMSksCiAgICAgICAgaSA9IG4oW1siZmlsbCIsICJjb2xvciJdLCBbInN0cm9rZSIsICJib3JkZXJDb2xvciJdLCBbImxpbmVXaWR0aCIsICJib3JkZXJXaWR0aCJdLCBbIm9wYWNpdHkiXSwgWyJzaGFkb3dCbHVyIl0sIFsic2hhZG93T2Zmc2V0WCJdLCBbInNoYWRvd09mZnNldFkiXSwgWyJzaGFkb3dDb2xvciJdLCBbInRleHRQb3NpdGlvbiJdLCBbInRleHRBbGlnbiJdXSksCiAgICAgICAgYSA9IHsKICAgICAgZ2V0SXRlbVN0eWxlOiBmdW5jdGlvbiBnZXRJdGVtU3R5bGUodCwgZSkgewogICAgICAgIHZhciByID0gaSh0aGlzLCB0LCBlKSwKICAgICAgICAgICAgbiA9IHRoaXMuZ2V0Qm9yZGVyTGluZURhc2goKTsKICAgICAgICByZXR1cm4gbiAmJiAoci5saW5lRGFzaCA9IG4pLCByOwogICAgICB9LAogICAgICBnZXRCb3JkZXJMaW5lRGFzaDogZnVuY3Rpb24gZ2V0Qm9yZGVyTGluZURhc2goKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLmdldCgiYm9yZGVyVHlwZSIpOwogICAgICAgIHJldHVybiAic29saWQiID09PSB0IHx8IG51bGwgPT0gdCA/IG51bGwgOiAiZGFzaGVkIiA9PT0gdCA/IFs1LCA1XSA6IFsxLCAxXTsKICAgICAgfQogICAgfTsKICAgIHQuZXhwb3J0cyA9IGE7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcig3KTsKICAgIG4uZXh0ZW5kQ2hhcnRWaWV3KHsKICAgICAgdHlwZTogIndvcmRDbG91ZCIsCiAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKHQsIGUsIHIpIHsKICAgICAgICB2YXIgaSA9IHRoaXMuZ3JvdXA7CiAgICAgICAgaS5yZW1vdmVBbGwoKTsKICAgICAgICB2YXIgYSA9IHQuZ2V0RGF0YSgpLAogICAgICAgICAgICBvID0gdC5nZXQoImdyaWRTaXplIik7CiAgICAgICAgdC5sYXlvdXRJbnN0YW5jZS5vbmRyYXcgPSBmdW5jdGlvbiAodCwgZSwgciwgcykgewogICAgICAgICAgdmFyIGwgPSBhLmdldEl0ZW1Nb2RlbChyKSwKICAgICAgICAgICAgICBoID0gbC5nZXRNb2RlbCgidGV4dFN0eWxlLm5vcm1hbCIpLAogICAgICAgICAgICAgIHUgPSBsLmdldE1vZGVsKCJ0ZXh0U3R5bGUuZW1waGFzaXMiKSwKICAgICAgICAgICAgICBjID0gbmV3IG4uZ3JhcGhpYy5UZXh0KHsKICAgICAgICAgICAgc3R5bGU6IG4uZ3JhcGhpYy5zZXRUZXh0U3R5bGUoe30sIGgsIHsKICAgICAgICAgICAgICB4OiBzLmluZm8uZmlsbFRleHRPZmZzZXRYLAogICAgICAgICAgICAgIHk6IHMuaW5mby5maWxsVGV4dE9mZnNldFkgKyAuNSAqIGUsCiAgICAgICAgICAgICAgdGV4dDogdCwKICAgICAgICAgICAgICB0ZXh0QmFzZWxpbmU6ICJtaWRkbGUiLAogICAgICAgICAgICAgIHRleHRGaWxsOiBhLmdldEl0ZW1WaXN1YWwociwgImNvbG9yIiksCiAgICAgICAgICAgICAgZm9udFNpemU6IGUKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHNjYWxlOiBbMSAvIHMuaW5mby5tdSwgMSAvIHMuaW5mby5tdV0sCiAgICAgICAgICAgIHBvc2l0aW9uOiBbKHMuZ3ggKyBzLmluZm8uZ3cgLyAyKSAqIG8sIChzLmd5ICsgcy5pbmZvLmdoIC8gMikgKiBvXSwKICAgICAgICAgICAgcm90YXRpb246IHMucm90CiAgICAgICAgICB9KTsKICAgICAgICAgIGkuYWRkKGMpLCBhLnNldEl0ZW1HcmFwaGljRWwociwgYyksIG4uZ3JhcGhpYy5zZXRIb3ZlclN0eWxlKGMsIG4uZ3JhcGhpYy5zZXRUZXh0U3R5bGUoe30sIHUsIG51bGwsIHsKICAgICAgICAgICAgZm9yTWVyZ2U6ICEwCiAgICAgICAgICB9LCAhMCkpOwogICAgICAgIH0sIHRoaXMuX21vZGVsID0gdDsKICAgICAgfSwKICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7CiAgICAgICAgdGhpcy5ncm91cC5yZW1vdmVBbGwoKSwgdGhpcy5fbW9kZWwubGF5b3V0SW5zdGFuY2UuZGlzcG9zZSgpOwogICAgICB9LAogICAgICBkaXNwb3NlOiBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICAgIHRoaXMuX21vZGVsLmxheW91dEluc3RhbmNlLmRpc3Bvc2UoKTsKICAgICAgfQogICAgfSk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbiwgaTsKICAgIC8qIQogICAgKiB3b3JkY2xvdWQyLmpzCiAgICAqIGh0dHA6Ly90aW1kcmVhbS5vcmcvd29yZGNsb3VkMi5qcy8KICAgICoKICAgICogQ29weXJpZ2h0IDIwMTEgLSAyMDEzIFRpbSBDaGllbgogICAgKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICAgICovCgogICAgd2luZG93LnNldEltbWVkaWF0ZSB8fCAod2luZG93LnNldEltbWVkaWF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHdpbmRvdy5tc1NldEltbWVkaWF0ZSB8fCB3aW5kb3cud2Via2l0U2V0SW1tZWRpYXRlIHx8IHdpbmRvdy5tb3pTZXRJbW1lZGlhdGUgfHwgd2luZG93Lm9TZXRJbW1lZGlhdGUgfHwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghd2luZG93LnBvc3RNZXNzYWdlIHx8ICF3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgcmV0dXJuIG51bGw7CgogICAgICAgIHZhciB0ID0gW3ZvaWQgMF0sCiAgICAgICAgICAgIGUgPSAiemVyby10aW1lb3V0LW1lc3NhZ2UiLAogICAgICAgICAgICByID0gZnVuY3Rpb24gcihfcikgewogICAgICAgICAgdmFyIG4gPSB0Lmxlbmd0aDsKICAgICAgICAgIHJldHVybiB0LnB1c2goX3IpLCB3aW5kb3cucG9zdE1lc3NhZ2UoZSArIG4udG9TdHJpbmcoMzYpLCAiKiIpLCBuOwogICAgICAgIH07CgogICAgICAgIHJldHVybiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHIuZGF0YSAmJiByLmRhdGEuc3Vic3RyKDAsIGUubGVuZ3RoKSA9PT0gZSkgewogICAgICAgICAgICByLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB2YXIgbiA9IHBhcnNlSW50KHIuZGF0YS5zdWJzdHIoZS5sZW5ndGgpLCAzNik7CiAgICAgICAgICAgIHRbbl0gJiYgKHRbbl0oKSwgdFtuXSA9IHZvaWQgMCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgITApLCB3aW5kb3cuY2xlYXJJbW1lZGlhdGUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdFtlXSAmJiAodFtlXSA9IHZvaWQgMCk7CiAgICAgICAgfSwgcjsKICAgICAgfSgpIHx8IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgd2luZG93LnNldFRpbWVvdXQodCwgMCk7CiAgICAgIH07CiAgICB9KCkpLCB3aW5kb3cuY2xlYXJJbW1lZGlhdGUgfHwgKHdpbmRvdy5jbGVhckltbWVkaWF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHdpbmRvdy5tc0NsZWFySW1tZWRpYXRlIHx8IHdpbmRvdy53ZWJraXRDbGVhckltbWVkaWF0ZSB8fCB3aW5kb3cubW96Q2xlYXJJbW1lZGlhdGUgfHwgd2luZG93Lm9DbGVhckltbWVkaWF0ZSB8fCBmdW5jdGlvbiAodCkgewogICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodCk7CiAgICAgIH07CiAgICB9KCkpLCBmdW5jdGlvbiAocikgewogICAgICB2YXIgYSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAgIGlmICghdCB8fCAhdC5nZXRDb250ZXh0KSByZXR1cm4gITE7CiAgICAgICAgdmFyIGUgPSB0LmdldENvbnRleHQoIjJkIik7CiAgICAgICAgcmV0dXJuICEhZS5nZXRJbWFnZURhdGEgJiYgISFlLmZpbGxUZXh0ICYmICEhQXJyYXkucHJvdG90eXBlLnNvbWUgJiYgISFBcnJheS5wcm90b3R5cGUucHVzaDsKICAgICAgfSgpLAogICAgICAgICAgbyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoYSkgewogICAgICAgICAgZm9yICh2YXIgdCwgZSwgciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpLmdldENvbnRleHQoIjJkIiksIG4gPSAyMDsgbjspIHsKICAgICAgICAgICAgaWYgKHIuZm9udCA9IG4udG9TdHJpbmcoMTApICsgInB4IHNhbnMtc2VyaWYiLCByLm1lYXN1cmVUZXh0KCLvvLciKS53aWR0aCA9PT0gdCAmJiByLm1lYXN1cmVUZXh0KCJtIikud2lkdGggPT09IGUpIHJldHVybiBuICsgMTsKICAgICAgICAgICAgdCA9IHIubWVhc3VyZVRleHQoIu+8tyIpLndpZHRoLCBlID0gci5tZWFzdXJlVGV4dCgibSIpLndpZHRoLCBuLS07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICB9KCksCiAgICAgICAgICBzID0gZnVuY3Rpb24gcyh0KSB7CiAgICAgICAgZm9yICh2YXIgZSwgciwgbiA9IHQubGVuZ3RoOyBuOyBlID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbiksIHIgPSB0Wy0tbl0sIHRbbl0gPSB0W2VdLCB0W2VdID0gcikgewogICAgICAgICAgOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHQ7CiAgICAgIH0sCiAgICAgICAgICBsID0gZnVuY3Rpb24gbCh0LCBlKSB7CiAgICAgICAgZnVuY3Rpb24gcih0LCBlKSB7CiAgICAgICAgICByZXR1cm4gImhzbCgiICsgKDM2MCAqIE1hdGgucmFuZG9tKCkpLnRvRml4ZWQoKSArICIsIiArICgzMCAqIE1hdGgucmFuZG9tKCkgKyA3MCkudG9GaXhlZCgpICsgIiUsIiArIChNYXRoLnJhbmRvbSgpICogKGUgLSB0KSArIHQpLnRvRml4ZWQoKSArICIlKSI7CiAgICAgICAgfQoKICAgICAgICBpZiAoYSkgewogICAgICAgICAgQXJyYXkuaXNBcnJheSh0KSB8fCAodCA9IFt0XSksIHQuZm9yRWFjaChmdW5jdGlvbiAoZSwgcikgewogICAgICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIGUpIHsKICAgICAgICAgICAgICBpZiAodFtyXSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGUpLCAhdFtyXSkgdGhyb3cgIlRoZSBlbGVtZW50IGlkIHNwZWNpZmllZCBpcyBub3QgZm91bmQuIjsKICAgICAgICAgICAgfSBlbHNlIGlmICghZS50YWdOYW1lICYmICFlLmFwcGVuZENoaWxkKSB0aHJvdyAiWW91IG11c3QgcGFzcyB2YWxpZCBIVE1MIGVsZW1lbnRzLCBvciBJRCBvZiB0aGUgZWxlbWVudC4iOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgbiA9IHsKICAgICAgICAgICAgbGlzdDogW10sCiAgICAgICAgICAgIGZvbnRGYW1pbHk6ICciVHJlYnVjaGV0IE1TIiwgIkhlaXRpIFRDIiwgIuW+rui7n+ato+m7kemrlCIsICJBcmlhbCBVbmljb2RlIE1TIiwgIkRyb2lkIEZhbGxiYWNrIFNhbnMiLCBzYW5zLXNlcmlmJywKICAgICAgICAgICAgZm9udFdlaWdodDogIm5vcm1hbCIsCiAgICAgICAgICAgIGNvbG9yOiAicmFuZG9tLWRhcmsiLAogICAgICAgICAgICBtaW5TaXplOiAwLAogICAgICAgICAgICB3ZWlnaHRGYWN0b3I6IDEsCiAgICAgICAgICAgIGNsZWFyQ2FudmFzOiAhMCwKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAiI2ZmZiIsCiAgICAgICAgICAgIGdyaWRTaXplOiA4LAogICAgICAgICAgICBkcmF3T3V0T2ZCb3VuZDogITEsCiAgICAgICAgICAgIG9yaWdpbjogbnVsbCwKICAgICAgICAgICAgZHJhd01hc2s6ICExLAogICAgICAgICAgICBtYXNrQ29sb3I6ICJyZ2JhKDI1NSwwLDAsMC4zKSIsCiAgICAgICAgICAgIG1hc2tHYXBXaWR0aDogLjMsCiAgICAgICAgICAgIHdhaXQ6IDAsCiAgICAgICAgICAgIGFib3J0VGhyZXNob2xkOiAwLAogICAgICAgICAgICBhYm9ydDogZnVuY3Rpb24gYWJvcnQoKSB7fSwKICAgICAgICAgICAgbWluUm90YXRpb246IC1NYXRoLlBJIC8gMiwKICAgICAgICAgICAgbWF4Um90YXRpb246IE1hdGguUEkgLyAyLAogICAgICAgICAgICByb3RhdGlvblN0ZXA6IC4xLAogICAgICAgICAgICBzaHVmZmxlOiAhMCwKICAgICAgICAgICAgcm90YXRlUmF0aW86IC4xLAogICAgICAgICAgICBzaGFwZTogImNpcmNsZSIsCiAgICAgICAgICAgIGVsbGlwdGljaXR5OiAuNjUsCiAgICAgICAgICAgIGNsYXNzZXM6IG51bGwsCiAgICAgICAgICAgIGhvdmVyOiBudWxsLAogICAgICAgICAgICBjbGljazogbnVsbAogICAgICAgICAgfTsKICAgICAgICAgIGlmIChlKSBmb3IgKHZhciBpIGluIGUpIHsKICAgICAgICAgICAgaSBpbiBuICYmIChuW2ldID0gZVtpXSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIG4ud2VpZ2h0RmFjdG9yKSB7CiAgICAgICAgICAgIHZhciBsID0gbi53ZWlnaHRGYWN0b3I7CgogICAgICAgICAgICBuLndlaWdodEZhY3RvciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQgKiBsOwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBuLnNoYXBlKSBzd2l0Y2ggKG4uc2hhcGUpIHsKICAgICAgICAgICAgY2FzZSAiY2lyY2xlIjoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBuLnNoYXBlID0gImNpcmNsZSI7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJjYXJkaW9pZCI6CiAgICAgICAgICAgICAgbi5zaGFwZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMSAtIE1hdGguc2luKHQpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAiZGlhbW9uZCI6CiAgICAgICAgICAgIGNhc2UgInNxdWFyZSI6CiAgICAgICAgICAgICAgbi5zaGFwZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9IHQgJSAoMiAqIE1hdGguUEkgLyA0KTsKICAgICAgICAgICAgICAgIHJldHVybiAxIC8gKE1hdGguY29zKGUpICsgTWF0aC5zaW4oZSkpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAidHJpYW5nbGUtZm9yd2FyZCI6CiAgICAgICAgICAgICAgbi5zaGFwZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9IHQgJSAoMiAqIE1hdGguUEkgLyAzKTsKICAgICAgICAgICAgICAgIHJldHVybiAxIC8gKE1hdGguY29zKGUpICsgTWF0aC5zcXJ0KDMpICogTWF0aC5zaW4oZSkpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAidHJpYW5nbGUiOgogICAgICAgICAgICBjYXNlICJ0cmlhbmdsZS11cHJpZ2h0IjoKICAgICAgICAgICAgICBuLnNoYXBlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHZhciBlID0gKHQgKyAzICogTWF0aC5QSSAvIDIpICUgKDIgKiBNYXRoLlBJIC8gMyk7CiAgICAgICAgICAgICAgICByZXR1cm4gMSAvIChNYXRoLmNvcyhlKSArIE1hdGguc3FydCgzKSAqIE1hdGguc2luKGUpKTsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInBlbnRhZ29uIjoKICAgICAgICAgICAgICBuLnNoYXBlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHZhciBlID0gKHQgKyAuOTU1KSAlICgyICogTWF0aC5QSSAvIDUpOwogICAgICAgICAgICAgICAgcmV0dXJuIDEgLyAoTWF0aC5jb3MoZSkgKyAuNzI2NTQzICogTWF0aC5zaW4oZSkpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAic3RhciI6CiAgICAgICAgICAgICAgbi5zaGFwZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9ICh0ICsgLjk1NSkgJSAoMiAqIE1hdGguUEkgLyAxMCk7CiAgICAgICAgICAgICAgICByZXR1cm4gKHQgKyAuOTU1KSAlICgyICogTWF0aC5QSSAvIDUpIC0gMiAqIE1hdGguUEkgLyAxMCA+PSAwID8gMSAvIChNYXRoLmNvcygyICogTWF0aC5QSSAvIDEwIC0gZSkgKyAzLjA3NzY4ICogTWF0aC5zaW4oMiAqIE1hdGguUEkgLyAxMCAtIGUpKSA6IDEgLyAoTWF0aC5jb3MoZSkgKyAzLjA3NzY4ICogTWF0aC5zaW4oZSkpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgfQogICAgICAgICAgbi5ncmlkU2l6ZSA9IE1hdGgubWF4KE1hdGguZmxvb3Iobi5ncmlkU2l6ZSksIDQpOwogICAgICAgICAgdmFyIGgsCiAgICAgICAgICAgICAgdSwKICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgIGYsCiAgICAgICAgICAgICAgZCwKICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgIGcsCiAgICAgICAgICAgICAgcCA9IG4uZ3JpZFNpemUsCiAgICAgICAgICAgICAgbSA9IHAgLSBuLm1hc2tHYXBXaWR0aCwKICAgICAgICAgICAgICB4ID0gTWF0aC5hYnMobi5tYXhSb3RhdGlvbiAtIG4ubWluUm90YXRpb24pLAogICAgICAgICAgICAgIHkgPSBNYXRoLm1pbihuLm1heFJvdGF0aW9uLCBuLm1pblJvdGF0aW9uKSwKICAgICAgICAgICAgICB3ID0gbi5yb3RhdGlvblN0ZXA7CgogICAgICAgICAgc3dpdGNoIChuLmNvbG9yKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmRvbS1kYXJrIjoKICAgICAgICAgICAgICBnID0gZnVuY3Rpb24gZygpIHsKICAgICAgICAgICAgICAgIHJldHVybiByKDEwLCA1MCk7CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJyYW5kb20tbGlnaHQiOgogICAgICAgICAgICAgIGcgPSBmdW5jdGlvbiBnKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHIoNTAsIDkwKTsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2Ygbi5jb2xvciAmJiAoZyA9IG4uY29sb3IpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfID0gbnVsbDsKICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4uY2xhc3NlcyAmJiAoXyA9IG4uY2xhc3Nlcyk7CgogICAgICAgICAgdmFyIGIsCiAgICAgICAgICAgICAgUyA9ICExLAogICAgICAgICAgICAgIE0gPSBbXSwKICAgICAgICAgICAgICBUID0gZnVuY3Rpb24gVCh0KSB7CiAgICAgICAgICAgIHZhciBlLAogICAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICAgIG4gPSB0LmN1cnJlbnRUYXJnZXQsCiAgICAgICAgICAgICAgICBpID0gbi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgdC50b3VjaGVzID8gKGUgPSB0LnRvdWNoZXNbMF0uY2xpZW50WCwgciA9IHQudG91Y2hlc1swXS5jbGllbnRZKSA6IChlID0gdC5jbGllbnRYLCByID0gdC5jbGllbnRZKTsKICAgICAgICAgICAgdmFyIGEgPSBlIC0gaS5sZWZ0LAogICAgICAgICAgICAgICAgbyA9IHIgLSBpLnRvcCwKICAgICAgICAgICAgICAgIHMgPSBNYXRoLmZsb29yKGEgKiAobi53aWR0aCAvIGkud2lkdGggfHwgMSkgLyBwKSwKICAgICAgICAgICAgICAgIGwgPSBNYXRoLmZsb29yKG8gKiAobi5oZWlnaHQgLyBpLmhlaWdodCB8fCAxKSAvIHApOwogICAgICAgICAgICByZXR1cm4gTVtzXVtsXTsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgayA9IGZ1bmN0aW9uIGsodCkgewogICAgICAgICAgICB2YXIgZSA9IFQodCk7CgogICAgICAgICAgICBpZiAoYiAhPT0gZSkgewogICAgICAgICAgICAgIGlmIChiID0gZSwgIWUpIHJldHVybiB2b2lkIG4uaG92ZXIodm9pZCAwLCB2b2lkIDAsIHQpOwogICAgICAgICAgICAgIG4uaG92ZXIoZS5pdGVtLCBlLmRpbWVuc2lvbiwgdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAgICAgQyA9IGZ1bmN0aW9uIEModCkgewogICAgICAgICAgICB2YXIgZSA9IFQodCk7CiAgICAgICAgICAgIGUgJiYgKG4uY2xpY2soZS5pdGVtLCBlLmRpbWVuc2lvbiwgdCksIHQucHJldmVudERlZmF1bHQoKSk7CiAgICAgICAgICB9LAogICAgICAgICAgICAgIFAgPSBbXSwKICAgICAgICAgICAgICBJID0gZnVuY3Rpb24gSSh0KSB7CiAgICAgICAgICAgIGlmIChQW3RdKSByZXR1cm4gUFt0XTsKICAgICAgICAgICAgdmFyIGUgPSA4ICogdCwKICAgICAgICAgICAgICAgIHIgPSBlLAogICAgICAgICAgICAgICAgaSA9IFtdOwoKICAgICAgICAgICAgZm9yICgwID09PSB0ICYmIGkucHVzaChbZlswXSwgZlsxXSwgMF0pOyByLS07KSB7CiAgICAgICAgICAgICAgdmFyIGEgPSAxOwogICAgICAgICAgICAgICJjaXJjbGUiICE9PSBuLnNoYXBlICYmIChhID0gbi5zaGFwZShyIC8gZSAqIDIgKiBNYXRoLlBJKSksIGkucHVzaChbZlswXSArIHQgKiBhICogTWF0aC5jb3MoLXIgLyBlICogMiAqIE1hdGguUEkpLCBmWzFdICsgdCAqIGEgKiBNYXRoLnNpbigtciAvIGUgKiAyICogTWF0aC5QSSkgKiBuLmVsbGlwdGljaXR5LCByIC8gZSAqIDIgKiBNYXRoLlBJXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBQW3RdID0gaSwgaTsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgQSA9IGZ1bmN0aW9uIEEoKSB7CiAgICAgICAgICAgIHJldHVybiBuLmFib3J0VGhyZXNob2xkID4gMCAmJiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHYgPiBuLmFib3J0VGhyZXNob2xkOwogICAgICAgICAgfSwKICAgICAgICAgICAgICBPID0gZnVuY3Rpb24gTygpIHsKICAgICAgICAgICAgcmV0dXJuIDAgPT09IG4ucm90YXRlUmF0aW8gPyAwIDogTWF0aC5yYW5kb20oKSA+IG4ucm90YXRlUmF0aW8gPyAwIDogMCA9PT0geCA/IHkgOiB5ICsgTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogeCAvIHcpICogdzsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgRCA9IGZ1bmN0aW9uIEQodCwgZSwgcikgewogICAgICAgICAgICB2YXIgaSA9IG4ud2VpZ2h0RmFjdG9yKGUpOwogICAgICAgICAgICBpZiAoaSA8PSBuLm1pblNpemUpIHJldHVybiAhMTsKICAgICAgICAgICAgdmFyIGEgPSAxOwogICAgICAgICAgICBpIDwgbyAmJiAoYSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gMjsgdCAqIGkgPCBvOykgewogICAgICAgICAgICAgICAgdCArPSAyOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgICAgIH0oKSk7CiAgICAgICAgICAgIHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIiksCiAgICAgICAgICAgICAgICBsID0gcy5nZXRDb250ZXh0KCIyZCIsIHsKICAgICAgICAgICAgICB3aWxsUmVhZEZyZXF1ZW50bHk6ICEwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsLmZvbnQgPSBuLmZvbnRXZWlnaHQgKyAiICIgKyAoaSAqIGEpLnRvU3RyaW5nKDEwKSArICJweCAiICsgbi5mb250RmFtaWx5OwogICAgICAgICAgICB2YXIgaCA9IGwubWVhc3VyZVRleHQodCkud2lkdGggLyBhLAogICAgICAgICAgICAgICAgdSA9IE1hdGgubWF4KGkgKiBhLCBsLm1lYXN1cmVUZXh0KCJtIikud2lkdGgsIGwubWVhc3VyZVRleHQoIu+8tyIpLndpZHRoKSAvIGEsCiAgICAgICAgICAgICAgICBjID0gaCArIDIgKiB1LAogICAgICAgICAgICAgICAgZiA9IDMgKiB1LAogICAgICAgICAgICAgICAgZCA9IE1hdGguY2VpbChjIC8gcCksCiAgICAgICAgICAgICAgICB2ID0gTWF0aC5jZWlsKGYgLyBwKTsKICAgICAgICAgICAgYyA9IGQgKiBwLCBmID0gdiAqIHA7CgogICAgICAgICAgICB2YXIgZyA9IC1oIC8gMiwKICAgICAgICAgICAgICAgIG0gPSAuNCAqIC11LAogICAgICAgICAgICAgICAgeCA9IE1hdGguY2VpbCgoYyAqIE1hdGguYWJzKE1hdGguc2luKHIpKSArIGYgKiBNYXRoLmFicyhNYXRoLmNvcyhyKSkpIC8gcCksCiAgICAgICAgICAgICAgICB5ID0gTWF0aC5jZWlsKChjICogTWF0aC5hYnMoTWF0aC5jb3MocikpICsgZiAqIE1hdGguYWJzKE1hdGguc2luKHIpKSkgLyBwKSwKICAgICAgICAgICAgICAgIHcgPSB5ICogcCwKICAgICAgICAgICAgICAgIF8gPSB4ICogcDsKCiAgICAgICAgICAgIHMuc2V0QXR0cmlidXRlKCJ3aWR0aCIsIHcpLCBzLnNldEF0dHJpYnV0ZSgiaGVpZ2h0IiwgXyksIGwuc2NhbGUoMSAvIGEsIDEgLyBhKSwgbC50cmFuc2xhdGUodyAqIGEgLyAyLCBfICogYSAvIDIpLCBsLnJvdGF0ZSgtciksIGwuZm9udCA9IG4uZm9udFdlaWdodCArICIgIiArIChpICogYSkudG9TdHJpbmcoMTApICsgInB4ICIgKyBuLmZvbnRGYW1pbHksIGwuZmlsbFN0eWxlID0gIiMwMDAiLCBsLnRleHRCYXNlbGluZSA9ICJtaWRkbGUiLCBsLmZpbGxUZXh0KHQsIGcgKiBhLCAobSArIC41ICogaSkgKiBhKTsKICAgICAgICAgICAgdmFyIGIgPSBsLmdldEltYWdlRGF0YSgwLCAwLCB3LCBfKS5kYXRhOwogICAgICAgICAgICBpZiAoQSgpKSByZXR1cm4gITE7CgogICAgICAgICAgICBmb3IgKHZhciBTLCBNLCBULCBrID0gW10sIEMgPSB5LCBQID0gW3ggLyAyLCB5IC8gMiwgeCAvIDIsIHkgLyAyXTsgQy0tOykgewogICAgICAgICAgICAgIGZvciAoUyA9IHg7IFMtLTspIHsKICAgICAgICAgICAgICAgIFQgPSBwOwoKICAgICAgICAgICAgICAgIHQ6IGZvciAoOyBULS07KSB7CiAgICAgICAgICAgICAgICAgIGZvciAoTSA9IHA7IE0tLTspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYls0ICogKChTICogcCArIFQpICogdyArIChDICogcCArIE0pKSArIDNdKSB7CiAgICAgICAgICAgICAgICAgICAgICBrLnB1c2goW0MsIFNdKSwgQyA8IFBbM10gJiYgKFBbM10gPSBDKSwgQyA+IFBbMV0gJiYgKFBbMV0gPSBDKSwgUyA8IFBbMF0gJiYgKFBbMF0gPSBTKSwgUyA+IFBbMl0gJiYgKFBbMl0gPSBTKTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIHQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG11OiBhLAogICAgICAgICAgICAgIG9jY3VwaWVkOiBrLAogICAgICAgICAgICAgIGJvdW5kczogUCwKICAgICAgICAgICAgICBndzogeSwKICAgICAgICAgICAgICBnaDogeCwKICAgICAgICAgICAgICBmaWxsVGV4dE9mZnNldFg6IGcsCiAgICAgICAgICAgICAgZmlsbFRleHRPZmZzZXRZOiBtLAogICAgICAgICAgICAgIGZpbGxUZXh0V2lkdGg6IGgsCiAgICAgICAgICAgICAgZmlsbFRleHRIZWlnaHQ6IHUsCiAgICAgICAgICAgICAgZm9udFNpemU6IGkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgTCA9IGZ1bmN0aW9uIEwodCwgZSwgciwgaSwgYSkgewogICAgICAgICAgICBmb3IgKHZhciBvID0gYS5sZW5ndGg7IG8tLTspIHsKICAgICAgICAgICAgICB2YXIgcyA9IHQgKyBhW29dWzBdLAogICAgICAgICAgICAgICAgICBsID0gZSArIGFbb11bMV07CgogICAgICAgICAgICAgIGlmIChzID49IHUgfHwgbCA+PSBjIHx8IHMgPCAwIHx8IGwgPCAwKSB7CiAgICAgICAgICAgICAgICBpZiAoIW4uZHJhd091dE9mQm91bmQpIHJldHVybiAhMTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFoW3NdW2xdKSByZXR1cm4gITE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAhMDsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgRiA9IGZ1bmN0aW9uIEYoZSwgciwgaSwgYSwgbywgcywgbCwgaCwgdSkgewogICAgICAgICAgICB2YXIgYywKICAgICAgICAgICAgICAgIGYgPSBpLmZvbnRTaXplOwogICAgICAgICAgICBjID0gZyA/IGcoYSwgbywgZiwgcywgbCkgOiBuLmNvbG9yOwogICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgZCA9IF8gPyBfKGEsIG8sIGYsIHMsIGwpIDogbi5jbGFzc2VzOwogICAgICAgICAgICB2YXIgdiA9IGkuYm91bmRzOwogICAgICAgICAgICB2WzNdLCB2WzBdLCB2WzFdLCB2WzNdLCB2WzJdLCB2WzBdLCB0LmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBpZiAodC5nZXRDb250ZXh0KSB7CiAgICAgICAgICAgICAgICB2YXIgbyA9IHQuZ2V0Q29udGV4dCgiMmQiKSwKICAgICAgICAgICAgICAgICAgICBzID0gaS5tdTsKICAgICAgICAgICAgICAgIG8uc2F2ZSgpLCBvLnNjYWxlKDEgLyBzLCAxIC8gcyksIG8uZm9udCA9IG4uZm9udFdlaWdodCArICIgIiArIChmICogcykudG9TdHJpbmcoMTApICsgInB4ICIgKyBuLmZvbnRGYW1pbHksIG8uZmlsbFN0eWxlID0gYywgby50cmFuc2xhdGUoKGUgKyBpLmd3IC8gMikgKiBwICogcywgKHIgKyBpLmdoIC8gMikgKiBwICogcyksIDAgIT09IGggJiYgby5yb3RhdGUoLWgpLCBvLnRleHRCYXNlbGluZSA9ICJtaWRkbGUiLCBvLmZpbGxUZXh0KGEsIGkuZmlsbFRleHRPZmZzZXRYICogcywgKGkuZmlsbFRleHRPZmZzZXRZICsgLjUgKiBmKSAqIHMpLCBvLnJlc3RvcmUoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIiksCiAgICAgICAgICAgICAgICAgICAgdiA9ICIiOwogICAgICAgICAgICAgICAgdiA9ICJyb3RhdGUoIiArIC1oIC8gTWF0aC5QSSAqIDE4MCArICJkZWcpICIsIDEgIT09IGkubXUgJiYgKHYgKz0gInRyYW5zbGF0ZVgoLSIgKyBpLmZpbGxUZXh0V2lkdGggLyA0ICsgInB4KSBzY2FsZSgiICsgMSAvIGkubXUgKyAiKSIpOwogICAgICAgICAgICAgICAgdmFyIGcgPSB7CiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgICBkaXNwbGF5OiAiYmxvY2siLAogICAgICAgICAgICAgICAgICBmb250OiBuLmZvbnRXZWlnaHQgKyAiICIgKyBmICogaS5tdSArICJweCAiICsgbi5mb250RmFtaWx5LAogICAgICAgICAgICAgICAgICBsZWZ0OiAoZSArIGkuZ3cgLyAyKSAqIHAgKyBpLmZpbGxUZXh0T2Zmc2V0WCArICJweCIsCiAgICAgICAgICAgICAgICAgIHRvcDogKHIgKyBpLmdoIC8gMikgKiBwICsgaS5maWxsVGV4dE9mZnNldFkgKyAicHgiLAogICAgICAgICAgICAgICAgICB3aWR0aDogaS5maWxsVGV4dFdpZHRoICsgInB4IiwKICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBpLmZpbGxUZXh0SGVpZ2h0ICsgInB4IiwKICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogZiArICJweCIsCiAgICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3dyYXAiLAogICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHYsCiAgICAgICAgICAgICAgICAgIHdlYmtpdFRyYW5zZm9ybTogdiwKICAgICAgICAgICAgICAgICAgbXNUcmFuc2Zvcm06IHYsCiAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogIjUwJSA0MCUiLAogICAgICAgICAgICAgICAgICB3ZWJraXRUcmFuc2Zvcm1PcmlnaW46ICI1MCUgNDAlIiwKICAgICAgICAgICAgICAgICAgbXNUcmFuc2Zvcm1PcmlnaW46ICI1MCUgNDAlIgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGMgJiYgKGcuY29sb3IgPSBjKSwgbC50ZXh0Q29udGVudCA9IGE7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgbSBpbiBnKSB7CiAgICAgICAgICAgICAgICAgIGwuc3R5bGVbbV0gPSBnW21dOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh1KSBmb3IgKHZhciB4IGluIHUpIHsKICAgICAgICAgICAgICAgICAgbC5zZXRBdHRyaWJ1dGUoeCwgdVt4XSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkICYmIChsLmNsYXNzTmFtZSArPSBkKSwgdC5hcHBlbmRDaGlsZChsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgICAgICBSID0gZnVuY3Rpb24gUihlLCByLCBuLCBpLCBhKSB7CiAgICAgICAgICAgIGlmICghKGUgPj0gdSB8fCByID49IGMgfHwgZSA8IDAgfHwgciA8IDApKSB7CiAgICAgICAgICAgICAgaWYgKGhbZV1bcl0gPSAhMSwgbikgewogICAgICAgICAgICAgICAgdFswXS5nZXRDb250ZXh0KCIyZCIpLmZpbGxSZWN0KGUgKiBwLCByICogcCwgbSwgbSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBTICYmIChNW2VdW3JdID0gewogICAgICAgICAgICAgICAgaXRlbTogYSwKICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogaQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgICAgIEIgPSBmdW5jdGlvbiBCKGUsIHIsIGksIGEsIG8sIHMpIHsKICAgICAgICAgICAgdmFyIGwsCiAgICAgICAgICAgICAgICBoID0gby5vY2N1cGllZCwKICAgICAgICAgICAgICAgIGYgPSBuLmRyYXdNYXNrOwogICAgICAgICAgICBmICYmIChsID0gdFswXS5nZXRDb250ZXh0KCIyZCIpLCBsLnNhdmUoKSwgbC5maWxsU3R5bGUgPSBuLm1hc2tDb2xvcik7CiAgICAgICAgICAgIHZhciBkOwoKICAgICAgICAgICAgaWYgKFMpIHsKICAgICAgICAgICAgICB2YXIgdiA9IG8uYm91bmRzOwogICAgICAgICAgICAgIGQgPSB7CiAgICAgICAgICAgICAgICB4OiAoZSArIHZbM10pICogcCwKICAgICAgICAgICAgICAgIHk6IChyICsgdlswXSkgKiBwLAogICAgICAgICAgICAgICAgdzogKHZbMV0gLSB2WzNdICsgMSkgKiBwLAogICAgICAgICAgICAgICAgaDogKHZbMl0gLSB2WzBdICsgMSkgKiBwCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgZyA9IGgubGVuZ3RoOyBnLS07KSB7CiAgICAgICAgICAgICAgdmFyIG0gPSBlICsgaFtnXVswXSwKICAgICAgICAgICAgICAgICAgeCA9IHIgKyBoW2ddWzFdOwogICAgICAgICAgICAgIG0gPj0gdSB8fCB4ID49IGMgfHwgbSA8IDAgfHwgeCA8IDAgfHwgUihtLCB4LCBmLCBkLCBzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZiAmJiBsLnJlc3RvcmUoKTsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgeiA9IGZ1bmN0aW9uIHoodCkgewogICAgICAgICAgICB2YXIgZSwgciwgaTsKICAgICAgICAgICAgQXJyYXkuaXNBcnJheSh0KSA/IChlID0gdFswXSwgciA9IHRbMV0pIDogKGUgPSB0LndvcmQsIHIgPSB0LndlaWdodCwgaSA9IHQuYXR0cmlidXRlcyk7CiAgICAgICAgICAgIHZhciBhID0gTygpLAogICAgICAgICAgICAgICAgbyA9IEQoZSwgciwgYSk7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuICExOwogICAgICAgICAgICBpZiAoQSgpKSByZXR1cm4gITE7CgogICAgICAgICAgICBpZiAoIW4uZHJhd091dE9mQm91bmQpIHsKICAgICAgICAgICAgICB2YXIgbCA9IG8uYm91bmRzOwogICAgICAgICAgICAgIGlmIChsWzFdIC0gbFszXSArIDEgPiB1IHx8IGxbMl0gLSBsWzBdICsgMSA+IGMpIHJldHVybiAhMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgaCA9IGQgKyAxOyBoLS07KSB7CiAgICAgICAgICAgICAgdmFyIGYgPSBJKGQgLSBoKTsKICAgICAgICAgICAgICBuLnNodWZmbGUgJiYgKGYgPSBbXS5jb25jYXQoZiksIHMoZikpOwoKICAgICAgICAgICAgICBmb3IgKHZhciB2ID0gMDsgdiA8IGYubGVuZ3RoOyB2KyspIHsKICAgICAgICAgICAgICAgIHZhciBnID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgdmFyIHMgPSBNYXRoLmZsb29yKG5bMF0gLSBvLmd3IC8gMiksCiAgICAgICAgICAgICAgICAgICAgICBsID0gTWF0aC5mbG9vcihuWzFdIC0gby5naCAvIDIpOwogICAgICAgICAgICAgICAgICBvLmd3LCBvLmdoOwogICAgICAgICAgICAgICAgICByZXR1cm4gISFMKHMsIGwsIDAsIDAsIG8ub2NjdXBpZWQpICYmIChGKHMsIGwsIG8sIGUsIHIsIGQgLSBoLCBuWzJdLCBhLCBpKSwgQihzLCBsLCAwLCAwLCBvLCB0KSwgewogICAgICAgICAgICAgICAgICAgIGd4OiBzLAogICAgICAgICAgICAgICAgICAgIGd5OiBsLAogICAgICAgICAgICAgICAgICAgIHJvdDogYSwKICAgICAgICAgICAgICAgICAgICBpbmZvOiBvCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfShmW3ZdKTsKCiAgICAgICAgICAgICAgICBpZiAoZykgcmV0dXJuIGc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgTiA9IGZ1bmN0aW9uIE4oZSwgciwgbikgewogICAgICAgICAgICBpZiAocikgcmV0dXJuICF0LnNvbWUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJDdXN0b21FdmVudCIpOwogICAgICAgICAgICAgIHJldHVybiBpLmluaXRDdXN0b21FdmVudChlLCAhMCwgciwgbiB8fCB7fSksICF0LmRpc3BhdGNoRXZlbnQoaSk7CiAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICB0LmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB2YXIgaSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJDdXN0b21FdmVudCIpOwogICAgICAgICAgICAgIGkuaW5pdEN1c3RvbUV2ZW50KGUsICEwLCByLCBuIHx8IHt9KSwgdC5kaXNwYXRjaEV2ZW50KGkpOwogICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgIH07CgogICAgICAgICAgIWZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0WzBdOwogICAgICAgICAgICBpZiAoZS5nZXRDb250ZXh0KSB1ID0gTWF0aC5jZWlsKGUud2lkdGggLyBwKSwgYyA9IE1hdGguY2VpbChlLmhlaWdodCAvIHApO2Vsc2UgewogICAgICAgICAgICAgIHZhciByID0gZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICB1ID0gTWF0aC5jZWlsKHIud2lkdGggLyBwKSwgYyA9IE1hdGguY2VpbChyLmhlaWdodCAvIHApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoTigid29yZGNsb3Vkc3RhcnQiLCAhMCkpIHsKICAgICAgICAgICAgICBmID0gbi5vcmlnaW4gPyBbbi5vcmlnaW5bMF0gLyBwLCBuLm9yaWdpblsxXSAvIHBdIDogW3UgLyAyLCBjIC8gMl0sIGQgPSBNYXRoLmZsb29yKE1hdGguc3FydCh1ICogdSArIGMgKiBjKSksIGggPSBbXTsKICAgICAgICAgICAgICB2YXIgaSwgYSwgbzsKICAgICAgICAgICAgICBpZiAoIWUuZ2V0Q29udGV4dCB8fCBuLmNsZWFyQ2FudmFzKSBmb3IgKHQuZm9yRWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgaWYgKHQuZ2V0Q29udGV4dCkgewogICAgICAgICAgICAgICAgICB2YXIgZSA9IHQuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICAgICAgICAgICAgZS5maWxsU3R5bGUgPSBuLmJhY2tncm91bmRDb2xvciwgZS5jbGVhclJlY3QoMCwgMCwgdSAqIChwICsgMSksIGMgKiAocCArIDEpKSwgZS5maWxsUmVjdCgwLCAwLCB1ICogKHAgKyAxKSwgYyAqIChwICsgMSkpOwogICAgICAgICAgICAgICAgfSBlbHNlIHQudGV4dENvbnRlbnQgPSAiIiwgdC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBuLmJhY2tncm91bmRDb2xvciwgdC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CiAgICAgICAgICAgICAgfSksIGkgPSB1OyBpLS07KSB7CiAgICAgICAgICAgICAgICBmb3IgKGhbaV0gPSBbXSwgYSA9IGM7IGEtLTspIHsKICAgICAgICAgICAgICAgICAgaFtpXVthXSA9ICEwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgICAgICAgICBzLmZpbGxTdHlsZSA9IG4uYmFja2dyb3VuZENvbG9yLCBzLmZpbGxSZWN0KDAsIDAsIDEsIDEpOwogICAgICAgICAgICAgICAgdmFyIGwgPSBzLmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKS5kYXRhLAogICAgICAgICAgICAgICAgICAgIGcgPSBlLmdldENvbnRleHQoIjJkIikuZ2V0SW1hZ2VEYXRhKDAsIDAsIHUgKiBwLCBjICogcCkuZGF0YTsKICAgICAgICAgICAgICAgIGkgPSB1OwoKICAgICAgICAgICAgICAgIGZvciAodmFyIG0sIHg7IGktLTspIHsKICAgICAgICAgICAgICAgICAgZm9yIChoW2ldID0gW10sIGEgPSBjOyBhLS07KSB7CiAgICAgICAgICAgICAgICAgICAgeCA9IHA7CgogICAgICAgICAgICAgICAgICAgIHQ6IGZvciAoOyB4LS07KSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKG0gPSBwOyBtLS07KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobyA9IDQ7IG8tLTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ1s0ICogKChhICogcCArIHgpICogdSAqIHAgKyAoaSAqIHAgKyBtKSkgKyBvXSAhPT0gbFtvXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaFtpXVthXSA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdDsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICExICE9PSBoW2ldW2FdICYmIChoW2ldW2FdID0gITApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZyA9IHMgPSBsID0gdm9pZCAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKG4uaG92ZXIgfHwgbi5jbGljaykgewogICAgICAgICAgICAgICAgZm9yIChTID0gITAsIGkgPSB1ICsgMTsgaS0tOykgewogICAgICAgICAgICAgICAgICBNW2ldID0gW107CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbi5ob3ZlciAmJiBlLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGspLCBuLmNsaWNrICYmIChlLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgQyksIGUuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsIEMpLCBlLmFkZEV2ZW50TGlzdGVuZXIoInRvdWNoZW5kIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgdC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSksIGUuc3R5bGUud2Via2l0VGFwSGlnaGxpZ2h0Q29sb3IgPSAicmdiYSgwLCAwLCAwLCAwKSIpLCBlLmFkZEV2ZW50TGlzdGVuZXIoIndvcmRjbG91ZHN0YXJ0IiwgZnVuY3Rpb24gdCgpIHsKICAgICAgICAgICAgICAgICAgZS5yZW1vdmVFdmVudExpc3RlbmVyKCJ3b3JkY2xvdWRzdGFydCIsIHQpLCBlLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGspLCBlLnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgQyksIGIgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG8gPSAwOwogICAgICAgICAgICAgIHZhciB5LCB3OwogICAgICAgICAgICAgIDAgIT09IG4ud2FpdCA/ICh5ID0gd2luZG93LnNldFRpbWVvdXQsIHcgPSB3aW5kb3cuY2xlYXJUaW1lb3V0KSA6ICh5ID0gd2luZG93LnNldEltbWVkaWF0ZSwgdyA9IHdpbmRvdy5jbGVhckltbWVkaWF0ZSk7CgogICAgICAgICAgICAgIHZhciBfID0gZnVuY3Rpb24gXyhlLCByKSB7CiAgICAgICAgICAgICAgICB0LmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgdC5yZW1vdmVFdmVudExpc3RlbmVyKGUsIHIpOwogICAgICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgVCA9IGZ1bmN0aW9uIHQoKSB7CiAgICAgICAgICAgICAgICBfKCJ3b3JkY2xvdWRzdGFydCIsIHQpLCB3KFApOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICFmdW5jdGlvbiAoZSwgcikgewogICAgICAgICAgICAgICAgdC5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIHQuYWRkRXZlbnRMaXN0ZW5lcihlLCByKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICAgIH0oIndvcmRjbG91ZHN0YXJ0IiwgVCk7CiAgICAgICAgICAgICAgdmFyIFAgPSB5KGZ1bmN0aW9uIHQoKSB7CiAgICAgICAgICAgICAgICBpZiAobyA+PSBuLmxpc3QubGVuZ3RoKSByZXR1cm4gdyhQKSwgTigid29yZGNsb3Vkc3RvcCIsICExKSwgdm9pZCBfKCJ3b3JkY2xvdWRzdGFydCIsIFQpOwogICAgICAgICAgICAgICAgdiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgdmFyIGUgPSB6KG4ubGlzdFtvXSksCiAgICAgICAgICAgICAgICAgICAgciA9ICFOKCJ3b3JkY2xvdWRkcmF3biIsICEwLCB7CiAgICAgICAgICAgICAgICAgIGl0ZW06IG4ubGlzdFtvXSwKICAgICAgICAgICAgICAgICAgZHJhd246IGUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKEEoKSB8fCByKSByZXR1cm4gdyhQKSwgbi5hYm9ydCgpLCBOKCJ3b3JkY2xvdWRhYm9ydCIsICExKSwgTigid29yZGNsb3Vkc3RvcCIsICExKSwgdm9pZCBfKCJ3b3JkY2xvdWRzdGFydCIsIFQpOwogICAgICAgICAgICAgICAgbysrLCBQID0geSh0LCBuLndhaXQpOwogICAgICAgICAgICAgIH0sIG4ud2FpdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0oKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBsLmlzU3VwcG9ydGVkID0gYSwgbC5taW5Gb250U2l6ZSA9IG8sIG4gPSBbXSwgdm9pZCAwICE9PSAoaSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbDsKICAgICAgfS5hcHBseShlLCBuKSkgJiYgKHQuZXhwb3J0cyA9IGkpOwogICAgfSgpOwogIH1dKTsKfSk7"},null]}